
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://tang-jiapeng.github.io/core/csapp/ch3/">
      
      
        <link rel="prev" href="../ch2/">
      
      
        <link rel="next" href="../ch4/">
      
      
      <link rel="icon" href="../../../logo.ico">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>Chapter3ï¼šç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º - 0X10CC's notes</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Serif SC";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/timeago.css">
    
      <link rel="stylesheet" href="../../../from_oi_wiki/css/extra.css?v=13">
    
      <link rel="stylesheet" href="../../../css/status.css">
    
      <link rel="stylesheet" href="../../../css/neoteroi-mkdocs.css">
    
      <link rel="stylesheet" href="../../../termynal.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-JT9BRCXKJJ"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-JT9BRCXKJJ",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-JT9BRCXKJJ",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º" class="md-skip">
          è·³è½¬è‡³
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="é¡µçœ‰">
    <a href="../../.." title="0X10CC&#39;s notes" class="md-header__button md-logo" aria-label="0X10CC's notes" data-md-component="logo">
      
  <img src="../../../logo.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            0X10CC's notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter3ï¼šç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="æœç´¢" placeholder="æœç´¢" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="æŸ¥æ‰¾">
        
        <button type="reset" class="md-search__icon md-icon" title="æ¸…ç©ºå½“å‰å†…å®¹" aria-label="æ¸…ç©ºå½“å‰å†…å®¹" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            æ­£åœ¨åˆå§‹åŒ–æœç´¢å¼•æ“
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/tang-jiapeng/tang-jiapeng.github.io" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    tang-jiapeng.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="æ ‡ç­¾" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
    
  
  ğŸ¡ Home

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../langs/" class="md-tabs__link">
          
  
    
  
  Langs

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  Core

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../tools/" class="md-tabs__link">
          
  
    
  
  Tools

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../life/" class="md-tabs__link">
          
  
    
  
  Life

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="å¯¼èˆªæ " data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="0X10CC&#39;s notes" class="md-nav__button md-logo" aria-label="0X10CC's notes" data-md-component="logo">
      
  <img src="../../../logo.ico" alt="logo">

    </a>
    0X10CC's notes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/tang-jiapeng/tang-jiapeng.github.io" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    tang-jiapeng.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../.." class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    ğŸ¡ Home
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            ğŸ¡ Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../langs/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Langs
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Langs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    C++é›¶ç¢æ‚è®°
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            C++é›¶ç¢æ‚è®°
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/%E9%A1%B6%E5%B1%82const%E4%B8%8E%E5%BA%95%E5%B1%82const/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    é¡¶å±‚constä¸åº•å±‚const
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/%E5%80%BC%E7%B1%BB%E5%9E%8B%E4%B8%8E%E5%8F%B3%E5%80%BC%E5%BC%95%E7%94%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    å€¼ç±»å‹ä¸å³å€¼å¼•ç”¨
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/%E6%95%B0%E7%BB%84%E6%8C%87%E9%92%88%E4%B8%8E%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    æ•°ç»„æŒ‡é’ˆä¸å‡½æ•°æŒ‡é’ˆ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/C%2B%2B%E7%B1%BB%E5%AF%B9%E8%B1%A1%E5%B8%83%E5%B1%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++ç±»å¯¹è±¡å¸ƒå±€
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/C%2B%2B%E4%B8%AD%E7%9A%84%E5%A4%9A%E6%80%81%E4%B8%8ERTTI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++ä¸­çš„å¤šæ€ä¸RTTI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Effective Modern C++
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Effective Modern C++
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item1ï¼šç†è§£æ¨¡æ¿ç±»å‹æ¨å¯¼
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item2ï¼šç†è§£autoç±»å‹æ¨å¯¼
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item3ï¼šç†è§£decltype
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item7ï¼šåŒºåˆ«ä½¿ç”¨()å’Œ{}åˆ›å»ºå¯¹è±¡
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item9ï¼šä¼˜å…ˆè€ƒè™‘åˆ«åå£°æ˜è€Œétypedef
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item23/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item23ï¼šç†è§£std::moveå’Œstd::forward
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Core
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CMU15-213ï¼šCSAPP
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            CMU15-213ï¼šCSAPP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter1ï¼šè®¡ç®—æœºç³»ç»Ÿæ¼«æ¸¸
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter2ï¼šä¿¡æ¯çš„è¡¨ç¤ºå’Œå¤„ç†
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Chapter3ï¼šç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Chapter3ï¼šç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="ç›®å½•">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intel-å¤„ç†å™¨å†å²" class="md-nav__link">
    <span class="md-ellipsis">
      Intel å¤„ç†å™¨å†å²
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ç¨‹åºç¼–ç " class="md-nav__link">
    <span class="md-ellipsis">
      ç¨‹åºç¼–ç 
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ç¨‹åºç¼–ç ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#æœºå™¨çº§ä»£ç " class="md-nav__link">
    <span class="md-ellipsis">
      æœºå™¨çº§ä»£ç 
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä»£ç ç¤ºä¾‹" class="md-nav__link">
    <span class="md-ellipsis">
      ä»£ç ç¤ºä¾‹
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#æ•°æ®æ ¼å¼" class="md-nav__link">
    <span class="md-ellipsis">
      æ•°æ®æ ¼å¼
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#è®¿é—®ä¿¡æ¯" class="md-nav__link">
    <span class="md-ellipsis">
      è®¿é—®ä¿¡æ¯
    </span>
  </a>
  
    <nav class="md-nav" aria-label="è®¿é—®ä¿¡æ¯">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#æ“ä½œæ•°" class="md-nav__link">
    <span class="md-ellipsis">
      æ“ä½œæ•°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ•°æ®ç§»åŠ¨æŒ‡ä»¤" class="md-nav__link">
    <span class="md-ellipsis">
      æ•°æ®ç§»åŠ¨æŒ‡ä»¤
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ç®—æœ¯å’Œé€»è¾‘æ“ä½œ" class="md-nav__link">
    <span class="md-ellipsis">
      ç®—æœ¯å’Œé€»è¾‘æ“ä½œ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ç®—æœ¯å’Œé€»è¾‘æ“ä½œ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#åŠ è½½æœ‰æ•ˆåœ°å€" class="md-nav__link">
    <span class="md-ellipsis">
      åŠ è½½æœ‰æ•ˆåœ°å€
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä¸€å…ƒå’ŒäºŒå…ƒæ“ä½œ" class="md-nav__link">
    <span class="md-ellipsis">
      ä¸€å…ƒå’ŒäºŒå…ƒæ“ä½œ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ç§»ä½æ“ä½œ" class="md-nav__link">
    <span class="md-ellipsis">
      ç§»ä½æ“ä½œ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ç‰¹æ®Šç®—æ•°æ“ä½œ" class="md-nav__link">
    <span class="md-ellipsis">
      ç‰¹æ®Šç®—æ•°æ“ä½œ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#æ§åˆ¶" class="md-nav__link">
    <span class="md-ellipsis">
      æ§åˆ¶
    </span>
  </a>
  
    <nav class="md-nav" aria-label="æ§åˆ¶">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#æ¡ä»¶ç " class="md-nav__link">
    <span class="md-ellipsis">
      æ¡ä»¶ç 
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#è·³è½¬æŒ‡ä»¤" class="md-nav__link">
    <span class="md-ellipsis">
      è·³è½¬æŒ‡ä»¤
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä½¿ç”¨æ¡ä»¶æ§åˆ¶å®ç°æ¡ä»¶åˆ†æ”¯" class="md-nav__link">
    <span class="md-ellipsis">
      ä½¿ç”¨æ¡ä»¶æ§åˆ¶å®ç°æ¡ä»¶åˆ†æ”¯
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä½¿ç”¨æ¡ä»¶ç§»åŠ¨å®ç°æ¡ä»¶åˆ†æ”¯" class="md-nav__link">
    <span class="md-ellipsis">
      ä½¿ç”¨æ¡ä»¶ç§»åŠ¨å®ç°æ¡ä»¶åˆ†æ”¯
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¾ªç¯" class="md-nav__link">
    <span class="md-ellipsis">
      å¾ªç¯
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å¾ªç¯">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#do-while" class="md-nav__link">
    <span class="md-ellipsis">
      Do-While
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#while" class="md-nav__link">
    <span class="md-ellipsis">
      While
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for" class="md-nav__link">
    <span class="md-ellipsis">
      For
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#switch" class="md-nav__link">
    <span class="md-ellipsis">
      Switch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#è¿‡ç¨‹" class="md-nav__link">
    <span class="md-ellipsis">
      è¿‡ç¨‹
    </span>
  </a>
  
    <nav class="md-nav" aria-label="è¿‡ç¨‹">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#è¿è¡Œæ—¶æ ˆ" class="md-nav__link">
    <span class="md-ellipsis">
      è¿è¡Œæ—¶æ ˆ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä¼ é€’æ§åˆ¶" class="md-nav__link">
    <span class="md-ellipsis">
      ä¼ é€’æ§åˆ¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä¼ é€’å‚æ•°" class="md-nav__link">
    <span class="md-ellipsis">
      ä¼ é€’å‚æ•°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å±€éƒ¨å˜é‡" class="md-nav__link">
    <span class="md-ellipsis">
      å±€éƒ¨å˜é‡
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#è¢«ä¿å­˜çš„å¯„å­˜å™¨" class="md-nav__link">
    <span class="md-ellipsis">
      è¢«ä¿å­˜çš„å¯„å­˜å™¨
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#é€’å½’" class="md-nav__link">
    <span class="md-ellipsis">
      é€’å½’
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#æ•°ç»„" class="md-nav__link">
    <span class="md-ellipsis">
      æ•°ç»„
    </span>
  </a>
  
    <nav class="md-nav" aria-label="æ•°ç»„">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#å¤šç»´æ•°ç»„" class="md-nav__link">
    <span class="md-ellipsis">
      å¤šç»´æ•°ç»„
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å®šé•¿æ•°ç»„" class="md-nav__link">
    <span class="md-ellipsis">
      å®šé•¿æ•°ç»„
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å˜é•¿æ•°ç»„" class="md-nav__link">
    <span class="md-ellipsis">
      å˜é•¿æ•°ç»„
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#å¼‚æ„æ•°æ®ç»“æ„" class="md-nav__link">
    <span class="md-ellipsis">
      å¼‚æ„æ•°æ®ç»“æ„
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å¼‚æ„æ•°æ®ç»“æ„">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ç»“æ„ä½“" class="md-nav__link">
    <span class="md-ellipsis">
      ç»“æ„ä½“
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#è”åˆä½“" class="md-nav__link">
    <span class="md-ellipsis">
      è”åˆä½“
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ•°æ®å¯¹é½" class="md-nav__link">
    <span class="md-ellipsis">
      æ•°æ®å¯¹é½
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#æœºå™¨çº§ä»£ç ä¸­æ§åˆ¶å’Œæ•°æ®çš„ç»„åˆ" class="md-nav__link">
    <span class="md-ellipsis">
      æœºå™¨çº§ä»£ç ä¸­æ§åˆ¶å’Œæ•°æ®çš„ç»„åˆ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="æœºå™¨çº§ä»£ç ä¸­æ§åˆ¶å’Œæ•°æ®çš„ç»„åˆ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ç†è§£æŒ‡é’ˆ" class="md-nav__link">
    <span class="md-ellipsis">
      ç†è§£æŒ‡é’ˆ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å†…å­˜å¼•ç”¨è¶Šç•Œå’Œç¼“å†²åŒºæº¢å‡º" class="md-nav__link">
    <span class="md-ellipsis">
      å†…å­˜å¼•ç”¨è¶Šç•Œå’Œç¼“å†²åŒºæº¢å‡º
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#é˜»æ­¢ç¼“å†²åŒºæº¢å‡ºæ”»å‡»" class="md-nav__link">
    <span class="md-ellipsis">
      é˜»æ­¢ç¼“å†²åŒºæº¢å‡ºæ”»å‡»
    </span>
  </a>
  
    <nav class="md-nav" aria-label="é˜»æ­¢ç¼“å†²åŒºæº¢å‡ºæ”»å‡»">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#éšæœºåŒ–æ ˆ" class="md-nav__link">
    <span class="md-ellipsis">
      éšæœºåŒ–æ ˆ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ ˆæŸåæ£€æµ‹" class="md-nav__link">
    <span class="md-ellipsis">
      æ ˆæŸåæ£€æµ‹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#é™åˆ¶å¯æ‰§è¡Œä»£ç åŒºåŸŸ" class="md-nav__link">
    <span class="md-ellipsis">
      é™åˆ¶å¯æ‰§è¡Œä»£ç åŒºåŸŸ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ”¯æŒå¯å˜å¤§å°çš„æ ˆå¸§" class="md-nav__link">
    <span class="md-ellipsis">
      æ”¯æŒå¯å˜å¤§å°çš„æ ˆå¸§
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#æµ®ç‚¹ä»£ç " class="md-nav__link">
    <span class="md-ellipsis">
      æµ®ç‚¹ä»£ç 
    </span>
  </a>
  
    <nav class="md-nav" aria-label="æµ®ç‚¹ä»£ç ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#æµ®ç‚¹æ•°çš„ç§»åŠ¨å’Œè½¬æ¢æ“ä½œ" class="md-nav__link">
    <span class="md-ellipsis">
      æµ®ç‚¹æ•°çš„ç§»åŠ¨å’Œè½¬æ¢æ“ä½œ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#è¿‡ç¨‹ä¸­çš„æµ®ç‚¹ä»£ç " class="md-nav__link">
    <span class="md-ellipsis">
      è¿‡ç¨‹ä¸­çš„æµ®ç‚¹ä»£ç 
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æµ®ç‚¹æ•°çš„ç®—æ•°æ“ä½œ" class="md-nav__link">
    <span class="md-ellipsis">
      æµ®ç‚¹æ•°çš„ç®—æ•°æ“ä½œ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æµ®ç‚¹å¸¸é‡çš„å®šä¹‰å’Œä½¿ç”¨" class="md-nav__link">
    <span class="md-ellipsis">
      æµ®ç‚¹å¸¸é‡çš„å®šä¹‰å’Œä½¿ç”¨
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æµ®ç‚¹ä»£ç ä¸­çš„ä½çº§è¿ç®—" class="md-nav__link">
    <span class="md-ellipsis">
      æµ®ç‚¹ä»£ç ä¸­çš„ä½çº§è¿ç®—
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æµ®ç‚¹æ•°çš„æ¯”è¾ƒæ“ä½œ" class="md-nav__link">
    <span class="md-ellipsis">
      æµ®ç‚¹æ•°çš„æ¯”è¾ƒæ“ä½œ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter4ï¼šå¤„ç†å™¨ä½“ç³»ç»“æ„
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter5ï¼šä¼˜åŒ–ç¨‹åºæ€§èƒ½
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter6ï¼šå­˜å‚¨å™¨å±‚æ¬¡ç»“æ„
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter7ï¼šé“¾æ¥
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter8ï¼šå¼‚å¸¸æ§åˆ¶æµ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter9ï¼šè™šæ‹Ÿå†…å­˜
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter10ï¼šç³»ç»Ÿçº§I/O
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter11ï¼šç½‘ç»œç¼–ç¨‹
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter12ï¼šå¹¶å‘ç¼–ç¨‹
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CMU10-714ï¼šDeep Learning Systems
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            CMU10-714ï¼šDeep Learning Systems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture2ï¼šML Refresher / Softmax Regression
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture3ï¼šManual Neural Networks / Backprop
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture4ï¼šAutomatic Differentiation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture5ï¼šAutomatic Differentiation Implementation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture6ï¼šOptimization
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../tools/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Tools
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../life/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Life
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Life
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="ç›®å½•">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intel-å¤„ç†å™¨å†å²" class="md-nav__link">
    <span class="md-ellipsis">
      Intel å¤„ç†å™¨å†å²
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ç¨‹åºç¼–ç " class="md-nav__link">
    <span class="md-ellipsis">
      ç¨‹åºç¼–ç 
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ç¨‹åºç¼–ç ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#æœºå™¨çº§ä»£ç " class="md-nav__link">
    <span class="md-ellipsis">
      æœºå™¨çº§ä»£ç 
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä»£ç ç¤ºä¾‹" class="md-nav__link">
    <span class="md-ellipsis">
      ä»£ç ç¤ºä¾‹
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#æ•°æ®æ ¼å¼" class="md-nav__link">
    <span class="md-ellipsis">
      æ•°æ®æ ¼å¼
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#è®¿é—®ä¿¡æ¯" class="md-nav__link">
    <span class="md-ellipsis">
      è®¿é—®ä¿¡æ¯
    </span>
  </a>
  
    <nav class="md-nav" aria-label="è®¿é—®ä¿¡æ¯">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#æ“ä½œæ•°" class="md-nav__link">
    <span class="md-ellipsis">
      æ“ä½œæ•°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ•°æ®ç§»åŠ¨æŒ‡ä»¤" class="md-nav__link">
    <span class="md-ellipsis">
      æ•°æ®ç§»åŠ¨æŒ‡ä»¤
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ç®—æœ¯å’Œé€»è¾‘æ“ä½œ" class="md-nav__link">
    <span class="md-ellipsis">
      ç®—æœ¯å’Œé€»è¾‘æ“ä½œ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ç®—æœ¯å’Œé€»è¾‘æ“ä½œ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#åŠ è½½æœ‰æ•ˆåœ°å€" class="md-nav__link">
    <span class="md-ellipsis">
      åŠ è½½æœ‰æ•ˆåœ°å€
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä¸€å…ƒå’ŒäºŒå…ƒæ“ä½œ" class="md-nav__link">
    <span class="md-ellipsis">
      ä¸€å…ƒå’ŒäºŒå…ƒæ“ä½œ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ç§»ä½æ“ä½œ" class="md-nav__link">
    <span class="md-ellipsis">
      ç§»ä½æ“ä½œ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ç‰¹æ®Šç®—æ•°æ“ä½œ" class="md-nav__link">
    <span class="md-ellipsis">
      ç‰¹æ®Šç®—æ•°æ“ä½œ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#æ§åˆ¶" class="md-nav__link">
    <span class="md-ellipsis">
      æ§åˆ¶
    </span>
  </a>
  
    <nav class="md-nav" aria-label="æ§åˆ¶">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#æ¡ä»¶ç " class="md-nav__link">
    <span class="md-ellipsis">
      æ¡ä»¶ç 
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#è·³è½¬æŒ‡ä»¤" class="md-nav__link">
    <span class="md-ellipsis">
      è·³è½¬æŒ‡ä»¤
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä½¿ç”¨æ¡ä»¶æ§åˆ¶å®ç°æ¡ä»¶åˆ†æ”¯" class="md-nav__link">
    <span class="md-ellipsis">
      ä½¿ç”¨æ¡ä»¶æ§åˆ¶å®ç°æ¡ä»¶åˆ†æ”¯
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä½¿ç”¨æ¡ä»¶ç§»åŠ¨å®ç°æ¡ä»¶åˆ†æ”¯" class="md-nav__link">
    <span class="md-ellipsis">
      ä½¿ç”¨æ¡ä»¶ç§»åŠ¨å®ç°æ¡ä»¶åˆ†æ”¯
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¾ªç¯" class="md-nav__link">
    <span class="md-ellipsis">
      å¾ªç¯
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å¾ªç¯">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#do-while" class="md-nav__link">
    <span class="md-ellipsis">
      Do-While
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#while" class="md-nav__link">
    <span class="md-ellipsis">
      While
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for" class="md-nav__link">
    <span class="md-ellipsis">
      For
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#switch" class="md-nav__link">
    <span class="md-ellipsis">
      Switch
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#è¿‡ç¨‹" class="md-nav__link">
    <span class="md-ellipsis">
      è¿‡ç¨‹
    </span>
  </a>
  
    <nav class="md-nav" aria-label="è¿‡ç¨‹">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#è¿è¡Œæ—¶æ ˆ" class="md-nav__link">
    <span class="md-ellipsis">
      è¿è¡Œæ—¶æ ˆ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä¼ é€’æ§åˆ¶" class="md-nav__link">
    <span class="md-ellipsis">
      ä¼ é€’æ§åˆ¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä¼ é€’å‚æ•°" class="md-nav__link">
    <span class="md-ellipsis">
      ä¼ é€’å‚æ•°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å±€éƒ¨å˜é‡" class="md-nav__link">
    <span class="md-ellipsis">
      å±€éƒ¨å˜é‡
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#è¢«ä¿å­˜çš„å¯„å­˜å™¨" class="md-nav__link">
    <span class="md-ellipsis">
      è¢«ä¿å­˜çš„å¯„å­˜å™¨
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#é€’å½’" class="md-nav__link">
    <span class="md-ellipsis">
      é€’å½’
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#æ•°ç»„" class="md-nav__link">
    <span class="md-ellipsis">
      æ•°ç»„
    </span>
  </a>
  
    <nav class="md-nav" aria-label="æ•°ç»„">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#å¤šç»´æ•°ç»„" class="md-nav__link">
    <span class="md-ellipsis">
      å¤šç»´æ•°ç»„
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å®šé•¿æ•°ç»„" class="md-nav__link">
    <span class="md-ellipsis">
      å®šé•¿æ•°ç»„
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å˜é•¿æ•°ç»„" class="md-nav__link">
    <span class="md-ellipsis">
      å˜é•¿æ•°ç»„
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#å¼‚æ„æ•°æ®ç»“æ„" class="md-nav__link">
    <span class="md-ellipsis">
      å¼‚æ„æ•°æ®ç»“æ„
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å¼‚æ„æ•°æ®ç»“æ„">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ç»“æ„ä½“" class="md-nav__link">
    <span class="md-ellipsis">
      ç»“æ„ä½“
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#è”åˆä½“" class="md-nav__link">
    <span class="md-ellipsis">
      è”åˆä½“
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ•°æ®å¯¹é½" class="md-nav__link">
    <span class="md-ellipsis">
      æ•°æ®å¯¹é½
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#æœºå™¨çº§ä»£ç ä¸­æ§åˆ¶å’Œæ•°æ®çš„ç»„åˆ" class="md-nav__link">
    <span class="md-ellipsis">
      æœºå™¨çº§ä»£ç ä¸­æ§åˆ¶å’Œæ•°æ®çš„ç»„åˆ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="æœºå™¨çº§ä»£ç ä¸­æ§åˆ¶å’Œæ•°æ®çš„ç»„åˆ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ç†è§£æŒ‡é’ˆ" class="md-nav__link">
    <span class="md-ellipsis">
      ç†è§£æŒ‡é’ˆ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å†…å­˜å¼•ç”¨è¶Šç•Œå’Œç¼“å†²åŒºæº¢å‡º" class="md-nav__link">
    <span class="md-ellipsis">
      å†…å­˜å¼•ç”¨è¶Šç•Œå’Œç¼“å†²åŒºæº¢å‡º
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#é˜»æ­¢ç¼“å†²åŒºæº¢å‡ºæ”»å‡»" class="md-nav__link">
    <span class="md-ellipsis">
      é˜»æ­¢ç¼“å†²åŒºæº¢å‡ºæ”»å‡»
    </span>
  </a>
  
    <nav class="md-nav" aria-label="é˜»æ­¢ç¼“å†²åŒºæº¢å‡ºæ”»å‡»">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#éšæœºåŒ–æ ˆ" class="md-nav__link">
    <span class="md-ellipsis">
      éšæœºåŒ–æ ˆ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ ˆæŸåæ£€æµ‹" class="md-nav__link">
    <span class="md-ellipsis">
      æ ˆæŸåæ£€æµ‹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#é™åˆ¶å¯æ‰§è¡Œä»£ç åŒºåŸŸ" class="md-nav__link">
    <span class="md-ellipsis">
      é™åˆ¶å¯æ‰§è¡Œä»£ç åŒºåŸŸ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ”¯æŒå¯å˜å¤§å°çš„æ ˆå¸§" class="md-nav__link">
    <span class="md-ellipsis">
      æ”¯æŒå¯å˜å¤§å°çš„æ ˆå¸§
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#æµ®ç‚¹ä»£ç " class="md-nav__link">
    <span class="md-ellipsis">
      æµ®ç‚¹ä»£ç 
    </span>
  </a>
  
    <nav class="md-nav" aria-label="æµ®ç‚¹ä»£ç ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#æµ®ç‚¹æ•°çš„ç§»åŠ¨å’Œè½¬æ¢æ“ä½œ" class="md-nav__link">
    <span class="md-ellipsis">
      æµ®ç‚¹æ•°çš„ç§»åŠ¨å’Œè½¬æ¢æ“ä½œ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#è¿‡ç¨‹ä¸­çš„æµ®ç‚¹ä»£ç " class="md-nav__link">
    <span class="md-ellipsis">
      è¿‡ç¨‹ä¸­çš„æµ®ç‚¹ä»£ç 
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æµ®ç‚¹æ•°çš„ç®—æ•°æ“ä½œ" class="md-nav__link">
    <span class="md-ellipsis">
      æµ®ç‚¹æ•°çš„ç®—æ•°æ“ä½œ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æµ®ç‚¹å¸¸é‡çš„å®šä¹‰å’Œä½¿ç”¨" class="md-nav__link">
    <span class="md-ellipsis">
      æµ®ç‚¹å¸¸é‡çš„å®šä¹‰å’Œä½¿ç”¨
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æµ®ç‚¹ä»£ç ä¸­çš„ä½çº§è¿ç®—" class="md-nav__link">
    <span class="md-ellipsis">
      æµ®ç‚¹ä»£ç ä¸­çš„ä½çº§è¿ç®—
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æµ®ç‚¹æ•°çš„æ¯”è¾ƒæ“ä½œ" class="md-nav__link">
    <span class="md-ellipsis">
      æµ®ç‚¹æ•°çš„æ¯”è¾ƒæ“ä½œ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º">ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º<a class="headerlink" href="#ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º" title="Permanent link">&para;</a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8V2m6.78 1a.69.69 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38-2.5-2.5Z"/></svg></span> çº¦ 14045 ä¸ªå­— <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6zm80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3z"/></svg></span> 502 è¡Œä»£ç  <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3L12.5 13Z"/></svg></span> é¢„è®¡é˜…è¯»æ—¶é—´ 53 åˆ†é’Ÿ</p>
</div>
<p>åœ¨ä½¿ç”¨é«˜çº§è¯­è¨€ï¼Œå¦‚ Cã€Java ç¼–ç¨‹æ—¶ï¼Œæˆ‘ä»¬æ— æ³•äº†è§£ç¨‹åºåœ¨æœºå™¨çº§åˆ«çš„å®ç°ã€‚è€Œä½¿ç”¨æ±‡ç¼–è¯­è¨€ç¼–å†™ç¨‹åºæ—¶ï¼Œç¨‹åºå‘˜åˆ™åªèƒ½å¼•ç”¨ä½çº§æŒ‡ä»¤ã€‚ç”±é«˜çº§è¯­è¨€ç¼–å†™çš„ç¨‹åºå¯ä»¥åœ¨å¤šç§ä¸åŒçš„æœºå™¨ä¸Šç¼–è¯‘è¿è¡Œï¼Œè€Œæ±‡ç¼–è¯­è¨€åˆ™ä¸æœºå™¨ç‰¹æ€§é«˜åº¦ç›¸å…³ã€‚</p>
<p>å°½ç®¡ç¼–è¯‘å™¨å®Œæˆäº†ç”Ÿæˆæ±‡ç¼–ä»£ç çš„å¤§éƒ¨åˆ†å·¥ä½œï¼Œä½†é˜…è¯»å’Œç†è§£æ±‡ç¼–è¯­è¨€å¯¹äºç¨‹åºå‘˜æ¥è¯´ä»æ˜¯ä¸€é¡¹é‡è¦çš„æŠ€èƒ½ï¼š</p>
<blockquote>
<p>Those who say "I understand the general principles, I don't want to bother learning the details" are deluding themselves.</p>
</blockquote>
<h2 id="intel-å¤„ç†å™¨å†å²">Intel å¤„ç†å™¨å†å²<a class="headerlink" href="#intel-å¤„ç†å™¨å†å²" title="Permanent link">&para;</a></h2>
<p><img alt="alt text" src="../image/image.png" /></p>
<h2 id="ç¨‹åºç¼–ç ">ç¨‹åºç¼–ç <a class="headerlink" href="#ç¨‹åºç¼–ç " title="Permanent link">&para;</a></h2>
<h3 id="æœºå™¨çº§ä»£ç ">æœºå™¨çº§ä»£ç <a class="headerlink" href="#æœºå™¨çº§ä»£ç " title="Permanent link">&para;</a></h3>
<p>æœºå™¨çº§ç¨‹åºçš„æ ¼å¼å’Œè¡Œä¸ºæ˜¯ç”±æŒ‡ä»¤é›†æ¶æ„ï¼ˆInstruction Set Architectureï¼ŒISAï¼‰å®šä¹‰çš„ï¼Œå®ƒåŒ…æ‹¬å¤„ç†å™¨çŠ¶æ€ã€æŒ‡ä»¤æ ¼å¼ä»¥åŠæ¯æ¡æŒ‡ä»¤å¯¹çŠ¶æ€çš„å½±å“ã€‚å¤§å¤šæ•° ISAï¼ŒåŒ…æ‹¬ x86-64ï¼Œéƒ½å°†ç¨‹åºçš„è¡Œä¸ºæè¿°ä¸ºæ¯æ¡æŒ‡ä»¤æŒ‰é¡ºåºæ‰§è¡Œï¼Œä¸”ä¸€æ¡æŒ‡ä»¤åœ¨ä¸‹ä¸€æ¡æŒ‡ä»¤å¼€å§‹ä¹‹å‰å®Œæˆã€‚è™½ç„¶å¤„ç†å™¨ç¡¬ä»¶å¯ä»¥åŒæ—¶æ‰§è¡Œè®¸å¤šæŒ‡ä»¤ï¼Œä½†å®ƒé‡‡ç”¨äº†å®‰å…¨æªæ–½ä»¥ç¡®ä¿å…¶æ•´ä½“è¡Œä¸ºä¸ ISA è§„å®šçš„æ“ä½œé¡ºåºç›¸åŒ¹é…ã€‚</p>
<p>æ±‡ç¼–ä»£ç éå¸¸æ¥è¿‘äºŒè¿›åˆ¶æ ¼å¼çš„æœºå™¨ä»£ç ï¼Œä½†å…¶æ–‡æœ¬æ ¼å¼æ›´å…·å¯è¯»æ€§ã€‚ä¸€äº›å¯¹ç¨‹åºå‘˜éšè—çš„å¤„ç†å™¨çŠ¶æ€åœ¨æ±‡ç¼–ä»£ç ä¸­æ˜¯å¯è§çš„ï¼š</p>
<ul>
<li>ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰ï¼šåœ¨ x86-64 ä¸­è¢«ç§°ä¸º %ripï¼Œä»£è¡¨å³å°†æ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤åœ¨å­˜å‚¨å™¨ä¸­çš„åœ°å€ï¼›</li>
<li>æ•´æ•°å¯„å­˜å™¨æ–‡ä»¶ï¼ˆRegister Fileï¼‰ï¼šæœ€å¤šå¯ä»¥å­˜å‚¨ 64 ä½çš„åœ°å€ï¼ˆä¸ C ä¸­çš„æŒ‡é’ˆå¯¹åº”ï¼‰æˆ–æ•´æ•°æ•°æ®ã€‚ä¸€äº›å¯„å­˜å™¨ç”¨äºè®°å½•ç¨‹åºçŠ¶æ€çš„å…³é”®éƒ¨åˆ†ï¼Œè€Œå…¶ä»–å¯„å­˜å™¨åˆ™ç”¨äºä¿å­˜ä¸´æ—¶æ•°æ®ï¼Œä¾‹å¦‚ <strong>è¿‡ç¨‹</strong> ä¸­çš„å‚æ•°å’Œå±€éƒ¨å˜é‡ä»¥åŠå‡½æ•°è¿”å›å€¼ï¼›</li>
<li>æ¡ä»¶ç å¯„å­˜å™¨ï¼ˆCondition Code Registersï¼‰ï¼šä¿å­˜äº†æœ€è¿‘ä¸€æ¬¡æ‰§è¡Œçš„ç®—æœ¯æˆ–é€»è¾‘æŒ‡ä»¤çš„çŠ¶æ€ä¿¡æ¯ï¼Œç”¨äºå®ç°æ§åˆ¶æµæˆ–æ•°æ®æµä¸­æ¡ä»¶çš„æ”¹å˜ï¼Œä¾‹å¦‚ If è¯­å¥å’Œ While è¯­å¥ï¼›</li>
<li>å‘é‡å¯„å­˜å™¨ï¼ˆVector Registersï¼‰ï¼šæ¯ä¸ªéƒ½å¯ä»¥ä¿å­˜ä¸€ä¸ªæˆ–å¤šä¸ªæ•´æ•°æˆ–æµ®ç‚¹æ•°å€¼ã€‚</li>
</ul>
<p>è™½ç„¶ C æä¾›äº†ä¸€ä¸ªæ¨¡å‹ï¼Œè®©æˆ‘ä»¬å¯ä»¥åœ¨å†…å­˜ä¸­å£°æ˜å’Œåˆ†é…ä¸åŒæ•°æ®ç±»å‹çš„å¯¹è±¡ã€‚ä½†æœºå™¨çº§ä»£ç åªä¼šç®€å•åœ°å°†å†…å­˜è§†ä¸ºä¸€ä¸ªæŒ‰å­—èŠ‚å¯»å€çš„æ•°ç»„ï¼Œå› æ­¤ C ä¸­çš„èšåˆæ•°æ®ç±»å‹ï¼ˆå¦‚æ•°ç»„å’Œç»“æ„ä½“ï¼‰åœ¨æœºå™¨çº§ä»£ç ä¸­ä¼šè¡¨ç¤ºä¸ºè¿ç»­çš„å­—èŠ‚é›†åˆã€‚ç”šè‡³å¯¹äºæ ‡é‡æ•°æ®ç±»å‹ï¼ˆå¦‚<code>int</code>ã€<code>char</code>ã€<code>float</code>å’Œ<code>bool</code>ç­‰ï¼‰ï¼Œæ±‡ç¼–ä»£ç ä¹Ÿä¸ä¼šåŒºåˆ†æœ‰ç¬¦å·å’Œæ— ç¬¦å·æ•´æ•°ã€ä¸åŒç±»å‹çš„æŒ‡é’ˆä»¥åŠæŒ‡é’ˆå’Œæ•´æ•°ã€‚</p>
<p>ç¨‹åºçš„å¯æ‰§è¡Œæœºå™¨çº§ä»£ç ã€æ“ä½œç³»ç»Ÿæ‰€éœ€çš„ä¸€äº›ä¿¡æ¯ã€ç”¨äºç®¡ç†è¿‡ç¨‹è°ƒç”¨å’Œè¿”å›çš„è¿è¡Œæ—¶æ ˆä»¥åŠç”¨æˆ·è¯·æ±‚çš„å †å†…å­˜ï¼ˆå¦‚ä½¿ç”¨åº“å‡½æ•°<code>malloc</code>ï¼‰å…±åŒæ„æˆäº†ç¨‹åºå†…å­˜ã€‚å®ƒä½¿ç”¨è™šæ‹Ÿåœ°å€å¯»å€ï¼Œä¸è¿‡åªæœ‰éƒ¨åˆ†è™šæ‹Ÿåœ°å€çš„èŒƒå›´æœ‰æ•ˆã€‚ä¾‹å¦‚ï¼Œx86-64 æœºå™¨çš„è™šæ‹Ÿåœ°å€å¿…é¡»å°†å‰ 16 ä½è®¾ç½®ä¸º 0ï¼Œå› æ­¤å…¶æœ‰æ•ˆèŒƒå›´åŒ…å« <span class="arithmatex">\(2^{48}\)</span> ï¼ˆ64 TBï¼‰å­—èŠ‚ã€‚</p>
<p>å•ä¸ªæœºå™¨æŒ‡ä»¤ä»…æ‰§è¡Œä¸€äº›åŸºæœ¬çš„æ“ä½œï¼Œå¦‚å°†å­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­çš„ä¸¤ä¸ªæ•°å­—ç›¸åŠ ã€åœ¨å†…å­˜å’Œå¯„å­˜å™¨ä¹‹é—´ä¼ è¾“æ•°æ®ä»¥åŠæœ‰æ¡ä»¶åœ°è·³è½¬åˆ°æ–°çš„æŒ‡ä»¤åœ°å€ã€‚ç¼–è¯‘å™¨å¿…é¡»ç”Ÿæˆè¿™æ ·çš„æŒ‡ä»¤åºåˆ—æ¥å®ç°ç¨‹åºç»“æ„ï¼Œä¾‹å¦‚ç®—æœ¯è¡¨è¾¾å¼æ±‚å€¼ã€å¾ªç¯æˆ–è¿‡ç¨‹è°ƒç”¨å’Œè¿”å›ã€‚</p>
<h3 id="ä»£ç ç¤ºä¾‹">ä»£ç ç¤ºä¾‹<a class="headerlink" href="#ä»£ç ç¤ºä¾‹" title="Permanent link">&para;</a></h3>
<p>ç¤ºä¾‹ C ç¨‹åºæ–‡ä»¶<code>mstore.c</code>ä¸­åŒ…å«å¦‚ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">long</span><span class="w"> </span><span class="nf">mult2</span><span class="p">(</span><span class="kt">long</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">multstore</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="o">*</span><span class="n">dest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">long</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mult2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<span class="w">  </span><span class="o">*</span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>ä½¿ç”¨<code>gcc -Og -S mstore.c</code>å‘½ä»¤å³å¯ç”Ÿæˆæ±‡ç¼–ä»£ç æ–‡ä»¶<code>mstore.s</code>ï¼Œå…¶ä¸­çš„<code>-Og</code>ä»£è¡¨å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ã€‚æ±‡ç¼–ä»£ç ä¸­æœ‰å¤šç§å£°æ˜ï¼ŒåŒ…æ‹¬ï¼š</p>
<p><img alt="alt text" src="../image/image-1.png" /></p>
<p>æ¯ä¸€è¡Œç¼©è¿›çš„ä»£ç éƒ½å¯¹åº”ç€ä¸€æ¡æœºå™¨æŒ‡ä»¤ï¼Œå›¾ä¸­çš„è“è‰²æ³¨è§£åˆ™æ ‡ç¤ºäº†æŒ‡ä»¤çš„ä½œç”¨ï¼Œå¦‚<code>pushq</code>ä»£è¡¨å°†å¯„å­˜å™¨<code>%rbx</code>ä¸­çš„å†…å®¹å‹å…¥ç¨‹åºæ ˆã€‚åŸç¨‹åºä¸­å±€éƒ¨å˜é‡åç§°ä»¥åŠæ•°æ®ç±»å‹çš„æ‰€æœ‰ä¿¡æ¯éƒ½å·²è¢«åˆ é™¤ï¼Œéšåæˆ‘ä»¬å¯ä»¥åœ¨ Linux ç³»ç»Ÿä¸­æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼š</p>
<div class="highlight"><pre><span></span><code>gcc<span class="w"> </span>-Og<span class="w"> </span>-c<span class="w"> </span>mstore.c
objdump<span class="w"> </span>-d<span class="w"> </span>mstore.o
</code></pre></div>
<p>ç¬¬ä¸€æ¡å‘½ä»¤å°†ç”ŸæˆäºŒè¿›åˆ¶æ ¼å¼çš„ç›®æ ‡ä»£ç æ–‡ä»¶<code>mstore.o</code>ï¼Œç¬¬äºŒæ¡å‘½ä»¤åˆ™æ˜¯è¿›è¡Œåæ±‡ç¼–ï¼Œå³å°†æœºå™¨çº§ä»£ç è½¬æ¢ä¸ºä¸€ç§ä¸æ±‡ç¼–è¯­è¨€æ ¼å¼ç±»ä¼¼çš„ä»£ç ã€‚å›¾ä¸­çš„è¡Œå·å’Œæ–œä½“æ³¨é‡Šæ˜¯ä¸ºäº†æ–¹ä¾¿è¯´æ˜åŠ å…¥çš„ï¼Œå·¦ä¾§æœ‰ 6 ç»„åå…­è¿›åˆ¶å­—èŠ‚åºåˆ—ï¼Œæ¯ä¸ªéƒ½æ˜¯ä¸€æ¡æŒ‡ä»¤ï¼Œå³ä¾§åˆ™æ˜¾ç¤ºäº†ç­‰æ•ˆçš„æ±‡ç¼–ä»£ç ï¼š</p>
<p><img alt="alt text" src="../image/image-2.png" /></p>
<ul>
<li>x86-64 æŒ‡ä»¤çš„é•¿åº¦èŒƒå›´ä¸º 1 åˆ° 15 ä¸ªå­—èŠ‚ï¼Œå¸¸ç”¨çš„å’Œ <a href="/posts/machine-level-representation-of-programs-note/#æ“ä½œæ•°">æ“ä½œæ•°</a> è¾ƒå°‘çš„æŒ‡ä»¤æ¯”ä¸å¤ªå¸¸ç”¨æˆ–æ“ä½œæ•°è¾ƒå¤šçš„æŒ‡ä»¤éœ€è¦æ›´å°‘çš„å­—èŠ‚æ•°ï¼›</li>
<li>ä»ç»™å®šçš„èµ·å§‹ä½ç½®å¼€å§‹ï¼Œåæ±‡ç¼–ç¨‹åºå°†å­—èŠ‚å”¯ä¸€åœ°è§£ç ä¸ºæœºå™¨æŒ‡ä»¤ã€‚ä¾‹å¦‚ï¼Œåªæœ‰æŒ‡ä»¤<code>pushq %rbx</code>ä»¥å­—èŠ‚å€¼ 53 å¼€å¤´ï¼›</li>
<li>åæ±‡ç¼–ç¨‹åºåªæ˜¯æ ¹æ®æœºå™¨çº§ä»£ç æ–‡ä»¶ä¸­çš„å­—èŠ‚åºåˆ—æ¥ç¡®å®šæ±‡ç¼–ä»£ç ï¼Œä¸éœ€è¦è®¿é—®æºä»£ç æˆ–æ±‡ç¼–ä»£ç ï¼›</li>
<li>åæ±‡ç¼–ç¨‹åºä½¿ç”¨çš„æŒ‡ä»¤å‘½åè§„åˆ™ä¸ GCC ç”Ÿæˆçš„æ±‡ç¼–ä»£ç ç•¥æœ‰ä¸åŒï¼Œå¦‚è®¸å¤šæŒ‡ä»¤ä¸­çš„åç¼€<code>q</code>è¢«çœç•¥äº†ã€‚è¿™äº›åç¼€æ˜¯å°ºå¯¸æŒ‡ç¤ºç¬¦ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥çœç•¥ã€‚è€Œåæ±‡ç¼–å™¨åœ¨<code>call</code>å’Œ<code>ret</code>æŒ‡ä»¤ä¸­æ·»åŠ äº†åç¼€<code>q</code>ï¼Œå®ƒä»¬åŒæ ·æ˜¯å¯ä»¥çœç•¥çš„ã€‚</li>
</ul>
<p>æƒ³è¦ç”Ÿæˆå®é™…çš„å¯æ‰§è¡Œä»£ç è¿˜éœ€è¦åœ¨ä¸€ç»„åŒ…å«<code>main</code>å‡½æ•°çš„ç›®æ ‡ä»£ç æ–‡ä»¶ä¸Šè¿è¡Œé“¾æ¥å™¨ï¼ˆLinkerï¼‰ï¼Œå‡è®¾ main.c æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">multstore</span><span class="p">(</span><span class="kt">long</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="o">*</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">long</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
<span class="w">  </span><span class="n">multstore</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">d</span><span class="p">);</span><span class="w"> </span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;2 * 3 --&gt; %ld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">);</span><span class="w"> </span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">long</span><span class="w"> </span><span class="nf">mult2</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">long</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w"> </span>
<span class="p">}</span>
</code></pre></div>
<p>é‚£ä¹ˆé€šè¿‡<code>gcc -Og -o prog main.c mstore.c</code>å‘½ä»¤ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶<code>prog</code>çš„å¤§å°å°±è¶…è¿‡äº†<code>mstore.o</code>ï¼Œå› ä¸ºå®ƒè¿˜åŒ…å«äº†ç”¨äºå¯åŠ¨å’Œç»ˆæ­¢ç¨‹åºä»¥åŠä¸æ“ä½œç³»ç»Ÿäº¤äº’çš„ä»£ç ã€‚åŒæ ·å¯¹<code>prog</code>æ–‡ä»¶ä½¿ç”¨<code>objdump</code>å‘½ä»¤è¿›è¡Œåæ±‡ç¼–ï¼Œå…¶è¾“å‡ºç»“æœåŒ…å«å¦‚ä¸‹ä»£ç ï¼š</p>
<p><img alt="alt text" src="../image/image-3.png" /></p>
<p>ä¸ç¬¬ä¸€æ¬¡åæ±‡ç¼–çš„ç»“æœç›¸æ¯”ï¼ŒåŒºåˆ«ä¸»è¦åœ¨ï¼š</p>
<ul>
<li>é“¾æ¥å™¨ç§»åŠ¨äº†ä»£ç çš„ä½ç½®ï¼Œå› æ­¤å›¾ä¸­å·¦ä¾§çš„åœ°å€ä¸åŒï¼›</li>
<li>é“¾æ¥å™¨çš„ä¸€é¡¹ä»»åŠ¡æ˜¯å°†å‡½æ•°è°ƒç”¨ä¸å…¶å¯æ‰§è¡Œä»£ç çš„ä½ç½®è¿›è¡ŒåŒ¹é…ã€‚åœ¨ä¸Šå›¾ç¬¬ 4 è¡Œï¼Œé“¾æ¥å™¨å¡«å……äº†<code>callq</code>æŒ‡ä»¤åœ¨è°ƒç”¨å‡½æ•°<code>mult2</code>æ—¶åº”è¯¥ä½¿ç”¨çš„åœ°å€ï¼›</li>
<li>ä¸Šå›¾ç¬¬ 8ï¼Œ9 è¡Œå¡«å……çš„ä»£ç å¯¹ç»“æœæ²¡æœ‰ä»»ä½•å½±å“ï¼Œ<code>nop</code>æ„ä¸ºâ€œNo Operationâ€ã€‚æ’å…¥å®ƒä»¬æ˜¯ä¸ºäº†å°†å‡½æ•°çš„ä»£ç å¢åŠ åˆ° 16 å­—èŠ‚ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½åœ°æ”¾ç½®ä¸‹ä¸€ä¸ªä»£ç å—ï¼Œä»è€Œæå‡å­˜å‚¨å™¨çš„ç³»ç»Ÿæ€§èƒ½ã€‚</li>
</ul>
<h2 id="æ•°æ®æ ¼å¼">æ•°æ®æ ¼å¼<a class="headerlink" href="#æ•°æ®æ ¼å¼" title="Permanent link">&para;</a></h2>
<p>Intel ç”¨æœ¯è¯­â€œå­—â€ï¼ˆWordï¼‰æ¥è¡¨ç¤º 16 ä½æ•°æ®ç±»å‹ï¼Œå› æ­¤ 32 ä½æ•°è¢«ç§°ä¸ºâ€œåŒå­—â€ï¼ˆDouble Wordsï¼‰ï¼Œ64 ä½æ•°è¢«ç§°ä¸ºâ€œå››å­—â€ï¼ˆQuad Wordsï¼‰ã€‚åœ¨ x86-64 æœºå™¨ä¸Š C çš„åŸå§‹æ•°æ®ç±»å‹å¤§å°å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>C declaration</th>
<th>Intel data type</th>
<th>Assembly-code suffix</th>
<th>Size(bytes)</th>
</tr>
</thead>
<tbody>
<tr>
<td>char</td>
<td>Byte</td>
<td>b</td>
<td>1</td>
</tr>
<tr>
<td>short</td>
<td>Word</td>
<td>w</td>
<td>2</td>
</tr>
<tr>
<td>int</td>
<td>Double word</td>
<td>l</td>
<td>4</td>
</tr>
<tr>
<td>long</td>
<td>Quad word</td>
<td>q</td>
<td>8</td>
</tr>
<tr>
<td>char *</td>
<td>Quad word</td>
<td>q</td>
<td>8</td>
</tr>
<tr>
<td>float</td>
<td>Single precision</td>
<td>s</td>
<td>4</td>
</tr>
<tr>
<td>double</td>
<td>Double precision</td>
<td>l</td>
<td>8</td>
</tr>
</tbody>
</table>
<p>å¤§å¤šæ•°ç”± GCC ç”Ÿæˆçš„æ±‡ç¼–ä»£ç éƒ½æœ‰ä¸€ä¸ªè¡¨ç¤ºæ“ä½œæ•°å¤§å°çš„å•å­—ç¬¦åç¼€ï¼Œå¦‚æ•°æ®ç§»åŠ¨æŒ‡ä»¤æœ‰å››ç§å˜ä½“ï¼š<code>movb</code>ï¼ˆç§»åŠ¨å­—èŠ‚ï¼‰ã€<code>movw</code>ï¼ˆç§»åŠ¨å­—ï¼‰ã€<code>movl</code>ï¼ˆç§»åŠ¨åŒå­—ï¼‰å’Œ<code>movq</code>ï¼ˆç§»åŠ¨å››å­—ï¼‰ã€‚å€¼å¾—ä¸€ææ˜¯ï¼Œåç¼€â€œlâ€å³å¯ä»¥è¡¨ç¤º 4 å­—èŠ‚æ•´æ•°åˆè¡¨ç¤º 8 å­—èŠ‚åŒç²¾åº¦æµ®ç‚¹æ•°ã€‚è¿™å¹¶ä¸ä¼šå¼•èµ·æ­§ä¹‰ï¼Œå› ä¸ºæ¶‰åŠåˆ°æµ®ç‚¹æ•°çš„ä»£ç ä½¿ç”¨ä¸€ç»„ä¸æ•´æ•°å®Œå…¨ä¸åŒçš„æŒ‡ä»¤å’Œå¯„å­˜å™¨ã€‚</p>
<h2 id="è®¿é—®ä¿¡æ¯">è®¿é—®ä¿¡æ¯<a class="headerlink" href="#è®¿é—®ä¿¡æ¯" title="Permanent link">&para;</a></h2>
<p>ä¸Šæ–‡æåˆ°ï¼Œx86-64 æœºå™¨çš„ CPU ä¸­åŒ…å« 16 ä¸ªé€šç”¨çš„æ•´æ•°å¯„å­˜å™¨ï¼Œå‡å¯ä»¥å­˜å‚¨ 64 ä½çš„æ•´æ•°æˆ–æŒ‡é’ˆæ•°æ®ï¼š</p>
<p><img alt="alt text" src="../image/image-4.png" /></p>
<p>å›¾ä¸­æ‰€æœ‰å¯„å­˜å™¨çš„åç§°å‡ä»¥ %r å¼€å¤´ï¼Œå®ƒä»¬çš„æ¼”å˜é¡ºåºæ˜¯ä»å³å¾€å·¦çš„ã€‚å‰ 8 ä¸ªå¯„å­˜å™¨ï¼Œå³ %ax åˆ° %spï¼Œæ˜¯æœ€åˆçš„ 8086 æœºå™¨ä½¿ç”¨çš„ 8 ä¸ª 16 ä½å¯„å­˜å™¨ã€‚éšç€ IA32 çš„å‡ºç°ï¼Œå®ƒä»¬è¢«æ‰©å±•ä½ 32 ä½ï¼Œå³ %eax åˆ° %espã€‚ç›®å‰çš„ x86-64 æœºå™¨å°†å…¶è¿›ä¸€æ­¥åœ°æ‰©å±•ä¸º 64 ä½ï¼Œå³ %rax åˆ° %rspã€‚åŒæ—¶è¿˜æ–°æ·»åŠ äº† 8 ä¸ªå¯„å­˜å™¨ï¼Œå³ %r8 åˆ° %r15ã€‚å›¾ä¸­å³ä¾§çš„æ³¨é‡Šè¯´æ˜äº†å„ä¸ªå¯„å­˜å™¨åœ¨å…¸å‹ç¨‹åºä¸­æ‰®æ¼”çš„è§’è‰²ï¼Œå…¶ä¸­æœ€ç‹¬ç‰¹çš„æ˜¯æ ˆæŒ‡é’ˆ %rspï¼Œå®ƒç”¨äºæŒ‡ç¤ºè¿è¡Œæ—¶æ ˆçš„ç»“æŸä½ç½®ã€‚</p>
<p>æŒ‡ä»¤å¯ä»¥å¯¹å­˜å‚¨åœ¨å¯„å­˜å™¨ä½ä½å­—èŠ‚ä¸­çš„ä¸åŒå¤§å°çš„æ•°æ®è¿›è¡Œæ“ä½œã€‚å­—èŠ‚çº§æ“ä½œå¯ä»¥è®¿é—®æœ€ä½æœ‰æ•ˆå­—èŠ‚ï¼Œ16 ä½æ“ä½œå¯ä»¥è®¿é—®æœ€ä½æœ‰æ•ˆ 2 ä¸ªå­—èŠ‚ï¼Œ32 ä½æ“ä½œå¯ä»¥è®¿é—®æœ€ä½æœ‰æ•ˆ 4 ä¸ªå­—èŠ‚ï¼Œ64 ä½æ“ä½œåˆ™å¯ä»¥è®¿é—®æ•´ä¸ªå¯„å­˜å™¨ã€‚</p>
<h3 id="æ“ä½œæ•°">æ“ä½œæ•°<a class="headerlink" href="#æ“ä½œæ•°" title="Permanent link">&para;</a></h3>
<p>å¤§å¤šæ•°æŒ‡ä»¤éƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ“ä½œæ•°ï¼ˆOperandï¼‰ï¼ŒæŒ‡å®šäº†æ‰§è¡Œæ“ä½œæ—¶ä½¿ç”¨çš„æºæ•°æ®å’Œç»“æœæ”¾ç½®çš„ä½ç½®ã€‚x86-64 æœºå™¨æ”¯æŒçš„æ“ä½œæ•°æ ¼å¼å¦‚ä¸‹ï¼š</p>
<p><img alt="alt text" src="../image/image-5.png" /></p>
<p>æºæ•°æ®æ—¢å¯ä»¥ä»¥å¸¸æ•°å½¢å¼ç»™å‡ºï¼Œä¹Ÿå¯ä»¥ä»å¯„å­˜å™¨æˆ–å†…å­˜ä¸­è¯»å–ï¼Œç»“æœåˆ™å­˜å‚¨åœ¨å¯„å­˜å™¨æˆ–å†…å­˜ä¸­ã€‚å› æ­¤æ“ä½œæ•°æœ‰ä¸‰ç§å¯èƒ½çš„ç±»å‹ï¼š</p>
<ul>
<li>ç«‹å³æ•°ï¼ˆImmediateï¼‰ï¼šå³å¸¸æ•°å€¼ï¼Œä¹¦å†™æ–¹å¼ä¸º $ ç¬¦å·åé¢è·Ÿä¸€ä¸ªæ•´æ•°ï¼›</li>
<li>å¯„å­˜å™¨ï¼ˆRegisterï¼‰ï¼šå¯„å­˜å™¨ä¸­çš„å†…å®¹ã€‚æˆ‘ä»¬ä½¿ç”¨ <span class="arithmatex">\(r_a\)</span> è¡¨ç¤ºä»»æ„å¯„å­˜å™¨ <span class="arithmatex">\(a\)</span>ï¼Œä½¿ç”¨ <span class="arithmatex">\(R[r_a]\)</span> æ¥è¡¨ç¤ºå®ƒçš„å€¼ï¼›</li>
<li>å†…å­˜ï¼ˆMemoryï¼‰å¼•ç”¨ï¼šæ ¹æ®è®¡ç®—å‡ºçš„åœ°å€ï¼ˆä¹Ÿç§°æœ‰æ•ˆåœ°å€ï¼‰æ¥è®¿é—®æŸä¸ªå†…å­˜ä½ç½®ã€‚ä½¿ç”¨ <span class="arithmatex">\(M_b[Addr]\)</span> è¡¨ç¤ºåœ¨å†…å­˜ä¸­ä»åœ°å€ <span class="arithmatex">\(Addr\)</span> å¼€å§‹ <span class="arithmatex">\(b\)</span> å­—èŠ‚çš„å¼•ç”¨ï¼Œå³ä¸‹è§’æ ‡ <span class="arithmatex">\(b\)</span> å¯ä»¥çœç•¥ã€‚</li>
</ul>
<p>æœ€é€šç”¨çš„å†…å­˜å¼•ç”¨æ–¹å¼åœ¨ä¸Šè¡¨åº•éƒ¨ï¼š<span class="arithmatex">\(M[Imm + R[r_b] + R[r_i]\times s]\)</span>ï¼Œå¸¸ç”¨äºå¼•ç”¨æ•°ç»„å…ƒç´ ã€‚</p>
<p>å‡è®¾ä¸‹åˆ—å€¼å­˜å‚¨åœ¨å†…å­˜æˆ–å¯„å­˜å™¨ä¸­æŒ‡å®šçš„åœ°å€å¤„ï¼š</p>
<p><img alt="alt text" src="../image/image-6.png" /></p>
<p>é‚£ä¹ˆä»¥ä¸‹æ“ä½œæ•°å­˜å‚¨çš„å€¼åˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li><code>%rax</code>ï¼š0x100</li>
<li><code>0x104</code>ï¼šåœ°å€ä¸º 0x104ï¼Œå€¼ä¸º 0xAB</li>
<li><code>$0x108</code>ï¼š0x108ï¼ˆç«‹å³æ•°ï¼‰</li>
<li><code>(%rax)</code>ï¼šåœ°å€ä¸º 0x100ï¼Œå€¼ä¸º 0xFF</li>
<li><code>9(%rax,%rdx)</code>ï¼šåœ°å€ä¸º 9 + 0x100 + 0x3 = 0x10Cï¼Œå€¼ä¸º 0x11</li>
<li><code>260(%rcx,%rdx)</code>ï¼š260 å³åå…­è¿›åˆ¶æ•° 0x104ï¼Œå› æ­¤åœ°å€ä¸º 0x104 + 0x1 + 0x3 = 0x108ï¼Œå€¼ä¸º 0x13</li>
<li><code>0xFC(,%rcx,4)</code>ï¼šåœ°å€ä¸º 0xFC + 0x1 * 4 = 0x100ï¼Œå€¼ä¸º 0xFF</li>
<li><code>%rax,%rdx,4</code>ï¼šåœ°å€ä¸ºï¼š0x100 + 0x3 * 4 = 0x10Cï¼Œå€¼ä¸º 0x11</li>
</ul>
<h3 id="æ•°æ®ç§»åŠ¨æŒ‡ä»¤">æ•°æ®ç§»åŠ¨æŒ‡ä»¤<a class="headerlink" href="#æ•°æ®ç§»åŠ¨æŒ‡ä»¤" title="Permanent link">&para;</a></h3>
<p>åœ¨æ‰€æœ‰æœºå™¨æŒ‡ä»¤ä¸­ä½¿ç”¨æœ€ä¸ºé¢‘ç¹çš„ä¾¿æ˜¯æ•°æ®ç§»åŠ¨æŒ‡ä»¤ï¼Œå®ƒä»¬è´Ÿè´£å°†æ•°æ®ä»ä¸€å¤„ç§»åŠ¨åˆ°å¦ä¸€å¤„ã€‚æˆ‘ä»¬å°†æ“ä½œç›¸åŒä½†æ“ä½œæ•°å°ºå¯¸ä¸åŒçš„æŒ‡ä»¤åˆ’åˆ†ä¸ºåŒä¸€ä¸ªæŒ‡ä»¤ç±»ï¼ˆInstruction Classesï¼‰ï¼Œä¸‹è¡¨åˆ—å‡ºçš„ä¾¿æ˜¯ MOV æŒ‡ä»¤ç±»ä¸­çš„å„ç§æ“ä½œï¼š</p>
<p><img alt="alt text" src="../image/image-7.png" /></p>
<p>ä¸Šè¡¨ä¸­çš„ S ä»£è¡¨ æºåœ°å€ï¼ˆSourceï¼‰ï¼ŒD ä»£è¡¨ç›®çš„åœ°å€ï¼ˆDestinationï¼‰ï¼ŒI ä»£è¡¨ç«‹å³æ•°ï¼ŒR ä»£è¡¨å¯„å­˜å™¨ã€‚å…¶ä¸­ï¼Œç§»åŠ¨æŒ‡ä»¤ä¸èƒ½å°†ä¸€ä¸ªä½äºå†…å­˜ä¸­çš„æ•°æ®ç›´æ¥ç§»åŠ¨åˆ°å†…å­˜ä¸­çš„å¦ä¸€ä¸ªä½ç½®ï¼Œå¿…é¡»ç»è¿‡ä¸€ä¸ªå¯„å­˜å™¨ä¸­è½¬ã€‚æ­¤å¤–ï¼Œå½“<code>movl</code>æŒ‡ä»¤çš„ç›®çš„åœ°å€ä¸ºä¸€ä¸ªå¯„å­˜å™¨æ—¶ï¼Œå®ƒä¸ä»…ä¼šæŠŠç›®çš„å¯„å­˜å™¨çš„è¾ƒä½å››ä½æ›´æ–°ä¸ºæºæ•°æ®ï¼Œè¿˜ä¼šå°†è¾ƒé«˜å››ä½çš„å­—èŠ‚å…¨éƒ¨ç½® 0ã€‚æœ€åï¼Œ<code>movabsq</code>æŒ‡ä»¤åªèƒ½å°†å¯„å­˜å™¨ä½œä¸ºæ•°æ®çš„ç›®çš„åœ°å€ã€‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå·¦è¾¹ä¸ºé¡ºåºæ‰§è¡Œçš„ç§»åŠ¨æŒ‡ä»¤ï¼Œå³è¾¹ä¸ºå¯„å­˜å™¨ %rax ä¸­å­—èŠ‚çš„å˜åŒ–æƒ…å†µï¼š</p>
<div class="highlight"><pre><span></span><code><span class="nf">movabsq</span><span class="w"> </span><span class="kc">$</span><span class="mh">0x0011223344556677</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span><span class="w">            </span><span class="o">%</span><span class="nb">rax</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">0011223344556677</span>
<span class="nf">movb</span><span class="w"> </span><span class="kc">$</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">al</span><span class="w">                                </span><span class="o">%</span><span class="nb">rax</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">00112233445566</span><span class="nv">FF</span>
<span class="nf">movw</span><span class="w"> </span><span class="kc">$</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">ax</span><span class="w">                                </span><span class="o">%</span><span class="nb">rax</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">001122334455</span><span class="nv">FFFF</span>
<span class="nf">movl</span><span class="w"> </span><span class="kc">$</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">eax</span><span class="w">                               </span><span class="o">%</span><span class="nb">rax</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="mi">00000000</span><span class="nv">FFFFFFFF</span>
<span class="nf">movq</span><span class="w"> </span><span class="kc">$</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span><span class="w">                               </span><span class="o">%</span><span class="nb">rax</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="nv">FFFFFFFFFFFFFFFF</span>
</code></pre></div>
<p>è¿˜æœ‰ä¸¤ç±»æ•°æ®ç§»åŠ¨æŒ‡ä»¤å¯ä»¥å°†è¾ƒå°å°ºå¯¸çš„æºæ•°æ®ç§»åŠ¨åˆ°è¾ƒå¤§å°ºå¯¸çš„ç›®çš„å¯„å­˜å™¨ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<p><img alt="alt text" src="../image/image-8.png" /></p>
<p><img alt="alt text" src="../image/image-9.png" /></p>
<p>ä¸¤è€…ä¸åŒçš„æ˜¯ï¼Œ<code>movz</code>æŒ‡ä»¤å°†ç›®çš„å¯„å­˜å™¨çš„å‰©ä½™å­—èŠ‚å‡å¡«å……ä¸º 0ï¼ˆé›¶æ‰©å±•ï¼‰ï¼Œ<code>movs</code>æŒ‡ä»¤åˆ™å°†å…¶å¡«å……ä¸ºæºæ“ä½œæ•°çš„æœ€é«˜æœ‰æ•ˆä½ï¼ˆç¬¦å·æ‰©å±•ï¼‰ã€‚ç›¸æ¯”äºç¬¦å·æ‰©å±•ï¼Œé›¶æ‰©å±•ç¼ºå°‘äº†æŒ‡ä»¤<code>movzlq</code>ã€‚è¿™æ˜¯å› ä¸ºä¸Šæ–‡æåˆ°ï¼Œä½¿ç”¨<code>movl</code>æŒ‡ä»¤ç§»åŠ¨æ•°æ®åˆ°å¯„å­˜å™¨æ—¶ï¼Œä¼šå°†é«˜ä½å…¨éƒ¨ç½®ä¸º 0ï¼Œå…¶æ•ˆæœä¸é›¶æ‰©å±•æ— å¼‚ã€‚å¦å¤–ï¼Œç¬¦å·æ‰©å±•è¿˜å¤šäº†ä¸€ä¸ªæŒ‡ä»¤<code>cltq</code>ã€‚å®ƒæ²¡æœ‰æ“ä½œæ•°ï¼Œå®é™…ä¸Šç­‰æ•ˆäº<code>movslq %eax, %rax</code>ã€‚</p>
<p>åœ¨ C ä¸­ï¼Œå¯¹æŒ‡é’ˆè§£å¼•ç”¨ï¼ˆDereference Pointerï¼Œ<code>*p</code>ï¼‰ä¼šå°†æŒ‡é’ˆæ‹·è´åˆ°å¯„å­˜å™¨ä¸­ï¼Œç„¶åå°†è¯¥å¯„å­˜å™¨ä½œä¸ºå†…å­˜åœ°å€çš„å¼•ç”¨ã€‚ä¸€ä¸ªç®€å•çš„ C ç¨‹åºå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">long</span><span class="w"> </span><span class="nf">exchange</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="o">*</span><span class="n">xp</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">long</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">xp</span><span class="p">;</span>
<span class="w">  </span><span class="o">*</span><span class="n">xp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>ä¸ä¹‹ç­‰æ•ˆçš„æ±‡ç¼–ä»£ç ä¸ºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="c1">; xp in %rdi, y in %rsi</span>
<span class="nl">exchange:</span>
<span class="w">  </span><span class="nf">movq</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="nb">rdi</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="w">  </span><span class="nf">movq</span><span class="w"> </span><span class="o">%</span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="nb">rdi</span><span class="p">)</span>
<span class="w">  </span><span class="nf">ret</span>
</code></pre></div>
<p>æœ€åä¸¤ä¸ªæ•°æ®ç§»åŠ¨æŒ‡ä»¤åˆ†åˆ«æ˜¯å°†æ•°æ®å‹å…¥ç¨‹åºæ ˆï¼ˆStackï¼‰çš„<code>push</code>å’Œå°†æ•°æ®ä»ç¨‹åºæ ˆä¸­å¼¹å‡ºçš„<code>pop</code>ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<p><img alt="alt text" src="../image/image-10.png" /></p>
<p>åœ¨ x86-64 ä¸­ï¼Œç¨‹åºæ ˆå­˜å‚¨åœ¨å†…å­˜ä¸­çš„æŸäº›åŒºåŸŸä¸­ï¼Œå…¶ç‰¹æ€§ä¸ºåè¿›å…ˆå‡ºï¼ˆLast-in, First-outï¼‰ã€‚ä¹ æƒ¯ä¸Šæˆ‘ä»¬å°†æ ˆé¡¶ç”»åœ¨åº•ç«¯ï¼Œè€Œæ ˆé¡¶å…ƒç´ çš„åœ°å€ï¼ˆç”±æ ˆæŒ‡é’ˆ %rsp ä¿å­˜ï¼‰æ˜¯æ•´ä¸ªæ ˆä¸­æœ€å°çš„ï¼š</p>
<p><img alt="alt text" src="../image/image-11.png" /></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæƒ³è¦å°†ä¸€ä¸ªå››å­—æ•°æ®å‹å…¥æ ˆä¸­ï¼Œé¦–å…ˆè¦æŠŠæ ˆæŒ‡é’ˆå‡ 8ï¼Œç„¶åä»¤æºæ•°æ®å€¼æˆä¸ºæ–°çš„æ ˆé¡¶å…ƒç´ ã€‚å› æ­¤æŒ‡ä»¤<code>pushq %rax</code>å°±ç­‰æ•ˆäºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="c1">; subq ä¸ºå‡æ³•è¿ç®—ï¼Œä¸‹ä¸€èŠ‚ä¼šè¿›è¡Œä»‹ç»</span>
<span class="nf">subq</span><span class="w"> </span><span class="kc">$</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nb">rsp</span>
<span class="nf">movq</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="nb">rsp</span><span class="p">)</span>
</code></pre></div>
<p>åŒæ ·ï¼Œè‹¥æƒ³å°†æ ˆé¡¶çš„å››å­—æ•°æ®å¼¹å‡ºæ ˆï¼Œé¦–å…ˆè¦æŠŠæ ˆé¡¶å…ƒç´ çš„å€¼æ‹·è´åˆ°å¯„å­˜å™¨ä¸­ï¼Œç„¶åå†æŠŠæ ˆæŒ‡é’ˆåŠ  8ã€‚å› æ­¤æŒ‡ä»¤<code>popq %rdx</code>å°±ç­‰æ•ˆäºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="nf">movq</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="nb">rsp</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="nb">rdx</span>
<span class="c1">; addq ä¸ºåŠ æ³•è¿ç®—ï¼Œä¸‹ä¸€èŠ‚ä¼šè¿›è¡Œä»‹ç»</span>
<span class="nf">addq</span><span class="w"> </span><span class="kc">$</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rsp</span>
</code></pre></div>
<h2 id="ç®—æœ¯å’Œé€»è¾‘æ“ä½œ">ç®—æœ¯å’Œé€»è¾‘æ“ä½œ<a class="headerlink" href="#ç®—æœ¯å’Œé€»è¾‘æ“ä½œ" title="Permanent link">&para;</a></h2>
<p>ä¸‹å›¾åˆ—å‡ºäº†ä¸€äº› x86-64 ä¸­çš„æ•´æ•°ç®—æœ¯å’Œé€»è¾‘æ“ä½œï¼Œå…¶ä¸­é™¤äº†<code>leaq</code>å¤–ç»™å‡ºçš„éƒ½æ˜¯æŒ‡ä»¤ç±»ï¼š</p>
<p><img alt="alt text" src="../image/image-12.png" /></p>
<p>ä»¥ä¸Šæ“ä½œå¯åˆ†ä¸ºå››ç±»ï¼šåŠ è½½æœ‰æ•ˆåœ°å€ï¼ˆLoad Effective Addressï¼‰ã€ä¸€å…ƒï¼ˆUnaryï¼‰ã€äºŒå…ƒï¼ˆBinaryï¼‰å’Œç§»ä½ï¼ˆShiftsï¼‰ã€‚ä¸€å…ƒæ“ä½œåªæœ‰ä¸€ä¸ªæ“ä½œæ•°ï¼Œè€ŒäºŒå…ƒæ“ä½œåˆ™æœ‰ä¸¤ä¸ªã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†åˆ†åˆ«ä»‹ç»å®ƒä»¬ã€‚</p>
<h3 id="åŠ è½½æœ‰æ•ˆåœ°å€">åŠ è½½æœ‰æ•ˆåœ°å€<a class="headerlink" href="#åŠ è½½æœ‰æ•ˆåœ°å€" title="Permanent link">&para;</a></h3>
<p>åŠ è½½æœ‰æ•ˆåœ°å€çš„æŒ‡ä»¤åä¸º<code>leaq</code>ï¼Œå…¶å®è´¨æ˜¯<code>movq</code>æŒ‡ä»¤çš„ä¸€ç§å˜ä½“ã€‚å®ƒä¼šä»å†…å­˜ä¸­è¯»å–æºæ“ä½œæ•°çš„åœ°å€æ‹·è´åˆ°å¯„å­˜å™¨ä¸­ï¼Œæœ‰æ—¶å€™ä¹Ÿç”¨äºå®ç°ä¸€äº›ç®€å•çš„è¿ç®—ã€‚ä¾‹å¦‚å¯„å­˜å™¨ %rdx ä¸­å­˜å‚¨çš„å€¼ä¸º xï¼Œé‚£ä¹ˆæŒ‡ä»¤<code>leaq 7(%rdx, %rdx, 4), %rax</code>çš„ä½œç”¨ä¾¿æ˜¯å°†å¯„å­˜å™¨ %rax çš„å€¼è®¾ä¸º 5x+7ã€‚è™½ç„¶<code>leaq</code>æŒ‡ä»¤åœ¨æ‰§è¡Œè¿ç®—æ–¹é¢çš„èƒ½åŠ›æ˜¯æœ‰é™çš„ï¼Œä½†æ˜¯ä¸åŠ æ³•å’Œä¹˜æ³•æŒ‡ä»¤ç›¸æ¯”ï¼Œå®ƒçš„æ€§èƒ½æ›´åŠ å‡ºè‰²ã€‚</p>
<h3 id="ä¸€å…ƒå’ŒäºŒå…ƒæ“ä½œ">ä¸€å…ƒå’ŒäºŒå…ƒæ“ä½œ<a class="headerlink" href="#ä¸€å…ƒå’ŒäºŒå…ƒæ“ä½œ" title="Permanent link">&para;</a></h3>
<p>ä¸€å…ƒæ“ä½œåªæœ‰ä¸€ä¸ªæ“ä½œæ•°ï¼Œå› æ­¤æºåœ°å€å’Œç›®çš„åœ°å€ç›¸åŒã€‚å¦‚æ“ä½œ<code>incq (%rsp)</code>å¯ä»¥å°†ç¨‹åºæ ˆé¡¶å¢åŠ  8 ä¸ªå­—èŠ‚çš„å…ƒç´ ï¼Œç±»ä¼¼äº C ä¸­çš„è‡ªå¢è¿ç®—ç¬¦<code>++</code>ã€‚</p>
<p>äºŒå…ƒæ“ä½œç±»ä¼¼äº C ä¸­çš„èµ‹å€¼è¿ç®—ç¬¦ï¼ˆAssignment Operatorï¼‰ï¼Œå¦‚<code>x -= y</code>ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæ“ä½œ<code>subq %rax, %rdx</code>ä¼šå°†å¯„å­˜å™¨ %rdx ä¸­çš„å€¼å‡å»å¯„å­˜å™¨ %rax ä¸­çš„å€¼ã€‚ç¬¬ä¸€ä¸ªæ“ä½œæ•°å¯ä»¥æ˜¯ç«‹å³æ•°ã€å¯„å­˜å™¨æˆ–å†…å­˜ä¸­çš„ä½ç½®ï¼Œç¬¬äºŒä¸ªæ“ä½œæ•°åˆ™åªèƒ½æ˜¯å¯„å­˜å™¨æˆ–å†…å­˜ä¸­çš„ä½ç½®ã€‚ä¸ MOV ç±»æŒ‡ä»¤ç›¸åŒï¼ŒäºŒå…ƒæ“ä½œçš„ä¸¤ä¸ªæ“ä½œæ•°ä¸èƒ½åŒæ—¶ä¸ºå†…å­˜ä¸­çš„ä½ç½®ã€‚</p>
<h3 id="ç§»ä½æ“ä½œ">ç§»ä½æ“ä½œ<a class="headerlink" href="#ç§»ä½æ“ä½œ" title="Permanent link">&para;</a></h3>
<p>ç§»ä½æ“ä½œçš„ç¬¬ä¸€ä¸ªæ“ä½œç¬¦ä¸ºä½æ•°ï¼Œå¯ä»¥æ˜¯ç«‹å³æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯å•å­—èŠ‚çš„å¯„å­˜å™¨ï¼ˆé€šå¸¸ä½¿ç”¨å¯„å­˜å™¨ %clï¼‰ã€‚ç¬¬äºŒä¸ªæ“ä½œæ•°ä¸ºç§»ä½çš„å€¼ã€‚å¯ä»¥æ˜¯å¯„å­˜å™¨æˆ–å†…å­˜ä¸­çš„ä½ç½®ã€‚å¯¹äºå³ç§»è¿ç®—æ¥è¯´ï¼ŒSAR ä»£è¡¨ç®—æœ¯å³ç§»ï¼ŒSHR åˆ™ä»£è¡¨é€»è¾‘å³ç§»ã€‚</p>
<h3 id="ç‰¹æ®Šç®—æ•°æ“ä½œ">ç‰¹æ®Šç®—æ•°æ“ä½œ<a class="headerlink" href="#ç‰¹æ®Šç®—æ•°æ“ä½œ" title="Permanent link">&para;</a></h3>
<p>ä¸¤ä¸ª 64 ä½æ•´å‹çš„ç§¯éœ€è¦ç”¨ 128 ä½æ¥è¡¨ç¤ºï¼Œå› æ­¤ Intel å¼•å…¥äº† 16 å­—èŠ‚å•ä½â€œå…«å­—â€ï¼ˆOct Wordï¼‰æ¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚ä¸‹è¡¨å±•ç¤ºäº†ä¸€äº›æ”¯æŒè¿ç®—ç»“æœä¸ºå…«å­—çš„æ“ä½œï¼š</p>
<p><img alt="alt text" src="../image/image-13.png" /></p>
<p>æˆ‘ä»¬åœ¨æ™®é€šç®—æ•°æ“ä½œå’Œç‰¹æ®Šç®—æ•°æ“ä½œä¸­å‡å‘ç°äº†<code>imulq</code>æŒ‡ä»¤ã€‚ç¬¬ä¸€ç§å±äº IMUL ç±»ï¼Œæœ‰ä¸¤ä¸ªæ“ä½œæ•°ã€‚å…¶è®¡ç®—ç»“æœä¸º 64 ä½ï¼ˆè‹¥è¶…è¿‡ 64 ä½ï¼Œåˆ™æˆªæ–­é«˜ä½ï¼‰ï¼Œç­‰æ•ˆäºç¬¬äºŒç« ä»‹ç»çš„ <a href="/posts/representing-and-manipulating-information-note/#æ— ç¬¦å·ä¹˜æ³•">æ— ç¬¦å·ä¹˜æ³•</a> å’Œ <a href="/posts/representing-and-manipulating-information-note/#äºŒè¿›åˆ¶è¡¥ç ä¹˜æ³•">äºŒè¿›åˆ¶è¡¥ç ä¹˜æ³•</a>ã€‚ç¬¬äºŒç§å³æ˜¯ä¸Šè¡¨ä¸­çš„ç‰¹æ®Šç®—æ•°æ“ä½œï¼Œåªæœ‰ä¸€ä¸ªæ“ä½œæ•°ï¼Œå› æ­¤ç¼–è¯‘å™¨å¯ä»¥æ ¹æ®æ“ä½œæ•°çš„æ•°é‡åŒºåˆ†å®ƒä»¬ã€‚</p>
<p>ç”¨äºæœ‰ç¬¦å·ä¹˜æ³•çš„æ“ä½œè¢«ç§°ä¸º<code>imulq</code>ï¼Œç”¨äºæ— ç¬¦å·ä¹˜æ³•çš„åˆ™ä¸º<code>mulq</code>ã€‚ä¸¤è€…çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå¯„å­˜å™¨ %raxï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæºæ“ä½œæ•°ã€‚è®¡ç®—ç»“æœä¸­è¾ƒé«˜ 64 ä½å°†å­˜å‚¨åœ¨å¯„å­˜å™¨ %rdx ä¸­ï¼Œè¾ƒä½ 64 ä½åˆ™å­˜å‚¨åœ¨å¯„å­˜å™¨ %rax ä¸­ã€‚</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;inttypes.h&gt;</span>
<span class="k">typedef</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">__int128</span><span class="w"> </span><span class="n">uint128_t</span>
<span class="kt">void</span><span class="w"> </span><span class="n">store_uprod</span><span class="p">(</span><span class="n">uint128_t</span><span class="w"> </span><span class="o">*</span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">y</span><span class="p">){</span>
<span class="w">    </span><span class="o">*</span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">uint128_t</span><span class="p">)</span><span class="n">y</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>ç¤ºä¾‹ C ç¨‹åºåœ¨å°ç«¯æ³•æœºå™¨ä¸Šå¯è½¬åŒ–ä¸ºå¦‚ä¸‹çš„æ±‡ç¼–ä»£ç ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="c1">; dest in %rdi, x in %rsi, y in %rdx</span>
<span class="nf">store_uprod</span>
<span class="w">  </span><span class="nf">movq</span><span class="w"> </span><span class="o">%</span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="w">  </span><span class="nf">mulq</span><span class="w"> </span><span class="o">%</span><span class="nb">rdx</span>
<span class="w">  </span><span class="nf">movq</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="nb">rdi</span><span class="p">)</span>
<span class="w">  </span><span class="nf">movq</span><span class="w"> </span><span class="o">%</span><span class="nb">rdx</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">(</span><span class="o">%</span><span class="nb">rdi</span><span class="p">)</span>
</code></pre></div>
<p>æ™®é€šç®—æ•°æ“ä½œä¸­æ²¡æœ‰æä¾›é™¤æ³•æˆ–ä½™æ•°è¿ç®—ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ç‰¹æ®Šç®—æ•°æ“ä½œ<code>idivq</code>å’Œ<code>divq</code>ã€‚ä¸ä¹˜æ³•ç±»ä¼¼ï¼Œè¢«é™¤æ•°çš„è¾ƒé«˜ 64 ä½å°†å­˜å‚¨åœ¨å¯„å­˜å™¨ %rdx ä¸­ï¼Œè¾ƒä½ 64 ä½å­˜å‚¨åœ¨å¯„å­˜å™¨ %rax ä¸­ã€‚é™¤æ•°ä¸ºæ“ä½œæ•°ï¼Œå•†ä¿å­˜åœ¨å¯„å­˜å™¨ %rax ä¸­ï¼Œä½™æ•°åˆ™ä¿å­˜åœ¨å¯„å­˜å™¨ %rdx ä¸­ã€‚å¦‚æœè¢«é™¤æ•°åªæœ‰ 64 ä½ï¼Œé‚£ä¹ˆå°±åº”å½“å°†å¯„å­˜å™¨ %rdx å…¨éƒ¨ç½®ä¸º 0ï¼ˆæ— ç¬¦å·è¿ç®—ï¼‰æˆ–ç¬¦å·ä½ï¼ˆæœ‰ç¬¦å·è¿ç®—ï¼‰ã€‚åè€…å¯ä»¥ä½¿ç”¨<code>cqto</code>æ“ä½œå®ç°ï¼Œå®ƒä¼šä»å¯„å­˜å™¨ %rax ä¸­è¯»å–ç¬¦å·ä½ï¼Œç„¶åå°†å…¶æ‹·è´åˆ°å¯„å­˜å™¨ %rdx å†…çš„æ¯ä¸€ä½ä¸­ã€‚</p>
<h2 id="æ§åˆ¶">æ§åˆ¶<a class="headerlink" href="#æ§åˆ¶" title="Permanent link">&para;</a></h2>
<p>ä¸Šæ–‡ä¸­ä»‹ç»çš„æ“ä½œåªè€ƒè™‘äº†é¡ºåºæ‰§è¡Œçš„ä»£ç ï¼Œå¯¹äº C ä¸­çš„ Ifã€Forã€While å’Œ Switch è¯­å¥ï¼Œå®ƒä»¬è¿˜éœ€è¦æ ¹æ®æ•°æ®æ£€éªŒçš„ç»“æœæ¥å†³å®šä»£ç æ‰§è¡Œçš„é¡ºåºã€‚æœºå™¨çº§ä»£ç æä¾›äº†ä¸¤ç§åŸºæœ¬æœºåˆ¶æ¥å®ç°è¿™ç§æ¡ä»¶è¡Œä¸ºï¼ˆConditional Behaviorï¼‰ï¼Œä¸€ç§æ ¹æ®æ£€éªŒç»“æœæ”¹å˜æ§åˆ¶æµï¼ˆControl Flowï¼‰ï¼Œå¦ä¸€ç§åˆ™æ”¹å˜æ•°æ®æµï¼ˆData Flowï¼‰ã€‚</p>
<h3 id="æ¡ä»¶ç ">æ¡ä»¶ç <a class="headerlink" href="#æ¡ä»¶ç " title="Permanent link">&para;</a></h3>
<p>ä¸Šæ–‡æåˆ°ï¼ŒCPU ç»´æŠ¤äº†ä¸€ç»„å•å­—èŠ‚çš„æ¡ä»¶ç å¯„å­˜å™¨ï¼Œå®ƒä»¬è®°å½•äº†æœ€è¿‘ä¸€æ¬¡ç®—æ•°æˆ–é€»è¾‘æ“ä½œç»“æœçš„æŸäº›å±æ€§ï¼š</p>
<ul>
<li>CFï¼ˆCarry Flagï¼‰ï¼šè¿›ä½æ ‡è¯†ï¼Œè®°å½•æœ€é«˜æœ‰æ•ˆä½æ˜¯å¦å‘ç”Ÿè¿›ä½ï¼Œç”¨äºæ£€æµ‹æ— ç¬¦å·æ•°æ“ä½œçš„æº¢å‡ºï¼›</li>
<li>ZFï¼ˆZero Flagï¼‰ï¼šé›¶æ ‡è¯†ï¼Œè®°å½•ç»“æœæ˜¯å¦ä¸º 0ï¼›</li>
<li>SFï¼ˆSign Flagï¼‰ï¼šç¬¦å·æ ‡è¯†ï¼Œè®°å½•ç»“æœæ˜¯å¦ä¸ºè´Ÿå€¼ï¼›</li>
<li>OFï¼ˆOverflow Flagï¼‰ï¼šæº¢å‡ºæ ‡è¯†ï¼Œè®°å½•æ˜¯å¦å‘ç”ŸäºŒè¿›åˆ¶è¡¥ç æº¢å‡ºã€‚</li>
</ul>
<p>ä¸‹åˆ—ä¸¤ä¸ªæŒ‡ä»¤ç±»å¯ä»¥åœ¨ä¸æ”¹å˜ä»»ä½•å…¶ä»–å¯„å­˜å™¨çš„æƒ…å†µä¸‹è®¾ç½®æ¡ä»¶ç ï¼Œå¦‚æŒ‡ä»¤<code>testq %rax, %rax</code>å¯ä»¥æ£€æµ‹å¯„å­˜å™¨ %rax å­˜å‚¨çš„å€¼æ˜¯æ­£æ•°ã€è´Ÿæ•°è¿˜æ˜¯é›¶ï¼š</p>
<p><img alt="alt text" src="../image/image-14.png" /></p>
<p>ç›¸æ¯”äºç›´æ¥è¯»å–ï¼Œæˆ‘ä»¬æ›´å¸¸ç”¨ä»¥ä¸‹ä¸‰ç§æ–¹å¼ä½¿ç”¨æ¡ä»¶ç ï¼š</p>
<ul>
<li>æ ¹æ®æ¡ä»¶ç çš„ç»„åˆå°†å•ä¸ªå­—èŠ‚è®¾ç½®ä¸º 0 æˆ– 1ï¼›</li>
<li>æœ‰æ¡ä»¶åœ°è·³è½¬åˆ°ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ï¼›</li>
<li>æœ‰æ¡ä»¶åœ°ä¼ è¾“æ•°æ®ã€‚</li>
</ul>
<p>ä¸‹åˆ—æ“ä½œæŒ‡ä»¤ä¾¿å¯ä»¥å®ç°ä¸Šè¿°ç¬¬ä¸€ç§æ–¹å¼ã€‚æ³¨æ„ï¼Œæ­¤å¤„çš„æŒ‡ä»¤åç¼€ä»£è¡¨çš„å¹¶éæ˜¯ä¸åŒçš„æ“ä½œæ•°å¤§å°ï¼Œè€Œæ˜¯ä¸åŒçš„æ¡ä»¶åˆ¤æ–­ã€‚å¦‚æŒ‡ä»¤<code>setl</code>å’Œ<code>setb</code>åˆ†åˆ«ä»£è¡¨ set less å’Œ set belowï¼š</p>
<p><img alt="alt text" src="../image/image-15.png" /></p>
<p>å¦‚ä¸‹æ±‡ç¼–ä»£ç é¦–å…ˆæ¯”è¾ƒäº†å˜é‡<code>a</code>å’Œ<code>b</code>çš„å¤§å°ï¼Œç„¶åæ ¹æ®ç»“æœæŠŠå¯„å­˜å™¨ %eax çš„æœ€ä½å­—èŠ‚ï¼ˆå³å¯„å­˜å™¨ %alï¼‰ç½®ä¸º 0 æˆ– 1ã€‚<code>movzbl</code>æŒ‡ä»¤çš„ä½œç”¨æ˜¯å°†å¯„å­˜å™¨ %eax çš„é«˜ä½ä¸‰ä¸ªå­—èŠ‚ä»¥åŠå¯„å­˜å™¨ %rax çš„é«˜ä½å››ä¸ªå­—èŠ‚å…¨éƒ¨æ¸…é›¶ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="c1">; int comp(data_t a, data_t b)</span>
<span class="c1">; a in rdi%, b in rsi%</span>
<span class="nl">comp:</span>
<span class="w">  </span><span class="nf">cmpq</span><span class="w"> </span><span class="o">%</span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span>
<span class="w">  </span><span class="nf">setl</span><span class="w"> </span><span class="o">%</span><span class="nb">al</span>
<span class="w">  </span><span class="nf">movzbl</span><span class="w"> </span><span class="o">%</span><span class="nb">al</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">eax</span>
<span class="w">  </span><span class="nf">ret</span>
</code></pre></div>
<h3 id="è·³è½¬æŒ‡ä»¤">è·³è½¬æŒ‡ä»¤<a class="headerlink" href="#è·³è½¬æŒ‡ä»¤" title="Permanent link">&para;</a></h3>
<p>è·³è½¬æŒ‡ä»¤å¯ä»¥è®©ç¨‹åºè½¬åˆ°ä¸€ä¸ªå…¨æ–°çš„ä½ç½®ç»§ç»­æ‰§è¡Œï¼Œè¯¥ä½ç½®åœ¨æ±‡ç¼–ä»£ç ä¸­ä½¿ç”¨æ ‡ç­¾ï¼ˆLabelï¼‰æ¥æŒ‡å®šã€‚</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="nf">movq</span><span class="w"> </span><span class="kc">$</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="w">  </span><span class="nf">jmp</span><span class="w"> </span><span class="nv">.L1</span>
<span class="w">  </span><span class="nf">movq</span><span class="w"> </span><span class="p">(</span><span class="nb">rax</span><span class="o">%</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="nb">rdx</span>
<span class="nl">.L1:</span>
<span class="w">  </span><span class="nf">popq</span><span class="w"> </span><span class="o">%</span><span class="nb">rdx</span>
</code></pre></div>
<p>ç¤ºä¾‹ C ç¨‹åºä¸­ï¼ŒæŒ‡ä»¤<code>jmp .L1</code>å°†ä½¿ç¨‹åºè·³è¿‡<code>movq</code>æŒ‡ä»¤ï¼Œå¼€å§‹æ‰§è¡Œ<code>popq</code>æ“ä½œã€‚ ä¸‹å›¾å±•ç¤ºäº†ä¸åŒçš„è·³è½¬æŒ‡ä»¤ï¼š</p>
<p><img alt="alt text" src="../image/image-16.png" /></p>
<p><code>jmp</code>æŒ‡ä»¤æ—¢å¯ä»¥æ˜¯ç›´æ¥è·³è½¬ï¼Œä¹Ÿå¯ä»¥æ˜¯é—´æ¥è·³è½¬ã€‚ç›´æ¥è·³è½¬çš„ç›®æ ‡ä½¿ç”¨æ ‡ç­¾æŒ‡å®šï¼Œè€Œé—´æ¥è·³è½¬çš„ç›®æ ‡åˆ™éœ€è¦ä»å¯„å­˜å™¨æˆ–å†…å­˜ä¸­è¯»å–ã€‚ä¸Šå›¾ä¸­çš„å…¶ä½™æŒ‡ä»¤å‡ä¸ºæ¡ä»¶è·³è½¬ï¼Œå®ƒä»¬æ ¹æ®æ¡ä»¶åˆ¤æ–­çš„ç»“æœæ¥å†³å®šæ˜¯å¦æ‰§è¡Œè·³è½¬æ“ä½œã€‚æ³¨æ„ï¼Œæ¡ä»¶è·³è½¬å‡ä¸ºç›´æ¥è·³è½¬ã€‚</p>
<p>åœ¨ç”Ÿæˆæœºå™¨ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œæ±‡ç¼–å™¨å’Œé“¾æ¥å™¨ä¼šç¡®å®šè·³è½¬ç›®æ ‡ï¼ˆå³ç›®æ ‡æŒ‡ä»¤çš„åœ°å€ï¼‰ï¼Œå¹¶ç¼–ç ä¸ºè·³è½¬æŒ‡ä»¤çš„ä¸€éƒ¨åˆ†ã€‚å…¶ä½¿ç”¨çš„ç¼–ç æ–¹å¼æœ‰å¤šç§ï¼Œä½†å¤§å¤šæ•°ä¸ç¨‹åºè®¡æ•°å™¨ç›¸å…³ï¼Œå³æ¯”è¾ƒç›®æ ‡æŒ‡ä»¤çš„åœ°å€å’Œç´§æŒ¨ç€è·³è½¬æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ä¹‹é—´çš„å·®å¼‚ã€‚è¿™æ ·çš„è¯´æ³•æœ‰äº›ç»•å£ï¼Œæˆ‘ä»¬ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="nf">movq</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span><span class="o">%</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="w">  </span><span class="nf">jmp</span><span class="w"> </span><span class="nv">.L2</span>
<span class="nf">.L3</span>
<span class="w">  </span><span class="nf">sarq</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="nf">.L2</span>
<span class="w">  </span><span class="nf">testq</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="w">  </span><span class="nf">jg</span><span class="w"> </span><span class="nv">.L3</span>
<span class="w">  </span><span class="nf">rep</span><span class="c1">; ret</span>
</code></pre></div>
<p>è¯¥æ±‡ç¼–ä»£ç åŒ…å«äº†ä¸¤ä¸ªè·³è½¬æŒ‡ä»¤ï¼Œç¬¬ä¸€ä¸ªè·³è½¬åˆ°äº†æ›´é«˜çš„åœ°å€å¤„ï¼Œç¬¬äºŒä¸ªåˆ™ç›¸åã€‚è€Œä¸‹å›¾æ˜¯å¯¹ä¸Šè¿°ä»£ç æ±‡ç¼–ç„¶åå†è¿›è¡Œåæ±‡ç¼–åçš„ç»“æœï¼š</p>
<p><img alt="alt text" src="../image/image-17.png" /></p>
<p>åœ¨å³ä¾§æ³¨é‡Šä¸­ï¼Œç¬¬ä¸€ä¸ªè·³è½¬æŒ‡ä»¤ä¸º +0x8ï¼Œç¬¬äºŒä¸ªè·³è½¬æŒ‡ä»¤ä¸º +0x5ã€‚å†çœ‹å·¦ä¾§æŒ‡ä»¤çš„å­—èŠ‚ç¼–ç ï¼Œç¬¬ä¸€ä¸ªæŒ‡ä»¤çš„ç›®æ ‡è¢«ç¼–ç ä¸º 0x03ï¼Œå°†å…¶åŠ ä¸Šä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ 0x5ï¼Œå°±å¾—åˆ°äº†è·³è½¬ç›®æ ‡æŒ‡ä»¤çš„åœ°å€ï¼Œå³ç¬¬å››è¡ŒæŒ‡ä»¤çš„åœ°å€ 0x8ã€‚åŒæ ·ï¼Œç¬¬äºŒä¸ªæŒ‡ä»¤çš„ç›®æ ‡æ˜¯ä½¿ç”¨å•å­—èŠ‚äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºçš„ 0xf8ï¼ˆå³åè¿›åˆ¶æ•° -8ï¼‰ï¼Œå°†å…¶åŠ ä¸Šä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ 0xdï¼Œå°±å¾—åˆ°äº†ç¬¬ä¸‰è¡ŒæŒ‡ä»¤çš„åœ°å€ 0x5ã€‚</p>
<p>å½“ç›®æ ‡ä»£ç æ–‡ä»¶ç»è¿‡é“¾æ¥å™¨å¤„ç†åï¼Œè¿™äº›æŒ‡ä»¤ä¼šè¢«é‡æ–°åˆ†é…åœ°å€ã€‚ä¸è¿‡ç¬¬äºŒè¡Œå’Œç¬¬äº”è¡Œè·³è½¬ç›®æ ‡çš„ç¼–ç ä¾ç„¶ä¸å˜ï¼Œè¿™ç§æ–¹å¼èƒ½å¤Ÿè®©æŒ‡ä»¤ç¼–ç æ›´åŠ ç´§å‡‘ï¼š</p>
<p><img alt="alt text" src="../image/image-18.png" /></p>
<h3 id="ä½¿ç”¨æ¡ä»¶æ§åˆ¶å®ç°æ¡ä»¶åˆ†æ”¯">ä½¿ç”¨æ¡ä»¶æ§åˆ¶å®ç°æ¡ä»¶åˆ†æ”¯<a class="headerlink" href="#ä½¿ç”¨æ¡ä»¶æ§åˆ¶å®ç°æ¡ä»¶åˆ†æ”¯" title="Permanent link">&para;</a></h3>
<p>è‹¥æƒ³å°† C ä¸­çš„æ¡ä»¶è¡¨è¾¾å¼è½¬åŒ–ä¸ºæœºå™¨ä»£ç ï¼Œé€šå¸¸ä½¿ç”¨æ¡ä»¶è·³è½¬å’Œæ— æ¡ä»¶è·³è½¬çš„ç»„åˆã€‚ä¸€ä¸ªç®€å•çš„ C ç¨‹åºåŠå…¶ç¼–è¯‘å¾—åˆ°çš„æ±‡ç¼–ä»£ç åˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">long</span><span class="w"> </span><span class="nf">absdiff</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">; long absdiff(long x, long y) </span>
<span class="c1">; x in %rdi, y in %rsi </span>
<span class="nl">absdiff:</span>
<span class="w">  </span><span class="nf">cmpq</span><span class="w"> </span><span class="o">%</span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span>
<span class="w">  </span><span class="nf">jge</span><span class="w"> </span><span class="nv">.L2</span>
<span class="w">  </span><span class="nf">movq</span><span class="w"> </span><span class="o">%</span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="w">  </span><span class="nf">subq</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="w">  </span><span class="nf">ret</span>
<span class="nf">.L2</span>
<span class="w">  </span><span class="nf">movq</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="w">  </span><span class="nf">subq</span><span class="w"> </span><span class="o">%</span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="w">  </span><span class="nf">ret</span>
</code></pre></div>
<p>å®é™…ä¸Šè¯¥æ±‡ç¼–ä»£ç çš„æ§åˆ¶æµï¼ˆControl Flowï¼‰æ›´åƒæ˜¯ä½¿ç”¨ Goto è¯­å¥å°†ç¤ºä¾‹ C ç¨‹åºæ”¹å†™åå¾—åˆ°çš„ç»“æœï¼Œå³å…ˆæ¯”è¾ƒä¸¤æ•°å¤§å°ï¼Œç„¶åæ ¹æ®ç»“æœå†³å®šæ˜¯å¦è·³è½¬ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">long</span><span class="w"> </span><span class="nf">gotodiff</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">x_ge_y</span><span class="p">;</span>
<span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="nl">x_ge_y</span><span class="p">:</span>
<span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>è®©æˆ‘ä»¬æ¨å¹¿åˆ°ä¸€èˆ¬æƒ…å†µã€‚å‡è®¾ C ä¸­çš„ If-else è¯­å¥æ¨¡æ¿ä¸ºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">test</span><span class="o">-</span><span class="n">expr</span><span class="p">)</span>
<span class="w">    </span><span class="n">then</span><span class="o">-</span><span class="n">statement</span>
<span class="k">else</span>
<span class="w">    </span><span class="k">else</span><span class="o">-</span><span class="n">statement</span>
</code></pre></div>
<p>é‚£ä¹ˆç¼–è¯‘ç”Ÿæˆçš„æ±‡ç¼–ä»£ç çš„æ§åˆ¶æµä¾¿å¯ä»¥ç”¨å¦‚ä¸‹ C ç¨‹åºæè¿°ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="w">Â Â Â Â </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="n">expr</span><span class="p">;</span>
<span class="w">Â Â Â Â </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">t</span><span class="p">)</span>
<span class="w">Â Â Â Â Â Â Â Â </span><span class="k">goto</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">Â Â Â Â </span><span class="n">then</span><span class="o">-</span><span class="n">statement</span>
<span class="w">Â Â Â Â </span><span class="k">goto</span><span class="w"> </span><span class="n">done</span><span class="p">;</span>
<span class="nl">false</span><span class="p">:</span>
<span class="k">else</span><span class="o">-</span><span class="n">statement</span>
<span class="nl">done</span><span class="p">:</span>
</code></pre></div>
<h3 id="ä½¿ç”¨æ¡ä»¶ç§»åŠ¨å®ç°æ¡ä»¶åˆ†æ”¯">ä½¿ç”¨æ¡ä»¶ç§»åŠ¨å®ç°æ¡ä»¶åˆ†æ”¯<a class="headerlink" href="#ä½¿ç”¨æ¡ä»¶ç§»åŠ¨å®ç°æ¡ä»¶åˆ†æ”¯" title="Permanent link">&para;</a></h3>
<p>ä½¿ç”¨æ¡ä»¶æ§åˆ¶å®ç°æ¡ä»¶åˆ†æ”¯è™½ç„¶ç®€å•æœ‰æ•ˆï¼Œä½†åœ¨ç°ä»£å¤„ç†å™¨ä¸Šä½¿ç”¨å¯èƒ½ååˆ†ä½æ•ˆï¼Œæˆ‘ä»¬æ›´å€¾å‘äºä½¿ç”¨ä¸€äº›ç®€å•çš„æ¡ä»¶ç§»åŠ¨æŒ‡ä»¤ã€‚ä¸Šä¸€èŠ‚ä¸­çš„ C ç¨‹åºå¯ä»¥æ”¹å†™ä¸ºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">long</span><span class="w"> </span><span class="nf">cmovdiff</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">rval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">eval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">ntest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/* Line below requires</span>
<span class="cm">    single instruction: */</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ntest</span><span class="p">)</span>
<span class="w">        </span><span class="n">rval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">rval</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>è¿™æ®µä»£ç é¦–å…ˆè®¡ç®—<code>y-x</code>å’Œ<code>x-y</code>ï¼Œåˆ†åˆ«å‘½åä¸ºå˜é‡<code>rval</code>å’Œå˜é‡<code>eval</code>ã€‚ç„¶åæµ‹è¯•<code>x</code>æ˜¯å¦å¤§äºæˆ–ç­‰äº<code>y</code>ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™åœ¨è¿”å›<code>rval</code>ä¹‹å‰å°†<code>eval</code>èµ‹å€¼ç»™<code>rval</code>ã€‚ç¼–è¯‘å™¨å¯ä»¥å‚è€ƒè¿™ç§æ§åˆ¶æµç”Ÿæˆæ±‡ç¼–ä»£ç ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="c1">; long absdiff(long x, long y)</span>
<span class="c1">; x in %rdi, y in %rsi</span>
<span class="nl">absdiff:</span>
<span class="w">  </span><span class="nf">movq</span><span class="w"> </span><span class="o">%</span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="w">  </span><span class="nf">subq</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="w">  </span><span class="nf">movq</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rdx</span>
<span class="w">  </span><span class="nf">subq</span><span class="w"> </span><span class="o">%</span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rdx</span>
<span class="w">  </span><span class="nf">cmpq</span><span class="w"> </span><span class="o">%</span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span>
<span class="w">  </span><span class="nf">cmovge</span><span class="w"> </span><span class="o">%</span><span class="nb">rdx</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="w">  </span><span class="nf">ret</span>
</code></pre></div>
<p>ä¸Šè¿°ä»£ç ä¸­çš„<code>comovge</code>å°±æ˜¯ä¸€ä¸ªæ¡ä»¶ç§»åŠ¨æŒ‡ä»¤ï¼Œåªæœ‰<code>cmpq</code>æŒ‡ä»¤åˆ¤æ–­ä¸€ä¸ªå€¼å¤§äºæˆ–ç­‰äºï¼ˆå¦‚åç¼€ ge æ‰€ç¤ºï¼‰å¦ä¸€ä¸ªå€¼æ—¶ï¼Œå®ƒæ‰ä¼šå°†æ•°æ®ä»æºå¯„å­˜å™¨ä¼ è¾“åˆ°ç›®æ ‡å¯„å­˜å™¨ã€‚</p>
<p>æˆ‘ä»¬å¿…é¡»äº†è§£ç°ä»£å¤„ç†å™¨çš„è¿è¡Œæ–¹å¼ï¼Œæ‰èƒ½æ˜ç™½ä¸ºä»€ä¹ˆåŸºäºæ¡ä»¶ç§»åŠ¨çš„ä»£ç æ•ˆç‡èƒœè¿‡æ¡ä»¶æ§åˆ¶ã€‚ä¸€æ¡æŒ‡ä»¤éœ€è¦å¤„ç†å™¨é€šè¿‡ä¸€ç³»åˆ—çš„æ­¥éª¤è¿›è¡Œå¤„ç†ï¼Œæ¯ä¸ªæ­¥éª¤åªæ‰§è¡Œæ‰€è¯¥æŒ‡ä»¤çš„ä¸€å°éƒ¨åˆ†ï¼ˆä¾‹å¦‚ï¼Œä»å†…å­˜ä¸­è·å–æŒ‡ä»¤ï¼Œç¡®å®šæŒ‡ä»¤ç±»å‹ã€ä»å†…å­˜è¯»å–ã€æ‰§è¡Œç®—æœ¯è¿ç®—ã€å†™å…¥å†…å­˜å’Œæ›´æ–°ç¨‹åºè®¡æ•°å™¨ç­‰ï¼‰ã€‚ä¸ºäº†å®ç°é«˜æ€§èƒ½ï¼Œè¿™æ¡æµæ°´çº¿ï¼ˆPipeliningï¼‰éœ€è¦å°†æŒ‡ä»¤çš„æ­¥éª¤é‡å ã€‚ä¾‹å¦‚ï¼Œåœ¨æ‰§è¡Œå‰ä¸€æ¡æŒ‡ä»¤çš„ç®—æœ¯è¿ç®—çš„åŒæ—¶æå–ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚æƒ³è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¤„ç†å™¨éœ€è¦èƒ½å¤Ÿæå‰ç¡®å®šå³å°†æ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—ï¼Œä»¥ä¿è¯æµæ°´çº¿ä¸Šå……æ»¡æŒ‡ä»¤ã€‚</p>
<p>å½“å¤„ç†å™¨é‡åˆ°æ¡ä»¶è·³è½¬ï¼ˆå³åˆ†æ”¯ï¼‰æ—¶ï¼Œå®ƒå°†é‡‡ç”¨å¤æ‚çš„é€»è¾‘æ¥é¢„æµ‹è·³è½¬æŒ‡ä»¤æ˜¯å¦è§¦å‘ã€‚å¦‚æœé¢„æµ‹ç»“æœè¶³å¤Ÿå¯é ï¼ˆç°ä»£å¾®å¤„ç†å™¨è¯•å›¾è¾¾åˆ° 90% çš„æˆåŠŸç‡ï¼‰ï¼Œæµæ°´çº¿å°±å¯ä»¥ä¿æŒæŒ‡ä»¤å……æ»¡ã€‚ä½†æ˜¯ï¼Œé”™è¯¯çš„é¢„æµ‹å°†å¯¼è‡´å¤„ç†å™¨ä¸å¾—ä¸ä¸¢å¼ƒå®ƒåœ¨æœªæ¥æŒ‡ä»¤ä¸Šå·²ç»å®Œæˆçš„å¤§éƒ¨åˆ†å·¥ä½œï¼Œä½¿ç¨‹åºæ€§èƒ½ä¸¥é‡ä¸‹é™ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ä¸­<code>x &gt;= y</code>çš„åˆ¤æ–­ç»“æœæ˜¾ç„¶æ˜¯éš¾ä»¥é¢„æµ‹çš„ï¼Œè¿™ç§æƒ…å†µä¸‹ä½¿ç”¨æ¡ä»¶æ§åˆ¶ä»£ç çš„æ•ˆç‡å¾ˆä½ã€‚è€Œæ¡ä»¶ç§»åŠ¨ä»£ç å…ˆè®¡ç®—å‡ºæ‰€æœ‰å¯èƒ½çš„ç»“æœï¼Œå†æ ¹æ®æ¡ä»¶åˆ¤æ–­å†³å®šè¿”å›å€¼ã€‚è¿™æ ·æ§åˆ¶æµä¾¿ä¸å†ä¾èµ–æ•°æ®ï¼Œå¤„ç†å™¨ä¹Ÿå°±æ›´å®¹æ˜“ä¿æŒå…¶æµæ°´çº¿çš„å®Œæ•´æ€§ï¼Œä»è€Œæå‡æ‰§è¡Œæ•ˆç‡ã€‚å…¨éƒ¨çš„æ¡ä»¶ç§»åŠ¨æŒ‡ä»¤å¦‚ä¸‹ï¼š</p>
<p><img alt="alt text" src="../image/image-19.png" /></p>
<p>ç¼–è¯‘å™¨å¯ä»¥ä»ç›®æ ‡å¯„å­˜å™¨çš„åç§°æ¨æ–­æ¡ä»¶ç§»åŠ¨æŒ‡ä»¤çš„æ“ä½œæ•°é•¿åº¦ï¼Œå› æ­¤ç›¸åŒçš„æŒ‡ä»¤åç§°å¯ç”¨äºä¸åŒçš„æ“ä½œæ•°é•¿åº¦ã€‚æˆ‘ä»¬åŒæ ·æŠŠæ¡ä»¶åˆ†æ”¯æ¨å¹¿åˆ°ä¸€èˆ¬æƒ…å†µï¼Œä½¿ç”¨ C ç¨‹åºæ¥æè¿°æ¡ä»¶ç§»åŠ¨çš„æ§åˆ¶æµï¼š</p>
<div class="highlight"><pre><span></span><code><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">expr</span><span class="p">;</span>
<span class="n">ve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">expr</span><span class="p">;</span>
<span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">expr</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">t</span><span class="p">)</span>
<span class="w">    </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ve</span><span class="p">;</span>
</code></pre></div>
<p>å½“ç„¶ï¼Œä½¿ç”¨æ¡ä»¶ç§»åŠ¨æ¥å®ç°æ¡ä»¶åˆ†æ”¯æ˜¯ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹çš„ã€‚å› ä¸ºæ— è®ºåˆ¤æ–­ç»“æœå¦‚ä½•ï¼Œæˆ‘ä»¬éƒ½ä¼šå…¨éƒ¨æ‰§è¡Œ then-expr å’Œ else-exprã€‚ä¸€æ—¦æŸä¸€ä¸ªåˆ†æ”¯ä¸­çš„æŒ‡ä»¤å‘ç”Ÿé”™è¯¯ï¼Œå°†å½±å“æ•´ä¸ªç¨‹åºçš„å¯ç”¨æ€§ã€‚å¦å¤–ï¼Œå¦‚æœ then-expr æˆ– else-expr éœ€è¦å¤§é‡è®¡ç®—ï¼Œè€Œå¯¹åº”çš„æ¡ä»¶åˆä¸æˆç«‹æ—¶ï¼Œå¤„ç†å™¨æ‰€åšçš„å·¥ä½œå°±å®Œå…¨ç™½è´¹äº†ã€‚ä¸è¿‡æ€»ä½“æ¥è¯´ï¼Œæ¡ä»¶ç§»åŠ¨çš„æ€§èƒ½è¿˜æ˜¯é«˜äºæ¡ä»¶æ§åˆ¶çš„ï¼Œè¿™ä¹Ÿæ˜¯ GCC ç¼–è¯‘å™¨ä½¿ç”¨å®ƒçš„åŸå› ã€‚</p>
<h3 id="å¾ªç¯">å¾ªç¯<a class="headerlink" href="#å¾ªç¯" title="Permanent link">&para;</a></h3>
<h4 id="do-while">Do-While<a class="headerlink" href="#do-while" title="Permanent link">&para;</a></h4>
<p>å‡è®¾ C ä¸­çš„ Do-While è¯­å¥æ¨¡æ¿ä¸ºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">do</span>
<span class="w">    </span><span class="n">body</span><span class="o">-</span><span class="n">statement</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">text</span><span class="o">-</span><span class="n">expr</span><span class="p">);</span>
</code></pre></div>
<p>æˆ‘ä»¬å¯ä»¥å°†å…¶è½¬åŒ–ä¸º Goto è¯­å¥å’Œ If-else è¯­å¥çš„ç»„åˆï¼š</p>
<div class="highlight"><pre><span></span><code><span class="nl">loop</span><span class="p">:</span>
<span class="w">    </span><span class="n">body</span><span class="o">-</span><span class="n">statement</span>
<span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="o">-</span><span class="n">expr</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">loop</span><span class="p">;</span>
</code></pre></div>
<p>å®é™…ä¸Šæ±‡ç¼–ä»£ç æ­£æ˜¯ç”¨è¿™ç§æ–¹å¼æ¥å®ç° Do-While è¯­å¥çš„æ§åˆ¶æµ ã€‚ç¤ºä¾‹å‡½æ•°<code>fact_do</code>åŠå…¶ç¼–è¯‘å¾—åˆ°çš„æ±‡ç¼–ä»£ç åˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">long</span><span class="w"> </span><span class="nf">fact_do</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">do</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">        </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">; long fact_do(long n)</span>
<span class="c1">; n in %rdi</span>
<span class="nl">fact_do:</span>
<span class="w">  </span><span class="nf">movl</span><span class="w"> </span><span class="kc">$</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">eax</span>
<span class="nl">.L2:</span>
<span class="w">  </span><span class="nf">imulq</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="w">  </span><span class="nf">subq</span><span class="w"> </span><span class="kc">$</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span>
<span class="w">  </span><span class="nf">cmpq</span><span class="w"> </span><span class="kc">$</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span>
<span class="w">  </span><span class="nf">jq</span><span class="w"> </span><span class="nv">.L2</span>
<span class="w">  </span><span class="nf">rep</span><span class="c1">; ret</span>
</code></pre></div>
<h4 id="while">While<a class="headerlink" href="#while" title="Permanent link">&para;</a></h4>
<p>å‡è®¾ C ä¸­çš„ While è¯­å¥æ¨¡æ¿ä¸ºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">text</span><span class="o">-</span><span class="n">expr</span><span class="p">);</span>
<span class="w">    </span><span class="n">body</span><span class="o">-</span><span class="n">statement</span>
</code></pre></div>
<p>æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•å°†å…¶è½¬åŒ–ä¸º Goto è¯­å¥å’Œ If-else è¯­å¥çš„ç»„åˆã€‚ç¬¬ä¸€ç§è¢«ç§°ä¸º Jump-to-Middleï¼Œé€šè¿‡ä¸€ä¸ªéæ¡ä»¶è·³è½¬åœ¨å¾ªç¯çš„ç»“æŸæ‰§è¡Œæ¡ä»¶åˆ¤æ–­ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="n">test</span><span class="p">;</span>
<span class="nl">loop</span><span class="p">:</span>
<span class="w">    </span><span class="n">body</span><span class="o">-</span><span class="n">statement</span>
<span class="nl">test</span><span class="p">:</span>
<span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="o">-</span><span class="n">expr</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">loop</span><span class="p">;</span>
</code></pre></div>
<p>å½“ GCC çš„ä¼˜åŒ–å‚æ•°æŒ‡å®šä¸º<code>-Og</code>æ—¶ï¼Œæ±‡ç¼–ä»£ç å°±ä¼šç”¨è¿™ç§æ–¹æ³•æ¥å®ç° While è¯­å¥çš„æ§åˆ¶æµ ã€‚ç¤ºä¾‹å‡½æ•°<code>fact_while</code>åŠå…¶ç¼–è¯‘å¾—åˆ°çš„æ±‡ç¼–ä»£ç åˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">long</span><span class="w"> </span><span class="nf">fact_while</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">        </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">; long fact_while(long n)</span>
<span class="c1">; n in %rdi</span>
<span class="nl">fact_while:</span>
<span class="w">  </span><span class="nf">movl</span><span class="w"> </span><span class="kc">$</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">eax</span><span class="w"> </span>
<span class="w">  </span><span class="nf">jmp</span><span class="w"> </span><span class="nv">.L5</span>
<span class="nl">.L6:</span>
<span class="w">  </span><span class="nf">imulq</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span><span class="w"> </span>
<span class="w">  </span><span class="nf">subq</span><span class="w"> </span><span class="kc">$</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span>
<span class="nl">.L5:</span><span class="w"> </span>
<span class="w">  </span><span class="nf">cmpq</span><span class="w"> </span><span class="kc">$</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span>
<span class="w">  </span><span class="nf">jg</span><span class="w"> </span><span class="nv">.L6</span>
<span class="w">  </span><span class="nf">rep</span><span class="c1">; ret</span>
</code></pre></div>
<p>ç¬¬äºŒç§æ–¹æ³•è¢«ç§°ä¸º Guarded-Doï¼Œå³é¦–å…ˆå°†ä»£ç è½¬åŒ–ä¸º Do-While å¾ªç¯ï¼Œå¦‚æœæ¡ä»¶åˆ¤æ–­å¤±è´¥åˆ™é€šè¿‡æ¡ä»¶ç§»åŠ¨æŒ‡ä»¤è·³è¿‡å¾ªç¯ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="n">expr</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">t</span><span class="p">)</span>
<span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">done</span><span class="p">;</span>
<span class="nl">loop</span><span class="p">:</span>
<span class="w">    </span><span class="n">body</span><span class="o">-</span><span class="n">statement</span><span class="w"> </span>
<span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="n">expr</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">loop</span><span class="p">;</span>
<span class="nl">done</span><span class="p">:</span>
</code></pre></div>
<p>å½“ GCC çš„ä¼˜åŒ–å‚æ•°æŒ‡å®šä¸ºæ›´é«˜çº§åˆ«çš„<code>-O1</code>æ—¶ï¼Œæ±‡ç¼–ä»£ç å°±ä¼šç”¨è¿™ç§æ–¹æ³•æ¥å®ç° While è¯­å¥çš„æ§åˆ¶æµ ã€‚ä¸Šé¢æåˆ°çš„å‡½æ•°<code>fact_while</code>ä½¿ç”¨ Guarded-Do ç¼–è¯‘å¾—åˆ°çš„æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="c1">; long fact_while(long n) </span>
<span class="c1">; n in %rdi</span>
<span class="nf">fact_while</span>
<span class="w">  </span><span class="nf">cmpq</span><span class="w"> </span><span class="kc">$</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span>
<span class="w">  </span><span class="nf">jle</span><span class="w"> </span><span class="nv">.L7</span>
<span class="w">  </span><span class="nf">movl</span><span class="w"> </span><span class="kc">$</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">eax</span>
<span class="nl">.L6:</span>
<span class="w">  </span><span class="nf">imulq</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="w">  </span><span class="nf">subq</span><span class="w"> </span><span class="kc">$</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span>
<span class="w">  </span><span class="nf">cmpq</span><span class="w"> </span><span class="kc">$</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span>
<span class="w">  </span><span class="nf">jne</span><span class="w"> </span><span class="nv">.L6</span>
<span class="w">  </span><span class="nf">rep</span><span class="c1">; ret</span>
<span class="nf">.L7</span>
<span class="w">  </span><span class="nf">movl</span><span class="w"> </span><span class="kc">$</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">eax</span>
<span class="w">  </span><span class="nf">ret</span>
</code></pre></div>
<h4 id="for">For<a class="headerlink" href="#for" title="Permanent link">&para;</a></h4>
<p>å‡è®¾ C ä¸­çš„ For è¯­å¥æ¨¡æ¿ä¸ºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">init</span><span class="o">-</span><span class="n">expr</span><span class="p">;</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="n">expr</span><span class="p">;</span><span class="w"> </span><span class="n">update</span><span class="o">-</span><span class="n">expr</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="n">body</span><span class="o">-</span><span class="n">statement</span>
</code></pre></div>
<p>æ˜¾ç„¶å¯ä»¥å°†å…¶è½¬åŒ–ä¸ºç­‰æ•ˆçš„ While è¯­å¥ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="n">init</span><span class="o">-</span><span class="n">expr</span><span class="p">;</span>
<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">test</span><span class="o">-</span><span class="n">expr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">body</span><span class="o">-</span><span class="n">statement</span>
<span class="w">    </span><span class="n">update</span><span class="o">-</span><span class="n">expr</span><span class="p">;</span><span class="w"> </span>
<span class="p">}</span>
</code></pre></div>
<p>å› æ­¤ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹æ³•æ¥å°†å…¶è½¬åŒ–ä¸º Goto è¯­å¥å’Œ If-else è¯­å¥çš„ç»„åˆã€‚</p>
<p>Jump-to-Middleï¼š</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="n">init</span><span class="o">-</span><span class="n">expr</span><span class="p">;</span>
<span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="n">test</span><span class="p">;</span>
<span class="nl">loop</span><span class="p">:</span>
<span class="w">    </span><span class="n">body</span><span class="o">-</span><span class="n">statement</span>
<span class="w">    </span><span class="n">update</span><span class="o">-</span><span class="n">expr</span><span class="p">;</span><span class="w"> </span>
<span class="nl">test</span><span class="p">:</span>
<span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="n">expr</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">loop</span><span class="p">;</span>
</code></pre></div>
<p>Guarded-Doï¼š</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="n">init</span><span class="o">-</span><span class="n">expr</span><span class="p">;</span>
<span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="n">expr</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">t</span><span class="p">)</span>
<span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">done</span><span class="p">;</span>
<span class="nl">loop</span><span class="p">:</span>
<span class="w">    </span><span class="n">body</span><span class="o">-</span><span class="n">statement</span><span class="w"> </span>
<span class="w">    </span><span class="n">update</span><span class="o">-</span><span class="n">expr</span><span class="p">;</span>
<span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test</span><span class="o">-</span><span class="n">expr</span><span class="p">;</span><span class="w"> </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">loop</span><span class="p">;</span>
<span class="nl">done</span><span class="p">:</span>
</code></pre></div>
<p>åŒæ ·åœ°ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®ç»™å®šçš„ä¼˜åŒ–å‚æ•°ä½¿ç”¨å¯¹åº”çš„æ§åˆ¶æµæ¥ç”Ÿæˆæ±‡ç¼–ä»£ç ã€‚</p>
<h3 id="switch">Switch<a class="headerlink" href="#switch" title="Permanent link">&para;</a></h3>
<p>GCC ä¼šæ ¹æ® Switch è¯­å¥ä¸­ Case çš„æ•°é‡å’Œ Case å€¼çš„ç¨€ç–æ€§ï¼ˆSparsityï¼‰å†³å®šç¼–è¯‘æ–¹æ³•ã€‚å½“å­˜åœ¨å¤šç§ Caseï¼ˆä¾‹å¦‚å››ä¸ªæˆ–æ›´å¤šï¼‰ï¼Œä¸”å®ƒä»¬è·¨è¶Šçš„å€¼èŒƒå›´è¾ƒå°æ—¶ä¼šä½¿ç”¨ä¸€ç§åä¸ºè·³è½¬è¡¨ï¼ˆJump Tableï¼‰çš„æ•°æ®ç»“æ„æ¥å®ç°ã€‚è·³è½¬è¡¨æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å…ƒç´ åˆ†åˆ«æ˜¯ Switch è¯­å¥ä¸­æ¯ä¸ª Case å¯¹åº”çš„ä»£ç å—åœ°å€ã€‚</p>
<p>ä¸€ä¸ªç®€å•çš„ C ç¨‹åºåŠå…¶é€šè¿‡ GCC ç¼–è¯‘åå¾—åˆ°çš„æ±‡ç¼–ä»£ç åˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">switch_eg</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="o">*</span><span class="n">dest</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">100</span><span class="p">:</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mi">13</span><span class="p">;</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">102</span><span class="p">:</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="w">        </span><span class="cm">/* Fall through */</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">103</span><span class="p">:</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">11</span><span class="p">;</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">104</span><span class="p">:</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">106</span><span class="p">:</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">default</span><span class="o">:</span>
<span class="w">        </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="o">*</span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">; void switch_eg(long x, long n, long *dest) </span>
<span class="c1">; x in %rdi, n in %rsi, dest in %rdx </span>
<span class="nl">switch_eg:</span>
<span class="w">  </span><span class="nf">subq</span><span class="w"> </span><span class="kc">$</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rsi</span>
<span class="w">  </span><span class="nf">cmpq</span><span class="w"> </span><span class="kc">$</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rsi</span>
<span class="w">  </span><span class="nf">ja</span><span class="w"> </span><span class="nv">.L8</span>
<span class="w">  </span><span class="nf">jmp</span><span class="w"> </span><span class="o">*</span><span class="nv">.L4</span><span class="p">(,</span><span class="o">%</span><span class="nb">rsi</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="nl">.L3:</span>
<span class="w">  </span><span class="nf">leaq</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="nb">rdi</span><span class="p">,</span><span class="o">%</span><span class="nb">rdi</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="w">  </span><span class="nf">leaq</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="nb">rdi</span><span class="p">,</span><span class="o">%</span><span class="nb">rax</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span>
<span class="w">  </span><span class="nf">jmp</span><span class="w"> </span><span class="nv">.L2</span>
<span class="nl">.L5:</span>
<span class="w">  </span><span class="nf">addq</span><span class="w"> </span><span class="kc">$</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span>
<span class="nl">.L6:</span>
<span class="w">  </span><span class="nf">addq</span><span class="w"> </span><span class="kc">$</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span>
<span class="w">  </span><span class="nf">jmp</span><span class="w"> </span><span class="nv">.L2</span>
<span class="nl">.L7:</span>
<span class="w">  </span><span class="nf">imulq</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span>
<span class="w">  </span><span class="nf">jmp</span><span class="w"> </span><span class="nv">.L2</span>
<span class="nl">.L8:</span>
<span class="w">  </span><span class="nf">movl</span><span class="w"> </span><span class="kc">$</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">edi</span>
<span class="nl">.L2:</span>
<span class="w">  </span><span class="nf">movq</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="nb">rdx</span><span class="p">)</span>
<span class="w">  </span><span class="nf">ret</span>
</code></pre></div>
<p>ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬ç”¨ C æ¥æè¿°å…¶å®ç°ï¼ˆè¿ç®—ç¬¦<code>&amp;&amp;</code>ä¼šä¸ºä»£ç å—çš„ä½ç½®åˆ›å»ºæŒ‡é’ˆï¼‰ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">switch_eg_impl</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="o">*</span><span class="n">dest</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="cm">/* Table of code pointers */</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">jt</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="n">loc_A</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="n">loc_def</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="n">loc_B</span><span class="p">,</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="n">loc_C</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="n">loc_D</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="n">loc_def</span><span class="p">,</span>
<span class="w">        </span><span class="o">&amp;&amp;</span><span class="n">loc_D</span><span class="p">};</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span>
<span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="n">loc_def</span><span class="p">;</span>
<span class="w">    </span><span class="cm">/* Multiway branch */</span>
<span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="o">*</span><span class="n">jt</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
<span class="nl">loc_A</span><span class="p">:</span><span class="w"> </span><span class="cm">/* Case 100 */</span>
<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">13</span><span class="p">;</span>
<span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="n">done</span><span class="p">;</span>
<span class="nl">loc_B</span><span class="p">:</span><span class="w"> </span><span class="cm">/* Case 102 */</span>
<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="nl">loc_C</span><span class="p">:</span><span class="w"> </span><span class="cm">/* Case 103 */</span>
<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">11</span><span class="p">;</span>
<span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="n">done</span><span class="p">;</span>
<span class="nl">loc_D</span><span class="p">:</span><span class="w"> </span><span class="cm">/* Case 104, 106 */</span>
<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="n">done</span><span class="p">;</span>
<span class="nl">loc_def</span><span class="p">:</span><span class="w"> </span><span class="cm">/* Default case */</span>
<span class="w">    </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="nl">done</span><span class="p">:</span>
<span class="w">    </span><span class="o">*</span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>å…¶ä¸­çš„<code>goto *jt[index]</code>å°±ç›¸å½“äºæ±‡ç¼–ä»£ç ä¸­ç¬¬äº”è¡Œçš„<code>jmp *.L4(,%rsi,8)</code>ã€‚å®ƒæ˜¯ä¸€ä¸ªé—´æ¥è·³è½¬æŒ‡ä»¤ï¼Œå…¶æ“ä½œæ•°<code>.L4(,%rsi,8)</code>æŒ‡å®šäº†ç”±å¯„å­˜å™¨ %rsi ç´¢å¼•çš„å†…å­˜åœ°å€ï¼ˆæˆ‘ä»¬å°†åœ¨åç»­ç« èŠ‚è®¨è®ºæ•°ç»„æ˜¯å¦‚ä½•è½¬åŒ–ä¸ºæœºå™¨ä»£ç çš„ï¼‰ã€‚</p>
<p>åœ¨æ±‡ç¼–ä»£ç ä¸­ï¼Œè·³è½¬è¡¨å°†è¢«è¡¨ç¤ºä¸ºï¼š</p>
<p><img alt="alt text" src="../image/image-20.png" /></p>
<p>åœ¨åä¸º<code>.rodata</code>çš„åªè¯»ç›®æ ‡ä»£ç æ®µä¸­ï¼ŒåŒ…å«äº†ç”±ä¸ƒä¸ª<code>quad</code>ï¼ˆå…«å­—èŠ‚ï¼‰ç»„æˆçš„åºåˆ—ï¼Œæ¯ä¸ª<code>quad</code>çš„å€¼ä¸ºæ±‡ç¼–ä»£ç æ ‡ç­¾ï¼ˆå¦‚<code>.L3</code>ï¼‰æ‰€å¯¹åº”çš„æŒ‡ä»¤åœ°å€ã€‚</p>
<h2 id="è¿‡ç¨‹">è¿‡ç¨‹<a class="headerlink" href="#è¿‡ç¨‹" title="Permanent link">&para;</a></h2>
<p>è¿‡ç¨‹ï¼ˆProcedureï¼‰åœ¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ä¸­æœ‰ä¸åŒçš„å«æ³•ï¼Œå¦‚å‡½æ•°ï¼ˆFunctionï¼‰ã€æ–¹æ³•ï¼ˆMethodï¼‰ã€å­ç¨‹åºï¼ˆSubroutineï¼‰å’Œå¤„ç†å™¨ï¼ˆHandlerï¼‰ç­‰ï¼Œä¸è¿‡å®ƒä»¬éƒ½æä¾›äº†ä¸€ç§æ‰“åŒ…ä»£ç çš„æ–¹æ³•ã€‚è¯¥ä»£ç ä½¿ç”¨ä¸€ç»„å‚æ•°å’Œå¯é€‰çš„è¿”å›å€¼æ¥å®ç°æŸäº›åŠŸèƒ½ï¼Œå¹¶å¯ä»¥åœ¨ç¨‹åºçš„ä¸åŒä½ç½®è°ƒç”¨ã€‚</p>
<p>å‡è®¾è¿‡ç¨‹ P è°ƒç”¨äº†è¿‡ç¨‹ Qï¼ŒQ æ‰§è¡Œå®Œæ¯•åè¿”å› Pã€‚é‚£ä¹ˆï¼š</p>
<ul>
<li>ä¼ é€’æ§åˆ¶ï¼šåœ¨è°ƒç”¨ Q æ—¶ç¨‹åºè®¡æ•°å™¨å¿…é¡»è®¾ç½®ä¸ºå…¶ä»£ç åœ°å€ï¼ŒåŒæ—¶åœ¨è¿”å› P æ—¶ä¹Ÿè¦ç½®ä¸º P çš„ä»£ç åœ°å€ï¼›</li>
<li>ä¼ é€’å‚æ•°ï¼šP å¿…é¡»èƒ½å‘ Q æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼Œåä¹‹ Q å¿…é¡»èƒ½å°†å€¼è¿”å›ç»™ Pï¼›</li>
<li>åˆ†é…å’Œé‡Šæ”¾å†…å­˜ï¼šåœ¨è°ƒç”¨ Q ä¹‹å‰å¯èƒ½éœ€è¦ä¸ºå…¶å±€éƒ¨å˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼Œå¹¶åœ¨è¿”å›æ—¶é‡Šæ”¾ã€‚</li>
</ul>
<h3 id="è¿è¡Œæ—¶æ ˆ">è¿è¡Œæ—¶æ ˆ<a class="headerlink" href="#è¿è¡Œæ—¶æ ˆ" title="Permanent link">&para;</a></h3>
<p><img alt="alt text" src="../image/image-21.png" /></p>
<p>å½“è¿‡ç¨‹æ‰€éœ€çš„å­˜å‚¨ç©ºé—´è¶…è¿‡å¯„å­˜å™¨æ‰€èƒ½å®¹çº³çš„èŒƒå›´æ—¶ï¼Œå®ƒä¾¿ä¼šåœ¨è¿è¡Œæ—¶æ ˆä¸Šåˆ†é…ç©ºé—´ã€‚ä¸Šå›¾ä¸ºè¿è¡Œæ—¶æ ˆçš„ä¸€èˆ¬ç»“æ„ï¼Œä¸»è¦ç”±æ‰§è¡Œè¿‡ç¨‹ Q å’Œè°ƒç”¨è¿‡ç¨‹ P æ‰€éœ€çš„å¸§ï¼ˆFrameï¼‰ç»„æˆã€‚æ¯ä¸ªè¿‡ç¨‹å¯ä»¥åœ¨å…¶æ ˆå¸§å†…ä¿å­˜å¯„å­˜å™¨çš„å€¼ï¼ˆå›¾ä¸­çš„â€œSaved Registersâ€ï¼‰ï¼Œä¸ºå±€éƒ¨å˜é‡åˆ†é…ç©ºé—´ï¼ˆå›¾ä¸­çš„â€œLocal Variablesâ€ï¼‰ï¼Œä»¥åŠä¸ºå…¶è°ƒç”¨çš„è¿‡ç¨‹è®¾ç½®å‚æ•°ï¼ˆå›¾ä¸­çš„â€œArgumentâ€ï¼‰ç­‰ã€‚å½“ P è°ƒç”¨ Q æ—¶ï¼Œå®ƒä¼šå°†è¿”å›åœ°å€ï¼ˆå›¾ä¸­â€œReturn Addressâ€ï¼‰å‹å…¥æ ˆä¸­ã€‚è¿™æ ·å½“ Q è¿”å›æ—¶ï¼Œç¨‹åºä¾¿çŸ¥é“åº”è¯¥åœ¨å“ªé‡Œæ¢å¤æ‰§è¡Œ Pã€‚</p>
<p>ä¸è¿‡å‡ºäºå¯¹æ—¶é—´å’Œç©ºé—´æ•ˆç‡çš„è€ƒè™‘ï¼Œç¨‹åºåªä¼šä¸ºè¿‡ç¨‹åˆ†é…å®ƒä»¬å¿…é¡»çš„æ ˆå¸§ã€‚ä¾‹å¦‚æŸä¸ªè¿‡ç¨‹çš„å‚æ•°ä¸è¶³ 6 ä¸ªï¼Œé‚£ä¹ˆå®ƒä»¬å°†å…¨éƒ¨å­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­è€Œéè¿è¡Œæ—¶æ ˆï¼ˆå›¾ä¸­çš„å‚æ•°åŒºæ˜¯ä» Argument 7 å¼€å§‹çš„ï¼‰ã€‚è®¸å¤šè¿‡ç¨‹çš„å±€éƒ¨å˜é‡å¾ˆå°‘ä¸”ä¸è°ƒç”¨å…¶ä»–è¿‡ç¨‹ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦è¿è¡Œæ—¶æ ˆã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šå¯¹è¿è¡Œæ—¶æ ˆä¸­çš„å„ä¸ªåŒºåŸŸè¿›è¡Œæ›´ä¸ºæ·±å…¥åœ°è®¨è®ºã€‚</p>
<h3 id="ä¼ é€’æ§åˆ¶">ä¼ é€’æ§åˆ¶<a class="headerlink" href="#ä¼ é€’æ§åˆ¶" title="Permanent link">&para;</a></h3>
<p>åœ¨æ±‡ç¼–ä»£ç ä¸­ï¼Œè¿‡ç¨‹é—´è°ƒç”¨æ˜¯é€šè¿‡æŒ‡ä»¤<code>call</code>å’Œ<code>ret</code>æ¥å®ç°çš„ã€‚å…¶ä¸­ï¼ŒæŒ‡ä»¤<code>call Q</code>ä¼šå°†ç¨‹åºè®¡æ•°å™¨è®¾ç½®ä¸ºè¿‡ç¨‹ Q ä»£ç çš„èµ·å§‹åœ°å€ï¼Œå¹¶å°†è¿”å›åœ°å€ A å‹å…¥æ ˆä¸­ã€‚æŒ‡ä»¤<code>ret</code>åˆ™ä¼šå°†åœ°å€ A ä»æ ˆä¸­å¼¹å‡ºï¼Œç„¶åå°†ç¨‹åºè®¡æ•°å™¨è®¾ç½®ä¸º Aã€‚å®é™…ä¸Šï¼Œåœ°å€ A å°±æ˜¯ç´§è·Ÿåœ¨<code>call</code>æŒ‡ä»¤ä¹‹åçš„æŒ‡ä»¤çš„åœ°å€ã€‚</p>
<p>ä¸‹å›¾è¯´æ˜äº† <a href="/posts/machine-level-representation-of-programs-note/#ä»£ç ç¤ºä¾‹">ä»£ç ç¤ºä¾‹</a> ä¸­ä¸»å‡½æ•°è°ƒç”¨<code>multstore</code>åè¿”å›çš„è¿‡ç¨‹ä¸­è¿è¡Œæ—¶æ ˆçš„å˜åŒ–æƒ…å†µï¼š</p>
<p><img alt="alt text" src="../image/image-22.png" /></p>
<p>å…¶å¯¹åº”çš„åæ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img alt="alt text" src="../image/image-23.png" /></p>
<p>å½“ä¸»å‡½æ•°è°ƒç”¨å‡½æ•°<code>multstore</code>æ—¶ï¼Œç¨‹åºè®¡æ•°å™¨ %rip ä¸­çš„å€¼ä¸º<code>call</code>æŒ‡ä»¤çš„åœ°å€ 0x400563ã€‚è¯¥æŒ‡ä»¤å°†è¿”å›åœ°å€ 0x400568 å‹å…¥æ ˆä¸­å¹¶è·³è½¬åˆ°å‡½æ•°<code>multstore</code>ä¸­çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ï¼Œå…¶åœ°å€ä¸º 0x0400540ã€‚ éšåå‡½æ•°<code>multstore</code>ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°åœ°å€ 0x40054d å¤„çš„<code>ret</code>æŒ‡ä»¤ã€‚ è¯¥æŒ‡ä»¤å°†è¿”å›åœ°å€ 0x400568 ä»æ ˆä¸­å¼¹å‡ºå¹¶è·³è½¬åˆ°è¯¥åœ°å€å¯¹åº”çš„æŒ‡ä»¤ï¼Œä¸»å‡½æ•°å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚</p>
<h3 id="ä¼ é€’å‚æ•°">ä¼ é€’å‚æ•°<a class="headerlink" href="#ä¼ é€’å‚æ•°" title="Permanent link">&para;</a></h3>
<p>åœ¨ x86-64 æœºå™¨ä¸Šï¼Œæœ€å¤šå¯ä»¥é€šè¿‡å¯„å­˜å™¨ä¼ é€’å…­ä¸ªå‚æ•°ï¼š</p>
<p><img alt="alt text" src="../image/image-24.png" /></p>
<p>ç¬¬ä¸ƒä¸ªåŠä¹‹åçš„å‚æ•°å°†å­˜å‚¨åœ¨è¿è¡Œæ—¶æ ˆä¸­ã€‚ä¸€ä¸ªç®€å•çš„ C ç¨‹åºåŠå…¶é€šè¿‡ GCC ç¼–è¯‘åå¾—åˆ°çš„æ±‡ç¼–ä»£ç åˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">proc</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="o">*</span><span class="n">a1p</span><span class="p">,</span>
<span class="w">          </span><span class="kt">int</span><span class="w"> </span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">a2p</span><span class="p">,</span>
<span class="w">          </span><span class="kt">short</span><span class="w"> </span><span class="n">a3</span><span class="p">,</span><span class="w"> </span><span class="kt">short</span><span class="w"> </span><span class="o">*</span><span class="n">a3p</span><span class="p">,</span>
<span class="w">          </span><span class="kt">char</span><span class="w"> </span><span class="n">a4</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">a4p</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="o">*</span><span class="n">a1p</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">a1</span><span class="p">;</span>
<span class="w">    </span><span class="o">*</span><span class="n">a2p</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">a2</span><span class="p">;</span>
<span class="w">    </span><span class="o">*</span><span class="n">a3p</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">a3</span><span class="p">;</span>
<span class="w">    </span><span class="o">*</span><span class="n">a4p</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">a4</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><img alt="alt text" src="../image/image-25.png" /></p>
<p>è™½ç„¶å‚æ•°<code>a4</code>çš„ç±»å‹ä¸º<code>char</code>ï¼Œä½†ç¨‹åºåˆ†åˆ«é€šè¿‡<code>8(%rsp)</code>å’Œ<code>16(%rsp)</code>æ¥å¯¹å®ƒå’ŒæŒ‡é’ˆç±»å‹çš„<code>a4p</code>è¿›è¡Œå¯»å€ï¼Œè¯´æ˜ä¸¤è€…å‡å ç”¨äº†æ ˆä¸­ 8 ä¸ªå­—èŠ‚çš„ç©ºé—´ã€‚å‚æ•°çš„æ ˆå¸§ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img alt="alt text" src="../image/image-26.png" /></p>
<h3 id="å±€éƒ¨å˜é‡">å±€éƒ¨å˜é‡<a class="headerlink" href="#å±€éƒ¨å˜é‡" title="Permanent link">&para;</a></h3>
<p>æŸäº›æƒ…å†µä¸‹ï¼Œå±€éƒ¨å˜é‡å¿…é¡»å­˜å‚¨åœ¨è¿è¡Œæ—¶æ ˆä¸­ï¼š</p>
<ul>
<li>æ²¡æœ‰è¶³å¤Ÿçš„å¯„å­˜å™¨æ¥å­˜å‚¨å±€éƒ¨å˜é‡ï¼›</li>
<li>ç¨‹åºéœ€è¦å¯¹å±€éƒ¨å˜é‡è¿›è¡Œå–åœ°å€ï¼ˆ<code>&amp;</code>ï¼‰æ“ä½œï¼›</li>
<li>å±€éƒ¨å˜é‡çš„ç±»å‹ä¸ºæ•°ç»„æˆ–ç»“æ„ä½“ï¼ˆæˆ‘ä»¬å°†åœ¨åç»­çš„ç« èŠ‚ä¸­è®¨è®ºè¿™ç§æƒ…å†µï¼‰ã€‚</li>
</ul>
<p>ç¤ºä¾‹å‡½æ•°<code>call_proc</code>çš„ä»£ç å¦‚ä¸‹ï¼Œå…¶ä¸­è°ƒç”¨çš„å‡½æ•°<code>proc</code>åœ¨ä¸Šä¸€èŠ‚ä¸­å·²æœ‰ä»‹ç»ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">long</span><span class="w"> </span><span class="nf">call_proc</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">    </span><span class="kt">short</span><span class="w"> </span><span class="n">x3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">x4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="w">    </span><span class="n">proc</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">x3</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">,</span><span class="w"> </span><span class="n">x4</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x4</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">x1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">x3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x4</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>è¯¥ C ç¨‹åºç”Ÿæˆçš„æ±‡ç¼–ä»£ç ååˆ†å†—é•¿ï¼Œä½†å€¼å¾—æˆ‘ä»¬è®¤çœŸé˜…è¯»å’Œç ”ç©¶ï¼š</p>
<p><img alt="alt text" src="../image/image-27.png" /></p>
<p>å›¾ä¸­â€œSet up arguments to procâ€é˜¶æ®µå¯¹åº”çš„æ ˆå¸§ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img alt="alt text" src="../image/image-28.png" /></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå±€éƒ¨å˜é‡<code>x1</code>åˆ°<code>x4</code>å­˜å‚¨åœ¨æ ˆä¸­ä¸”æœ‰ç€ä¸åŒçš„å¤§å°ï¼Œåˆ†åˆ«å ç”¨å­—èŠ‚ 24-31ã€20-23ã€18-19 å’Œ 17ã€‚æŒ‡å‘è¿™äº›å‚æ•°çš„æŒ‡é’ˆå‡é€šè¿‡æŒ‡ä»¤<code>leaq</code>ç”Ÿæˆï¼Œåˆ†åˆ«å¯¹åº”æ±‡ç¼–ä»£ç ä¸­çš„ç¬¬ 7ã€10ã€12 å’Œ 14 è¡Œã€‚å‰å…­ä¸ªå‚æ•°é€šè¿‡å¯„å­˜å™¨ä¼ é€’ï¼Œè€Œç¬¬ä¸ƒä¸ªå’Œç¬¬å…«ä¸ªå‚æ•°åˆ™å­˜å‚¨åœ¨æ ˆä¸­ï¼Œç›¸å¯¹äºæ ˆæŒ‡é’ˆ %rsp çš„åç§»é‡ä¸º 0 å’Œ 8ã€‚</p>
<p>å½“ç¨‹åºæ‰§è¡Œåˆ°â€œCall procâ€é˜¶æ®µæ—¶ï¼Œç”±äºè°ƒç”¨äº†å‡½æ•°<code>proc</code>ï¼Œå› æ­¤è¿”å›åœ°å€éœ€è¦è¢«å‹å…¥åˆ°æ ˆé¡¶ã€‚æ­¤æ—¶çš„æ ˆå¸§ç»“æ„å’Œä¸Šä¸€èŠ‚å±•ç¤ºçš„ç›¸åŒï¼Œç¬¬ä¸ƒä¸ªå‚æ•°å’Œç¬¬å…«ä¸ªå‚æ•°ç›¸å¯¹äºæ ˆæŒ‡é’ˆ %rsp çš„åç§»é‡åˆ†åˆ«å˜ä¸ºäº† 8 å’Œ 16ã€‚</p>
<h3 id="è¢«ä¿å­˜çš„å¯„å­˜å™¨">è¢«ä¿å­˜çš„å¯„å­˜å™¨<a class="headerlink" href="#è¢«ä¿å­˜çš„å¯„å­˜å™¨" title="Permanent link">&para;</a></h3>
<p>å½“ä¸€ä¸ªè¿‡ç¨‹ï¼ˆè°ƒç”¨è€…ï¼‰åœ¨è°ƒç”¨å¦ä¸€ä¸ªè¿‡ç¨‹ï¼ˆè¢«è°ƒç”¨è€…ï¼‰æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»ä¿è¯è¢«è°ƒç”¨è€…çš„æ‰§è¡Œä¸ä¼šå½±å“åˆ°è°ƒç”¨è€…åç»­è®¡åˆ’ä½¿ç”¨çš„å¯„å­˜å™¨å€¼ã€‚å› æ­¤ï¼Œx86-64 è§„å®šå¯„å­˜å™¨ %rbxã€%rbp å’Œ %r12â€“%r15 ä¸ºè¢«è°ƒç”¨è€…ä¿å­˜ï¼ˆCallee-savedï¼‰å¯„å­˜å™¨ã€‚è¢«è°ƒç”¨è€…é€šè¿‡å°†ä¸Šè¿°å¯„å­˜å™¨ä¸­çš„å€¼å‹å…¥æ ˆä¸­ï¼Œç„¶ååœ¨è¿”å›æ—¶å°†åŸå§‹å€¼å¼¹å‡ºä»¥å®ç°è°ƒç”¨å‰åå¯„å­˜å™¨çš„å€¼ä¸å˜ã€‚é™¤æ ˆæŒ‡é’ˆ %rsp ä»¥å¤–çš„å…¶ä»–å¯„å­˜å™¨åˆ™ä¸ºè°ƒç”¨è€…ä¿å­˜ï¼ˆCaller-savedï¼‰å¯„å­˜å™¨ï¼Œç”±äºè¢«è°ƒç”¨è€…å¯ä»¥éšæ„ä¿®æ”¹å…¶ä¸­çš„å€¼ï¼Œå› æ­¤è°ƒç”¨è€…æœ‰è´£ä»»ä¿å­˜è°ƒç”¨ä¹‹å‰çš„æ•°æ®ã€‚</p>
<h3 id="é€’å½’">é€’å½’<a class="headerlink" href="#é€’å½’" title="Permanent link">&para;</a></h3>
<p>x86-64 å…è®¸è¿‡ç¨‹ä»¥é€’å½’ï¼ˆRecursiveï¼‰çš„æ–¹å¼è°ƒç”¨è‡ªèº«ï¼Œè¿™æ˜¯å› ä¸ºæ¯ä¸ªè¿‡ç¨‹åœ¨è¿è¡Œæ—¶æ ˆä¸Šçš„ç©ºé—´æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤å¤šä¸ªæœªå®Œæˆè°ƒç”¨çš„å±€éƒ¨å˜é‡ä¸ä¼šäº’ç›¸å¹²æ‰°ã€‚é€’å½’è°ƒç”¨å®è´¨ä¸Šå’Œè°ƒç”¨ä¸€ä¸ªå…¶ä»–è¿‡ç¨‹æ²¡æœ‰åŒºåˆ«ã€‚</p>
<h2 id="æ•°ç»„">æ•°ç»„<a class="headerlink" href="#æ•°ç»„" title="Permanent link">&para;</a></h2>
<p>å¯¹äºé•¿åº¦ä¸º L çš„æ•°æ®ç±»å‹ T å’Œæ•´å‹å¸¸é‡ Nï¼Œå£°æ˜<code>T A[N]</code>ä»£è¡¨ï¼š</p>
<ul>
<li>å†…å­˜ä¸­å°†ä¸ºå…¶åˆ†é… L * N å¤§å°çš„ç©ºé—´ï¼›</li>
<li>æ•°ç»„åç§° A ä¸ºæŒ‡å‘æ•°ç»„å¤´éƒ¨ï¼ˆè®¾ä¸º<span class="arithmatex">\(x_A\)</span>ï¼‰çš„æŒ‡é’ˆï¼Œä»»æ„æ•°ç»„å…ƒç´  i çš„åœ°å€ä¸º <span class="arithmatex">\(x_A\)</span> + L * iã€‚</li>
</ul>
<p>åœ¨ x86-64 ä¸­ï¼Œå†…å­˜å¼•ç”¨æŒ‡ä»¤çš„è®¾è®¡æ—¨åœ¨ç®€åŒ–å¯¹æ•°ç»„å…ƒç´ çš„è®¿é—®ã€‚ä¾‹å¦‚<code>int</code>ç±»å‹çš„æ•°ç»„<code>E[i]</code>ï¼Œ<code>E</code>çš„åœ°å€å­˜å‚¨åœ¨å¯„å­˜å™¨ %rdx ä¸­ï¼Œi åˆ™å­˜å‚¨åœ¨å¯„å­˜å™¨ %rcx ä¸­ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æŒ‡ä»¤<code>movl(%rdx, %rcx, 4), %eax</code>æ¥å°†ç›®æ ‡æ•°ç»„å…ƒç´ æ‹·è´åˆ°å¯„å­˜å™¨ %eax ä¸­ã€‚</p>
<p>C å…è®¸æˆ‘ä»¬å¯¹æŒ‡é’ˆè¿›è¡Œè®¡ç®—ã€‚å‡è®¾æŒ‡é’ˆ<code>p</code>æŒ‡å‘ä¸€ä¸ªé•¿åº¦ä¸º Lã€æ•°æ®ç±»å‹ä¸º T çš„æ•°ç»„ä¸”å…¶å€¼ä¸º <span class="arithmatex">\(x_p\)</span>ï¼Œåˆ™è¡¨è¾¾å¼<code>p + i</code>çš„å€¼ä¸º <span class="arithmatex">\(x_p\)</span> + L * iã€‚è¿›ä¸€æ­¥åœ°ï¼Œä»»æ„æ•°ç»„å…ƒç´ <code>A[i]</code>å°±ç­‰æ•ˆäºè¡¨è¾¾å¼<code>*(A + i)</code>ã€‚</p>
<p>è¿˜æ˜¯ä»¥æ•°ç»„<code>E[i]</code>ä¸ºä¾‹ï¼Œä¸€äº›æŒ‡é’ˆç®—æ•°è¡¨è¾¾å¼çš„ç»“æœå’Œå¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤å¦‚ä¸‹ï¼š</p>
<p><img alt="alt text" src="../image/image-29.png" /></p>
<p>æœ€åä¸€ä¸ªä¾‹å­è¡¨æ˜ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—åŒä¸€æ•°æ®ç»“æ„ä¸­ä¸¤ä¸ªæŒ‡é’ˆçš„å·®å€¼ã€‚å…¶ç»“æœçš„æ•°æ®ç±»å‹ä¸º<code>long</code>ï¼Œ å€¼ä¸ºä¸¤ä¸ªåœ°å€çš„å·®å€¼é™¤ä»¥æ•°æ®ç±»å‹çš„é•¿åº¦ã€‚</p>
<h3 id="å¤šç»´æ•°ç»„">å¤šç»´æ•°ç»„<a class="headerlink" href="#å¤šç»´æ•°ç»„" title="Permanent link">&para;</a></h3>
<p>å¤šç»´æ•°ç»„å¯ä»¥è½¬åŒ–ä¸ºä¸€èˆ¬æ•°ç»„çš„å½¢å¼ï¼Œä¾‹å¦‚å£°æ˜<code>int A[5][3]</code>å°±ç­‰æ•ˆä¸ºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">row3_t</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="n">row3_t</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
</code></pre></div>
<p>æ•°æ®ç±»å‹<code>row3_t</code>æ˜¯ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªæ•´å‹çš„æ•°ç»„ï¼Œè€Œæ•°ç»„<code>A</code>åˆ™åŒ…å«äº”ä¸ªè¿™æ ·çš„å…ƒç´ ã€‚æˆ‘ä»¬å°†å…¶æ¨å¹¿åˆ°ä¸€èˆ¬æƒ…å†µï¼Œè‹¥ä¸€ä¸ªæ•°ç»„å£°æ˜ä¸º<code>T D[R][C]</code>ï¼Œåˆ™æ•°ç»„å…ƒç´ <code>D[i][j]</code>åœ¨å†…å­˜ä¸­çš„åœ°å€ä¸ºï¼š</p>
<div class="arithmatex">\[\tag{3.1} \And D[i][j] = x_D + L(C * i + j)\]</div>
<p>å…¶ä¸­ï¼Œ<span class="arithmatex">\(x_D\)</span> ä¸ºæ•°ç»„åœ°å€ï¼ŒL ä¸ºæ•°ç»„å…ƒç´ çš„é•¿åº¦ã€‚</p>
<p>ä¸€ä¸ª 5 X 3 çš„æ•´å‹æ•°ç»„<code>A</code>ï¼Œå…¶ä»»æ„æ•°ç»„å…ƒç´  <code>A[i][j]</code> çš„åœ°å€ç”¨æ±‡ç¼–ä»£ç çš„è¡¨ç¤ºç»“æœä¸ºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="c1">; A in %rdi, i in % rsi and j in %rdx</span>
<span class="c1">; Compute 3i</span>
<span class="nf">leaq</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="c1">; Compute A + 12i</span>
<span class="nf">leaq</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="nb">rdi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="c1">; Read from M[A + 12i + 4j]</span>
<span class="nf">movl</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="nb">rax</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rdx</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
</code></pre></div>
<h3 id="å®šé•¿æ•°ç»„">å®šé•¿æ•°ç»„<a class="headerlink" href="#å®šé•¿æ•°ç»„" title="Permanent link">&para;</a></h3>
<p>ç¼–è¯‘å™¨å¯ä»¥å¯¹ä¸€äº›æ“ä½œå®šé•¿å¤šç»´æ•°ç»„çš„ä»£ç è¿›è¡Œä¼˜åŒ–ã€‚ä¾‹å¦‚ç¤ºä¾‹ C ç¨‹åºæ‰§è¡ŒçŸ©é˜µè¿ç®—ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#define N 16</span>
<span class="k">typedef</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">fix_matrix</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">N</span><span class="p">];</span>
<span class="cm">/* Compute i,k of fixed matrix product */</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">fix_prod_ele</span><span class="p">(</span><span class="n">fix_matrix</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">fix_matrix</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">j</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">k</span><span class="p">];</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>å®ƒå¯ä»¥è¢«ä¼˜åŒ–ä¸ºä¸‹åˆ—ä»£ç ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#define N 16</span>
<span class="k">typedef</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">fix_matrix</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">N</span><span class="p">];</span>
<span class="cm">/* Compute i,k of fixed matrix product */</span>
<span class="n">fix_prod_ele_opt</span><span class="p">(</span><span class="n">fix_matrix</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">fix_matrix</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">k</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Aptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span><span class="w">   </span><span class="cm">/* Points to elements in row i of A    */</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Bptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">k</span><span class="p">];</span><span class="w">   </span><span class="cm">/* Points to elements in column k of B */</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">Bend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">B</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">k</span><span class="p">];</span><span class="w">   </span><span class="cm">/* Marks stopping point for Bptr */</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">do</span>
<span class="w">    </span><span class="p">{</span><span class="w">                              </span><span class="cm">/* No need for initial test */</span>
<span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">*</span><span class="n">Aptr</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">*</span><span class="n">Bptr</span><span class="p">;</span><span class="w">   </span><span class="cm">/* Add next product to sum */</span>
<span class="w">        </span><span class="n">Aptr</span><span class="o">++</span><span class="p">;</span><span class="w">                    </span><span class="cm">/* Move Aptr to next column */</span>
<span class="w">        </span><span class="n">Bptr</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w">                 </span><span class="cm">/* Move Bptr to next row */</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">Bptr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">Bend</span><span class="p">);</span><span class="w">        </span><span class="cm">/* Test for stopping point */</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>æ¯”è¾ƒä¸¤è€…æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œä¼˜åŒ–ä»£ç æ²¡æœ‰ä½¿ç”¨ç´¢å¼• jï¼Œå¹¶å°†æ‰€æœ‰çš„æ•°ç»„å¼•ç”¨éƒ½è½¬æ¢ä¸ºäº†æŒ‡é’ˆå¼•ç”¨ã€‚å…¶ä¸­ï¼Œ<code>Aptr</code>æŒ‡å‘çŸ©é˜µ A ä¸­ç¬¬ i è¡Œä¸­çš„è¿ç»­å…ƒç´ ï¼Œ<code>Bptr</code>æŒ‡å‘çŸ©é˜µ B ä¸­ç¬¬ k åˆ— ä¸­çš„è¿ç»­å…ƒç´ ã€‚<code>Bend</code>åˆ™æŒ‡å‘çŸ©é˜µ B ä¸­ç¬¬ k åˆ—ä¸­çš„ç¬¬ N + 1 ä¸ªå…ƒç´ ï¼Œå®ƒå°±ç­‰äºå¾ªç¯ç»“æŸæ—¶<code>Bptr</code>çš„å€¼ã€‚</p>
<h3 id="å˜é•¿æ•°ç»„">å˜é•¿æ•°ç»„<a class="headerlink" href="#å˜é•¿æ•°ç»„" title="Permanent link">&para;</a></h3>
<p>C åªæ”¯æŒå¯ä»¥åœ¨ç¼–è¯‘æ—¶ç¡®å®šé•¿åº¦çš„å¤šç»´æ•°ç»„(ä¸€ç»´å¯èƒ½é™¤å¤–ï¼‰ï¼Œå£°æ˜å¯å˜å¤§å°çš„æ•°ç»„æ—¶å¿…é¡»ä½¿ç”¨<code>malloc</code>æˆ–<code>calloc</code>ç­‰å‡½æ•°æ¥åˆ†é…æ•°ç»„çš„å­˜å‚¨ç©ºé—´ï¼Œå¹¶ä¸”éœ€è¦é€šè¿‡è¡Œä¸»ç´¢å¼•ï¼ˆRow-major Indexingï¼‰å°†å¤šç»´æ•°ç»„çš„æ˜ å°„æ˜¾å¼åœ°ç¼–ç ä¸ºä¸€ç»´æ•°ç»„ï¼ˆå°±åƒ å…¬å¼ 3.1 åšçš„é‚£æ ·ï¼‰ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¿é—® n Ã— n æ•°ç»„çš„å…ƒç´ <code>A[i][j]</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">var_ele</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">n</span><span class="p">],</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">j</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<p>å‚æ•°<code>n</code>å¿…é¡»åœ¨å‚æ•°<code>A[n][n]</code>ä¹‹å‰ï¼Œè¿™æ ·å‡½æ•°åœ¨å¤„ç†æ•°ç»„æ—¶æ‰èƒ½å¤Ÿæ˜ç¡®å…¶ç»´åº¦ã€‚è¯¥ç¨‹åºç» GCC ç¼–è¯‘å¾—åˆ°çš„æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="c1">; int var_ele(long n, int A[n][n], long i, long j)</span>
<span class="c1">; n in %rdi, A in %rsi, i in %rdx, j in %rcx </span>
<span class="nl">var_ele:</span>
<span class="w">  </span><span class="err">ï¼›</span><span class="w"> </span><span class="nf">Compute</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">i</span>
<span class="w">  </span><span class="nf">imulq</span><span class="w"> </span><span class="o">%</span><span class="nb">rdx</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rdi</span>
<span class="w">  </span><span class="c1">; Compute A + 4(n * i)</span>
<span class="w">  </span><span class="nf">leaq</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="nb">rsi</span><span class="p">,</span><span class="o">%</span><span class="nb">rdi</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
<span class="w">  </span><span class="c1">; Read from M[A + 4(n * i) + j]</span>
<span class="w">  </span><span class="nf">movl</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="nb">rax</span><span class="p">,</span><span class="o">%</span><span class="nb">rcx</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="nb">eax</span>
<span class="w">  </span><span class="nf">ret</span>
</code></pre></div>
<p>æ•°ç»„å…ƒç´ <code>A[i][j]</code>åœ°å€çš„è®¡ç®—æ–¹å¼ä¸å®šé•¿å¤šç»´æ•°ç»„ç±»ä¼¼ï¼Œå³ <span class="arithmatex">\(x_A + 4(n \* i) + 4j = x_A + 4(n \* i + j)\)</span>ã€‚åŒºåˆ«ä¹‹å¤„åœ¨äºï¼š</p>
<ul>
<li>ç”±äºæ·»åŠ äº†å˜é‡<code>n</code>ï¼Œå¯„å­˜å™¨çš„ä½¿ç”¨æ–¹å¼ä¸åŒï¼›</li>
<li>ä½¿ç”¨äº†ä¹˜æ³•æŒ‡ä»¤<code>imulq</code>è€Œä¸æ˜¯<code>leaq</code>æ¥è®¡ç®—<code>n * i</code>ï¼Œå› æ­¤ç¨‹åºçš„æ€§èƒ½å°†ä¼šä¸‹é™ã€‚</li>
</ul>
<p>æ— è®ºæ•°ç»„çš„é•¿åº¦æ˜¯å¦ä¸ºå¸¸é‡ï¼Œç¼–è¯‘å™¨éƒ½ä¼šå¯¹æ“ä½œå¤šç»´æ•°ç»„çš„ä»£ç è¿›è¡Œä¸€å®šä¼˜åŒ–ã€‚è™½ç„¶äºŒè€…å®ç°çš„ç»†èŠ‚æœ‰æ‰€å·®å¼‚ï¼Œä½†å…¶å®—æ—¨æ˜¯ä¸€è‡´çš„ï¼šé¿å…ç›´æ¥ä½¿ç”¨ å…¬å¼ 3.1 è€Œå¯¼è‡´çš„ä¹˜æ³•è¿ç®—ã€‚</p>
<h2 id="å¼‚æ„æ•°æ®ç»“æ„">å¼‚æ„æ•°æ®ç»“æ„<a class="headerlink" href="#å¼‚æ„æ•°æ®ç»“æ„" title="Permanent link">&para;</a></h2>
<h3 id="ç»“æ„ä½“">ç»“æ„ä½“<a class="headerlink" href="#ç»“æ„ä½“" title="Permanent link">&para;</a></h3>
<p>ç»“æ„ä½“ï¼ˆStructureï¼‰çš„æ¯ä¸ªéƒ¨åˆ†éƒ½å­˜å‚¨åœ¨è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼ŒæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆæ˜¯å…¶ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åœ°å€ã€‚ä¸€ä¸ªç®€å•çš„ç»“æ„ä½“å£°æ˜å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">rec</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>è¯¥ç»“æ„ä½“åŒ…å«äº†å››ä¸ªå­—æ®µï¼šä¸¤ä¸ªå››å­—èŠ‚çš„<code>int</code>å˜é‡ï¼Œä¸€ä¸ªä¸¤å…ƒç´ çš„<code>int</code>å‹æ•°ç»„å’Œä¸€ä¸ªå…«å­—èŠ‚çš„<code>int</code>å‹æŒ‡é’ˆï¼Œå…±å ç”¨ 24 å­—èŠ‚çš„å†…å­˜ç©ºé—´ï¼š</p>
<p><img alt="alt text" src="../image/image-30.png" /></p>
<p>æ±‡ç¼–ä»£ç å¯ä»¥é€šè¿‡åœ¨ç»“æ„ä½“åœ°å€ä¸Šæ·»åŠ é€‚å½“çš„åç§»é‡æ¥è®¿é—®ç»“æ„ä½“ä¸­çš„ä»»æ„å­—æ®µã€‚å‡è®¾<code>structure rec *</code>ç±»å‹çš„å˜é‡<code>r</code>å­˜å‚¨åœ¨å¯„å­˜å™¨ %rdi ä¸­ï¼Œé‚£ä¹ˆä¸‹åˆ—ä»£ç å°†å…ƒç´ <code>r -&gt; i</code>ï¼Œå³<code>(*r).i</code>ï¼Œæ‹·è´åˆ°<code>r -&gt; j</code>ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="nf">movl</span><span class="w"> </span><span class="p">(</span><span class="o">%</span><span class="nb">rdi</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="nb">eax</span>
<span class="nf">movl</span><span class="w"> </span><span class="o">%</span><span class="nb">eax</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">(</span><span class="o">%</span><span class="nb">rdi</span><span class="p">)</span>
</code></pre></div>
<p>åŒæ ·ï¼Œå¦‚æœæˆ‘ä»¬è¦è·å–ç»“æ„ä½“ä¸­æ•°ç»„å…ƒç´ <code>rec.a[i]</code>çš„åœ°å€<code>&amp;(r -&gt; a[i])</code>ï¼Œåªéœ€ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="c1">; r in %rdi, i in %rdi</span>
<span class="nf">leaq</span><span class="w"> </span><span class="mi">8</span><span class="p">(</span><span class="o">%</span><span class="nb">rdi</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rsi</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">),</span><span class="w"> </span><span class="o">%</span><span class="nb">rax</span>
</code></pre></div>
<p>å¦‚ä¸Šè¿°æ±‡ç¼–ä»£ç æ‰€ç¤ºï¼Œç¨‹åºå¯¹ç»“æ„ä½“å­—æ®µçš„é€‰æ‹©æ˜¯åœ¨ç¼–è¯‘æ—¶å®Œæˆçš„ï¼Œå› æ­¤æœºå™¨ä»£ç ä¸­ä¸å«æœ‰ä»»ä½•æœ‰å…³å­—æ®µå£°æ˜æˆ–å­—æ®µåç§°çš„ä¿¡æ¯ã€‚</p>
<h3 id="è”åˆä½“">è”åˆä½“<a class="headerlink" href="#è”åˆä½“" title="Permanent link">&para;</a></h3>
<p>è”åˆä½“ï¼ˆUnionsï¼‰çš„å£°æ˜å’Œè¯­æ³•ä¸ç»“æ„ä½“ç›¸åŒï¼Œä½†å…¶ä¸åŒå­—æ®µå‡å¼•ç”¨ç›¸åŒçš„å†…å­˜ç©ºé—´ã€‚ä¾‹å¦‚ä¸€ä¸ªç»“æ„ä½“å’Œä¸€ä¸ªè”åˆä½“çš„å£°æ˜å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">S3</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">union</span><span class="w"> </span><span class="nc">U3</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>é‚£ä¹ˆ<code>S3</code>å’Œ<code>U3</code>å„ä¸ªå­—æ®µçš„åç§»é‡å’Œæ€»æ•°æ®é•¿åº¦ä¸ºï¼š</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>c</th>
<th>i</th>
<th>v</th>
<th>Size</th>
</tr>
</thead>
<tbody>
<tr>
<td>S3</td>
<td>0</td>
<td>4</td>
<td>16</td>
<td>24</td>
</tr>
<tr>
<td>U3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>8</td>
</tr>
</tbody>
</table>
<p>å¯¹äºç±»å‹ä¸º<code>union U3 *</code>çš„æŒ‡é’ˆ<code>p</code>ï¼Œè¡¨è¾¾å¼<code>p -&gt; c</code>ï¼Œ<code>p -&gt; i[0]</code>å’Œ<code>p -&gt; v</code>éƒ½å°†å¼•ç”¨è”åˆä½“çš„èµ·å§‹åœ°å€ã€‚è”åˆä½“çš„é•¿åº¦ç­‰äºå…¶æ‰€æœ‰å­—æ®µä¸­æœ€å¤§çš„æ•°æ®é•¿åº¦ï¼Œè€Œç»“æ„ä½“åˆ™ç­‰äºå…¶æ‰€æœ‰å­—æ®µé•¿åº¦çš„å’Œã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ <strong>æ•°æ®å¯¹é½</strong> ä¸­ä»‹ç»ä¸ºä»€ä¹ˆ<code>i</code>åœ¨<code>S3</code>ä¸­çš„åç§»é‡æ˜¯ 4 è€Œä¸æ˜¯ 1ï¼Œä»¥åŠ<code>v</code>çš„åç§»é‡æ˜¯ 16ï¼Œè€Œä¸æ˜¯ 9 æˆ– 12ã€‚</p>
<p>å¦‚æœä¸€ä¸ªæ•°æ®ç»“æ„ä¸­çš„ä¸¤ä¸ªå­—æ®µæ˜¯äº’æ–¥ï¼ˆMutually Exclusiveï¼‰çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è”åˆä½“æ¥å‡å°‘ç©ºé—´æµªè´¹ã€‚å‡å¦‚å­˜åœ¨ä¸€ä¸ªäºŒå‰æ ‘ï¼Œå…¶æ¯ä¸ªå¶èŠ‚ç‚¹ï¼ˆLeaf nodeï¼‰éƒ½æœ‰ä¸¤ä¸ªåŒç²¾åº¦æµ®ç‚¹å€¼ï¼Œæ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹ï¼ˆInternal nodeï¼‰éƒ½æœ‰ä¸¤ä¸ªæŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚é‚£ä¹ˆä½¿ç”¨ç»“æ„ä½“å®ç°è¯¥æ•°æ®ç»“æ„çš„ä»£ç ä¸ºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">node_s</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// for internal node</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">node_s</span><span class="w"> </span><span class="o">*</span><span class="n">left</span><span class="p">;</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">node_s</span><span class="w"> </span><span class="o">*</span><span class="n">right</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// for leaf node</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">};</span>
</code></pre></div>
<p>è¿™æ ·æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦å ç”¨ 32 å­—èŠ‚çš„ç©ºé—´ï¼Œå…¶ä¸­åªæœ‰ä¸€åŠä¼šè¢«èŠ‚ç‚¹çœŸæ­£ä½¿ç”¨ã€‚è€Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨è”åˆä½“æ¥å®ç°ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">union</span><span class="w"> </span><span class="nc">node_u</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">struct</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">union</span><span class="w"> </span><span class="nc">node_u</span><span class="w"> </span><span class="o">*</span><span class="n">left</span><span class="p">;</span>
<span class="w">        </span><span class="k">union</span><span class="w"> </span><span class="nc">node_u</span><span class="w"> </span><span class="o">*</span><span class="n">right</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">internal</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">};</span>
</code></pre></div>
<p>åˆ™æ¯ä¸ªèŠ‚ç‚¹å°±åªéœ€å ç”¨ 16 ä¸ªå­—èŠ‚çš„ç©ºé—´ã€‚å¯¹äºç±»å‹ä¸º<code>union node_u *</code>çš„æŒ‡é’ˆ<code>n</code>ï¼Œå¶èŠ‚ç‚¹å¯ä»¥ç”¨<code>n -&gt; data[0]</code>å’Œ<code>n -&gt; data[1]</code>æ¥è¡¨ç¤ºï¼Œè€Œå†…éƒ¨èŠ‚ç‚¹æŒ‡å‘çš„å­èŠ‚ç‚¹å¯ä»¥ç”¨<code>n -&gt; internal.left</code>å’Œ<code>n -&gt; internal.right</code>æ¥è¡¨ç¤ºã€‚</p>
<p>è”åˆä½“è¿˜å¯ç”¨äºè®¿é—®ä¸åŒæ•°æ®ç±»å‹çš„ä½æ¨¡å¼ã€‚å‡è®¾æˆ‘ä»¬éœ€è¦å°†ä¸€ä¸ª<code>double</code>ç±»å‹çš„å˜é‡å¼ºåˆ¶è½¬æ¢ä¸º<code>unsigned long</code>ï¼Œåˆ™å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•å®ç°ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">double2bits</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">union</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
<span class="w">        </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">u</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span>
<span class="w">    </span><span class="n">temp</span><span class="p">.</span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">temp</span><span class="p">.</span><span class="n">u</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>è¯¥ä»£ç å°†ä¸¤ç§æ•°æ®ç±»å‹å‡å­˜å‚¨åœ¨è”åˆä½“<code>temp</code>ä¸­ï¼Œä½¿å…¶æœ‰ç€ç›¸åŒçš„ä½çº§è¡¨è¾¾ï¼Œä»è€Œå®ç°äº†ç±»å‹è½¬æ¢ã€‚</p>
<h3 id="æ•°æ®å¯¹é½">æ•°æ®å¯¹é½<a class="headerlink" href="#æ•°æ®å¯¹é½" title="Permanent link">&para;</a></h3>
<p>è®¸å¤šè®¡ç®—æœºç³»ç»Ÿè¦æ±‚ç¨‹åºå¯¹è±¡çš„åœ°å€å¿…é¡»æ˜¯æŸä¸ªå€¼ï¼ˆé€šå¸¸ä¸º 2ï¼Œ4 æˆ– 8ï¼‰çš„å€æ•°ï¼Œå…¶ç›®çš„æ˜¯ç®€åŒ–å¤„ç†å™¨å’Œå†…å­˜ç³»ç»Ÿä¹‹é—´çš„ç¡¬ä»¶æ¥å£è®¾è®¡ã€‚å‡è®¾ä¸€ä¸ªå¤„ç†å™¨æ¯æ¬¡éƒ½ä»å†…å­˜ä¸­è¯»å– 8 ä¸ªå­—èŠ‚ï¼Œè€Œä¸€ä¸ª<code>double</code>ç±»å‹çš„æ•°æ®åœ°å€ä¸º 8 çš„å€æ•°ï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥è¢«ä¸€æ¬¡å†…å­˜è®¿é—®æ“ä½œè¯»å–æˆ–å†™å…¥ã€‚å¦åˆ™ï¼Œå®ƒä¼šè¢«æ‹†åˆ†ä¸ºä¸¤ä¸ª 8 å­—èŠ‚çš„å†…å­˜å—ï¼Œå¯¼è‡´å¤„ç†å™¨æ“ä½œæ¬¡æ•°çš„å¢åŠ ã€‚</p>
<p>æ— è®ºæ•°æ®å¯¹é½æ˜¯å¦å®ç°ï¼Œx86-64 çš„ç¡¬ä»¶éƒ½å°†æ­£å¸¸å·¥ä½œã€‚ä½†æ˜¯ Intel å»ºè®®å¯¹é½æ•°æ®ä»¥æé«˜å†…å­˜ç³»ç»Ÿæ€§èƒ½ï¼Œå…¶è§„åˆ™ä¸ºï¼šä»»ä½• K å­—èŠ‚å¯¹è±¡çš„åœ°å€å¿…é¡»ä¸º K çš„å€æ•°ï¼š</p>
<table>
<thead>
<tr>
<th>K</th>
<th>Types</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>char</td>
</tr>
<tr>
<td>2</td>
<td>short</td>
</tr>
<tr>
<td>4</td>
<td>int, float</td>
</tr>
<tr>
<td>8</td>
<td>long, double, char *</td>
</tr>
</tbody>
</table>
<p>ç¼–è¯‘å™¨ä¼šåœ¨æ±‡ç¼–ä»£ç ä¸­æ”¾ç½®æŒ‡ä»¤ï¼ŒæŒ‡ç¤ºå…¨å±€æ•°æ®æ‰€éœ€çš„å¯¹é½æ–¹å¼ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨ä»‹ç»è·³è½¬è¡¨æ—¶ï¼Œç¤ºä¾‹ä»£ç ä¸­çš„<code>.align 8</code>å°±ä»£è¡¨è¯¥æŒ‡ä»¤åé¢çš„æ•°æ®åœ°å€å‡ä¸º 8 çš„å€æ•°ã€‚å¯¹äºæ¶‰åŠåˆ°ç»“æ„ä½“çš„ä»£ç ï¼Œç¼–è¯‘å™¨å¯èƒ½è¿˜éœ€è¦åœ¨å­—æ®µåˆ†é…ç©ºé—´æ—¶æ’å…¥é—´éš™ä»¥å®ç°æ•°æ®å¯¹é½ã€‚ä¸€ä¸ªç®€å•ç»“æ„ä½“çš„å£°æ˜å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">S1</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>ç¼–è¯‘å™¨å®é™…ä¸ºå…¶åˆ†é…çš„å†…å­˜ç©ºé—´ä¸ºï¼š</p>
<p><img alt="alt text" src="../image/image-31.png" /></p>
<p>å³ç„¶å„å­—æ®µçš„åç§»é‡å‡ä¸º 4 çš„å€æ•°ï¼Œé‚£ä¹ˆåªè¦èµ·å§‹åœ°å€ä¹Ÿä¸º 4 çš„å€æ•°ï¼Œè¯¥ç»“æ„ä½“ä¾¿å®ç°äº†æ•°æ®å¯¹é½ã€‚</p>
<h2 id="æœºå™¨çº§ä»£ç ä¸­æ§åˆ¶å’Œæ•°æ®çš„ç»„åˆ">æœºå™¨çº§ä»£ç ä¸­æ§åˆ¶å’Œæ•°æ®çš„ç»„åˆ<a class="headerlink" href="#æœºå™¨çº§ä»£ç ä¸­æ§åˆ¶å’Œæ•°æ®çš„ç»„åˆ" title="Permanent link">&para;</a></h2>
<h3 id="ç†è§£æŒ‡é’ˆ">ç†è§£æŒ‡é’ˆ<a class="headerlink" href="#ç†è§£æŒ‡é’ˆ" title="Permanent link">&para;</a></h3>
<ul>
<li>æŒ‡é’ˆä¸æ˜¯æœºå™¨ä»£ç çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ C æä¾›çš„ä¸€ç§ç”¨æ¥å¸®åŠ©ç¨‹åºå‘˜é¿å…å¯»å€é”™è¯¯çš„æŠ½è±¡ï¼›</li>
<li>æ¯ä¸ªæŒ‡é’ˆéƒ½æœ‰ä¸€ä¸ªå…³è”çš„ç±»å‹ã€‚ç‰¹æ®Šçš„æŒ‡é’ˆç±»å‹<code>void *</code>ä»£è¡¨é€šç”¨ï¼ˆèŒƒå‹ï¼‰æŒ‡é’ˆï¼Œå¯ä»¥æ˜¾å¼æˆ–éšå¼åœ°è½¬æ¢ä¸ºæœ‰å…³è”ç±»å‹çš„æŒ‡é’ˆï¼›</li>
<li>æ¯ä¸ªæŒ‡é’ˆéƒ½æœ‰ä¸€ä¸ªå€¼ï¼Œå…¶å€¼ä¸ºæŒ‡å®šç±»å‹çš„æŸä¸ªå¯¹è±¡çš„åœ°å€ã€‚è‹¥æŒ‡é’ˆçš„å€¼ä¸º<code>NULL</code>(0)ï¼Œåˆ™ä»£è¡¨å®ƒæ²¡æœ‰æŒ‡å‘ä»»ä½•åœ°æ–¹ï¼›</li>
<li>æŒ‡é’ˆæ˜¯æ“ä½œç¬¦<code>&amp;</code>åˆ›å»ºçš„ï¼Œåœ¨æœºå™¨ä»£ç ä¸­å¸¸ç”¨<code>leaq</code>æŒ‡ä»¤å®ç°ï¼›</li>
<li>ä½¿ç”¨æ“ä½œç¬¦<code>*</code>æ¥å¯¹æŒ‡é’ˆè§£å¼•ç”¨ï¼›</li>
<li>æ•°ç»„å’ŒæŒ‡é’ˆä¹‹é—´å…³ç³»å¯†åˆ‡ï¼›</li>
<li>æŒ‡é’ˆå¯ä»¥è¢«å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä½†ä¸ä¼šæ”¹å˜å…¶å€¼ï¼›</li>
<li>æŒ‡é’ˆä¹Ÿå¯ä»¥æŒ‡å‘å‡½æ•°ï¼Œä½¿ç¨‹åºå¯ä»¥åœ¨å…¶ä»–åœ°æ–¹è°ƒç”¨ä»£ç ï¼Œå…¶å€¼ä¸ºå‡½æ•°çš„æœºå™¨ä»£ç ä¸­ç¬¬ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚</li>
</ul>
<p>ä¾‹å¦‚ä¸€ä¸ªå‡½æ•°çš„åŸå‹ä¸ºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">fun</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">);</span>
</code></pre></div>
<p>æˆ‘ä»¬å¯ä»¥å£°æ˜ä¸€ä¸ªæŒ‡é’ˆæ¥æŒ‡å‘å®ƒï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">fp</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="p">)</span>
<span class="n">fp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fun</span><span class="p">;</span>
</code></pre></div>
<p>è¿™æ ·ä¾¿å¯ä»¥ä½¿ç”¨æŒ‡é’ˆæ¥è°ƒç”¨è¯¥å‡½æ•°ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fp</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">y</span><span class="p">);</span>
</code></pre></div>
<h3 id="å†…å­˜å¼•ç”¨è¶Šç•Œå’Œç¼“å†²åŒºæº¢å‡º">å†…å­˜å¼•ç”¨è¶Šç•Œå’Œç¼“å†²åŒºæº¢å‡º<a class="headerlink" href="#å†…å­˜å¼•ç”¨è¶Šç•Œå’Œç¼“å†²åŒºæº¢å‡º" title="Permanent link">&para;</a></h3>
<p>C ä¸ä¼šå¯¹æ•°ç»„å¼•ç”¨åšä»»ä½•çš„è¾¹ç•Œæ£€æŸ¥ï¼Œè¿™å¯èƒ½å¯¼è‡´å­˜å‚¨åœ¨æ ˆä¸­çš„æ•°æ®å› å†™å…¥è¶Šç•Œï¼ˆOut-of-Boundsï¼‰çš„æ•°ç»„å…ƒç´ è€ŒæŸåã€‚å¦‚æœç¨‹åºéšåä»¥è¿™ç§çŠ¶æ€é‡æ–°åŠ è½½å¯„å­˜å™¨æˆ–æ‰§è¡Œ<code>ret</code>æŒ‡ä»¤ï¼Œäº‹æƒ…å¯èƒ½ä¼šå˜å¾—ååˆ†ä¸¥é‡ã€‚</p>
<p>ä¸€ç§å¸¸è§çš„çŠ¶æ€æŸååŸå› è¢«ç§°ä¸ºç¼“å­˜åŒºæº¢å‡ºï¼ˆBuffer Overflowï¼‰ï¼Œæ¯”è¾ƒå…¸å‹çš„ä¾‹å­æ˜¯å­—ç¬¦ä¸²çš„é•¿åº¦è¶…è¿‡äº†æ ˆä¸­ä¸ºå…¶åˆ†é…çš„å­—ç¬¦æ•°ç»„ç©ºé—´ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cm">/* Implementation of library function gets() */</span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="nf">gets</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getchar</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">EOF</span><span class="p">)</span>
<span class="w">        </span><span class="o">*</span><span class="n">dest</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">EOF</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="w">        </span><span class="cm">/* No characters read */</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="o">*</span><span class="n">dest</span><span class="o">++</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Terminate string */</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/* Read input line and write it back */</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">echo</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span><span class="w"> </span><span class="cm">/* Way too small! */</span>
<span class="w">    </span><span class="n">gets</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
<span class="w">    </span><span class="n">puts</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>ä¸ŠåŠéƒ¨åˆ†ä»£ç å±•ç¤ºäº†åº“å‡½æ•°<code>gets</code>çš„å®ç°è¿‡ç¨‹ï¼šå®ƒé¦–å…ˆä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–ä¸€è¡Œå­—ç¬¦ä¸²ï¼Œå½“é‡åˆ°æ¢è¡Œç¬¦æˆ–æŸäº›é”™è¯¯æ¡ä»¶æ—¶åœæ­¢ï¼›ç„¶åå®ƒå°†è¯»å–å†…å®¹å¤åˆ¶åˆ°å‚æ•°<code>s</code>æŒ‡å‘çš„ä½ç½®ä¸Šï¼Œå¹¶ä»¥å­—ç¬¦<code>NULL</code>ç»“å°¾ã€‚<code>gets</code>çš„é—®é¢˜åœ¨äºå…¶æ— æ³•ç¡®å®šæ˜¯å¦åˆ†é…äº†è¶³å¤Ÿçš„ç©ºé—´æ¥ä¿å­˜è¯»å–åˆ°çš„å­—ç¬¦ä¸²ã€‚è€Œåœ¨ä¸‹åŠéƒ¨åˆ†çš„å‡½æ•°<code>echo</code>ä¸­ï¼Œæˆ‘ä»¬æ•…æ„å°†ç¼“å†²åŒºåšå¾—éå¸¸å°ï¼ˆåªæœ‰ 8 ä¸ªå­—èŠ‚ï¼‰ï¼Œå› æ­¤ä»»ä½•è¶…è¿‡ 7 ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²éƒ½ä¼šå¯¼è‡´è¶Šç•Œå†™å…¥ã€‚éšç€å­—ç¬¦ä¸²é•¿åº¦çš„å¢åŠ ï¼Œå—åˆ°å½±å“çš„æ ˆåŒºåŸŸä¼šè¶Šæ¥è¶Šå¤šï¼š</p>
<table>
<thead>
<tr>
<th>Character Typed</th>
<th>Additional Corrupted State</th>
</tr>
</thead>
<tbody>
<tr>
<td>0-7</td>
<td>None</td>
</tr>
<tr>
<td>8-23</td>
<td>Unused Stack Space</td>
</tr>
<tr>
<td>24-31</td>
<td>Return Address</td>
</tr>
<tr>
<td>32+</td>
<td>Saved State in Caller</td>
</tr>
</tbody>
</table>
<p>ç¼–è¯‘å™¨ä¸ºå‡½æ•°<code>echo</code>åˆ†é…äº† 24 ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œå› æ­¤è¯»å–å°‘äº 23 ä¸ªå­—ç¬¦çš„å†…å®¹ä¸ä¼šå‘ç”Ÿä¸¥é‡åæœã€‚ä½†ä¸€æ—¦è¶…å‡ºè¿™ä¸ªèŒƒå›´ï¼Œè¿”å›æŒ‡é’ˆçš„å€¼å’Œå…¶ä»–ä¿å­˜çš„çŠ¶æ€å°±ä¼šè¢«ç ´åï¼Œ<code>ret</code>æŒ‡ä»¤å°†å¯¼è‡´ç¨‹åºè·³è½¬åˆ°ä¸€ä¸ªå®Œå…¨ä¸å¯é¢„çŸ¥çš„ä½ç½®ã€‚</p>
<h3 id="é˜»æ­¢ç¼“å†²åŒºæº¢å‡ºæ”»å‡»">é˜»æ­¢ç¼“å†²åŒºæº¢å‡ºæ”»å‡»<a class="headerlink" href="#é˜»æ­¢ç¼“å†²åŒºæº¢å‡ºæ”»å‡»" title="Permanent link">&para;</a></h3>
<p>ç¼“å†²åŒºæº¢å‡ºç”šè‡³ä¼šå¯¼è‡´è®¡ç®—æœºå—åˆ°ç½‘ç»œæ”»å‡»ï¼Œå±å®³ç³»ç»Ÿå®‰å…¨ã€‚å—åˆ°æ”»å‡»çš„ç¨‹åºä¼šæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒåŒ…å«ä¸€äº›å¯æ‰§è¡Œä»£ç çš„å­—èŠ‚ç¼–ç ï¼ˆä¹Ÿç§°æ¼æ´åˆ©ç”¨ä»£ç ï¼‰ï¼Œä»¥åŠä¸€äº›é¢å¤–å­—èŠ‚ã€‚åªè¦é¢å¤–å­—èŠ‚èƒ½å¤Ÿå°†è¿”å›åœ°å€è¦†ç›–ä¸ºæŒ‡å‘æ¼æ´åˆ©ç”¨ä»£ç çš„æŒ‡é’ˆï¼Œç¨‹åºæ‰§è¡Œ<code>ret</code>æŒ‡ä»¤æ—¶å°±ä¼šè·³è½¬åˆ°æ¼æ´åˆ©ç”¨ä»£ç ã€‚ç°ä»£ç¼–è¯‘å™¨å’Œæ“ä½œç³»ç»Ÿå·²ç»å¼€å§‹å¼•å…¥ä¸€äº›æœºåˆ¶æ¥æŠµå¾¡è¿™ç§æ”»å‡»ã€‚</p>
<h4 id="éšæœºåŒ–æ ˆ">éšæœºåŒ–æ ˆ<a class="headerlink" href="#éšæœºåŒ–æ ˆ" title="Permanent link">&para;</a></h4>
<p>åªè¦æˆ‘ä»¬åœ¨ç¨‹åºå¼€å§‹è¿è¡Œæ—¶åœ¨æ ˆä¸Šåˆ†é… 0 åˆ° n ä¸ªå­—èŠ‚ä¹‹é—´çš„éšæœºç©ºé—´ï¼ˆä¾‹å¦‚ä½¿ç”¨åˆ†é…å‡½æ•°<code>alloca</code>ï¼‰ï¼Œå°±å¯ä»¥è®©ç›¸åŒçš„ä»£ç åœ¨å¤šæ¬¡è¿è¡Œä¸­ä½¿ç”¨ä¸åŒçš„æ ˆåœ°å€ã€‚åˆ†é…çš„ç©ºé—´èŒƒå›´ n éœ€è¦è¶³å¤Ÿå¤§ï¼Œä»¥ä¾¿æ ˆåœ°å€èƒ½å¤Ÿå‘ç”Ÿè¶³å¤Ÿçš„å˜åŒ–ã€‚ä½†åˆè¦è¶³å¤Ÿå°ï¼Œå¦åˆ™ç¨‹åºå°†æµªè´¹å¤ªå¤šçš„å†…å­˜ç©ºé—´ã€‚</p>
<p>ä¸è¿‡æ”»å‡»è€…å¯ä»¥åœ¨å®é™…çš„æ¼æ´åˆ©ç”¨ä»£ç å‰åŠ å…¥ä¸€é•¿ä¸²çš„<code>nop</code>æŒ‡ä»¤ï¼Œä»è€Œæš´åŠ›æ”»å…‹éšæœºåŒ–æ ˆã€‚å› æ­¤éšæœºåŒ–æ ˆå¯ä»¥å¢åŠ æˆåŠŸæ”»å‡»ç³»ç»Ÿæ‰€éœ€çš„å·¥ä½œé‡ï¼Œä½†ä¸èƒ½æä¾›å¯é å®Œå–„çš„ä¿éšœã€‚</p>
<h4 id="æ ˆæŸåæ£€æµ‹">æ ˆæŸåæ£€æµ‹<a class="headerlink" href="#æ ˆæŸåæ£€æµ‹" title="Permanent link">&para;</a></h4>
<p>æˆ‘ä»¬è¿˜å¯ä»¥åœ¨å±€éƒ¨ç¼“å†²åŒºå’Œæ ˆçš„å‰©ä½™éƒ¨åˆ†ä¹‹é—´æ’å…¥ä¸€ä¸ªé‡‘ä¸é›€å€¼ï¼ˆCanaryï¼‰æ¥æ£€æµ‹æ ˆæ˜¯å¦æŸåï¼š</p>
<p><img alt="alt text" src="../image/image-32.png" /></p>
<h4 id="é™åˆ¶å¯æ‰§è¡Œä»£ç åŒºåŸŸ">é™åˆ¶å¯æ‰§è¡Œä»£ç åŒºåŸŸ<a class="headerlink" href="#é™åˆ¶å¯æ‰§è¡Œä»£ç åŒºåŸŸ" title="Permanent link">&para;</a></h4>
<p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é™åˆ¶åªæœ‰ä¿å­˜äº†ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç çš„é‚£éƒ¨åˆ†å†…å­˜åŒºåŸŸæ˜¯å¯æ‰§è¡Œçš„ï¼Œå…¶ä»–éƒ¨åˆ†è¢«é™åˆ¶ä¸ºåªè¯»æˆ–åªå†™ã€‚</p>
<h3 id="æ”¯æŒå¯å˜å¤§å°çš„æ ˆå¸§">æ”¯æŒå¯å˜å¤§å°çš„æ ˆå¸§<a class="headerlink" href="#æ”¯æŒå¯å˜å¤§å°çš„æ ˆå¸§" title="Permanent link">&para;</a></h3>
<p>åœ¨ä¹‹å‰æˆ‘ä»¬ä»‹ç»çš„æ±‡ç¼–ä»£ç ä¸­ï¼Œç¼–è¯‘å™¨ä¸ºç¨‹åºåˆ†é…çš„è¿è¡Œæ—¶æ ˆå¤§å°éƒ½æ˜¯ç¡®å®šçš„ã€‚è€Œæœ‰äº›ç¨‹åºåˆ™éœ€è¦å¤§å°å¯å˜çš„è¿è¡Œæ—¶æ ˆï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">long</span><span class="w"> </span><span class="nf">vframe</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="o">*</span><span class="n">q</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
<span class="w">    </span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<p>å‡½æ•°<code>vframe</code>å£°æ˜äº†ä¸€ä¸ªå˜é•¿çš„æŒ‡é’ˆæ•°ç»„<code>*p[n]</code>ï¼Œå°†åœ¨æ ˆä¸­å ç”¨<code>8n</code>ä¸ªå­—èŠ‚çš„ç©ºé—´ã€‚ç”±äº<code>n</code>çš„å€¼æ˜¯ç”±å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ç»™å‡ºçš„ï¼Œå› æ­¤ç¼–è¯‘å™¨æ— æ³•ç¡®å®šè¦ä¸ºè¯¥å‡½æ•°çš„è¿è¡Œæ—¶æ ˆåˆ†é…å¤šå°‘ç©ºé—´ã€‚å¦å¤–ï¼Œç¨‹åºæ¶‰åŠäº†å¯¹å±€éƒ¨å˜é‡<code>i</code>åœ°å€çš„å¼•ç”¨ï¼Œæ‰€ä»¥è¯¥å˜é‡å¿…é¡»å­˜å‚¨åœ¨æ ˆä¸­ã€‚å½“å‡½æ•°è¿”å›æ—¶ï¼Œè¿è¡Œæ—¶æ ˆéœ€è¦è¢«å›æ”¶ï¼Œæ ˆæŒ‡é’ˆå°†æŒ‡å‘å­˜å‚¨è¿”å›åœ°å€çš„ä½ç½®ã€‚</p>
<p>ä¸ºäº†ç®¡ç†å¯å˜å¤§å°çš„æ ˆå¸§ï¼Œx86-64 ä½¿ç”¨å¯„å­˜å™¨ %rbp ä½œä¸ºå¸§æŒ‡é’ˆï¼ˆåˆç§°åŸºæŒ‡é’ˆï¼ŒBase Pointerï¼‰ã€‚æ ˆå¸§ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img alt="alt text" src="../image/image-33.png" /></p>
<p>ä¸Šæ–‡æåˆ°ï¼Œ%rbp æ˜¯ä¸€ä¸ª <strong>è¢«è°ƒç”¨è€…ä¿å­˜å¯„å­˜å™¨</strong> ï¼Œå› æ­¤å…¶åŸå€¼å°†è¢«ä¿å­˜åœ¨æ ˆä¸­ï¼ˆå›¾ä¸­çš„â€œSaved %rbpâ€ï¼‰ã€‚åœ¨ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œ%rbp ä¼šä¸€ç›´æŒ‡å‘è¿™ä¸ªä½ç½®ã€‚ä¸€äº›å›ºå®šé•¿åº¦çš„å±€éƒ¨å˜é‡ï¼Œæ¯”å¦‚<code>i</code>ï¼Œå°±å¯ä»¥æ ¹æ®å…¶ç›¸å¯¹äº %rbp çš„åç§»é‡æ¥å¼•ç”¨ã€‚å‡½æ•°ç¼–è¯‘åç”Ÿæˆçš„éƒ¨åˆ†æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img alt="alt text" src="../image/image-34.png" /></p>
<p>å‡½æ•°é¦–å…ˆå°† %rbp å‹å…¥æ ˆä¸­ï¼Œç„¶åå°†å…¶ç½®ä¸ºå½“å‰è¿è¡Œæ—¶æ ˆçš„åœ°å€ï¼ˆæ±‡ç¼–ä»£ç ç¬¬ 2 åˆ° 3 è¡Œï¼‰ã€‚æ¥ä¸‹æ¥åœ¨æ ˆä¸Šåˆ†é…äº† 16 ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œæ ˆæŒ‡é’ˆæŒ‡å‘å›¾ä¸­ s1 çš„ä½ç½®ã€‚å‰ 8 ä¸ªå­—èŠ‚ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡<code>i</code>ï¼Œå 8 ä¸ªå­—èŠ‚å¹¶æœªä½¿ç”¨ã€‚ç„¶åå®ƒå¼€å§‹ä¸ºæ•°ç»„<code>*p[n]</code>åˆ†é…ç©ºé—´ï¼Œæ ˆæŒ‡é’ˆæŒ‡å‘å›¾ä¸­ s2 çš„ä½ç½®ã€‚å…¶ç›¸å¯¹äº s1 çš„åç§»é‡æ˜¯é€šè¿‡æ±‡ç¼–ä»£ç ç¬¬ 5 åˆ° 7 è¡Œè®¡ç®—å¾—åˆ°çš„ï¼š</p>
<div class="arithmatex">\[
(8n + 22) \And (-16)= \begin{cases}
   8n + 8 &amp;\text n ä¸ºå¥‡æ•° \cr
   8n + 16 &amp;\text n ä¸ºå¶æ•°
\end{cases}
\]</div>
<p>ç”±äºè¯¥ç»“æœæ˜¯ 16 çš„å€æ•°ï¼Œå› æ­¤å®ç°äº†æ•°æ®å¯¹é½ã€‚æ±‡ç¼–ä»£ç ç¬¬ 8 åˆ° 10 è¡Œå°†å›¾ä¸­ p çš„å€¼ç½®ä¸ºæœ€æ¥è¿‘ s2 çš„ 8 çš„å€æ•°ï¼Œæœ€ç»ˆç”±å¯„å­˜å™¨ %rcx ä¸­çš„å€¼ä½œä¸º<code>*p[n]</code>çš„èµ·å§‹åœ°å€ã€‚å‡è®¾ n ä¸º 5 æˆ– 6ï¼Œs1 çš„å€¼ä¸º 2065 æˆ– 2064ï¼Œåˆ™å›¾ä¸­å„å€¼ä¸ºï¼š</p>
<table>
<thead>
<tr>
<th>n</th>
<th>s1</th>
<th>s2</th>
<th>p</th>
<th>e1</th>
<th>e2</th>
</tr>
</thead>
<tbody>
<tr>
<td>5</td>
<td>2065</td>
<td>2017</td>
<td>2024</td>
<td>1</td>
<td>7</td>
</tr>
<tr>
<td>6</td>
<td>2064</td>
<td>2000</td>
<td>2000</td>
<td>16</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>åœ¨å‡½æ•°æ‰§è¡Œç»“æŸå‰ï¼Œæ±‡ç¼–ä»£ç ç¬¬ 20 è¡Œçš„<code>leave</code>æŒ‡ä»¤å°†å¸§æŒ‡é’ˆæ¢å¤åŸå€¼ã€‚ç›¸å½“äºæ‰§è¡Œäº†ä»¥ä¸‹ä¸¤æ¡æŒ‡ä»¤ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="c1">; Set stack pointer to beginning of frame </span>
<span class="nf">movq</span><span class="w"> </span><span class="o">%</span><span class="nb">rbp</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">rsp</span>
<span class="c1">; Restore saved %rbp and set stack ptr</span>
<span class="c1">; to end of callerâ€™s frame</span>
<span class="nf">popq</span><span class="w"> </span><span class="o">%</span><span class="nb">rbp</span>
</code></pre></div>
<h2 id="æµ®ç‚¹ä»£ç ">æµ®ç‚¹ä»£ç <a class="headerlink" href="#æµ®ç‚¹ä»£ç " title="Permanent link">&para;</a></h2>
<p>å¤„ç†å™¨çš„æµ®ç‚¹æ¶æ„å†³å®šäº†æ“ä½œæµ®ç‚¹æ•°çš„ç¨‹åºä¸æœºå™¨çº§ä»£ç ä¹‹é—´çš„æ˜ å°„æ–¹å¼ï¼ŒåŒ…æ‹¬ä»¥ä¸‹æ–¹é¢ï¼š</p>
<ul>
<li>æµ®ç‚¹æ•°æ˜¯è¢«å¦‚ä½•è¢«å­˜å‚¨å’Œè®¿é—®çš„ï¼›</li>
<li>æ“ä½œæµ®ç‚¹æ•°çš„æŒ‡ä»¤ï¼›</li>
<li>æµ®ç‚¹æ•°å¦‚ä½•ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ä»¥åŠå¦‚ä½•ä½œä¸ºç»“æœè¿”å›ï¼›</li>
<li>åœ¨å‡½æ•°è°ƒç”¨æ—¶å¦‚ä½•ä¿å­˜å¯„å­˜å™¨ä¸­çš„å€¼ã€‚</li>
</ul>
<p>æˆ‘ä»¬çš„å†…å®¹åŸºäº AVX2ï¼ˆAdcanced Vector Extensions2ï¼‰æ‰©å±•ï¼Œå¯ä»¥åœ¨ GCC ç¼–è¯‘æ—¶åŠ å…¥<code>-mavx2</code>å‚æ•°ä»¥ç”Ÿæˆè¿™ç§æ¶æ„çš„ä»£ç ã€‚</p>
<p><img alt="alt text" src="../image/image-35.png" /></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒAVX æ¶æ„å…è®¸æµ®ç‚¹æ•°å­˜å‚¨åœ¨ 16 ä¸ª YMM å¯„å­˜å™¨ä¸­ï¼Œæ¯ä¸ªé•¿åº¦å‡ä¸º 256 ä½ï¼ˆ32 å­—èŠ‚ï¼‰ã€‚åœ¨å¯¹æ ‡é‡æ•°æ®è¿›è¡Œæ“ä½œæ—¶ï¼Œè¿™äº›å¯„å­˜å™¨åªä¼šä¿å­˜æµ®ç‚¹å‹æ•°æ®ã€‚è€Œå¯¹äº<code>float</code>ç±»å‹å’Œ<code>double</code>ç±»å‹ï¼Œåˆ†åˆ«åªæœ‰è¾ƒä½çš„ 32 ä½å’Œ 64 ä½è¢«ä½¿ç”¨ã€‚æ±‡ç¼–ä»£ç é€šè¿‡ XMM å¯„å­˜å™¨ï¼ˆå³å›¾ä¸­çš„â€œ%xmm0â€ï½â€œ%xmm15â€ï¼‰çš„åç§°æ¥å¼•ç”¨å®ƒä»¬ï¼Œæ¯ä¸ª XMM å¯„å­˜å™¨æ˜¯å…¶å¯¹åº”çš„ YMM å¯„å­˜å™¨çš„ä½ 128 ä½ï¼ˆ16 å­—èŠ‚ï¼‰ã€‚</p>
<h3 id="æµ®ç‚¹æ•°çš„ç§»åŠ¨å’Œè½¬æ¢æ“ä½œ">æµ®ç‚¹æ•°çš„ç§»åŠ¨å’Œè½¬æ¢æ“ä½œ<a class="headerlink" href="#æµ®ç‚¹æ•°çš„ç§»åŠ¨å’Œè½¬æ¢æ“ä½œ" title="Permanent link">&para;</a></h3>
<p>ä¸‹å›¾å±•ç¤ºäº†ä¸€ç»„åœ¨å†…å­˜å’Œ XMM å¯„å­˜å™¨ä¹‹é—´å’Œåœ¨ä¸¤ä¸ª XMM å¯„å­˜å™¨ä¹‹é—´ä¸è¿›è¡Œç±»å‹è½¬æ¢çš„ä¼ è¾“æ•°æ®æµ®ç‚¹æ•°æŒ‡ä»¤ï¼š</p>
<p><img alt="alt text" src="../image/image-36.png" /></p>
<p>å‰å››ä¸ªæŒ‡ä»¤æ¶‰åŠåˆ°å¯¹å†…å­˜çš„å¼•ç”¨ï¼Œæˆ‘ä»¬ç§°å…¶ä¸º Scalar æŒ‡ä»¤ã€‚å®ƒä»¬æ“ä½œçš„å¯¹è±¡æ˜¯å•ç‹¬çš„æ•°å€¼ï¼Œåªä¼šæ”¹å˜ç›®çš„å¯„å­˜å™¨ä½ä½çš„å››å­—èŠ‚æˆ–å…«å­—èŠ‚ã€‚è€Œåä¸¤ä¸ªæŒ‡ä»¤åˆ™å±äº Packed æŒ‡ä»¤ï¼Œå®ƒä»¬ä¼šæ›´æ–°ç›®çš„å¯„å­˜å™¨ä¸­å…¨éƒ¨çš„å†…å®¹ã€‚</p>
<p>æµ®ç‚¹æ•°å’Œæ•´å‹ä¹‹é—´è¿›è¡Œè½¬æ¢çš„æ“ä½œæŒ‡ä»¤ä¸ºï¼š</p>
<p><img alt="alt text" src="../image/image-37.png" /></p>
<p>åœ¨ C å’Œå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæµ®ç‚¹æ•°è½¬æ¢ä¸ºæ•´å‹æ—¶ä¼šå…ˆè¿›è¡Œæˆªæ–­æ“ä½œï¼Œå°†æ•°å€¼å‘é›¶èˆå…¥ã€‚è€Œæ•´å‹è½¬åŒ–ä¸ºæµ®ç‚¹æ•°æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šå¿½ç•¥ç¬¬äºŒä¸ªæºæ“ä½œæ•°ï¼Œå› ä¸ºå®ƒåªå½±å“ç»“æœçš„é«˜ä½å­—èŠ‚ã€‚å› æ­¤ï¼Œé€šå¸¸æƒ…å†µä¸‹ç¬¬äºŒä¸ªæºæ“ä½œæ•°å’Œç›®çš„æ“ä½œæ•°æ˜¯ç›¸åŒçš„ã€‚</p>
<p>æœ€ååˆ™æ˜¯ä¸¤ç§æµ®ç‚¹æ•°ä¹‹é—´çš„ç±»å‹è½¬æ¢ã€‚å‡è®¾å¯„å­˜å™¨ %xmm0 çš„ä½ä½å››å­—èŠ‚ä¿å­˜äº†ä¸€ä¸ªå•ç²¾åº¦æµ®ç‚¹å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾ˆå®¹æ˜“ä½¿ç”¨æŒ‡ä»¤<code>vcvtss2sd %xmm0, %xmm0, %xmm0</code>æ¥æŠŠå®ƒè½¬æ¢ä¸ºåŒç²¾åº¦æµ®ç‚¹å€¼ç„¶åå†å­˜å‚¨äºå¯„å­˜å™¨ %xmm0 çš„ä½ä½å…«å­—èŠ‚ä¸­ã€‚ç„¶è€Œå®é™…ä¸Š GCC ç”Ÿæˆçš„æ±‡ç¼–ä»£ç ä¸ºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="c1">; Replicate first vector element</span>
<span class="nf">vunpcklps</span><span class="w"> </span><span class="o">%</span><span class="nb">xmm0</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">xmm0</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">xmm0</span>
<span class="c1">; Convert two vector elements to double</span>
<span class="nf">vcvtps2pd</span><span class="w"> </span><span class="o">%</span><span class="nb">xmm0</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">xmm0</span>
</code></pre></div>
<p>æŒ‡ä»¤<code>vunpcklps</code>ä¼šäº¤é”™ä¸¤ä¸ª XMM å¯„å­˜å™¨ä¸­çš„å€¼ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨ç¬¬ä¸‰ä¸ªå¯„å­˜å™¨ä¸­ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä¸¤ä¸ªæºå¯„å­˜å™¨ä¸­çš„å€¼åˆ†åˆ«ä¸º<span class="arithmatex">\([s_3, s_2, s_1, s_0]\)</span>å’Œ<span class="arithmatex">\([d_3, d_2, d_1, d_0]\)</span>ï¼Œé‚£ä¹ˆç›®æ ‡å¯„å­˜å™¨çš„å€¼å°±æ˜¯<span class="arithmatex">\([s_1, d_1, s_0, d_0 ]\)</span>ã€‚åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œä¸‰ä¸ªæ“ä½œæ•°ä½¿ç”¨ç›¸åŒçš„å¯„å­˜å™¨ï¼Œå› æ­¤å¦‚æœå¯„å­˜å™¨ %xmm0 ä¸­çš„åŸå§‹å€¼ä¸º<span class="arithmatex">\([x_3, x_2, x_1, x_0]\)</span>ï¼Œåˆ™è¯¥æŒ‡ä»¤å°†æ›´æ–°å…¶å€¼ä¸º<span class="arithmatex">\([x_1, x_1, x_0, x_0]\)</span>ã€‚</p>
<p>æŒ‡ä»¤<code>vcvtps2pd</code>å°†æº XMM å¯„å­˜å™¨ä¸­çš„ä¸¤ä¸ªä½ä½å•ç²¾åº¦å€¼æ‰©å±•ä¸ºç›®çš„ XMM å¯„å­˜å™¨ä¸­çš„ä¸¤ä¸ªåŒç²¾åº¦å€¼ã€‚è®¾ <span class="arithmatex">\(dx_0\)</span> ä¸ºå°† <span class="arithmatex">\(x_0\)</span> è½¬æ¢ä¸ºåŒç²¾åº¦çš„ç»“æœï¼Œé‚£ä¹ˆè¯¥æŒ‡ä»¤å°†å¾—å‡ºå€¼<span class="arithmatex">\([dx_0, dx_0]\)</span>ã€‚ç»¼ä¸Šï¼Œè¿™ä¸¤æ¡æŒ‡ä»¤çš„æœ€ç»ˆæ•ˆæœæ˜¯å°†å¯„å­˜å™¨ %xmm0 ä¸­ä½ä½å››å­—èŠ‚ä¸­çš„åŸå§‹å•ç²¾åº¦å€¼è½¬æ¢ä¸ºåŒç²¾åº¦å€¼ï¼Œå¹¶å°†å®ƒçš„ä¸¤ä¸ªå‰¯æœ¬å­˜å‚¨åœ¨å¯„å­˜å™¨ %xmm0 ä¸­ã€‚</p>
<p>åŒæ ·ï¼ŒGCC ä¸ºåŒç²¾åº¦å€¼è½¬æ¢ä¸ºå•ç²¾åº¦ç”Ÿæˆç±»ä¼¼çš„æ±‡ç¼–ä»£ç ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="c1">; Replicate first vector element</span>
<span class="nf">vmovddup</span><span class="w"> </span><span class="o">%</span><span class="nb">xmm0</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">xmm0</span>
<span class="c1">; Convert two vector elements to single</span>
<span class="nf">vcvtpd2psx</span><span class="w"> </span><span class="o">%</span><span class="nb">xmm0</span><span class="p">,</span><span class="w"> </span><span class="o">%</span><span class="nb">xmm0</span>
</code></pre></div>
<p>å‡è®¾å¯„å­˜å™¨ %xmm0 ä¸­åŒ…å«äº†ä¸¤ä¸ªåŒç²¾åº¦å€¼<span class="arithmatex">\([x_1, x_0]\)</span>ï¼Œåˆ™æ‰§è¡Œä¸Šè¿°ä»£ç çš„ç»“æœä¸º<span class="arithmatex">\([0.0, 0.0, x_0, x_0]\)</span>ã€‚</p>
<h3 id="è¿‡ç¨‹ä¸­çš„æµ®ç‚¹ä»£ç ">è¿‡ç¨‹ä¸­çš„æµ®ç‚¹ä»£ç <a class="headerlink" href="#è¿‡ç¨‹ä¸­çš„æµ®ç‚¹ä»£ç " title="Permanent link">&para;</a></h3>
<p>è§‚å¯Ÿå›¾ 3.45 ä¸­æœ€å³ä¾§çš„æ³¨é‡Šï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ä»¥ä¸‹å‡†åˆ™ï¼š</p>
<ul>
<li>æœ€å¤šå¯ä»¥ä½¿ç”¨ XMM å¯„å­˜å™¨ä¼ é€’å…«ä¸ªå‚æ•°ï¼ˆ%xmm0-%xmm7ï¼‰ï¼Œå…¶ä½™çš„åˆ™éœ€è¦é€šè¿‡æ ˆï¼›</li>
<li>å’Œ %rax ç±»ä¼¼ï¼Œ%xmm0 é€šå¸¸ä½œä¸ºæµ®ç‚¹æ•°çš„è¿”å›å¯„å­˜å™¨ï¼›</li>
<li>æ‰€æœ‰ XMM å¯„å­˜å™¨å‡ä¸ºè°ƒç”¨è€…ä¿å­˜ï¼Œè¢«è°ƒç”¨è€…å¯ä»¥è¦†ç›–å…¶ä¸­ä»»æ„ä¸€ä¸ªï¼›</li>
<li>å½“å‡½æ•°å‚æ•°æ˜¯æŒ‡é’ˆã€æ•´æ•°å’Œæµ®ç‚¹æ•°çš„ç»„åˆæ—¶ï¼ŒæŒ‡é’ˆå’Œæ•´æ•°åœ¨é€šç”¨å¯„å­˜å™¨ä¸­ä¼ é€’ï¼Œè€Œæµ®ç‚¹å€¼åˆ™åœ¨ XMM å¯„å­˜å™¨ä¸­ä¼ é€’ã€‚</li>
</ul>
<h3 id="æµ®ç‚¹æ•°çš„ç®—æ•°æ“ä½œ">æµ®ç‚¹æ•°çš„ç®—æ•°æ“ä½œ<a class="headerlink" href="#æµ®ç‚¹æ•°çš„ç®—æ•°æ“ä½œ" title="Permanent link">&para;</a></h3>
<p>æµ®ç‚¹æ•°ç®—æ•°æ“ä½œæŒ‡ä»¤å¦‚ä¸‹ï¼Œæ¯ä¸ªæŒ‡ä»¤éƒ½æœ‰ä¸€åˆ°ä¸¤ä¸ªæºæ“ä½œæ•°å’Œä¸€ä¸ªç›®çš„æ“ä½œæ•°ã€‚ç¬¬ä¸€ä¸ªæºæ“ä½œæ•°å¯ä»¥æ˜¯ XMM å¯„å­˜å™¨æˆ–å†…å­˜ä¸­çš„ä½ç½®ï¼Œç¬¬äºŒä¸ªæºæ“ä½œæ•°å’Œç›®çš„æ“ä½œæ•°åªèƒ½æ˜¯ XMM å¯„å­˜å™¨ï¼›</p>
<p><img alt="alt text" src="../image/image-38.png" /></p>
<h3 id="æµ®ç‚¹å¸¸é‡çš„å®šä¹‰å’Œä½¿ç”¨">æµ®ç‚¹å¸¸é‡çš„å®šä¹‰å’Œä½¿ç”¨<a class="headerlink" href="#æµ®ç‚¹å¸¸é‡çš„å®šä¹‰å’Œä½¿ç”¨" title="Permanent link">&para;</a></h3>
<p>ä¸æ•´æ•°ç®—æœ¯è¿ç®—ä¸åŒï¼ŒAVX æµ®ç‚¹è¿ç®—ä¸èƒ½å°†ç«‹å³æ•°ä½œä¸ºæ“ä½œæ•°ã€‚ç¼–è¯‘å™¨å¿…é¡»ä¸ºå¸¸é‡åˆ†é…å’Œåˆå§‹åŒ–å­˜å‚¨ç©ºé—´ï¼Œå†ç”±ä»£ç ä»å†…å­˜ä¸­è¯»å–å€¼ã€‚</p>
<h3 id="æµ®ç‚¹ä»£ç ä¸­çš„ä½çº§è¿ç®—">æµ®ç‚¹ä»£ç ä¸­çš„ä½çº§è¿ç®—<a class="headerlink" href="#æµ®ç‚¹ä»£ç ä¸­çš„ä½çº§è¿ç®—" title="Permanent link">&para;</a></h3>
<p>ä¸‹å›¾å±•ç¤ºäº†ä¸¤ä¸ªç”¨äº XMM å¯„å­˜å™¨çš„ä½çº§è¿ç®—æŒ‡ä»¤ï¼Œå…¶æ“ä½œå¯¹è±¡å‡ä¸º Packed æ•°å€¼ï¼ˆXMM å¯„å­˜å™¨ä¸­å…¨éƒ¨çš„ 128 ä½ï¼‰ï¼š</p>
<p><img alt="alt text" src="../image/image-39.png" /></p>
<h3 id="æµ®ç‚¹æ•°çš„æ¯”è¾ƒæ“ä½œ">æµ®ç‚¹æ•°çš„æ¯”è¾ƒæ“ä½œ<a class="headerlink" href="#æµ®ç‚¹æ•°çš„æ¯”è¾ƒæ“ä½œ" title="Permanent link">&para;</a></h3>
<p>AVX 2 ä¸ºæµ®ç‚¹æ•°å€¼çš„æ¯”è¾ƒè¿ç®—æä¾›ä¸¤ç§æ“ä½œæŒ‡ä»¤ï¼š</p>
<table>
<thead>
<tr>
<th>Instruction</th>
<th>Based on</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>vucomiss <span class="arithmatex">\(S_1\)</span>, <span class="arithmatex">\(S_2\)</span></td>
<td><span class="arithmatex">\(S_2 - S_1\)</span></td>
<td>Compare Single Precision</td>
</tr>
<tr>
<td>vucomisd <span class="arithmatex">\(S_1\)</span>, <span class="arithmatex">\(S_2\)</span></td>
<td><span class="arithmatex">\(S_2 - S_1\)</span></td>
<td>Compare Double Precision</td>
</tr>
</tbody>
</table>
<p>ä¸Šè¿°æŒ‡ä»¤ä¸ <strong>æ¡ä»¶ç </strong> ä¸­ä»‹ç»çš„ CMP æŒ‡ä»¤ç±»ç›¸ä¼¼ã€‚å‚æ•° <span class="arithmatex">\(S_2\)</span> å¿…é¡»æ˜¯ XMM å¯„å­˜å™¨ï¼Œè€Œå‚æ•° <span class="arithmatex">\(S_1\)</span> åˆ™æ—¢å¯ä»¥æ˜¯ XMM å¯„å­˜å™¨ï¼Œåˆå¯ä»¥æ˜¯å†…å­˜ä¸­çš„ä½ç½®ã€‚</p>
<p>æµ®ç‚¹æ•°æ¯”è¾ƒæ“ä½œä¼šæ”¹å˜ä»¥ä¸‹æ¡ä»¶ç çš„å€¼ï¼Œå…¶ä¸­ PF æ„ä¸º Parity Flagï¼š</p>
<table>
<thead>
<tr>
<th>Ordering <span class="arithmatex">\(S_2\)</span>:<span class="arithmatex">\(S_1\)</span></th>
<th>CF</th>
<th>ZF</th>
<th>PF</th>
</tr>
</thead>
<tbody>
<tr>
<td>Unordered</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td><span class="arithmatex">\(S_2\)</span> &lt; <span class="arithmatex">\(S_1\)</span></td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td><span class="arithmatex">\(S_2\)</span> = <span class="arithmatex">\(S_1\)</span></td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td><span class="arithmatex">\(S_2\)</span> &gt; <span class="arithmatex">\(S_1\)</span></td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>å½“ä»»æ„æ“ä½œæ•°ä¸º NaN æ—¶ï¼Œå›¾ä¸­â€œUnorderedâ€çš„æƒ…å†µå°±ä¼šå‡ºç°ã€‚PF çš„å€¼å°†è¢«ç½®ä¸º 1ï¼Œå¯¹åº”çš„è·³è½¬æŒ‡ä»¤ä¸º<code>jp</code>ã€‚å…¶ä½™ä¸‰ç§æƒ…å†µåˆ™å’Œæ•´å‹çš„ <strong>è·³è½¬æŒ‡ä»¤</strong> ç›¸åŒï¼Œåˆ†åˆ«ä¸º<code>jb</code>ã€<code>je</code>å’Œ<code>ja</code>ã€‚</p>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="æœ€åæ›´æ–°">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-08-09T13:17:58+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-08-09</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="åˆ›å»ºæ—¥æœŸ">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-08-09T13:17:58+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-08-09</span>
  </span>

    
    
    
  </aside>


  



<div id="__comments">

<h3>é¢œè‰²ä¸»é¢˜è°ƒæ•´</h3>

<!-- <div class="tx-switch">
<button data-md-color-scheme="default"><code>default</code></button>
<button data-md-color-scheme="slate"><code>slate</code></button>
</div>

<script>
var buttons = document.querySelectorAll("button[data-md-color-scheme]")
buttons.forEach(function(button) {
        button.addEventListener("click", function() {
        var attr = this.getAttribute("data-md-color-scheme")
        document.body.setAttribute("data-md-color-scheme", attr)
        localStorage.setItem("data-md-color-scheme",attr);
        updateScheme();
        })
})
</script> -->

<div class="tx-switch">
<button class="button1" data-md-color-primary="red" style="background-color:red">red</button>
<button class="button1" data-md-color-primary="pink" style="background-color:pink;color:black">pink</button>
<button class="button1" data-md-color-primary="purple" style="background-color:purple">purple</button>
<button class="button1" data-md-color-primary="indigo" style="background-color:indigo">indigo</button>
<button class="button1" data-md-color-primary="blue" style="background-color:blue">blue</button>
<button class="button1" data-md-color-primary="cyan" style="background-color:cyan;color:black">cyan</button>
<button class="button1" data-md-color-primary="teal" style="background-color:teal">teal</button>
<button class="button1" data-md-color-primary="green" style="background-color:green">green</button>
<button class="button1" data-md-color-primary="lime" style="background-color:lime;color:black">lime</button>
<button class="button1" data-md-color-primary="orange" style="background-color:orange;color:black">orange</button>
<button class="button1" data-md-color-primary="brown" style="background-color:brown;border-radius=3px">brown</button>
<button class="button1" data-md-color-primary="grey" style="background-color:grey">grey</button>
<button class="button1" data-md-color-primary="black" style="background-color:black">black</button>
<button class="button1" data-md-color-primary="white" style="background-color:white;color:black">white</button>
</div>

<script>
var buttons = document.querySelectorAll("button[data-md-color-primary]")
buttons.forEach(function(button) {
        button.addEventListener("click", function() {
        var attr = this.getAttribute("data-md-color-primary")
        document.body.setAttribute("data-md-color-primary", attr)
        localStorage.setItem("data-md-color-primary",attr);
        })
})
</script>

<h2 ><!-- è¯„è®º -->è¯„è®ºåŒº~</h2>

æœ‰ç”¨çš„è¯è¯·ç»™æˆ‘ä¸ªèµå’Œ star => <a href="https://github.com/Tangjp-wraith/Tangjp-wraith.github.io"><img alt="GitHub stars" src="https://img.shields.io/github/stars/Tangjp-wraith/Tangjp-wraith.github.io.svg?style=plastic&amp;label=Stars"></a>

</br>

å¿«æ¥è·Ÿæˆ‘èŠå¤©~

</div>

<script src="https://giscus.app/client.js" data-repo="Tangjp-wraith/discussion" data-repo-id="R_kgDOLRJCPw"
    data-category="General" data-category-id="DIC_kwDOLRJCP84CdJdO" data-mapping="pathname" data-strict="0"
    data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="dark" data-lang="zh-CN"
    crossorigin="anonymous" async>
    </script>

<!-- Synchronize Giscus theme with palette -->
<script>
var giscus = document.querySelector("script[src*=giscus]")

/* Set palette on initial load */
var palette = __md_get("__palette")
if (palette && typeof palette.color === "object") {
    var theme = palette.color.scheme === "slate" ? "dark" : "light"
    giscus.setAttribute("data-theme", theme) 
}

/* Register event handlers after documented loaded */
document.addEventListener("DOMContentLoaded", function() {
    var ref = document.querySelector("[data-md-component=palette]")
    ref.addEventListener("change", function() {
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate" ? "dark" : "light"
        localStorage.setItem("data-md-color-scheme", palette.color.scheme === "slate" ? "slate" : "default");
        /* Instruct Giscus to change theme */
        var frame = document.querySelector(".giscus-frame")
        frame.contentWindow.postMessage(
        { giscus: { setConfig: { theme } } },
        "https://giscus.app"
        )
    }
    })
})
</script>
                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  å›åˆ°é¡µé¢é¡¶éƒ¨
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      æœ¬é¡µé¢çš„å…¨éƒ¨å†…å®¹åœ¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh">CC BY-SA 4.0</a> å’Œ <a href="https://github.com/zTrix/sata-license">SATA</a> åè®®ä¹‹æ¡æ¬¾ä¸‹æä¾›ï¼Œé™„åŠ æ¡æ¬¾äº¦å¯èƒ½åº”ç”¨
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "content.code.annotate", "navigation.indexes", "navigation.top", "toc.follow"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="../../../js/timeago.min.js"></script>
      
        <script src="../../../js/timeago_mkdocs_material.js"></script>
      
        <script src="../../../from_oi_wiki/js/extra.js"></script>
      
        <script src="../../../js/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../../js/tablesort.js"></script>
      
        <script src="../../../termynal.js"></script>
      
    
  </body>
</html>