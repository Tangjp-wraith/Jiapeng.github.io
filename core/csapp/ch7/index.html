
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://tang-jiapeng.github.io/core/csapp/ch7/">
      
      
        <link rel="prev" href="../ch6/">
      
      
        <link rel="next" href="../ch8/">
      
      
      <link rel="icon" href="../../../logo.ico">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>Chapter7：链接 - 0X10CC's notes</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Serif SC";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/timeago.css">
    
      <link rel="stylesheet" href="../../../from_oi_wiki/css/extra.css?v=13">
    
      <link rel="stylesheet" href="../../../css/status.css">
    
      <link rel="stylesheet" href="../../../css/neoteroi-mkdocs.css">
    
      <link rel="stylesheet" href="../../../termynal.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-JT9BRCXKJJ"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-JT9BRCXKJJ",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-JT9BRCXKJJ",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#链接" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="0X10CC&#39;s notes" class="md-header__button md-logo" aria-label="0X10CC's notes" data-md-component="logo">
      
  <img src="../../../logo.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            0X10CC's notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter7：链接
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/tang-jiapeng/tang-jiapeng.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    tang-jiapeng.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
    
  
  🏡 Home

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../langs/" class="md-tabs__link">
          
  
    
  
  Langs

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  Core

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../tools/" class="md-tabs__link">
          
  
    
  
  Tools

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../life/" class="md-tabs__link">
          
  
    
  
  Life

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="0X10CC&#39;s notes" class="md-nav__button md-logo" aria-label="0X10CC's notes" data-md-component="logo">
      
  <img src="../../../logo.ico" alt="logo">

    </a>
    0X10CC's notes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/tang-jiapeng/tang-jiapeng.github.io" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    tang-jiapeng.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../.." class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    🏡 Home
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            🏡 Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../langs/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Langs
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Langs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    C++零碎杂记
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            C++零碎杂记
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/%E9%A1%B6%E5%B1%82const%E4%B8%8E%E5%BA%95%E5%B1%82const/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    顶层const与底层const
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/%E5%80%BC%E7%B1%BB%E5%9E%8B%E4%B8%8E%E5%8F%B3%E5%80%BC%E5%BC%95%E7%94%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    值类型与右值引用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/%E6%95%B0%E7%BB%84%E6%8C%87%E9%92%88%E4%B8%8E%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数组指针与函数指针
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/C%2B%2B%E7%B1%BB%E5%AF%B9%E8%B1%A1%E5%B8%83%E5%B1%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++类对象布局
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/C%2B%2B%E4%B8%AD%E7%9A%84%E5%A4%9A%E6%80%81%E4%B8%8ERTTI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++中的多态与RTTI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Effective Modern C++
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Effective Modern C++
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item1：理解模板类型推导
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item2：理解auto类型推导
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item3：理解decltype
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item7：区别使用()和{}创建对象
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item9：优先考虑别名声明而非typedef
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item23/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item23：理解std::move和std::forward
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Core
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CMU15-213：CSAPP
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            CMU15-213：CSAPP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter1：计算机系统漫游
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter2：信息的表示和处理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter3：程序的机器级表示
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter4：处理器体系结构
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter5：优化程序性能
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter6：存储器层次结构
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Chapter7：链接
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Chapter7：链接
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#编译器驱动" class="md-nav__link">
    <span class="md-ellipsis">
      编译器驱动
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#静态链接" class="md-nav__link">
    <span class="md-ellipsis">
      静态链接
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#目标文件" class="md-nav__link">
    <span class="md-ellipsis">
      目标文件
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#可重定位目标文件" class="md-nav__link">
    <span class="md-ellipsis">
      可重定位目标文件
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#符号和符号表" class="md-nav__link">
    <span class="md-ellipsis">
      符号和符号表
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#符号解析" class="md-nav__link">
    <span class="md-ellipsis">
      符号解析
    </span>
  </a>
  
    <nav class="md-nav" aria-label="符号解析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#解析名称重复的符号" class="md-nav__link">
    <span class="md-ellipsis">
      解析名称重复的符号
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#与静态库链接" class="md-nav__link">
    <span class="md-ellipsis">
      与静态库链接
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#静态库的符号解析" class="md-nav__link">
    <span class="md-ellipsis">
      静态库的符号解析
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#重定位" class="md-nav__link">
    <span class="md-ellipsis">
      重定位
    </span>
  </a>
  
    <nav class="md-nav" aria-label="重定位">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#重定位条目" class="md-nav__link">
    <span class="md-ellipsis">
      重定位条目
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#重定位符号引用" class="md-nav__link">
    <span class="md-ellipsis">
      重定位符号引用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="重定位符号引用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pc-相对地址重定位" class="md-nav__link">
    <span class="md-ellipsis">
      PC 相对地址重定位
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#绝对地址重定位" class="md-nav__link">
    <span class="md-ellipsis">
      绝对地址重定位
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#可执行目标文件" class="md-nav__link">
    <span class="md-ellipsis">
      可执行目标文件
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#加载可执行目标文件" class="md-nav__link">
    <span class="md-ellipsis">
      加载可执行目标文件
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#使用共享库动态链接" class="md-nav__link">
    <span class="md-ellipsis">
      使用共享库动态链接
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#从应用程序中加载和链接共享库" class="md-nav__link">
    <span class="md-ellipsis">
      从应用程序中加载和链接共享库
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#与位置无关代码" class="md-nav__link">
    <span class="md-ellipsis">
      与位置无关代码
    </span>
  </a>
  
    <nav class="md-nav" aria-label="与位置无关代码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pic-数据引用" class="md-nav__link">
    <span class="md-ellipsis">
      PIC 数据引用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pic-函数调用" class="md-nav__link">
    <span class="md-ellipsis">
      PIC 函数调用
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#库插入" class="md-nav__link">
    <span class="md-ellipsis">
      库插入
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter8：异常控制流
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter9：虚拟内存
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter10：系统级I/O
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter11：网络编程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter12：并发编程
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CMU10-714：Deep Learning Systems
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            CMU10-714：Deep Learning Systems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture2：ML Refresher / Softmax Regression
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture3：Manual Neural Networks / Backprop
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture4：Automatic Differentiation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture5：Automatic Differentiation Implementation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture6：Optimization
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../tools/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Tools
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../life/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Life
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Life
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#编译器驱动" class="md-nav__link">
    <span class="md-ellipsis">
      编译器驱动
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#静态链接" class="md-nav__link">
    <span class="md-ellipsis">
      静态链接
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#目标文件" class="md-nav__link">
    <span class="md-ellipsis">
      目标文件
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#可重定位目标文件" class="md-nav__link">
    <span class="md-ellipsis">
      可重定位目标文件
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#符号和符号表" class="md-nav__link">
    <span class="md-ellipsis">
      符号和符号表
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#符号解析" class="md-nav__link">
    <span class="md-ellipsis">
      符号解析
    </span>
  </a>
  
    <nav class="md-nav" aria-label="符号解析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#解析名称重复的符号" class="md-nav__link">
    <span class="md-ellipsis">
      解析名称重复的符号
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#与静态库链接" class="md-nav__link">
    <span class="md-ellipsis">
      与静态库链接
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#静态库的符号解析" class="md-nav__link">
    <span class="md-ellipsis">
      静态库的符号解析
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#重定位" class="md-nav__link">
    <span class="md-ellipsis">
      重定位
    </span>
  </a>
  
    <nav class="md-nav" aria-label="重定位">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#重定位条目" class="md-nav__link">
    <span class="md-ellipsis">
      重定位条目
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#重定位符号引用" class="md-nav__link">
    <span class="md-ellipsis">
      重定位符号引用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="重定位符号引用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pc-相对地址重定位" class="md-nav__link">
    <span class="md-ellipsis">
      PC 相对地址重定位
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#绝对地址重定位" class="md-nav__link">
    <span class="md-ellipsis">
      绝对地址重定位
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#可执行目标文件" class="md-nav__link">
    <span class="md-ellipsis">
      可执行目标文件
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#加载可执行目标文件" class="md-nav__link">
    <span class="md-ellipsis">
      加载可执行目标文件
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#使用共享库动态链接" class="md-nav__link">
    <span class="md-ellipsis">
      使用共享库动态链接
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#从应用程序中加载和链接共享库" class="md-nav__link">
    <span class="md-ellipsis">
      从应用程序中加载和链接共享库
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#与位置无关代码" class="md-nav__link">
    <span class="md-ellipsis">
      与位置无关代码
    </span>
  </a>
  
    <nav class="md-nav" aria-label="与位置无关代码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pic-数据引用" class="md-nav__link">
    <span class="md-ellipsis">
      PIC 数据引用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pic-函数调用" class="md-nav__link">
    <span class="md-ellipsis">
      PIC 函数调用
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#库插入" class="md-nav__link">
    <span class="md-ellipsis">
      库插入
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="链接">链接<a class="headerlink" href="#链接" title="Permanent link">&para;</a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8V2m6.78 1a.69.69 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38-2.5-2.5Z"/></svg></span> 约 7056 个字 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6zm80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3z"/></svg></span> 122 行代码 <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3L12.5 13Z"/></svg></span> 预计阅读时间 25 分钟</p>
</div>
<p>链接（Linking）是将各部分代码和数据收集并组成单个文件的过程，该文件可以被加载（复制）到内存中执行。链接可以在编译时（即源代码被翻译成机器代码时）执行，也可以在加载时（即程序被加载到内存并由加载器执行时）执行，甚至还可以在运行时由应用程序执行。在现代系统中，能够自动执行链接的程序被称为链接器（Linker）。</p>
<p>链接器支持单独编译（Separate Compilation），因此在软件开发中起着至关重要的作用。与其将大型应用程序组织为一个单一的大块源文件，不如将其分解为一些更小、更易于管理并且可以单独修改和编译的模块。一旦我们修改了其中的某个模块，只需重新编译该模块并将其链接到应用程序，不必再次编译其他文件。</p>
<h2 id="编译器驱动">编译器驱动<a class="headerlink" href="#编译器驱动" title="Permanent link">&para;</a></h2>
<p>大多数编译系统都提供了一个编译器驱动（Compiler Driver），它可以根据用户需求调用语言预处理器（Language Preprocessor）、编译器、汇编器和链接器等。例如要在 GNU 编译系统中构建下列程序，我们可以   使用命令<code>gcc -Og -o prog main.c sum.c</code>:</p>
<p><img alt="alt text" src="../image/image-70.png" />
编译器驱动将示例程序从 ASCII 源文件转换为可执行目标文件时的过程如下图所示：</p>
<p><img alt="alt text" src="../image/image-71.png" />
首先，驱动运行 C 预处理器（C Preprocessor，CPP），将源文件<code>main.c</code>转换为 ASCII 中间文件<code>main.i</code>；接下来，驱动运行 C 编译器 (C Compiler，CC)，将<code>main.i</code>转换为 ASCII
汇编语言文件<code>main.s</code>；然后，驱动运行汇编器，将<code>main.s</code>转换为二进制可重定位（Relocatable）目标文件<code>main.o</code>（<code>sum.o</code>的生成过程相同）；最后，驱动运行链接器，将<code>main.o</code>、<code>sum.o</code>和一些必要的系统目标文件组合，创建二进制可执行目标文件<code>prog</code>。</p>
<h2 id="静态链接">静态链接<a class="headerlink" href="#静态链接" title="Permanent link">&para;</a></h2>
<p>静态链接器（Static Linker）将可重定位目标文件和命令行参数作为输入，生成完全链接的可执行目标文件。可重定位目标文件由各种代码和数据组成，指令、初始化的全局变量和未初始化的变量分别处于不同部分。</p>
<p>链接器需要完成两个主要任务：</p>
<ul>
<li>符号解析（Symbol Resolution）：目标文件定义并引用符号，每个符号对应一个函数、全局变量或静态变量（即使用<code>static</code>声明的任何变量）。符号解析的目的是将每个符号引用与一个符号定义相关联；</li>
<li>重定位（Relocation）：编译器和汇编器生成的代码和数据段是从地址 0 开始的，链接器会重定位所有的符号定义并修改其对应的符号引用。</li>
</ul>
<p>目标文件只是字节块的集合，其中可能包含代码、数据或指导链接器和加载器的数据结构。链接器将各个块连接在一起，确定整个块的运行时位置，并修改代码和数据块中的不同位置。编译器和汇编器在生成目标文件时已经完成了大部分工作，因而链接器对目标机器的了解甚少。</p>
<h2 id="目标文件">目标文件<a class="headerlink" href="#目标文件" title="Permanent link">&para;</a></h2>
<p>目标文件（Object File）有三种形式：</p>
<ul>
<li>可重定位目标文件：包含二进制代码和数据，可以在编译时与其他可重定位目标文件组合以创建可执行目标文件；</li>
<li>可执行目标文件：包含二进制代码和数据形式，可直接被复制到内存中执行；</li>
<li>共享目标文件：一种特殊类型的可重定位目标文件，可以在加载时或运行时被加载到内存中并动态链接。</li>
</ul>
<h2 id="可重定位目标文件">可重定位目标文件<a class="headerlink" href="#可重定位目标文件" title="Permanent link">&para;</a></h2>
<p>典型的 ELF（Executable and Linkable Format）可重定位目标文件格式如下图所示：</p>
<p><img alt="alt text" src="../image/image-72.png" />
- ELF 头（ELF Header）：开头是一个表征系统字长（Word Size）和字节顺序（Byte Ordering）的 16 字节序列。其余部分包括 ELF 头的大小、目标文件的类型（如可重定位、可执行或共享）、机器类型（如 x86-64）、节头表（Section Header Table）的文件偏移量以及其中条目的大小和数量；
- 节头表：描述了目标文件中每个 Section 的位置和大小；
- Section：位于 ELF 头和节头表之间，包括：
  - .text：编译后程序的机器码；
  - .rodata：只读数据，例如<code>printf</code>中的格式字符串，Switch 语句的 <strong>跳转表</strong> 等；
  - .data：已初始化的全局变量和静态变量。非静态局部变量在运行时位于栈中，不会出现在 .data 或 .bss 中；
  - .bss：未初始化的静态变量，以及初始化为 0 的全局变量和静态变量。此 Section 只是一个占位符，在目标文件中不占用实际空间，因此可以提升空间效率。这些变量在运行时被分配到内存中，初始值为零；
  - .symtab ：一个保存了在程序中被定义和引用的函数和全局变量信息的符号表（Symbol Table）。与编译器中的符号表不同，.symtab 中的符号表不包含任何局部变量；
  - .rel.text：当链接器将目标文件与其他文件组合时，.text 中的许多位置都需要被修改，而 .rel.text 中则保存了与之相关的重定位信息。通常，任何调用外部函数或引用全局变量的指令都需要被修改，而调用局部函数的指令则不变。可执行目标文件一般不需要重定位信息，因此这部分可以省略；
  - .rel.data：被引用或定义的任何全局变量的重定位信息。通常，所有初始值为全局变量地址或外部定义函数地址的已初始化全局变量都需要被修改；
  - .debug：调试符号表，仅在使用<code>-g</code>选项调用编译器驱动时出现；
  - .line：原始程序中行号与 .text 中机器代码指令之间的映射关系，仅在使用<code>-g</code>选项调用编译器驱动时出现；
  - .strtab：一个以<code>NULL</code>结尾，包含 .symtab 和 .debug 中的符号表以及 Section 名称的字符串序列。</p>
<h2 id="符号和符号表">符号和符号表<a class="headerlink" href="#符号和符号表" title="Permanent link">&para;</a></h2>
<p>每个目标文件都有一个符号表，其中包含了该文件所定义和引用的符号信息。符号有以下三种：</p>
<ul>
<li>全局符号（Global Symbols）：由该文件定义并且可以被其他文件引用的符号；</li>
<li>外部符号（Externals）：被该文件引用但由其他文件定义的符号；</li>
<li>局部符号（Local Symbols）：由该文件定义且无法被其他文件引用的符号，即使用<code>static</code>声明的函数和变量。</li>
</ul>
<p>上节提到，非静态局部变量在运行时位于栈中，与链接器无关。而静态局部变量则保存在 .data 或 .bss 中，编译器会在符号表中为其创建名称唯一的局部符号。例如同一文件中的两个函数都定义了静态局部变量<code>x</code>：</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">f</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">g</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>那么编译器可能将<code>x.1</code>作为函数<code>f()</code>中的变量符号，将<code>x.2</code>作为函数<code>g()</code>中的变量符号发送给汇编器。汇编器使用接收到的<code>.s</code>文件中的符号构建符号表，其中每个条目的数据结构为：</p>
<p><img alt="alt text" src="../image/image-73.png" />
- <code>name</code>：符号名在字符串表 .strtab 中的偏移量；
- <code>value</code>：对于可重定位目标文件是符号在其 Section 中的偏移量，对于可执行目标文件是符号的运行时地址；
- <code>size</code>：符号的大小；
- <code>type</code>：符号的类型；
- <code>binding</code>：符号是局部的还是全局的；
- <code>section</code>：符号所在的 Section 在节头表中的索引。</p>
<p>值得一提的是，有三个伪 Section 在节头表中没有条目：</p>
<ul>
<li>ABS：不应重定位的符号；</li>
<li>UNDEF：在此文件中引用但在其他文件中定义的符号；</li>
<li>COMMON：未初始化的全局符号。</li>
</ul>
<p>上述三个 Section 仅存在于可重定位目标文件，在可执行目标文件中并不存在。我们可以使用 <a href="https://man7.org/linux/man-pages/man1/readelf.1.html">READELF</a> 工具阅读目标文件中的内容，<strong>示例程序 main.c</strong> 生成的目标文件符号表条目如下：</p>
<p><img alt="alt text" src="../image/image-74.png" />
READELF 通过整数索引 Ndx 标识每个 Section，1 表示 .text，3 表示 .data。全局符号<code>main</code>和<code>array</code>分别位于上述两个 Section 首部，因此其偏移量<code>value</code>均为 0。外部符号<code>sum</code>未在本文件中定义，位于 UNDEF。</p>
<h2 id="符号解析">符号解析<a class="headerlink" href="#符号解析" title="Permanent link">&para;</a></h2>
<p>链接器将每个符号引用与符号表中的符号定义相关联以完成符号解析（Symbol Resolution）。当编译器遇到未在当前文件中定义的符号时，它会假设该符号已在其他文件中定义，然后生成对应的符号表条目。如果链接器无法在任何输入文件中找到该符号的定义，那么它就会终止链接。</p>
<p>不同文件可能定义了相同名称的全局符号。对于这种情况，链接器要么直接报错，要么选取其中之一。</p>
<blockquote>
<p>C++ 和 Java 允许重载名称相同但参数列表不同的方法。编译器会将每个方法和参数列表组合为一个唯一的名称，这样链接器就可以区分它们。例如，<code>Foo::bar(int, long)</code>会被编码为<code>bar__3Fooil</code>。其中，3 代表类名 Foo 的字符数，i 和 l 则分别代表参数列表中的<code>int</code>和<code>long</code>。</p>
</blockquote>
<h3 id="解析名称重复的符号">解析名称重复的符号<a class="headerlink" href="#解析名称重复的符号" title="Permanent link">&para;</a></h3>
<p>Linux 编译系统会在编译时将全局符号分为两种类型：函数和已初始化的全局变量是强符号，未初始化的全局变量是弱符号。汇编器将符号的强弱信息隐式地编码到目标文件的符号表中。</p>
<p>链接器解析名称重复的符号的规则为：</p>
<ul>
<li>不允许多个强符号名称重复；</li>
<li>若一个强符号和多个弱符号名称重复，选择强符号；</li>
<li>若多个弱符号名称重复，从中任选其一。</li>
</ul>
<blockquote>
<p>注：最新版本的 GCC（如 GCC 10）默认使用标识位<code>-fno-common</code>，因此若程序包含多个名称重复的弱符号将引发链接错误。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="cm">/* foo3.c */</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15213</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>

<span class="w">    </span><span class="n">f</span><span class="p">();</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;x = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/* bar3.c */</span>
<span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">f</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15212</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>示例程序中，文件<code>bar3.c</code>中的函数<code>f</code>是强符号，文件<code>foo3.c</code>中的函数<code>f</code>是弱符号，因此主函数的输出<code>x</code>的值为 15212。</p>
<p>上文提到，未初始化的全局变量保存在 COMMON 中，而未初始化的静态变量，以及初始化为 0 的全局变量和静态变量保存在 .bss 中。这是因为前者是弱符号，编译器无法知晓其他文件中是否定义了相同名称的变量，必须将其分配到 COMMON 中并随后由链接器处理。已初始化为 0 的全局变量是强符号，根据第二条解析规则，该变量一定是唯一的，因此编译器可以安心地把它放到 .bss 中。静态变量无法被其他文件引用，自然也无需担心名称重复的问题。</p>
<h3 id="与静态库链接">与静态库链接<a class="headerlink" href="#与静态库链接" title="Permanent link">&para;</a></h3>
<p>编译系统将一些相关的目标模块打包到一个文件中，该文件被称为静态库（Static Library）。在构建可执行目标文件时，链接器仅复制静态库中被应用程序引用的目标模块，从而减小了磁盘和内存中可执行文件的大小。静态库为我们提供了 I/O、字符串操作和数学运算等标准函数。</p>
<p>在 Linux 系统中，静态库以特定的文件格式（后缀为<code>.a</code>）存储在磁盘上。应用程序可以在命令行中指定文件名来使用静态库中定义的任何函数（实际上，C 编译器驱动总是将<code>libc.a</code>传递给链接器），如：</p>
<div class="highlight"><pre><span></span><code><span class="n">linux</span><span class="o">&gt;</span><span class="w"> </span><span class="n">gcc</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">c</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libm</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="n">a</span>
</code></pre></div>
<p>我们使用 AR 命令将下列程序打包为静态库文件<code>libvector.a</code>：</p>
<p><img alt="alt text" src="../image/image-75.png" />
<div class="highlight"><pre><span></span><code><span class="n">linux</span><span class="o">&gt;</span><span class="w"> </span><span class="n">gcc</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="n">addvec</span><span class="p">.</span><span class="n">c</span><span class="w"> </span><span class="n">multvec</span><span class="p">.</span><span class="n">c</span>
<span class="n">linux</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ar</span><span class="w"> </span><span class="n">rcs</span><span class="w"> </span><span class="n">libvector</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="n">addvec</span><span class="p">.</span><span class="n">o</span><span class="w"> </span><span class="n">multvec</span><span class="p">.</span><span class="n">o</span>
</code></pre></div></p>
<p>接下来再编写一个程序<code>main2.c</code>调用该静态库，头文件<code>vector.h</code>定义了库文件中的函数原型：</p>
<p><img alt="alt text" src="../image/image-76.png" />
最后使用如下命令编译并链接<code>main2.o</code>和<code>libvector.a</code>：</p>
<div class="highlight"><pre><span></span><code><span class="n">linux</span><span class="o">&gt;</span><span class="w"> </span><span class="n">gcc</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="n">main2</span><span class="p">.</span><span class="n">c</span>
<span class="n">linux</span><span class="o">&gt;</span><span class="w"> </span><span class="n">gcc</span><span class="w"> </span><span class="o">-</span><span class="k">static</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">prog2c</span><span class="w"> </span><span class="n">main2</span><span class="p">.</span><span class="n">o</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">libvector</span><span class="p">.</span><span class="n">a</span>
</code></pre></div>
<p><code>-static</code>参数表示链接器应当构建一个完全链接的可执行目标文件，该文件可以被加载到内存中运行而无需进一步地链接。完整的链接流程如下图所示：</p>
<p><img alt="alt text" src="../image/image-77.png" /></p>
<h3 id="静态库的符号解析">静态库的符号解析<a class="headerlink" href="#静态库的符号解析" title="Permanent link">&para;</a></h3>
<p>符号解析时，链接器会按照从左到右的顺序依次扫描命令行中的目标文件和静态库。在这个过程中，E 为可重定位目标文件的集合，U 为被引用但还未找到定义的符号，D 为已扫描过的文件定义的符号，开始时三者均为空。</p>
<ul>
<li>若命令行中的输入文件为可重定位目标文件，则链接器将其添加到 E 中并更新 U 和 D 中的符号；</li>
<li>若命令行中的输入文件为静态库，则链接器会将 U 中的符号与该静态库中定义的符号相匹配。匹配成功的模块会被添加到 E 中，随后链接器更新 U 和 D 中的符号。当 U 和 D 中的符号不再改变时，匹配结束，任何不在 E 中的静态库模块都将被直接丢弃；</li>
<li>若扫描全部完成时 U 为空，则链接器合并并重定位 E 中所有的目标文件以构建可执行文件。否则，链接器将报错并终止。</li>
</ul>
<p>链接器的这种行为限制了命令行中的文件顺序。如果定义符号的静态库出现在引用该符号的目标文件之前，链接就会失败。</p>
<h2 id="重定位">重定位<a class="headerlink" href="#重定位" title="Permanent link">&para;</a></h2>
<p>符号解析完成后，链接器会将代码中的每个符号引用与一个符号定义相关联。接下来，链接器开始对目标文件重定位：</p>
<ul>
<li>重定位 Section 和符号定义：链接器将所有输入模块中相同类型的 Section 合并为一个新的聚合 Section，然后将运行时地址分配给每个 Section 和符号；</li>
<li>在 Section 内重定位符号引用：链接器修改代码和数据段中的每个符号引用，使其指向正确的运行时地址。</li>
</ul>
<h3 id="重定位条目">重定位条目<a class="headerlink" href="#重定位条目" title="Permanent link">&para;</a></h3>
<p>汇编器在生成目标文件时，并不知晓代码、数据和引用的外部符号在内存中的最终位置。它只会为每个引用生成一个重定位条目（Relocation Entry），指导链接器如何修改它们。上文提到，代码的重定位条目放在 .rel.text 中，数据的重定位条目则放在 .rel.data 中。</p>
<p>ELF 重定位条目的数据结构为：</p>
<div class="highlight"><pre><span></span><code><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span><span class="w">    </span><span class="cm">/* Offset of the reference to relocate */</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">type</span><span class="o">:</span><span class="mi">32</span><span class="p">,</span><span class="w">   </span><span class="cm">/* Relocation type */</span>
<span class="w">         </span><span class="nl">symbol</span><span class="p">:</span><span class="mi">32</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Symbol table index */</span>
<span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">addend</span><span class="p">;</span><span class="w">    </span><span class="cm">/* Constant part of relocation expression */</span>
<span class="p">}</span><span class="w"> </span><span class="n">Elf64_Rela</span><span class="p">;</span>
</code></pre></div>
<p><code>offset</code>是被修改的引用在其 Section 中的偏移量；<code>symbol</code>是引用指向的符号在符号表中的索引；<code>type</code>告知链接器如何修改引用；<code>addend</code>是一个有符号常量，某些类型的重定位使用它来偏置被修改的引用值。</p>
<p>最基本的两种重定位类型为：</p>
<ul>
<li>R_X86_64_PC32：使用 32 位 PC 相对地址重定位引用。当 CPU 执行一条使用 PC 相对地址的指令时，它会将指令中的目标地址与 PC 当前值（即下一条指令在内存中的地址）相加得到有效地址（在 <strong>跳转指令</strong> 一节中我们讨论过这一问题）；</li>
<li>R_X86_64_32：使用 32 位绝对地址重定位引用。CPU 直接使用指令中的目标地址作为有效地址，无需进一步地修改。</li>
</ul>
<h3 id="重定位符号引用">重定位符号引用<a class="headerlink" href="#重定位符号引用" title="Permanent link">&para;</a></h3>
<p>重定位算法的伪码如下图所示：</p>
<p><img alt="alt text" src="../image/image-78.png" />
链接器遍历每个 Section（<code>s</code>）中的每个重定位条目（<code>r</code>），<code>s</code>是一个字节数组，<code>r</code>是上一节介绍的<code>Elf64_Rela</code>类型的结构体，<code>*refptr</code>是指令中的目标地址。假设该算法运行时，链接器已经为每个 Section 和每个符号选择了运行时地址<code>ADDR(s)</code>和<code>ADDR(r.symbol)</code>。</p>
<p>我们使用命令<code>objdump -dx main.o</code>得到汇编器为 <strong>示例程序 main.c</strong> 生成的机器码和重定位条目：</p>
<p><img alt="alt text" src="../image/image-79.png" />
重定位条目（图中第 5 行和第 7 行）告知链接器对符号<code>array</code>的引用使用绝对地址重定位，而对符号<code>sum()</code>的引用则使用 PC 相对地址重定位。</p>
<h4 id="pc-相对地址重定位">PC 相对地址重定位<a class="headerlink" href="#pc-相对地址重定位" title="Permanent link">&para;</a></h4>
<p>如上图第 6 行所示：指令<code>callq</code>在其 Section 中的偏移量为 0xe，它包含一个一字节的指令码 0xe8 和一个用于指向<code>sum()</code>的 32 位 PC 相对引用的占位符。该引用对应的重定位条目为：</p>
<div class="highlight"><pre><span></span><code><span class="n">r</span><span class="p">.</span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xf</span>
<span class="n">r</span><span class="p">.</span><span class="n">symbol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span>
<span class="n">r</span><span class="p">.</span><span class="n">type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">R_X86_64_PC32</span>
<span class="n">r</span><span class="p">.</span><span class="n">addend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-4</span>
</code></pre></div>
<p>上述字段告诉链接器需要修改从偏移量 0xf 开始的 32 位 PC 相对引用，使其在运行时指向<code>sum()</code>。 假设<code>ADDR(s) = ADDR(.text) = 0x4004d0</code>，<code>ADDR(r.symbol) = ADDR(sum) = 0x4004e8</code>，那么首先我们可以计算得到该引用的运行时地址为：</p>
<div class="highlight"><pre><span></span><code><span class="n">refaddr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ADDR</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">offset</span>
<span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mh">0x4004d0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">0xf</span>
<span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mh">0x4004df</span>
</code></pre></div>
<p>然后根据上节中的算法更新引用使其指向<code>sum()</code>：</p>
<div class="highlight"><pre><span></span><code><span class="o">*</span><span class="n">refptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">ADDR</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">symbol</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">addend</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">refaddr</span><span class="p">)</span>
<span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mh">0x4004e8</span><span class="w">       </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">-4</span><span class="p">)</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="mh">0x4004df</span><span class="p">)</span>
<span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mh">0x5</span><span class="p">)</span>
</code></pre></div>
<p>指令<code>callq</code>的运行时地址为 0x4004de（<code>0x4004df -1</code>）。当 CPU 执行该指令时，PC 中的值为该指令的下一条指令的地址 0x4004e3（<code>0x4004de + (0xe - 9)</code>）。CPU 将该值压入栈中，然后加上 0x5（即<code>*refptr</code>），就得到了<code>sum()</code>的地址 0x4004e8。</p>
<h4 id="绝对地址重定位">绝对地址重定位<a class="headerlink" href="#绝对地址重定位" title="Permanent link">&para;</a></h4>
<p>如上图中的第四行所示：指令<code>mov</code>将数组地址拷贝到寄存器 %edi 中，它在 Section 中的偏移量为 0x9，包含一个一字节的指令码 0xbf 和一个用于指向<code>array</code>的 32 位绝对引用的占位符。该引用的重定位条目为：</p>
<div class="highlight"><pre><span></span><code><span class="n">r</span><span class="p">.</span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0xa</span>
<span class="n">r</span><span class="p">.</span><span class="n">symbol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span>
<span class="n">r</span><span class="p">.</span><span class="n">type</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">R_X86_64_32</span>
<span class="n">r</span><span class="p">.</span><span class="n">addend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
</code></pre></div>
<p>上述字段告诉链接器需要修改从偏移量 0xa 开始的 32 位 PC 绝对引用，使其在运行时指向<code>array</code>。 假设<code>ADDR(r.symbol) = ADDR(array) = 0x601018</code>，那么我们可以根据上节中的算法更新该引用为：</p>
<div class="highlight"><pre><span></span><code><span class="o">*</span><span class="n">refptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">ADDR</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">symbol</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">addend</span><span class="p">)</span>
<span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mh">0x601018</span><span class="w">       </span><span class="o">+</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mh">0x601018</span><span class="p">)</span>
</code></pre></div>
<p>下图展示了最终生成的可执行目标文件中的 .text 和 .data：</p>
<p><img alt="alt text" src="../image/image-80.png" />
加载器在加载时将这些 Section 中的字节直接拷贝到内存中，无需任何修改便可以执行其中的指令。</p>
<h2 id="可执行目标文件">可执行目标文件<a class="headerlink" href="#可执行目标文件" title="Permanent link">&para;</a></h2>
<p>ELF 可执行目标文件的结构如下：</p>
<p><img alt="alt text" src="../image/image-81.png" />
ELF 头描述了文件的整体格式，并包含了程序在运行时执行的第一条指令的地址。.init 定义了一个名为<code>_init</code>的函数，它将被程序的初始化代码所调用。其余 Section 与可重定位目标文件类似，只不过它们已被重定位到运行时的内存地址。正因如此，该文件中没有 .rel.text 和 .rel.data。</p>
<p>可执行目标文件的连续块与连续内存段之间的映射关系由程序头表（Program Header Table）描述：</p>
<p><img alt="alt text" src="../image/image-82.png" />
第一个内存段具有读取和执行权限，从内存地址 0x400000 开始，大小为 0x69c 个字节。该内存段是由可执行目标文件的前 0x69c 个字节（偏移量为 0）初始化得到的，包含了 ELF 头、程序头表、.init、.text 和 .rodata。</p>
<p>第二个内存段具有读取和写入权限，从内存地址 0x600df8 开始，大小为  0x230 个字节。该内存段对应了可执行目标文件中偏移量为 0xdf8 的 0x228 个字节，包含了 .data 和 .bss（两者大小之差的 8 个字节即保存在 .bss 并将在运行时初始化为 0 的数据）。</p>
<p>对于每个内存段，链接器必须选择一个起始地址 vaddr，使得：</p>
<div class="arithmatex">\[vaddr\space mod\space align = off\space mod\space align\]</div>
<p>其中，off 是该内存段中第一个 Section 在目标文件中的偏移量，align 是程序头表中指定的对齐方式。这种对齐要求是一种优化，它可以使目标文件被更加有效地加载到内存中。</p>
<h2 id="加载可执行目标文件">加载可执行目标文件<a class="headerlink" href="#加载可执行目标文件" title="Permanent link">&para;</a></h2>
<p>下图展示了 Linux 程序的运行时内存结构：</p>
<p><img alt="alt text" src="../image/image-83.png" />
加载器首先根据程序头表将可执行目标文件中的块复制到内存中的代码和数据段，然后跳转到程序入口，即<code>_start_</code>函数（在系统目标文件<code>crt1.o</code>中定义）的地址。该函数再调用<code>libc.so</code>中定义的系统启动函数<code>__libc_start_main</code>，由它初始化执行环境，调用用户级的主函数并处理其返回。</p>
<h2 id="使用共享库动态链接">使用共享库动态链接<a class="headerlink" href="#使用共享库动态链接" title="Permanent link">&para;</a></h2>
<p>静态库会被定期维护和更新，因此程序员需要知晓其变动并将重新链接程序。此外，几乎所有 C 程序都会使用一些标准 I/O 函数，例如<code>printf</code>。这些函数的代码将在运行时被复制到每个进程的代码段中，从而导致严重的内存浪费。</p>
<p>共享库（Shared Libraries）可以解决上述静态库的缺点。它是一种可以在加载时或运行时于任意内存地址加载并与程序链接的目标模块，该过程被称为动态链接（Dynamic Linking）。共享库在 Linux 系统中以<code>.so</code>为后缀，而在 Windows 系统中则被称为 DLL（Dynamic Linking Libraries）。</p>
<p>在任意文件系统中，每个共享库都只有一个<code>.so</code>文件。与静态库不同的是，该文件中的代码和数据可以被引用该库的所有可执行文件共享，而不需要复制到可执行文件中。</p>
<p>示例程序的动态链接过程如下图所示：
<div class="highlight"><pre><span></span><code><span class="cm">/* $begin main2 */</span>
<span class="cm">/* main2.c */</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;vector.h&quot;</span>

<span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">};</span>
<span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">};</span>
<span class="kt">int</span><span class="w"> </span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span>
<span class="p">{</span>
<span class="w">    </span><span class="n">addvec</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;z = [%d %d]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/* $end main2 */</span>
</code></pre></div>
<img alt="alt text" src="../image/image-84.png" /></p>
<p>我们使用如下指令将 <strong>addvec.c 和 multvec.c</strong>（见上图7.6） 构建为共享库文件<code>libvector.so</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">linux</span><span class="o">&gt;</span><span class="w"> </span><span class="n">gcc</span><span class="w"> </span><span class="o">-</span><span class="n">shared</span><span class="w"> </span><span class="o">-</span><span class="n">fpic</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">libvector</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">addvec</span><span class="p">.</span><span class="n">c</span><span class="w"> </span><span class="n">multvec</span><span class="p">.</span><span class="n">c</span>
</code></pre></div>
<p>其中，<code>-fpic</code>指示编译器生成 <strong>与位置无关代码</strong>（Position-Independent Code），而<code>-shared</code>则指示链接器创建共享目标文件。一旦共享库文件创建成功，就可以将其链接到示例程序中：</p>
<div class="highlight"><pre><span></span><code><span class="n">inux</span><span class="o">&gt;</span><span class="w"> </span><span class="n">gcc</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">prog2l</span><span class="w"> </span><span class="n">main2</span><span class="p">.</span><span class="n">c</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">libvector</span><span class="p">.</span><span class="n">so</span>
</code></pre></div>
<p>我们需要明确的是，<code>libvector.so</code>的任意代码和数据都没有被复制到可执行文件<code>prog2l</code>中。链接器只会复制一些重定位和符号表信息，它们将在加载时用于解析引用了共享库的符号。</p>
<p>加载器随后读取可执行文件中包含的动态链接器路径，加载并运行它。动态链接器也是一个共享库文件，如 Linux 系统的<code>ld-linux.so</code>。它通过执行以下重定位操作来完成链接：</p>
<ul>
<li>将<code>libc.so</code>的代码和数据重定位到某个内存段；</li>
<li>将<code>libvector.so</code>中的代码和数据重定位到另一个内存段；</li>
<li>将<code>prog2l</code>中所有引用了共享库的符号重定位。</li>
</ul>
<p>最终，动态链接器将控制权转移给应用程序，共享库的位置不会在程序执行期间改变。</p>
<h2 id="从应用程序中加载和链接共享库">从应用程序中加载和链接共享库<a class="headerlink" href="#从应用程序中加载和链接共享库" title="Permanent link">&para;</a></h2>
<p>应用程序还可以在运行时请求动态链接器加载和链接共享库，其应用场景包括：Windows 应用程序的开发人员使用共享库来分发软件更新；现代 Web 服务器使用动态链接有效地更新或添加功能。</p>
<p>Linux 系统为应用程序提供了一些简单接口以实现上述功能：</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;dlfcn.h&gt;</span>
<span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">dlopen</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flag</span><span class="p">);</span>
<span class="c1">// Returns: pointer to handle if OK, NULL on error</span>
</code></pre></div>
<p>函数<code>dlopen</code>加载并链接共享库文件<code>filename</code>，参数<code>flag</code>可以是<code>RTLD_GLOBAL</code>、<code>RTLD_NOW</code>和<code>RTLD_LAZY</code>中的一个或多个（详见 <a href="https://man7.org/linux/man-pages/man3/dlopen.3.html">dlopen</a>）。</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;dlfcn.h&gt;</span>
<span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">dlsym</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">symbol</span><span class="p">);</span>
<span class="c1">// Returns: pointer to symbol if OK, NULL on error</span>
</code></pre></div>
<p>类似的接口函数还有 <a href="https://man7.org/linux/man-pages/man3/dlsym.3.html">dlsym</a>、<a href="https://man7.org/linux/man-pages/man3/dlclose.3.html">dlclose</a> 和 <a href="https://man7.org/linux/man-pages/man3/dlerror.3.html">dlerror</a>。</p>
<p>示例程序展示了应用程序是如何调用它们来动态链接共享库的。
<div class="highlight"><pre><span></span><code><span class="cm">/* $begin dll */</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;dlfcn.h&gt;</span>

<span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">};</span>
<span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">};</span>
<span class="kt">int</span><span class="w"> </span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">handle</span><span class="p">;</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">addvec</span><span class="p">)(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">);</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">error</span><span class="p">;</span><span class="w"> </span>

<span class="w">    </span><span class="cm">/* dynamically load the shared library that contains addvec() */</span>
<span class="w">    </span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dlopen</span><span class="p">(</span><span class="s">&quot;./libvector.so&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">RTLD_LAZY</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">handle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dlerror</span><span class="p">());</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/* get a pointer to the addvec() function we just loaded */</span>
<span class="w">    </span><span class="n">addvec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dlsym</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;addvec&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dlerror</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/* Now we can call addvec() it just like any other function */</span>
<span class="w">    </span><span class="n">addvec</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;z = [%d %d]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

<span class="w">    </span><span class="cm">/* unload the shared library */</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dlclose</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dlerror</span><span class="p">());</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/* $end dll */</span>
</code></pre></div></p>
<h2 id="与位置无关代码">与位置无关代码<a class="headerlink" href="#与位置无关代码" title="Permanent link">&para;</a></h2>
<p>现代系统在编译共享库时会生成一种无需重定位即可被加载到内存中任意位置的代码，即与位置无关代码（Position-Independent Code，PIC），这样共享库就能被多个正在运行的进程同时引用。</p>
<h3 id="pic-数据引用">PIC 数据引用<a class="headerlink" href="#pic-数据引用" title="Permanent link">&para;</a></h3>
<p>编译器在 PIC 数据段的开头创建了一个全局偏移量表（Global Offset Table，GOT），其中的每个条目都对应一个被目标模块引用的全局符号。编译器还会为这些条目生成重定位记录。加载时，动态链接器重定位每个 GOT 条目，使其包含被引用符号的绝对地址。每个引用了全局符号的目标模块都有自己的 GOT。</p>
<p>下图展示了示例共享库<code>libvector.so</code>中的 GOT：</p>
<p><img alt="alt text" src="../image/image-85.png" /></p>
<p>无论我们在何处加载共享模块，其数据段与代码段之间的距离始终相同。因此，代码段中的<code>addl</code>与数据段中的 GOT[3] 之间的偏移量是一个运行时常量。当函数<code>addvec</code>引用全局变量<code>addcnt</code>时，先通过<code>0x2008b9(%rip)</code>计算得到 GOT[3] 的地址，然后从中读取加载时被动态链接器赋予的<code>addcnt</code>的绝对地址。</p>
<h3 id="pic-函数调用">PIC 函数调用<a class="headerlink" href="#pic-函数调用" title="Permanent link">&para;</a></h3>
<p>PIC 函数调用的运行时地址是在该函数第一次被调用时确定的，这种技术被称为延迟绑定（Lazy Binding）。当应用程序导入了一个包含成百上千个函数的共享库（如<code>libc.so</code>），却只调用其中一小部分的函数时，这种技术可以大大减少加载时不必要的重定位操作。</p>
<p>延迟绑定是通过 GOT 和过程链接表（Procedure Linkage Table，PLT）共同实现的。只要目标模块调用了共享库中定义的函数，那么它就有自己的 GOT 和 PLT。上文提到，GOT 是数据段的一部分，而 PLT 则是代码段的一部分。</p>
<p>GOT 和 PLT 在运行时协同工作解析函数地址的过程如下图所示：</p>
<p><img alt="alt text" src="../image/image-86.png" /></p>
<p>可执行文件中每个对共享库函数的调用都与 PLT 数组中的条目对应。其中，PLT[0] 是跳转到动态链接器的特殊条目，PLT[1] 对应系统启动函数<code>__libc_start_main</code>。从 PLT[2] 开始的条目对应用户代码调用的函数，如图中的<code>addvec</code>。</p>
<p>当与 PLT 一起使用时，GOT [0] 和 GOT[1] 包含了动态连接器在解析函数地址时所需的信息，GOT[2] 是动态链接器的入口点。其余的每个条目均对应于一个在运行时需要被解析地址的调用函数，以及一个 PLT 条目。例如，GOT[4] 和 PLT[2] 与<code>addvec</code>对应。</p>
<p>程序第一次调用<code>addvec</code>并解析其地址的过程如上图（a）所示：</p>
<ol>
<li>PLT[2] 是该函数的入口，程序首先调用它；</li>
<li>PLT[2] 中的第一条指令间接跳转到 GOT[4]。由于最初每个 GOT 条目都指向对应 PLT 条目中的第二条指令，因此控制权将转移到 PLT[2] 中的第二条指令；</li>
<li>PLT[2] 中的第二条指令将<code>addvec</code>的 ID 0x1 压入栈中，第三条指令跳转到 PLT[0]；</li>
<li>PLT[0] 中的第一条指令将 *GOT[1] 压入栈中，第二条指令通过 GOT[2] 间接跳转到动态链接器。动态链接器根据被压入栈中的两个条目确定<code>addvec</code>的运行时地址并用它覆盖 GOT[4]，最终将控制权转移给<code>addvec</code>。</li>
</ol>
<p>程序再次调用<code>addvec</code>的过程如上图（b）所示：</p>
<ol>
<li>程序依然首先调用 PLT[2]；</li>
<li>此时 GOT[4] 指向了<code>addvec</code>，因此控制权将被直接转移到该函数。</li>
</ol>
<h2 id="库插入">库插入<a class="headerlink" href="#库插入" title="Permanent link">&para;</a></h2>
<p>库插入（Library Interpositioning）能够拦截程序对共享库函数的调用，并执行用户自定义的代码。基于这项技术，我们可以计算库函数的调用次数，验证并跟踪其输入和输出的值，甚至将其替换为完全不同的函数。</p>
<p>库插入的基本思想是创建一个与库函数原型相同的包装函数，然后“欺骗”系统调用包装函数而非库函数。通常，包装函数会执行自己的逻辑，调用库函数并将其返回值传递给调用者。</p>
<p>库插入可以在编译时、链接时以及运行时使用。</p>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-08-09T13:17:58+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-08-09</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="创建日期">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-08-09T13:17:58+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-08-09</span>
  </span>

    
    
    
  </aside>


  



<div id="__comments">

<h3>颜色主题调整</h3>

<!-- <div class="tx-switch">
<button data-md-color-scheme="default"><code>default</code></button>
<button data-md-color-scheme="slate"><code>slate</code></button>
</div>

<script>
var buttons = document.querySelectorAll("button[data-md-color-scheme]")
buttons.forEach(function(button) {
        button.addEventListener("click", function() {
        var attr = this.getAttribute("data-md-color-scheme")
        document.body.setAttribute("data-md-color-scheme", attr)
        localStorage.setItem("data-md-color-scheme",attr);
        updateScheme();
        })
})
</script> -->

<div class="tx-switch">
<button class="button1" data-md-color-primary="red" style="background-color:red">red</button>
<button class="button1" data-md-color-primary="pink" style="background-color:pink;color:black">pink</button>
<button class="button1" data-md-color-primary="purple" style="background-color:purple">purple</button>
<button class="button1" data-md-color-primary="indigo" style="background-color:indigo">indigo</button>
<button class="button1" data-md-color-primary="blue" style="background-color:blue">blue</button>
<button class="button1" data-md-color-primary="cyan" style="background-color:cyan;color:black">cyan</button>
<button class="button1" data-md-color-primary="teal" style="background-color:teal">teal</button>
<button class="button1" data-md-color-primary="green" style="background-color:green">green</button>
<button class="button1" data-md-color-primary="lime" style="background-color:lime;color:black">lime</button>
<button class="button1" data-md-color-primary="orange" style="background-color:orange;color:black">orange</button>
<button class="button1" data-md-color-primary="brown" style="background-color:brown;border-radius=3px">brown</button>
<button class="button1" data-md-color-primary="grey" style="background-color:grey">grey</button>
<button class="button1" data-md-color-primary="black" style="background-color:black">black</button>
<button class="button1" data-md-color-primary="white" style="background-color:white;color:black">white</button>
</div>

<script>
var buttons = document.querySelectorAll("button[data-md-color-primary]")
buttons.forEach(function(button) {
        button.addEventListener("click", function() {
        var attr = this.getAttribute("data-md-color-primary")
        document.body.setAttribute("data-md-color-primary", attr)
        localStorage.setItem("data-md-color-primary",attr);
        })
})
</script>

<h2 ><!-- 评论 -->评论区~</h2>

有用的话请给我个赞和 star => <a href="https://github.com/Tangjp-wraith/Tangjp-wraith.github.io"><img alt="GitHub stars" src="https://img.shields.io/github/stars/Tangjp-wraith/Tangjp-wraith.github.io.svg?style=plastic&amp;label=Stars"></a>

</br>

快来跟我聊天~

</div>

<script src="https://giscus.app/client.js" data-repo="Tangjp-wraith/discussion" data-repo-id="R_kgDOLRJCPw"
    data-category="General" data-category-id="DIC_kwDOLRJCP84CdJdO" data-mapping="pathname" data-strict="0"
    data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="dark" data-lang="zh-CN"
    crossorigin="anonymous" async>
    </script>

<!-- Synchronize Giscus theme with palette -->
<script>
var giscus = document.querySelector("script[src*=giscus]")

/* Set palette on initial load */
var palette = __md_get("__palette")
if (palette && typeof palette.color === "object") {
    var theme = palette.color.scheme === "slate" ? "dark" : "light"
    giscus.setAttribute("data-theme", theme) 
}

/* Register event handlers after documented loaded */
document.addEventListener("DOMContentLoaded", function() {
    var ref = document.querySelector("[data-md-component=palette]")
    ref.addEventListener("change", function() {
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate" ? "dark" : "light"
        localStorage.setItem("data-md-color-scheme", palette.color.scheme === "slate" ? "slate" : "default");
        /* Instruct Giscus to change theme */
        var frame = document.querySelector(".giscus-frame")
        frame.contentWindow.postMessage(
        { giscus: { setConfig: { theme } } },
        "https://giscus.app"
        )
    }
    })
})
</script>
                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      本页面的全部内容在 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh">CC BY-SA 4.0</a> 和 <a href="https://github.com/zTrix/sata-license">SATA</a> 协议之条款下提供，附加条款亦可能应用
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "content.code.annotate", "navigation.indexes", "navigation.top", "toc.follow"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="../../../js/timeago.min.js"></script>
      
        <script src="../../../js/timeago_mkdocs_material.js"></script>
      
        <script src="../../../from_oi_wiki/js/extra.js"></script>
      
        <script src="../../../js/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../../js/tablesort.js"></script>
      
        <script src="../../../termynal.js"></script>
      
    
  </body>
</html>