
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://tang-jiapeng.github.io/core/csapp/ch8/">
      
      
        <link rel="prev" href="../ch7/">
      
      
        <link rel="next" href="../ch9/">
      
      
      <link rel="icon" href="../../../logo.ico">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>Chapter8ï¼šå¼‚å¸¸æ§åˆ¶æµ - 0X10CC's notes</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Serif SC";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/timeago.css">
    
      <link rel="stylesheet" href="../../../from_oi_wiki/css/extra.css?v=13">
    
      <link rel="stylesheet" href="../../../css/status.css">
    
      <link rel="stylesheet" href="../../../css/neoteroi-mkdocs.css">
    
      <link rel="stylesheet" href="../../../termynal.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-JT9BRCXKJJ"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-JT9BRCXKJJ",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-JT9BRCXKJJ",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#å¼‚å¸¸æ§åˆ¶æµ" class="md-skip">
          è·³è½¬è‡³
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="é¡µçœ‰">
    <a href="../../.." title="0X10CC&#39;s notes" class="md-header__button md-logo" aria-label="0X10CC's notes" data-md-component="logo">
      
  <img src="../../../logo.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            0X10CC's notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter8ï¼šå¼‚å¸¸æ§åˆ¶æµ
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="æœç´¢" placeholder="æœç´¢" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="æŸ¥æ‰¾">
        
        <button type="reset" class="md-search__icon md-icon" title="æ¸…ç©ºå½“å‰å†…å®¹" aria-label="æ¸…ç©ºå½“å‰å†…å®¹" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            æ­£åœ¨åˆå§‹åŒ–æœç´¢å¼•æ“
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/tang-jiapeng/tang-jiapeng.github.io" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    tang-jiapeng.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="æ ‡ç­¾" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
    
  
  ğŸ¡ Home

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../langs/" class="md-tabs__link">
          
  
    
  
  Langs

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  Core

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../tools/" class="md-tabs__link">
          
  
    
  
  Tools

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../life/" class="md-tabs__link">
          
  
    
  
  Life

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="å¯¼èˆªæ " data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="0X10CC&#39;s notes" class="md-nav__button md-logo" aria-label="0X10CC's notes" data-md-component="logo">
      
  <img src="../../../logo.ico" alt="logo">

    </a>
    0X10CC's notes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/tang-jiapeng/tang-jiapeng.github.io" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    tang-jiapeng.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../.." class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    ğŸ¡ Home
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            ğŸ¡ Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../langs/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Langs
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Langs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    C++é›¶ç¢æ‚è®°
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            C++é›¶ç¢æ‚è®°
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/%E9%A1%B6%E5%B1%82const%E4%B8%8E%E5%BA%95%E5%B1%82const/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    é¡¶å±‚constä¸åº•å±‚const
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/%E5%80%BC%E7%B1%BB%E5%9E%8B%E4%B8%8E%E5%8F%B3%E5%80%BC%E5%BC%95%E7%94%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    å€¼ç±»å‹ä¸å³å€¼å¼•ç”¨
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/%E6%95%B0%E7%BB%84%E6%8C%87%E9%92%88%E4%B8%8E%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    æ•°ç»„æŒ‡é’ˆä¸å‡½æ•°æŒ‡é’ˆ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/C%2B%2B%E7%B1%BB%E5%AF%B9%E8%B1%A1%E5%B8%83%E5%B1%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++ç±»å¯¹è±¡å¸ƒå±€
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/C%2B%2B%E4%B8%AD%E7%9A%84%E5%A4%9A%E6%80%81%E4%B8%8ERTTI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++ä¸­çš„å¤šæ€ä¸RTTI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Effective Modern C++
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Effective Modern C++
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item1ï¼šç†è§£æ¨¡æ¿ç±»å‹æ¨å¯¼
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item2ï¼šç†è§£autoç±»å‹æ¨å¯¼
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item3ï¼šç†è§£decltype
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item7ï¼šåŒºåˆ«ä½¿ç”¨()å’Œ{}åˆ›å»ºå¯¹è±¡
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item9ï¼šä¼˜å…ˆè€ƒè™‘åˆ«åå£°æ˜è€Œétypedef
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item23/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item23ï¼šç†è§£std::moveå’Œstd::forward
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Core
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CMU15-213ï¼šCSAPP
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            CMU15-213ï¼šCSAPP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter1ï¼šè®¡ç®—æœºç³»ç»Ÿæ¼«æ¸¸
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter2ï¼šä¿¡æ¯çš„è¡¨ç¤ºå’Œå¤„ç†
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter3ï¼šç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter4ï¼šå¤„ç†å™¨ä½“ç³»ç»“æ„
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter5ï¼šä¼˜åŒ–ç¨‹åºæ€§èƒ½
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter6ï¼šå­˜å‚¨å™¨å±‚æ¬¡ç»“æ„
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter7ï¼šé“¾æ¥
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Chapter8ï¼šå¼‚å¸¸æ§åˆ¶æµ
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Chapter8ï¼šå¼‚å¸¸æ§åˆ¶æµ
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="ç›®å½•">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#å¼‚å¸¸" class="md-nav__link">
    <span class="md-ellipsis">
      å¼‚å¸¸
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å¼‚å¸¸">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#å¼‚å¸¸å¤„ç†" class="md-nav__link">
    <span class="md-ellipsis">
      å¼‚å¸¸å¤„ç†
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¼‚å¸¸çš„åˆ†ç±»" class="md-nav__link">
    <span class="md-ellipsis">
      å¼‚å¸¸çš„åˆ†ç±»
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å¼‚å¸¸çš„åˆ†ç±»">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ä¸­æ–­" class="md-nav__link">
    <span class="md-ellipsis">
      ä¸­æ–­
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#é™·é˜±å’Œç³»ç»Ÿè°ƒç”¨" class="md-nav__link">
    <span class="md-ellipsis">
      é™·é˜±å’Œç³»ç»Ÿè°ƒç”¨
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ•…éšœ" class="md-nav__link">
    <span class="md-ellipsis">
      æ•…éšœ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä¸­æ­¢" class="md-nav__link">
    <span class="md-ellipsis">
      ä¸­æ­¢
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linuxx86-64-ç³»ç»Ÿä¸­çš„å¼‚å¸¸" class="md-nav__link">
    <span class="md-ellipsis">
      Linux/x86-64 ç³»ç»Ÿä¸­çš„å¼‚å¸¸
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linux/x86-64 ç³»ç»Ÿä¸­çš„å¼‚å¸¸">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#æ•…éšœå’Œä¸­æ­¢" class="md-nav__link">
    <span class="md-ellipsis">
      æ•…éšœå’Œä¸­æ­¢
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ç³»ç»Ÿè°ƒç”¨" class="md-nav__link">
    <span class="md-ellipsis">
      ç³»ç»Ÿè°ƒç”¨
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#è¿›ç¨‹" class="md-nav__link">
    <span class="md-ellipsis">
      è¿›ç¨‹
    </span>
  </a>
  
    <nav class="md-nav" aria-label="è¿›ç¨‹">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#é€»è¾‘æ§åˆ¶æµ" class="md-nav__link">
    <span class="md-ellipsis">
      é€»è¾‘æ§åˆ¶æµ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¹¶å‘æµ" class="md-nav__link">
    <span class="md-ellipsis">
      å¹¶å‘æµ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ç§æœ‰åœ°å€ç©ºé—´" class="md-nav__link">
    <span class="md-ellipsis">
      ç§æœ‰åœ°å€ç©ºé—´
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ç”¨æˆ·æ€å’Œå†…æ ¸æ€" class="md-nav__link">
    <span class="md-ellipsis">
      ç”¨æˆ·æ€å’Œå†…æ ¸æ€
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä¸Šä¸‹æ–‡åˆ‡æ¢" class="md-nav__link">
    <span class="md-ellipsis">
      ä¸Šä¸‹æ–‡åˆ‡æ¢
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ç³»ç»Ÿè°ƒç”¨é”™è¯¯å¤„ç†" class="md-nav__link">
    <span class="md-ellipsis">
      ç³»ç»Ÿè°ƒç”¨é”™è¯¯å¤„ç†
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#è¿›ç¨‹æ§åˆ¶" class="md-nav__link">
    <span class="md-ellipsis">
      è¿›ç¨‹æ§åˆ¶
    </span>
  </a>
  
    <nav class="md-nav" aria-label="è¿›ç¨‹æ§åˆ¶">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#è·å–è¿›ç¨‹-id" class="md-nav__link">
    <span class="md-ellipsis">
      è·å–è¿›ç¨‹ ID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#åˆ›å»ºå’Œç»ˆæ­¢è¿›ç¨‹" class="md-nav__link">
    <span class="md-ellipsis">
      åˆ›å»ºå’Œç»ˆæ­¢è¿›ç¨‹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å›æ”¶å­è¿›ç¨‹" class="md-nav__link">
    <span class="md-ellipsis">
      å›æ”¶å­è¿›ç¨‹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#è®©è¿›ç¨‹ä¼‘çœ " class="md-nav__link">
    <span class="md-ellipsis">
      è®©è¿›ç¨‹ä¼‘çœ 
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#åŠ è½½å¹¶è¿è¡Œç¨‹åº" class="md-nav__link">
    <span class="md-ellipsis">
      åŠ è½½å¹¶è¿è¡Œç¨‹åº
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä½¿ç”¨-fork-å’Œ-execve-è¿è¡Œç¨‹åº" class="md-nav__link">
    <span class="md-ellipsis">
      ä½¿ç”¨ fork å’Œ execve è¿è¡Œç¨‹åº
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ä¿¡å·" class="md-nav__link">
    <span class="md-ellipsis">
      ä¿¡å·
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ä¿¡å·">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ä¿¡å·æœ¯è¯­" class="md-nav__link">
    <span class="md-ellipsis">
      ä¿¡å·æœ¯è¯­
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å‘é€ä¿¡å·" class="md-nav__link">
    <span class="md-ellipsis">
      å‘é€ä¿¡å·
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å‘é€ä¿¡å·">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#è¿›ç¨‹ç»„" class="md-nav__link">
    <span class="md-ellipsis">
      è¿›ç¨‹ç»„
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä»é”®ç›˜å‘é€ä¿¡å·" class="md-nav__link">
    <span class="md-ellipsis">
      ä»é”®ç›˜å‘é€ä¿¡å·
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä½¿ç”¨-kill-å‡½æ•°å‘é€ä¿¡å·" class="md-nav__link">
    <span class="md-ellipsis">
      ä½¿ç”¨ kill å‡½æ•°å‘é€ä¿¡å·
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä½¿ç”¨-alarm-å‡½æ•°å‘é€ä¿¡å·" class="md-nav__link">
    <span class="md-ellipsis">
      ä½¿ç”¨ alarm å‡½æ•°å‘é€ä¿¡å·
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ¥æ”¶ä¿¡å·" class="md-nav__link">
    <span class="md-ellipsis">
      æ¥æ”¶ä¿¡å·
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#é˜»å¡ä¿¡å·" class="md-nav__link">
    <span class="md-ellipsis">
      é˜»å¡ä¿¡å·
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ç¼–å†™ä¿¡å·å¤„ç†ç¨‹åº" class="md-nav__link">
    <span class="md-ellipsis">
      ç¼–å†™ä¿¡å·å¤„ç†ç¨‹åº
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ç¼–å†™ä¿¡å·å¤„ç†ç¨‹åº">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#å®‰å…¨çš„ä¿¡å·å¤„ç†" class="md-nav__link">
    <span class="md-ellipsis">
      å®‰å…¨çš„ä¿¡å·å¤„ç†
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ­£ç¡®çš„ä¿¡å·å¤„ç†" class="md-nav__link">
    <span class="md-ellipsis">
      æ­£ç¡®çš„ä¿¡å·å¤„ç†
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¯ç§»æ¤çš„ä¿¡å·å¤„ç†" class="md-nav__link">
    <span class="md-ellipsis">
      å¯ç§»æ¤çš„ä¿¡å·å¤„ç†
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#é¿å…å¹¶å‘é”™è¯¯" class="md-nav__link">
    <span class="md-ellipsis">
      é¿å…å¹¶å‘é”™è¯¯
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ˜¾å¼ç­‰å¾…ä¿¡å·" class="md-nav__link">
    <span class="md-ellipsis">
      æ˜¾å¼ç­‰å¾…ä¿¡å·
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#éæœ¬åœ°è·³è½¬" class="md-nav__link">
    <span class="md-ellipsis">
      éæœ¬åœ°è·³è½¬
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter9ï¼šè™šæ‹Ÿå†…å­˜
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter10ï¼šç³»ç»Ÿçº§I/O
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter11ï¼šç½‘ç»œç¼–ç¨‹
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter12ï¼šå¹¶å‘ç¼–ç¨‹
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CMU10-714ï¼šDeep Learning Systems
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            CMU10-714ï¼šDeep Learning Systems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture2ï¼šML Refresher / Softmax Regression
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture3ï¼šManual Neural Networks / Backprop
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture4ï¼šAutomatic Differentiation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture5ï¼šAutomatic Differentiation Implementation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture6ï¼šOptimization
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../tools/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Tools
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../life/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Life
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Life
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="ç›®å½•">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#å¼‚å¸¸" class="md-nav__link">
    <span class="md-ellipsis">
      å¼‚å¸¸
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å¼‚å¸¸">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#å¼‚å¸¸å¤„ç†" class="md-nav__link">
    <span class="md-ellipsis">
      å¼‚å¸¸å¤„ç†
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¼‚å¸¸çš„åˆ†ç±»" class="md-nav__link">
    <span class="md-ellipsis">
      å¼‚å¸¸çš„åˆ†ç±»
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å¼‚å¸¸çš„åˆ†ç±»">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ä¸­æ–­" class="md-nav__link">
    <span class="md-ellipsis">
      ä¸­æ–­
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#é™·é˜±å’Œç³»ç»Ÿè°ƒç”¨" class="md-nav__link">
    <span class="md-ellipsis">
      é™·é˜±å’Œç³»ç»Ÿè°ƒç”¨
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ•…éšœ" class="md-nav__link">
    <span class="md-ellipsis">
      æ•…éšœ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä¸­æ­¢" class="md-nav__link">
    <span class="md-ellipsis">
      ä¸­æ­¢
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linuxx86-64-ç³»ç»Ÿä¸­çš„å¼‚å¸¸" class="md-nav__link">
    <span class="md-ellipsis">
      Linux/x86-64 ç³»ç»Ÿä¸­çš„å¼‚å¸¸
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linux/x86-64 ç³»ç»Ÿä¸­çš„å¼‚å¸¸">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#æ•…éšœå’Œä¸­æ­¢" class="md-nav__link">
    <span class="md-ellipsis">
      æ•…éšœå’Œä¸­æ­¢
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ç³»ç»Ÿè°ƒç”¨" class="md-nav__link">
    <span class="md-ellipsis">
      ç³»ç»Ÿè°ƒç”¨
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#è¿›ç¨‹" class="md-nav__link">
    <span class="md-ellipsis">
      è¿›ç¨‹
    </span>
  </a>
  
    <nav class="md-nav" aria-label="è¿›ç¨‹">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#é€»è¾‘æ§åˆ¶æµ" class="md-nav__link">
    <span class="md-ellipsis">
      é€»è¾‘æ§åˆ¶æµ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¹¶å‘æµ" class="md-nav__link">
    <span class="md-ellipsis">
      å¹¶å‘æµ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ç§æœ‰åœ°å€ç©ºé—´" class="md-nav__link">
    <span class="md-ellipsis">
      ç§æœ‰åœ°å€ç©ºé—´
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ç”¨æˆ·æ€å’Œå†…æ ¸æ€" class="md-nav__link">
    <span class="md-ellipsis">
      ç”¨æˆ·æ€å’Œå†…æ ¸æ€
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä¸Šä¸‹æ–‡åˆ‡æ¢" class="md-nav__link">
    <span class="md-ellipsis">
      ä¸Šä¸‹æ–‡åˆ‡æ¢
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ç³»ç»Ÿè°ƒç”¨é”™è¯¯å¤„ç†" class="md-nav__link">
    <span class="md-ellipsis">
      ç³»ç»Ÿè°ƒç”¨é”™è¯¯å¤„ç†
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#è¿›ç¨‹æ§åˆ¶" class="md-nav__link">
    <span class="md-ellipsis">
      è¿›ç¨‹æ§åˆ¶
    </span>
  </a>
  
    <nav class="md-nav" aria-label="è¿›ç¨‹æ§åˆ¶">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#è·å–è¿›ç¨‹-id" class="md-nav__link">
    <span class="md-ellipsis">
      è·å–è¿›ç¨‹ ID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#åˆ›å»ºå’Œç»ˆæ­¢è¿›ç¨‹" class="md-nav__link">
    <span class="md-ellipsis">
      åˆ›å»ºå’Œç»ˆæ­¢è¿›ç¨‹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å›æ”¶å­è¿›ç¨‹" class="md-nav__link">
    <span class="md-ellipsis">
      å›æ”¶å­è¿›ç¨‹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#è®©è¿›ç¨‹ä¼‘çœ " class="md-nav__link">
    <span class="md-ellipsis">
      è®©è¿›ç¨‹ä¼‘çœ 
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#åŠ è½½å¹¶è¿è¡Œç¨‹åº" class="md-nav__link">
    <span class="md-ellipsis">
      åŠ è½½å¹¶è¿è¡Œç¨‹åº
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä½¿ç”¨-fork-å’Œ-execve-è¿è¡Œç¨‹åº" class="md-nav__link">
    <span class="md-ellipsis">
      ä½¿ç”¨ fork å’Œ execve è¿è¡Œç¨‹åº
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ä¿¡å·" class="md-nav__link">
    <span class="md-ellipsis">
      ä¿¡å·
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ä¿¡å·">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ä¿¡å·æœ¯è¯­" class="md-nav__link">
    <span class="md-ellipsis">
      ä¿¡å·æœ¯è¯­
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å‘é€ä¿¡å·" class="md-nav__link">
    <span class="md-ellipsis">
      å‘é€ä¿¡å·
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å‘é€ä¿¡å·">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#è¿›ç¨‹ç»„" class="md-nav__link">
    <span class="md-ellipsis">
      è¿›ç¨‹ç»„
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä»é”®ç›˜å‘é€ä¿¡å·" class="md-nav__link">
    <span class="md-ellipsis">
      ä»é”®ç›˜å‘é€ä¿¡å·
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä½¿ç”¨-kill-å‡½æ•°å‘é€ä¿¡å·" class="md-nav__link">
    <span class="md-ellipsis">
      ä½¿ç”¨ kill å‡½æ•°å‘é€ä¿¡å·
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä½¿ç”¨-alarm-å‡½æ•°å‘é€ä¿¡å·" class="md-nav__link">
    <span class="md-ellipsis">
      ä½¿ç”¨ alarm å‡½æ•°å‘é€ä¿¡å·
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ¥æ”¶ä¿¡å·" class="md-nav__link">
    <span class="md-ellipsis">
      æ¥æ”¶ä¿¡å·
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#é˜»å¡ä¿¡å·" class="md-nav__link">
    <span class="md-ellipsis">
      é˜»å¡ä¿¡å·
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ç¼–å†™ä¿¡å·å¤„ç†ç¨‹åº" class="md-nav__link">
    <span class="md-ellipsis">
      ç¼–å†™ä¿¡å·å¤„ç†ç¨‹åº
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ç¼–å†™ä¿¡å·å¤„ç†ç¨‹åº">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#å®‰å…¨çš„ä¿¡å·å¤„ç†" class="md-nav__link">
    <span class="md-ellipsis">
      å®‰å…¨çš„ä¿¡å·å¤„ç†
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ­£ç¡®çš„ä¿¡å·å¤„ç†" class="md-nav__link">
    <span class="md-ellipsis">
      æ­£ç¡®çš„ä¿¡å·å¤„ç†
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¯ç§»æ¤çš„ä¿¡å·å¤„ç†" class="md-nav__link">
    <span class="md-ellipsis">
      å¯ç§»æ¤çš„ä¿¡å·å¤„ç†
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#é¿å…å¹¶å‘é”™è¯¯" class="md-nav__link">
    <span class="md-ellipsis">
      é¿å…å¹¶å‘é”™è¯¯
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ˜¾å¼ç­‰å¾…ä¿¡å·" class="md-nav__link">
    <span class="md-ellipsis">
      æ˜¾å¼ç­‰å¾…ä¿¡å·
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#éæœ¬åœ°è·³è½¬" class="md-nav__link">
    <span class="md-ellipsis">
      éæœ¬åœ°è·³è½¬
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="å¼‚å¸¸æ§åˆ¶æµ">å¼‚å¸¸æ§åˆ¶æµ<a class="headerlink" href="#å¼‚å¸¸æ§åˆ¶æµ" title="Permanent link">&para;</a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8V2m6.78 1a.69.69 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38-2.5-2.5Z"/></svg></span> çº¦ 8299 ä¸ªå­— <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6zm80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3z"/></svg></span> 341 è¡Œä»£ç  <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3L12.5 13Z"/></svg></span> é¢„è®¡é˜…è¯»æ—¶é—´ 32 åˆ†é’Ÿ</p>
</div>
<p>åœ¨è®¡ç®—æœºçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œç¨‹åºè®¡æ•°å™¨ä¾æ¬¡æŒ‡å‘ä¸€ç³»åˆ—çš„å€¼ï¼š<span class="arithmatex">\(a_0, a_1, ..., a_n\)</span>ã€‚å…¶ä¸­ï¼Œ<span class="arithmatex">\(a_k\)</span> æ˜¯å…¶å¯¹åº”æŒ‡ä»¤ <span class="arithmatex">\(I_k\)</span> çš„åœ°å€ã€‚ä» <span class="arithmatex">\(a_k\)</span> åˆ° <span class="arithmatex">\(a_{k+1}\)</span> çš„è½¬æ¢è¢«ç§°ä¸ºæ§åˆ¶è½¬ç§»ï¼ˆControl Transferï¼‰ï¼Œä¸€ç³»åˆ—çš„æ§åˆ¶è½¬ç§»åˆ™è¢«ç§°ä¸ºå¤„ç†å™¨çš„æ§åˆ¶æµï¼ˆControl Flowï¼‰ã€‚</p>
<p>æœ€ç®€å•çš„æ§åˆ¶æµä¾¿æ˜¯ç¨‹åºä¸­çš„æŒ‡ä»¤æŒ‰é¡ºåºæ‰§è¡Œï¼Œå³ <span class="arithmatex">\(I_k\)</span> ä¸ <span class="arithmatex">\(I_{k+1}\)</span> åœ¨å†…å­˜ä¸­ç›¸é‚»ã€‚ä¸è¿‡ï¼Œè¿™ç§â€œå¹³æ»‘â€çš„æ§åˆ¶æµé€šå¸¸å› æŒ‡ä»¤çš„è·³è½¬ã€è°ƒç”¨å’Œè¿”å›è€Œçªç„¶æ”¹å˜ï¼Œæ­¤æ—¶ <span class="arithmatex">\(I_k\)</span> ä¾¿ä¸å†ä¸ <span class="arithmatex">\(I_{k+1}\)</span> ç›¸é‚»ã€‚</p>
<p>ç¨‹åºå†…éƒ¨çš„çŠ¶æ€æ˜¯ç”±ç¨‹åºå˜é‡è¡¨ç¤ºçš„ï¼Œæ§åˆ¶æµä½¿å¾—ç¨‹åºå¯ä»¥å¯¹å…¶æ›´æ–°åšå‡ºååº”ã€‚ä½†ç³»ç»Ÿè¿˜å¿…é¡»èƒ½å¤Ÿåº”å¯¹è‡ªèº«çŠ¶æ€çš„å˜åŒ–ï¼Œå®ƒä»¬æ— æ³•è¢«å†…éƒ¨ç¨‹åºå˜é‡æ•è·ï¼Œç”šè‡³ä¸ä¸€å®šä¸ç¨‹åºçš„æ‰§è¡Œæœ‰å…³ã€‚æ¯”å¦‚ï¼Œæ•°æ®åŒ…åœ¨åˆ°è¾¾ç½‘ç»œé€‚é…å™¨åéœ€è¦è¢«å­˜å‚¨åˆ°å†…å­˜ä¸­ï¼›ç¨‹åºè¯·æ±‚ç£ç›˜ä¸­çš„æ•°æ®æ—¶éœ€è¦å¾—çŸ¥å…¶ä½•æ—¶å¯ç”¨ï¼›çˆ¶è¿›ç¨‹å¿…é¡»åœ¨å…¶å­è¿›ç¨‹ç»ˆæ­¢æ—¶æ”¶åˆ°é€šçŸ¥ç­‰ã€‚</p>
<p>ç°ä»£ç³»ç»Ÿé€šè¿‡å¼‚å¸¸æ§åˆ¶æµï¼ˆExceptional Control Flowï¼ŒECFï¼‰æ¥å¤„ç†ä¸Šè¿°æƒ…å†µï¼Œå®ƒåº”ç”¨äºè®¡ç®—æœºç³»ç»Ÿçš„æ‰€æœ‰çº§åˆ«ä¸­ã€‚</p>
<h2 id="å¼‚å¸¸">å¼‚å¸¸<a class="headerlink" href="#å¼‚å¸¸" title="Permanent link">&para;</a></h2>
<p>å¼‚å¸¸ï¼ˆExceptionï¼‰æ˜¯ä¸ºäº†å“åº”å¤„ç†å™¨çŠ¶æ€æ”¹å˜è€Œåœ¨æ§åˆ¶æµä¸­çªç„¶å‘ç”Ÿçš„å˜åŒ–ï¼Œå…¶åŸºæœ¬æ€æƒ³å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img alt="alt text" src="../image/image-87.png" />
å¤„ç†å™¨çŠ¶æ€çš„å˜åŒ–è¢«ç§°ä¸ºäº‹ä»¶ï¼ˆEventï¼‰ï¼Œå®ƒå¯èƒ½ä¸å½“å‰æŒ‡ä»¤ï¼ˆ<span class="arithmatex">\(I_{curr}\)</span>ï¼‰çš„æ‰§è¡Œç›´æ¥ç›¸å…³ï¼Œæ¯”å¦‚ç®—æœ¯æº¢å‡ºæˆ–é™¤æ•°ä¸ºé›¶ï¼›ä¹Ÿå¯èƒ½ä¸å½“å‰æŒ‡ä»¤çš„æ‰§è¡Œæ— å…³ï¼Œæ¯”å¦‚ç³»ç»Ÿè®¡æ—¶å™¨å…³é—­æˆ– I/O è¯·æ±‚å®Œæˆã€‚</p>
<h3 id="å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†<a class="headerlink" href="#å¼‚å¸¸å¤„ç†" title="Permanent link">&para;</a></h3>
<p>å¼‚å¸¸å¤„ç†æ¶‰åŠåˆ°è½¯ä»¶å’Œç¡¬ä»¶çš„å¯†åˆ‡åˆä½œï¼Œå› æ­¤å¾ˆå®¹æ˜“å°†ä¸åŒç»„ä»¶æ‰§è¡Œçš„å·¥ä½œç›¸æ··æ·†ã€‚ç³»ç»Ÿä¸­æ¯ç§å¯èƒ½çš„å¼‚å¸¸éƒ½å¯¹åº”äº†ä¸€ä¸ªå”¯ä¸€çš„éè´Ÿæ•´æ•°ï¼Œå³å¼‚å¸¸æ•°å­—ï¼ˆException Numberï¼‰ã€‚å½“è®¡ç®—æœºç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šåˆå§‹åŒ–ä¸€ä¸ªè·³è½¬è¡¨ï¼Œä¹Ÿç§°å¼‚å¸¸è¡¨ï¼ˆException Tableï¼‰ã€‚å¼‚å¸¸æ•°å­—æ˜¯å¼‚å¸¸è¡¨çš„ç´¢å¼•ï¼Œå…¶ä¸­çš„æ¯ä¸ªæ¡ç›® k å‡åŒ…å«äº†å¼‚å¸¸ k çš„å¤„ç†ç¨‹åºåœ°å€ï¼š</p>
<p><img alt="alt text" src="../image/image-88.png" />
å½“å¤„ç†å™¨æ£€æµ‹åˆ°äº‹ä»¶çš„å‘ç”Ÿæ—¶ï¼Œé¦–å…ˆå°†ç¡®å®šå¼‚å¸¸æ•°å­—ï¼Œç„¶åæ ¹æ®å¼‚å¸¸è¡¨è°ƒç”¨å¯¹åº”çš„å¼‚å¸¸å¤„ç†ç¨‹åºã€‚</p>
<p><img alt="alt text" src="../image/image-89.png" />
å¼‚å¸¸ä¸è¿‡ç¨‹è°ƒç”¨ç±»ä¼¼ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›é‡è¦åŒºåˆ«ï¼š</p>
<ul>
<li>å¼‚å¸¸çš„è¿”å›åœ°å€è¦ä¹ˆæ˜¯å½“å‰æŒ‡ä»¤ï¼ˆ<span class="arithmatex">\(I_{curr}\)</span>ï¼‰ï¼Œè¦ä¹ˆæ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼ˆ<span class="arithmatex">\(I_{next}\)</span>ï¼‰ï¼›</li>
<li>å¤„ç†å™¨è¿˜ä¼šå°†ä¸€äº›é¢å¤–çš„å¤„ç†å™¨çŠ¶æ€ä¿¡æ¯å‹å…¥æ ˆä¸­ã€‚å½“å¤„ç†ç¨‹åºè¿”å›åï¼Œè¿™äº›ä¿¡æ¯æ˜¯é‡å¯è¢«ä¸­æ–­ç¨‹åºæ‰€å¿…éœ€çš„ï¼›</li>
<li>å¼‚å¸¸å¤„ç†ç¨‹åºåœ¨å†…æ ¸æ€è¿è¡Œï¼Œå› æ­¤å¯ä»¥è®¿é—®æ‰€æœ‰ç³»ç»Ÿèµ„æºã€‚</li>
</ul>
<h3 id="å¼‚å¸¸çš„åˆ†ç±»">å¼‚å¸¸çš„åˆ†ç±»<a class="headerlink" href="#å¼‚å¸¸çš„åˆ†ç±»" title="Permanent link">&para;</a></h3>
<p><img alt="alt text" src="../image/image-90.png" /></p>
<h4 id="ä¸­æ–­">ä¸­æ–­<a class="headerlink" href="#ä¸­æ–­" title="Permanent link">&para;</a></h4>
<p>ä¸­æ–­ï¼ˆInterruptï¼‰å¼‚æ­¥å‘ç”Ÿï¼Œå› ä¸ºå®ƒæ˜¯ç”±å¤„ç†å™¨å¤–éƒ¨çš„ I/O è®¾å¤‡å‘å‡ºçš„ä¿¡å·äº§ç”Ÿçš„ã€‚</p>
<p><img alt="alt text" src="../image/image-91.png" />
å½“å‰æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•åï¼Œå¤„ç†å™¨æ³¨æ„åˆ°ä¸­æ–­å¼•è„šå˜é«˜ï¼Œäºæ˜¯ä»ç³»ç»Ÿæ€»çº¿è¯»å–å¼‚å¸¸æ•°å­—ï¼Œç„¶åè°ƒç”¨å¯¹åº”çš„ä¸­æ–­å¤„ç†ç¨‹åºã€‚å½“å¤„ç†ç¨‹åºè¿”å›æ—¶ï¼Œå®ƒå°†æ§åˆ¶æƒè¿”å›ç»™ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚éšåç¨‹åºç»§ç»­æ‰§è¡Œï¼Œå°±å¥½åƒä¸­æ–­ä»æœªå‘ç”Ÿè¿‡ä¸€æ ·ã€‚</p>
<p>å…¶ä½™å‡ ç§å¼‚å¸¸ä½œä¸ºå½“å‰æŒ‡ä»¤çš„æ‰§è¡Œç»“æœåŒæ­¥å‘ç”Ÿï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ•…éšœæŒ‡ä»¤ï¼ˆFaulting Instructionï¼‰ã€‚</p>
<h4 id="é™·é˜±å’Œç³»ç»Ÿè°ƒç”¨">é™·é˜±å’Œç³»ç»Ÿè°ƒç”¨<a class="headerlink" href="#é™·é˜±å’Œç³»ç»Ÿè°ƒç”¨" title="Permanent link">&para;</a></h4>
<p>ä¸ä¸­æ–­å¤„ç†ç¨‹åºä¸€æ ·ï¼Œé™·é˜±ï¼ˆTrapï¼‰å¤„ç†ç¨‹åºä¹Ÿå°†æ§åˆ¶è¿”å›ç»™ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚å…¶æœ€é‡è¦çš„ç”¨é€”æ˜¯åœ¨ç”¨æˆ·ç¨‹åºå’Œå†…æ ¸ä¹‹é—´æä¾›æ¥å£ï¼Œå³ç³»ç»Ÿè°ƒç”¨ï¼ˆSystem Callï¼‰ã€‚</p>
<p>ç”¨æˆ·ç¨‹åºé€šè¿‡ç³»ç»Ÿè°ƒç”¨å‘å†…æ ¸è¯·æ±‚æœåŠ¡ï¼Œå¦‚è¯»å–æ–‡ä»¶ï¼ˆ<code>read</code>ï¼‰ã€åˆ›å»ºæ–°è¿›ç¨‹ï¼ˆ<code>fork</code>ï¼‰ã€åŠ è½½æ–°ç¨‹åºï¼ˆ<code>execve</code>ï¼‰å’Œç»ˆæ­¢å½“å‰è¿›ç¨‹ï¼ˆ<code>exit</code>ï¼‰ç­‰ã€‚
<img alt="alt text" src="../image/image-92.png" />
åœ¨ç¨‹åºå‘˜çœ‹æ¥ï¼Œç³»ç»Ÿè°ƒç”¨å’Œå¸¸è§„å‡½æ•°æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ä½†å¸¸è§„å‡½æ•°è¿è¡Œåœ¨ç”¨æˆ·æ€ï¼Œå› æ­¤å…¶å¯æ‰§è¡Œçš„æŒ‡ä»¤ç±»å‹å—é™ï¼Œä¹Ÿåªèƒ½è®¿é—®ç”¨æˆ·æ ˆã€‚è€Œç³»ç»Ÿè°ƒç”¨è¿è¡Œåœ¨å†…æ ¸æ€ï¼Œèƒ½å¤Ÿæ‰§è¡Œç‰¹æƒæŒ‡ä»¤å¹¶è®¿é—®å†…æ ¸æ ˆã€‚</p>
<h4 id="æ•…éšœ">æ•…éšœ<a class="headerlink" href="#æ•…éšœ" title="Permanent link">&para;</a></h4>
<p>æ•…éšœï¼ˆFaultingï¼‰æ˜¯ç”±ä¸€äº›é”™è¯¯çŠ¶å†µå¼•èµ·çš„å¼‚å¸¸ï¼Œè€Œè¿™äº›é”™è¯¯æƒ…å†µæœ‰å¯èƒ½è¢«å¤„ç†ç¨‹åºä¿®æ­£ï¼Œå¦åˆ™å°†è¿”å›åˆ°å†…æ ¸ä¸­çš„ä¸­æ­¢ä¾‹ç¨‹ï¼ˆå›¾ä¸­çš„â€œabortâ€ï¼‰ï¼š</p>
<p><img alt="alt text" src="../image/image-93.png" /></p>
<h4 id="ä¸­æ­¢">ä¸­æ­¢<a class="headerlink" href="#ä¸­æ­¢" title="Permanent link">&para;</a></h4>
<p>ä¸æ•…éšœç›¸æ¯”ï¼Œå¼•å‘ä¸­æ­¢ï¼ˆAbortï¼‰çš„é”™è¯¯çŠ¶å†µæ— æ³•æŒ½æ•‘ã€‚é€šå¸¸æ˜¯ç¡¬ä»¶å‡ºç°é—®é¢˜ï¼Œå¦‚ RAM ä½æŸåå¼•èµ·çš„å¥‡å¶æ ¡éªŒé”™è¯¯ã€‚ä¸­æ­¢å¤„ç†ç¨‹åºæ°¸è¿œä¸ä¼šå°†æ§åˆ¶æƒè¿”å›ç»™åº”ç”¨ç¨‹åºï¼š</p>
<p><img alt="alt text" src="../image/image-94.png" /></p>
<h3 id="linuxx86-64-ç³»ç»Ÿä¸­çš„å¼‚å¸¸">Linux/x86-64 ç³»ç»Ÿä¸­çš„å¼‚å¸¸<a class="headerlink" href="#linuxx86-64-ç³»ç»Ÿä¸­çš„å¼‚å¸¸" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Exception Number</th>
<th>Description</th>
<th>Exception Class</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Divide Error</td>
<td>Fault</td>
</tr>
<tr>
<td>13</td>
<td>General Protection Fault</td>
<td>Fault</td>
</tr>
<tr>
<td>14</td>
<td>Page Fault</td>
<td>Fault</td>
</tr>
<tr>
<td>18</td>
<td>Machine Check</td>
<td>Abort</td>
</tr>
<tr>
<td>32-255</td>
<td>OS-defined Exception</td>
<td>Interrupt or Trap</td>
</tr>
</tbody>
</table>
<h4 id="æ•…éšœå’Œä¸­æ­¢">æ•…éšœå’Œä¸­æ­¢<a class="headerlink" href="#æ•…éšœå’Œä¸­æ­¢" title="Permanent link">&para;</a></h4>
<ul>
<li>é™¤æ³•æ•…éšœï¼ˆDivide Errorï¼‰ï¼šå½“åº”ç”¨ç¨‹åºå°è¯•é™¤ä»¥ 0 æˆ–é™¤æ³•æŒ‡ä»¤çš„ç»“æœå¯¹ç›®æ ‡æ“ä½œæ•°æ¥è¯´å¤ªå¤§æ—¶ï¼Œå°±ä¼šå‘ç”Ÿé™¤æ³•æ•…éšœã€‚Unix ä¸ä¼šè¯•å›¾çº æ­£é™¤æ³•æ•…éšœï¼Œè€Œæ˜¯ç›´æ¥ä¸­æ­¢ç¨‹åºï¼›</li>
<li>ä¸€èˆ¬ä¿æŠ¤æ•…éšœï¼ˆGeneral Protection Faultï¼‰ï¼šä¸€èˆ¬ä¿æŠ¤æ•…éšœå‡ºç°çš„åŸå› æœ‰å¾ˆå¤šï¼Œé€šå¸¸æ˜¯ç¨‹åºå¼•ç”¨äº†æœªå®šä¹‰çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸï¼Œæˆ–è¯•å›¾å‘åªè¯»æ–‡æœ¬æ®µå†™å…¥ã€‚Linux ä¸ä¼šè¯•å›¾çº æ­£è¯¥æ•…éšœï¼Œè€Œ Shell ä¸€èˆ¬å°†å…¶æŠ¥å‘Šä¸ºåˆ†æ®µæ•…éšœï¼ˆSegmentation Faultsï¼‰ï¼›</li>
<li>ç¼ºé¡µæ•…éšœï¼ˆPage Faultï¼‰ï¼šç¨‹åºå¼•ç”¨ä¸åœ¨å†…å­˜è€Œåœ¨ç£ç›˜ä¸Šçš„è™šæ‹Ÿé¡µé¢ä¼šå¯¼è‡´ç¼ºé¡µæ•…éšœã€‚å¤„ç†ç¨‹åºå°†ç£ç›˜ä¸Šåˆé€‚çš„è™šæ‹Ÿå†…å­˜é¡µé¢æ˜ å°„åˆ°ç‰©ç†å†…å­˜é¡µé¢ï¼Œç„¶åé‡æ–°æ‰§è¡Œæ•…éšœæŒ‡ä»¤ï¼›</li>
<li>æœºå™¨æ£€æŸ¥ï¼ˆMachine Checkï¼‰ï¼šä¸€æ—¦ç³»ç»Ÿåœ¨æ‰§è¡ŒæŒ‡ä»¤æœŸé—´æ£€æµ‹åˆ°è‡´å‘½çš„ç¡¬ä»¶é”™è¯¯ï¼Œä¾¿ä¼šå‘ç”Ÿæœºå™¨æ£€æŸ¥ã€‚å¤„ç†ç¨‹åºæ°¸è¿œä¸ä¼šå°†æ§åˆ¶æƒè¿”å›ç»™åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<h4 id="ç³»ç»Ÿè°ƒç”¨">ç³»ç»Ÿè°ƒç”¨<a class="headerlink" href="#ç³»ç»Ÿè°ƒç”¨" title="Permanent link">&para;</a></h4>
<p><img alt="alt text" src="../image/image-95.png" />
ä¸Šå›¾ä¸­çš„æ¯ä¸ªç³»ç»Ÿè°ƒç”¨éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ•°å­—ï¼Œå¯¹åº”äº†å†…æ ¸ä¸­è·³è½¬è¡¨çš„åç§»é‡ã€‚æ³¨æ„ï¼Œè¯¥è·³è½¬è¡¨ä¸ä¸Šæ–‡æåˆ°çš„å¼‚å¸¸è¡¨ä¸åŒã€‚</p>
<p>C æ ‡å‡†åº“ä¸ºå¤§å¤šæ•°ç³»ç»Ÿè°ƒç”¨æä¾›äº†ä¸€ç»„åŒ…è£…å‡½æ•°ï¼ˆWrapper Functionï¼‰ï¼Œå®ƒä»¬æ¯”ç›´æ¥ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨æ›´åŠ æ–¹ä¾¿ã€‚ç³»ç»Ÿè°ƒç”¨åŠå…¶ç›¸å…³çš„åŒ…è£…å‡½æ•°è¢«ç»Ÿç§°ä¸ºç³»ç»Ÿçº§å‡½æ•°ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç³»ç»Ÿçº§å‡½æ•°<code>write</code>ä»£æ›¿<code>printf</code>ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hello, world</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">);</span>
<span class="w">    </span><span class="n">_exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>X86-64 ç³»ç»Ÿé€šè¿‡<code>syscall</code>æŒ‡ä»¤ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œå…¶æ‰€æœ‰å‚æ•°å‡é€šè¿‡å¯„å­˜å™¨ä¼ é€’ã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œå¯„å­˜å™¨ %rax ä¿å­˜ç³»ç»Ÿè°ƒç”¨ç¼–å·ï¼Œå¯„å­˜å™¨ %rdiã€%rsiã€%rdxã€%r10ã€%r8 å’Œ %r9 ä¾æ¬¡ä¿å­˜å„å‚æ•°çš„å€¼ã€‚ç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼å°†å†™å…¥åˆ°å¯„å­˜å™¨ %rax ä¸­ï¼Œè‹¥ä¸ºè´Ÿåˆ™è¡¨ç¤ºå‘ç”Ÿäº†ä¸è´Ÿ<code>errno</code>ç›¸å…³çš„é”™è¯¯ã€‚å› æ­¤ï¼Œä¸Šé¢çš„ç¨‹åºå¯ä»¥ç›´æ¥ç”¨æ±‡ç¼–è¯­è¨€è¡¨ç¤ºä¸ºï¼š
<img alt="alt text" src="../image/image-96.png" /></p>
<h2 id="è¿›ç¨‹">è¿›ç¨‹<a class="headerlink" href="#è¿›ç¨‹" title="Permanent link">&para;</a></h2>
<p>è¿›ç¨‹æ˜¯æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºçš„å®ä¾‹ï¼Œç³»ç»Ÿä¸­çš„æ¯ä¸ªç¨‹åºéƒ½åœ¨è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚ä¸Šä¸‹æ–‡ç”±ç¨‹åºæ­£ç¡®è¿è¡Œæ‰€éœ€çš„çŠ¶æ€ç»„æˆï¼ŒåŒ…æ‹¬å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ç¨‹åºä»£ç å’Œæ•°æ®ã€æ ˆã€é€šç”¨å¯„å­˜å™¨ä¸­çš„å†…å®¹ã€ç¨‹åºè®¡æ•°å™¨ã€ç¯å¢ƒå˜é‡ä»¥åŠæ‰“å¼€ <a href="https://en.wikipedia.org/wiki/File_descriptor">æ–‡ä»¶æè¿°ç¬¦</a> ã€‚</p>
<p>è¿›ç¨‹ä¸ºåº”ç”¨æä¾›äº†ä¸¤ä¸ªå…³é”®æŠ½è±¡ï¼š</p>
<ul>
<li>ä¸€ä¸ªç‹¬ç«‹çš„é€»è¾‘æ§åˆ¶æµï¼Œè®©æˆ‘ä»¬äº§ç”Ÿç¨‹åºç‹¬å å¤„ç†å™¨çš„é”™è§‰ï¼›</li>
<li>ä¸€ä¸ªç§æœ‰çš„åœ°å€ç©ºé—´ï¼Œè®©æˆ‘ä»¬äº§ç”Ÿç¨‹åºç‹¬å å†…å­˜çš„é”™è§‰ã€‚</li>
</ul>
<h3 id="é€»è¾‘æ§åˆ¶æµ">é€»è¾‘æ§åˆ¶æµ<a class="headerlink" href="#é€»è¾‘æ§åˆ¶æµ" title="Permanent link">&para;</a></h3>
<p><img alt="alt text" src="../image/image-97.png" /></p>
<p>è¿›ç¨‹è½®æµä½¿ç”¨å¤„ç†å™¨ã€‚æ¯ä¸ªè¿›ç¨‹æ‰§è¡Œå…¶æµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œç„¶ååœ¨å…¶ä»–è¿›ç¨‹æ‰§è¡Œæ—¶è¢«æŠ¢å ï¼ˆå³æš‚æ—¶æŒ‚èµ·ï¼‰ã€‚</p>
<h3 id="å¹¶å‘æµ">å¹¶å‘æµ<a class="headerlink" href="#å¹¶å‘æµ" title="Permanent link">&para;</a></h3>
<p>æ‰§è¡Œæ—¶é—´é‡å çš„ä¸¤ä¸ªé€»è¾‘æ§åˆ¶æµè¢«ç§°ä¸ºå¹¶å‘æµï¼ˆConcurrent Flowï¼‰ï¼Œå®ƒä»¬å¹¶å‘è¿è¡Œã€‚å¦‚ä¸Šå›¾ 8.12 æ‰€ç¤ºï¼Œè¿›ç¨‹ A å’Œ è¿›ç¨‹ B å¹¶å‘è¿è¡Œï¼Œä½†è¿›ç¨‹ B å’Œè¿›ç¨‹ C åˆ™ä¸æ˜¯ã€‚</p>
<p>å¹¶å‘æµçš„æ¦‚å¿µä¸å¤„ç†å™¨çš„æ ¸æ•°ä»¥åŠè®¡ç®—æœºçš„æ•°é‡æ— å…³ï¼Œåªè¦ä¸¤ä¸ªé€»è¾‘æ§åˆ¶æµåœ¨æ—¶é—´ä¸Šé‡å ï¼Œé‚£ä¹ˆå®ƒä»¬ä¾¿æ˜¯å¹¶å‘çš„ã€‚å¦‚æœä¸¤ä¸ªé€»è¾‘æ§åˆ¶æµåœ¨ä¸åŒçš„å¤„ç†å™¨å†…æ ¸æˆ–è®¡ç®—æœºä¸ŠåŒæ—¶è¿è¡Œï¼Œæˆ‘ä»¬å°±ç§°å®ƒä»¬ä¸ºå¹¶è¡Œæµï¼ˆParallel Flowï¼‰ã€‚æ˜¾ç„¶ï¼Œå¹¶è¡Œæµæ˜¯å¹¶å‘æµçš„å­é›†ã€‚</p>
<h3 id="ç§æœ‰åœ°å€ç©ºé—´">ç§æœ‰åœ°å€ç©ºé—´<a class="headerlink" href="#ç§æœ‰åœ°å€ç©ºé—´" title="Permanent link">&para;</a></h3>
<p>è¿›ç¨‹ä¸ºç¨‹åºæä¾›äº†ç‹¬äº«çš„ç§æœ‰åœ°å€ç©ºé—´ï¼Œä¸ç©ºé—´å†…ç‰¹å®šåœ°å€ç›¸å…³çš„å†…å­˜å­—èŠ‚é€šå¸¸ä¸èƒ½è¢«å…¶ä»–ä»»ä½•è¿›ç¨‹è¯»å–æˆ–å†™å…¥ã€‚å°½ç®¡ç§æœ‰åœ°å€ç©ºé—´çš„å†…å®¹ä¸åŒï¼Œä½†å…¶å…·æœ‰ç›¸åŒçš„ç»„ç»‡ç»“æ„ï¼ˆå›¾ä¸­çš„â€œ%espâ€åº”ä¸ºâ€œ%rspâ€ï¼‰ï¼š</p>
<p><img alt="alt text" src="../image/image-98.png" /></p>
<p>åœ°å€ç©ºé—´åº•éƒ¨æ˜¯ä¸ºç”¨æˆ·ç¨‹åºä¿ç•™çš„ï¼Œä»£ç æ®µæ€»æ˜¯ä»åœ°å€ 0x400000 å¼€å§‹ã€‚åœ°å€ç©ºé—´é¡¶éƒ¨æ˜¯ä¸ºå†…æ ¸ä¿ç•™çš„ï¼ŒåŒ…å«äº†å†…æ ¸ä¸ºè¿›ç¨‹æ‰§è¡ŒæŒ‡ä»¤ï¼ˆå¦‚ç³»ç»Ÿè°ƒç”¨ï¼‰æ—¶ä½¿ç”¨çš„ä»£ç ã€æ•°æ®å’Œæ ˆã€‚</p>
<h3 id="ç”¨æˆ·æ€å’Œå†…æ ¸æ€">ç”¨æˆ·æ€å’Œå†…æ ¸æ€<a class="headerlink" href="#ç”¨æˆ·æ€å’Œå†…æ ¸æ€" title="Permanent link">&para;</a></h3>
<p>å¤„ç†å™¨é€šè¿‡ä¿å­˜åœ¨æ§åˆ¶å¯„å­˜å™¨ä¸­çš„æ¨¡å¼ä½ï¼ˆMode Bitï¼‰æ¥è¯†åˆ«è¿›ç¨‹å½“å‰äº«æœ‰çš„ç‰¹æƒã€‚å½“æ¨¡å¼ä½è¢«è®¾ç½®æ—¶ï¼Œè¿›ç¨‹è¿è¡Œåœ¨å†…æ ¸æ€ï¼ˆKernel Modeï¼‰ï¼Œåä¹‹åˆ™è¿è¡Œåœ¨ç”¨æˆ·æ€ï¼ˆUser Modeï¼‰ã€‚åœ¨å†…æ ¸æ€ä¸­è¿è¡Œçš„ç¨‹åºå¯ä»¥æ‰§è¡ŒæŒ‡ä»¤é›†ä¸­çš„ä»»æ„æŒ‡ä»¤ï¼Œå¹¶ä¸”èƒ½å¤Ÿè®¿é—®ç³»ç»Ÿä¸­çš„ä»»æ„ä½ç½®ã€‚è€Œåœ¨ç”¨æˆ·æ€ä¸­è¿è¡Œçš„ç¨‹åºåˆ™å—åˆ°é™åˆ¶ï¼Œåªèƒ½ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨é—´æ¥åœ°è®¿é—®å†…æ ¸ä»£ç å’Œæ•°æ®ã€‚</p>
<p>åº”ç”¨ç¨‹åºçš„è¿›ç¨‹åªèƒ½é€šè¿‡å¼‚å¸¸æ¥ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ã€‚å½“å¼‚å¸¸å‘ç”Ÿä¸”æ§åˆ¶è½¬ç§»åˆ°å¼‚å¸¸å¤„ç†ç¨‹åºæ—¶ï¼Œå¤„ç†å™¨åˆ‡æ¢åˆ°å†…æ ¸æ€ã€‚éšåå¼‚å¸¸å¤„ç†ç¨‹åºåœ¨å†…æ ¸æ€ä¸­è¿è¡Œï¼Œå¤„ç†å™¨å°†åœ¨å®ƒè¿”å›æ—¶åˆ‡æ¢å›ç”¨æˆ·æ€ã€‚</p>
<h3 id="ä¸Šä¸‹æ–‡åˆ‡æ¢">ä¸Šä¸‹æ–‡åˆ‡æ¢<a class="headerlink" href="#ä¸Šä¸‹æ–‡åˆ‡æ¢" title="Permanent link">&para;</a></h3>
<p>åœ¨è¿›ç¨‹æ‰§è¡ŒæœŸé—´ï¼Œå†…æ ¸å¯ä»¥æš‚æ—¶æŒ‚èµ·å½“å‰è¿›ç¨‹å¹¶é‡å¯å…ˆå‰è¢«æŠ¢å çš„è¿›ç¨‹ï¼Œè¿™ä¸€è¡Œä¸ºè¢«ç§°ä¸ºè°ƒåº¦ï¼ˆSchedulingï¼‰ã€‚å†…æ ¸è°ƒåº¦æ–°è¿›ç¨‹æ˜¯é€šè¿‡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆContext Switchï¼‰æœºåˆ¶æ¥å®ç°çš„ï¼Œè¯¥æœºåˆ¶ï¼š</p>
<ul>
<li>ä¿å­˜å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼›</li>
<li>æ¢å¤ä¹‹å‰è¢«æŠ¢å è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼›</li>
<li>å°†æ§åˆ¶æƒè½¬ç§»ç»™æ–°è¿›ç¨‹ã€‚</li>
</ul>
<p>ç¨‹åºæ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ—¶å¯èƒ½ä¼šå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚æ¯”å¦‚ç³»ç»Ÿè°ƒç”¨<code>read</code>éœ€è¦è®¿é—®ç£ç›˜ä¸­çš„æ•°æ®ï¼Œå†…æ ¸å¯ä»¥é€šè¿‡ä¸Šä¸‹æ–‡åˆ‡æ¢æ¥è°ƒåº¦å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™æ ·å°±æ— éœ€ç­‰å¾…æ•°æ®ä»ç£ç›˜åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p>
<p><img alt="alt text" src="../image/image-99.png" /></p>
<h2 id="ç³»ç»Ÿè°ƒç”¨é”™è¯¯å¤„ç†">ç³»ç»Ÿè°ƒç”¨é”™è¯¯å¤„ç†<a class="headerlink" href="#ç³»ç»Ÿè°ƒç”¨é”™è¯¯å¤„ç†" title="Permanent link">&para;</a></h2>
<p>å½“æ‰§è¡Œ Unix ç³»ç»Ÿçº§å‡½æ•°é‡åˆ°é”™è¯¯æ—¶ï¼Œå®ƒä»¬ä¼šè¿”å› -1 å¹¶è®¾ç½®å…¨å±€æ•´å‹å˜é‡<code>errno</code>çš„å€¼ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨ç¨‹åºä¸­æ£€æŸ¥è°ƒç”¨æ˜¯å¦å‘ç”Ÿé”™è¯¯ï¼Œå¦‚ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fork</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;fork error: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">strerror</span><span class="p">(</span><span class="n">errno</span><span class="p">));</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>å…¶ä¸­ï¼Œ<code>strerror</code>å‡½æ•°ä¼šæ ¹æ®<code>errno</code>çš„å€¼è¿”å›ç›¸å…³çš„æ–‡æœ¬å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªé”™è¯¯æŠ¥å‘Šï¼ˆError-reportingï¼‰å‡½æ•°ä»¥ç®€åŒ–ä¸Šè¿°ä»£ç ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">unix_error</span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="cm">/* Unix-style error */</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%s: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">strerror</span><span class="p">(</span><span class="n">errno</span><span class="p">));</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fork</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="n">unix_error</span><span class="p">(</span><span class="s">&quot;fork error&quot;</span><span class="p">);</span>
</code></pre></div>
<p>å½“ç„¶è¿˜å¯ä»¥è¿›ä¸€æ­¥åœ°å°†ä»£ç ç®€åŒ–ä¸ºä¸€ä¸ªé”™è¯¯å¤„ç†ï¼ˆError-handlingï¼‰å‡½æ•°ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">pid_t</span><span class="w"> </span><span class="nf">Fork</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">pid_t</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fork</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="n">unix_error</span><span class="p">(</span><span class="s">&quot;Fork error&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fork</span><span class="p">();</span>
</code></pre></div>
<p>è¿™æ ·æˆ‘ä»¬ä¾¿èƒ½å¤Ÿä½¿ç”¨åŒ…è£…å‡½æ•°<code>Fork</code>ä»£æ›¿<code>fork</code>åŠå…¶é”™è¯¯æ£€æŸ¥ä»£ç ã€‚æœ¬ä¹¦ä½¿ç”¨çš„åŒ…è£…å‡½æ•°å‡å®šä¹‰åœ¨ <a href="http://csapp.cs.cmu.edu/2e/ics2/code/include/csapp.h"><code>csapp.h</code></a> å’Œ  <a href="http://csapp.cs.cmu.edu/2e/ics2/code/src/csapp.c"><code>csapp.c</code></a> ä¸­ã€‚</p>
<h2 id="è¿›ç¨‹æ§åˆ¶">è¿›ç¨‹æ§åˆ¶<a class="headerlink" href="#è¿›ç¨‹æ§åˆ¶" title="Permanent link">&para;</a></h2>
<h3 id="è·å–è¿›ç¨‹-id">è·å–è¿›ç¨‹ ID<a class="headerlink" href="#è·å–è¿›ç¨‹-id" title="Permanent link">&para;</a></h3>
<p>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€ä¸”å¤§äº 0 çš„è¿›ç¨‹ IDï¼ˆPIDï¼‰ã€‚å‡½æ•°<code>getpid</code>è¿”å›è°ƒç”¨è¿›ç¨‹çš„ PIDï¼Œè€Œå‡½æ•°<code>getppid</code>åˆ™è¿”å›åˆ›å»ºè°ƒç”¨è¿›ç¨‹çš„è¿›ç¨‹ï¼ˆå³çˆ¶è¿›ç¨‹ï¼‰ çš„ PIDã€‚</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/types.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="kt">pid_t</span><span class="w"> </span><span class="nf">getpid</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">pid_t</span><span class="w"> </span><span class="nf">getppid</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</code></pre></div>
<p>äºŒè€…è¿”å›å€¼çš„ç±»å‹å‡ä¸º<code>pid_t</code>ï¼Œå®ƒåœ¨ Linux ç³»ç»Ÿçš„<code>sys/types.h</code>æ–‡ä»¶ä¸­è¢«å®šä¹‰ä¸º<code>int</code>ã€‚</p>
<h3 id="åˆ›å»ºå’Œç»ˆæ­¢è¿›ç¨‹">åˆ›å»ºå’Œç»ˆæ­¢è¿›ç¨‹<a class="headerlink" href="#åˆ›å»ºå’Œç»ˆæ­¢è¿›ç¨‹" title="Permanent link">&para;</a></h3>
<p>åœ¨ç¨‹åºå‘˜çœ‹æ¥ï¼Œè¿›ç¨‹æœ‰ä¸‰ç§çŠ¶æ€ï¼š</p>
<ul>
<li>è¿è¡Œï¼ˆRunningï¼‰ï¼šè¯¥è¿›ç¨‹è¦ä¹ˆåœ¨ CPU ä¸­æ‰§è¡Œï¼Œè¦ä¹ˆåœ¨ç­‰å¾…å†…æ ¸è°ƒåº¦ï¼›</li>
<li>åœæ­¢ï¼ˆStoppedï¼‰ï¼šè¿›ç¨‹æ‰§è¡Œæš‚åœï¼Œå¹¶ä¸”ä¸ä¼šè¢«è°ƒåº¦ï¼›</li>
<li>ç»ˆæ­¢ï¼ˆTerminatedï¼‰ï¼šè¿›ç¨‹æ°¸ä¹…åœ°åœæ­¢ã€‚</li>
</ul>
<p>å‡½æ•°<code>exit</code>ä¼šä»¥å‚æ•°<code>status</code>ä½œä¸ºé€€å‡ºçŠ¶æ€ç»ˆæ­¢è¿›ç¨‹ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">exit</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>
</code></pre></div>
<p>çˆ¶è¿›ç¨‹å¯ä»¥è°ƒç”¨<code>fork</code>å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å­è¿›ç¨‹ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/types.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="kt">pid_t</span><span class="w"> </span><span class="nf">fork</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</code></pre></div>
<p>å­è¿›ç¨‹å°†è·å¾—ä¸€ä¸ªä¸çˆ¶è¿›ç¨‹ç›¸åŒä½†ç‹¬ç«‹çš„ç”¨æˆ·çº§è™šæ‹Ÿå†…å­˜ç©ºé—´å‰¯æœ¬ï¼ŒåŒ…æ‹¬ä»£ç ã€æ•°æ®ã€å †ã€å…±äº«åº“å’Œç”¨æˆ·æ ˆç­‰ã€‚å®ƒè¿˜ä¼šå¾—åˆ°ä¸çˆ¶è¿›ç¨‹ç›¸åŒçš„æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦å‰¯æœ¬ï¼Œå› æ­¤èƒ½å¤Ÿè¯»å†™ä»»æ„çˆ¶è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ã€‚çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´æœ€æ˜¾è‘—çš„åŒºåˆ«ä¾¿æ˜¯ PID ä¸åŒã€‚</p>
<p>å‡½æ•°<code>fork</code>æ‰§è¡Œä¸€æ¬¡å´è¿”å›ä¸¤æ¬¡ï¼šåœ¨çˆ¶è¿›ç¨‹ä¸­è¿”å›å­è¿›ç¨‹çš„ PIDï¼Œåœ¨å­è¿›ç¨‹ä¸­è¿”å› 0ã€‚ç”±äºå­è¿›ç¨‹çš„ PID å§‹ç»ˆå¤§äº 0 ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿”å›å€¼åˆ¤æ–­ç¨‹åºåœ¨å“ªä¸ªè¿›ç¨‹ä¸­æ‰§è¡Œã€‚</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;csapp.h&quot;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">pid_t</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fork</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="cm">/* Child */</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;child : x=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">++</span><span class="n">x</span><span class="p">);</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/* Parent */</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;parent: x=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">--</span><span class="n">x</span><span class="p">);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>è¯¥ç¨‹åºç¼–è¯‘åè¿è¡Œçš„å¯èƒ½ç»“æœä¸ºï¼š</p>
<div class="highlight"><pre><span></span><code>linux&gt;<span class="w"> </span>./fork
parent:<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">0</span>
child<span class="w"> </span>:<span class="w"> </span><span class="nv">x</span><span class="o">=</span><span class="m">2</span>
</code></pre></div>
<p>ä»ç»“æœæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼šçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹å¹¶å‘æ‰§è¡Œï¼Œæˆ‘ä»¬æ°¸è¿œæ— æ³•é¢„æµ‹å…¶æ‰§è¡Œé¡ºåºï¼›å­è¿›ç¨‹çš„åœ°å€ç©ºé—´æ˜¯çˆ¶è¿›ç¨‹çš„å‰¯æœ¬ï¼Œå› æ­¤å½“ç¬¬å…­è¡Œçš„å‡½æ•°<code>Fork</code>è¿”å›æ—¶ï¼Œä¸¤è¿›ç¨‹ä¸­çš„å±€éƒ¨å˜é‡<code>x</code>å‡ä¸º 1ï¼›ä¸¤è¿›ç¨‹å¯¹å˜é‡çš„æ›´æ”¹äº’ä¸å½±å“ï¼Œæ‰€ä»¥æœ€ç»ˆè¾“å‡ºçš„å€¼ä¸åŒã€‚</p>
<p>ç»˜åˆ¶è¿›ç¨‹å›¾ï¼ˆProcess Graphï¼‰å¯¹ç†è§£<code>fork</code>å‡½æ•°å¾ˆæœ‰å¸®åŠ©ï¼Œå¦‚ï¼š</p>
<p><img alt="alt text" src="../image/image-100.png" /></p>
<h3 id="å›æ”¶å­è¿›ç¨‹">å›æ”¶å­è¿›ç¨‹<a class="headerlink" href="#å›æ”¶å­è¿›ç¨‹" title="Permanent link">&para;</a></h3>
<p>è¿›ç¨‹ç»ˆæ­¢åï¼Œå†…æ ¸ä¸ä¼šç«‹å³å°†å…¶ç§»é™¤ã€‚å®ƒéœ€è¦è¢«å…¶çˆ¶è¿›ç¨‹å›æ”¶ï¼ˆReapï¼‰ï¼Œå¦åˆ™å°†æˆä¸ºåƒµå°¸ï¼ˆZombieï¼‰è¿›ç¨‹ã€‚å½“çˆ¶è¿›ç¨‹å›æ”¶å…¶ç»ˆæ­¢çš„å­è¿›ç¨‹æ—¶ï¼Œå†…æ ¸å°†å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ä¼ é€’ç»™çˆ¶è¿›ç¨‹ï¼Œç„¶åå†ä¸¢å¼ƒå®ƒã€‚</p>
<p>å¦‚æœçˆ¶è¿›ç¨‹ç»ˆæ­¢ï¼Œå†…æ ¸ä¼šå®‰æ’<code>init</code>è¿›ç¨‹ï¼ˆPID ä¸º 1ï¼‰â€œæ”¶å…»â€å­¤å„¿è¿›ç¨‹ï¼›å¦‚æœçˆ¶è¿›ç¨‹åœ¨ç»ˆæ­¢å‰æ²¡æœ‰å›æ”¶åƒµå°¸å­è¿›ç¨‹ï¼Œé‚£ä¹ˆåˆ™ç”±<code>init</code>è¿›ç¨‹å›æ”¶å®ƒä»¬ã€‚</p>
<p>è¿›ç¨‹é€šè¿‡è°ƒç”¨å‡½æ•°<code>waitpid</code>ç­‰å¾…å…¶å­è¿›ç¨‹ç»ˆæ­¢æˆ–åœæ­¢ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/types.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/wait.h&gt;</span>
<span class="kt">pid_t</span><span class="w"> </span><span class="nf">waitpid</span><span class="p">(</span><span class="kt">pid_t</span><span class="w"> </span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">statusp</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">options</span><span class="p">);</span>
<span class="c1">// Returns: PID of child if OK, 0 (if WNOHANG), or âˆ’1 on error</span>
</code></pre></div>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ˆå‚æ•°<code>options</code>ä¸º 0 æ—¶ï¼‰ï¼Œå‡½æ•°<code>waitpid</code>ä¼šæš‚åœè°ƒç”¨è¿›ç¨‹ï¼Œç›´è‡³å…¶ç­‰å¾…é›†ï¼ˆWait Setï¼‰ä¸­çš„æŸä¸ªå­è¿›ç¨‹ç»ˆæ­¢ã€‚è¯¥å‡½æ•°å§‹ç»ˆè¿”å›ç¬¬ä¸€ä¸ªç»ˆæ­¢çš„å­è¿›ç¨‹ PIDã€‚æ­¤æ—¶ï¼Œç»ˆæ­¢çš„å­è¿›ç¨‹å·²è¢«å›æ”¶ï¼Œå†…æ ¸ä»ç³»ç»Ÿä¸­åˆ é™¤äº†å®ƒçš„æ‰€æœ‰ç—•è¿¹ã€‚</p>
<p>è‹¥å‚æ•°<code>pid_t</code>å¤§äº 0 ï¼Œåˆ™ç­‰å¾…é›†ä¸­åªæœ‰ä¸€ä¸ª PID ä¸è¯¥å‚æ•°ç›¸ç­‰çš„å­è¿›ç¨‹ã€‚è‹¥å‚æ•°<code>pid_t</code>ç­‰äº -1ï¼Œåˆ™ç­‰å¾…é›†åŒ…å«è°ƒç”¨è¿›ç¨‹çš„æ‰€æœ‰å­è¿›ç¨‹ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹å‚æ•°<code>options</code>çš„å€¼æ¥æ”¹å˜å‡½æ•°<code>waitpid</code>çš„è¡Œä¸ºï¼š</p>
<ul>
<li><code>WNOHANG</code>ï¼šå¦‚æœç­‰å¾…é›†ä¸­çš„å­è¿›ç¨‹è¿˜æœªç»ˆæ­¢ï¼Œåˆ™ç«‹å³è¿”å› 0ï¼›</li>
<li><code>WUNTRACED</code>ï¼šæš‚åœè°ƒç”¨è¿›ç¨‹æ‰§è¡Œï¼Œç›´åˆ°ç­‰å¾…é›†ä¸­çš„è¿›ç¨‹ç»ˆæ­¢æˆ–åœæ­¢ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä»…è¿”å›ç»ˆæ­¢çš„å­è¿›ç¨‹ PIDï¼‰ï¼›</li>
<li><code>WCONTINUED</code>ï¼šæš‚åœè°ƒç”¨è¿›ç¨‹æ‰§è¡Œï¼Œç›´åˆ°ç­‰å¾…é›†ä¸­çš„è¿›ç¨‹ç»ˆæ­¢æˆ–ç­‰å¾…é›†ä¸­åœæ­¢çš„è¿›ç¨‹æ”¶åˆ° SIGCONT ä¿¡å·æ¢å¤ã€‚</li>
</ul>
<p>è‹¥å‚æ•°<code>statusp</code>ä¸ä¸º<code>NULL</code>ï¼Œé‚£ä¹ˆ<code>waitpid</code>è¿˜ä¼šå°†è¿”å›çš„å­è¿›ç¨‹çŠ¶æ€ä¿¡æ¯ç¼–ç åˆ°<code>status</code>ä¸­ï¼ˆ<code>*statusp = status</code>ï¼‰ã€‚<code>wait.h</code>æ–‡ä»¶å®šä¹‰äº†å‡ ä¸ªç”¨äºè§£é‡Šå‚æ•°<code>status</code>çš„å®ï¼š</p>
<ul>
<li><code>WIFEXITED(status)</code>ï¼šå¦‚æœå­è¿›ç¨‹æ­£å¸¸ç»ˆæ­¢ï¼ˆæ¯”å¦‚è°ƒç”¨<code>exit</code>æˆ–è¿”å›ï¼‰ï¼Œåˆ™è¿”å›<code>True</code>ï¼›</li>
<li><code>WEXITSTATUS(status)</code>ï¼šå¦‚æœ<code>WIFEXITED()</code>è¿”å›<code>True</code>ï¼Œåˆ™è¿”å›ç»ˆæ­¢å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ï¼›</li>
<li><code>WIFSIGNALED(status)</code>ï¼šå¦‚æœå­è¿›ç¨‹ç”±äºæœªæ•è·çš„ä¿¡å·è€Œç»ˆæ­¢ï¼Œåˆ™è¿”å›<code>True</code>ï¼›</li>
<li><code>WTERMSIG(status)</code>ï¼šå¦‚æœ<code>WIFSIGNALED()</code>è¿”å›<code>True</code>ï¼Œåˆ™è¿”å›å¯¼è‡´å­è¿›ç¨‹ç»ˆæ­¢çš„ä¿¡å·ç¼–å·ï¼›</li>
<li><code>WIFSTOPPED(status)</code>ï¼šå¦‚æœè¿”å›çš„å­è¿›ç¨‹å½“å‰å·²åœæ­¢ï¼Œåˆ™è¿”å›<code>True</code>ï¼›</li>
<li><code>WSTOPSIG(status)</code>ï¼šå¦‚æœ<code>WIFSTOPPED()</code>è¿”å›<code>True</code>ï¼Œåˆ™è¿”å›å¯¼è‡´å­è¿›ç¨‹åœæ­¢çš„ä¿¡å·ç¼–å·ï¼›</li>
<li><code>WIFCONTINUED(status)</code>ï¼šå¦‚æœå­è¿›ç¨‹æ”¶åˆ° SIGCONT ä¿¡å·åæ¢å¤ï¼Œåˆ™è¿”å›<code>True</code>ã€‚</li>
</ul>
<p>å¦‚æœè°ƒç”¨è¿›ç¨‹æ²¡æœ‰å­è¿›ç¨‹ï¼Œ<code>waitpid</code>å°†è¿”å› -1 å¹¶å°†å…¨å±€å˜é‡<code>errno</code>è®¾ä¸º<code>ECHILD</code>ï¼›å¦‚æœ<code>waitpid</code>è¢«ä¿¡å·ä¸­æ–­ï¼Œåˆ™è¿”å› -1 å¹¶å°†å…¨å±€å˜é‡<code>errno</code>è®¾ä¸º<code>EINTR</code>ã€‚</p>
<p>å‡½æ•°<code>wait</code>æ˜¯<code>waitpid</code>çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œ<code>wait(&amp;status)</code>ç­‰æ•ˆäº<code>waitpid(-1, &amp;status, 0)</code>ã€‚</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;csapp.h&quot;</span>
<span class="cp">#define N 2</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="kt">pid_t</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span>

<span class="w">    </span><span class="cm">/* Parent creates N children */</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fork</span><span class="p">())</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="cm">/* child */</span>
<span class="w">            </span><span class="n">exit</span><span class="p">(</span><span class="mi">100</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Parent reaps N children in no particular order */</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">waitpid</span><span class="p">(</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">WIFEXITED</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;child %d terminated normally with exit status=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="n">WEXITSTATUS</span><span class="p">(</span><span class="n">status</span><span class="p">));</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;child %d terminated abnormally</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pid</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/* The only normal termination is if there are no more children */</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errno</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ECHILD</span><span class="p">)</span>
<span class="w">        </span><span class="n">unix_error</span><span class="p">(</span><span class="s">&quot;waitpid error&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>å¦‚ç¤ºä¾‹ç¨‹åºæ‰€ç¤ºï¼Œçˆ¶è¿›ç¨‹é¦–å…ˆè°ƒç”¨<code>Fork</code>åˆ›å»ºäº†ä¸¤ä¸ªé€€å‡ºçŠ¶æ€å”¯ä¸€çš„å­è¿›ç¨‹ï¼ˆ<code>exit(100+i)</code>ï¼‰ã€‚ éšååœ¨ While å¾ªç¯çš„æµ‹è¯•æ¡ä»¶ä¸­é€šè¿‡<code>waitpid</code>ç­‰å¾…å…¶æ‰€æœ‰çš„å­è¿›ç¨‹ç»ˆæ­¢ï¼Œå¹¶æ‰“å°å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ã€‚æœ€ç»ˆæ‰€æœ‰çš„å­è¿›ç¨‹å‡è¢«å›æ”¶ï¼Œ<code>waitpid</code>è¿”å› -1 ä¸”å°†å…¨å±€å˜é‡<code>errno</code>è®¾ä¸º<code>ECHILD</code>ï¼Œå‡½æ•°æ‰§è¡Œå®Œæ¯•ã€‚</p>
<p>åœ¨ Linux ç³»ç»Ÿä¸Šè¿è¡Œè¯¥ç¨‹åºæ—¶ï¼Œå®ƒä¼šäº§ç”Ÿä»¥ä¸‹è¾“å‡ºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="n">linux</span><span class="o">&gt;</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">waitpid1</span>
<span class="n">child</span><span class="w"> </span><span class="mi">22966</span><span class="w"> </span><span class="n">terminated</span><span class="w"> </span><span class="n">normally</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span><span class="o">=</span><span class="mi">100</span><span class="w"> </span>
<span class="n">child</span><span class="w"> </span><span class="mi">22967</span><span class="w"> </span><span class="n">terminated</span><span class="w"> </span><span class="n">normally</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">status</span><span class="o">=</span><span class="mi">101</span>
</code></pre></div>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œçˆ¶è¿›ç¨‹å›æ”¶å­è¿›ç¨‹çš„é¡ºåºæ˜¯éšæœºçš„ã€‚æˆ‘ä»¬å¯ä»¥å¯¹ä¸Šè¿°ç¨‹åºè¿›è¡Œä¸€å®š <a href="http://csapp.cs.cmu.edu/2e/ics2/code/ecf/waitpid2.c">ä¿®æ”¹</a>ï¼Œä»è€Œä½¿å…¶æŒ‰å­è¿›ç¨‹çš„ PID é¡ºåºè¾“å‡ºã€‚</p>
<h3 id="è®©è¿›ç¨‹ä¼‘çœ ">è®©è¿›ç¨‹ä¼‘çœ <a class="headerlink" href="#è®©è¿›ç¨‹ä¼‘çœ " title="Permanent link">&para;</a></h3>
<p>å‡½æ•°<code>sleep</code>å¯ä»¥è®©è¿›ç¨‹æš‚åœæ‰§è¡Œä¸€æ®µæ—¶é—´ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">sleep</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">secs</span><span class="p">);</span>
<span class="c1">// Returns: seconds left to sleep</span>
</code></pre></div>
<p>å¦‚æœè¯·æ±‚çš„æš‚åœæ—¶é—´å·²ç»è¿‡å»ï¼Œåˆ™å‡½æ•°è¿”å› 0ï¼›å¦‚æœè¯¥è¿›ç¨‹è¢«ä¿¡å·ä¸­æ–­ï¼Œåˆ™è¿”å›å‰©ä½™çš„æš‚åœæ—¶é—´ã€‚</p>
<p>å‡½æ•°<code>pause</code>ä¼šä½¿è°ƒç”¨è¿›ç¨‹è¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œç›´è‡³æ”¶åˆ°ä¿¡å·ã€‚è¯¥å‡½æ•°å§‹ç»ˆè¿”å› -1:</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">pause</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</code></pre></div>
<h3 id="åŠ è½½å¹¶è¿è¡Œç¨‹åº">åŠ è½½å¹¶è¿è¡Œç¨‹åº<a class="headerlink" href="#åŠ è½½å¹¶è¿è¡Œç¨‹åº" title="Permanent link">&para;</a></h3>
<p>å‡½æ•°<code>execve</code>åœ¨å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­åŠ è½½å¹¶è¿è¡Œä¸€ä¸ªæ–°ç¨‹åºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">execve</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[],</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">envp</span><span class="p">[]);</span>
</code></pre></div>
<p>å‚æ•°<code>filename</code>æ˜¯åŠ è½½å¹¶è¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶åç§°ï¼Œ<code>argv</code>å’Œ<code>envp</code>åˆ™åˆ†åˆ«æ˜¯å‚æ•°å’Œç¯å¢ƒå˜é‡åˆ—è¡¨ã€‚å‡½æ•°<code>execve</code>é€šå¸¸æ²¡æœ‰è¿”å›å€¼ï¼Œä»…åœ¨å‡ºç°é”™è¯¯æ—¶è¿”å› -1ã€‚</p>
<p>å˜é‡<code>argv</code>æŒ‡å‘ä¸€ä¸ªä»¥<code>NULL</code>ä¸ºç»“å°¾çš„æŒ‡é’ˆæ•°ç»„ï¼Œå…¶ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æŒ‡å‘ä¸€ä¸ªå‚æ•°å­—ç¬¦ä¸²ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ<code>argv[0]</code>æ˜¯å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶åç§°ï¼›å˜é‡<code>envp</code>ä¹ŸæŒ‡å‘ä¸€ä¸ªä»¥<code>NULL</code>ç»“å°¾çš„æŒ‡é’ˆæ•°ç»„ï¼Œå…¶ä¸­çš„æ¯ä¸ªå…ƒç´ å‡æŒ‡å‘ä¸€ä¸ªç¯å¢ƒå˜é‡å­—ç¬¦ä¸²ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²éƒ½æ˜¯ä¸€ä¸ª<code>name=value</code>å½¢å¼çš„é”®å€¼å¯¹ã€‚ä¸¤è€…çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img alt="alt text" src="../image/image-101.png" />
<code>execve</code>åŠ è½½æ–‡ä»¶ååï¼Œä¼šè°ƒç”¨å¯åŠ¨ä»£ç ã€‚ å¯åŠ¨ä»£ç è®¾ç½®æ ˆå¹¶å°†æ§åˆ¶æƒä¼ é€’ç»™æ–°ç¨‹åºçš„<code>main</code>å‡½æ•°ï¼Œå…¶åŸå‹ä¸ºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[],</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">envp</span><span class="p">[]);</span>
</code></pre></div>
<p><code>main</code>å‡½æ•°æ‰§è¡Œæ—¶çš„ç”¨æˆ·æ ˆç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä»æ ˆåº•åˆ°æ ˆé¡¶åˆ†åˆ«æ˜¯ï¼šç¯å¢ƒå˜é‡å­—ç¬¦ä¸²ã€å‚æ•°å­—ç¬¦ä¸²ã€æŒ‡å‘ç¯å¢ƒå˜é‡å­—ç¬¦ä¸²çš„æŒ‡é’ˆæ•°ç»„å’ŒæŒ‡å‘å‚æ•°å­—ç¬¦ä¸²çš„æŒ‡é’ˆæ•°ç»„ã€‚è¯¥å‡½æ•°çš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«ä¿å­˜åœ¨ä¸åŒçš„å¯„å­˜å™¨ä¸­ï¼šå‚æ•°<code>argc</code>ç»™å‡ºæ•°ç»„<code>argv[]</code>ä¸­çš„éç©ºæŒ‡é’ˆæ•°é‡ï¼›å‚æ•°<code>argv</code>æŒ‡å‘æ•°ç»„<code>argv[]</code>ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ï¼›å‚æ•°<code>envp</code>åˆ™æŒ‡å‘æ•°ç»„<code>envp[]</code>ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼š</p>
<p><img alt="alt text" src="../image/image-102.png" />
Linux æä¾›äº†å‡ ä¸ªç”¨äºæ“ä½œç¯å¢ƒå˜é‡æ•°ç»„çš„å‡½æ•°ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="nf">getenv</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">setenv</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">newvalue</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">overwrite</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">unsetenv</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">);</span>
</code></pre></div>
<p>å¦‚æœæ•°ç»„ä¸­åŒ…å«ä»¥å‚æ•°<code>name</code>ä¸ºé”®çš„å­—ç¬¦ä¸²ï¼Œåˆ™å‡½æ•°<code>getenv</code>è¿”å›å…¶å¯¹åº”çš„å€¼ï¼Œå‡½æ•°<code>unsetenv</code>åˆ é™¤è¯¥å­—ç¬¦ä¸²ï¼Œå‡½æ•°<code>setenv</code>å°†å€¼æ›¿æ¢ä¸ºå‚æ•°<code>newvalue</code>ï¼ˆ<code>overwrite</code>éé›¶æ—¶ï¼‰ï¼›å¦‚æœä¸å­˜åœ¨ä»¥<code>name</code>ä¸ºé”®çš„å­—ç¬¦ä¸²ï¼Œåˆ™å‡½æ•°<code>setenv</code>ä¼šå°†<code>name=newvalue</code>æ·»åŠ åˆ°æ•°ç»„ä¸­ã€‚</p>
<h3 id="ä½¿ç”¨-fork-å’Œ-execve-è¿è¡Œç¨‹åº">ä½¿ç”¨ fork å’Œ execve è¿è¡Œç¨‹åº<a class="headerlink" href="#ä½¿ç”¨-fork-å’Œ-execve-è¿è¡Œç¨‹åº" title="Permanent link">&para;</a></h3>
<p>Unix shell å’Œ Web æœåŠ¡å™¨ç­‰ç¨‹åºå¤§é‡ä½¿ç”¨äº†<code>fork</code>å’Œ<code>execve</code>å‡½æ•°ã€‚æœ¬ä¹¦æä¾›äº†ä¸€ä¸ªç®€å•çš„ <a href="http://csapp.cs.cmu.edu/2e/ics2/code/ecf/shellex.c">shell ç¨‹åº</a>ï¼Œå…¶ç¼ºé™·åœ¨äºæ²¡æœ‰å›æ”¶ä»»ä½•åå°è¿è¡Œçš„å­è¿›ç¨‹ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸‹ä¸€èŠ‚ä»‹ç»çš„ä¿¡å·æ¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚</p>
<h2 id="ä¿¡å·">ä¿¡å·<a class="headerlink" href="#ä¿¡å·" title="Permanent link">&para;</a></h2>
<p>ä¿¡å·ï¼ˆSignalï¼‰æ˜¯ä¸€ç§é«˜çº§çš„å¼‚å¸¸æ§åˆ¶æµï¼Œå®ƒå…è®¸è¿›ç¨‹å’Œå†…æ ¸å°†æŸäº›ç±»å‹çš„ç³»ç»Ÿäº‹ä»¶é€šçŸ¥ç»™å…¶ä»–è¿›ç¨‹ã€‚Linux æ”¯æŒçš„ä¿¡å·ç±»å‹å¤šè¾¾ä¸‰åç§ï¼š</p>
<p><img alt="alt text" src="../image/image-103.png" />
ä½çº§åˆ«çš„ç¡¬ä»¶å¼‚å¸¸ç”±å†…æ ¸ä¸­çš„å¼‚å¸¸å¤„ç†ç¨‹åºå¤„ç†ï¼Œé€šå¸¸ä¸ä¼šå¯¹ç”¨æˆ·è¿›ç¨‹å¯è§ï¼Œè€Œä¿¡å·åˆ™å¯ä»¥å°†æ­¤ç±»å¼‚å¸¸æš´éœ²ç»™ç”¨æˆ·è¿›ç¨‹ã€‚å¦‚æœä¸€ä¸ªè¿›ç¨‹è¯•å›¾é™¤ä»¥ 0ï¼Œå†…æ ¸å°±ä¼šå‘å®ƒå‘é€ä¸€ä¸ª SIGFPEï¼ˆç¼–å· 8ï¼‰ä¿¡å·ã€‚</p>
<h3 id="ä¿¡å·æœ¯è¯­">ä¿¡å·æœ¯è¯­<a class="headerlink" href="#ä¿¡å·æœ¯è¯­" title="Permanent link">&para;</a></h3>
<p>å‘é€ä¿¡å·åˆ°ç›®æ ‡è¿›ç¨‹éœ€è¦å®Œæˆä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>å‘é€ï¼ˆä¼ é€’ï¼‰ä¿¡å·ï¼šå†…æ ¸é€šè¿‡æ›´æ–°ç›®æ ‡è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­çš„æŸäº›çŠ¶æ€æ¥å‘ç›®æ ‡è¿›ç¨‹å‘é€ä¿¡å·ã€‚å‘é€ä¿¡å·çš„åŸå› æœ‰ä¸¤ç§ï¼šâ‘  å†…æ ¸æ£€æµ‹åˆ°ç³»ç»Ÿäº‹ä»¶çš„å‘ç”Ÿï¼Œå¦‚è¢« 0 é™¤é”™è¯¯æˆ–å­è¿›ç¨‹ç»ˆæ­¢ç­‰ï¼›â‘¡ è¿›ç¨‹è°ƒç”¨äº†<code>kill</code>å‡½æ•°ï¼ˆå°†åœ¨ä¸‹ä¸€èŠ‚ä»‹ç»ï¼‰ã€‚è¿›ç¨‹å¯ä»¥å‘è‡ªå·±å‘é€ä¿¡å·ï¼›</li>
<li>æ¥æ”¶ä¿¡å·ï¼šå½“å†…æ ¸å¼ºåˆ¶ç›®æ ‡è¿›ç¨‹ä»¥æŸç§æ–¹å¼å¯¹ä¿¡å·åšå‡ºå“åº”æ—¶ï¼Œå®ƒä¾¿æ¥æ”¶åˆ°äº†ä¿¡å·ã€‚è¯¥è¿›ç¨‹å¯ä»¥é€šè¿‡æ‰§è¡Œç”¨æˆ·çº§åˆ«çš„ä¿¡å·å¤„ç†ç¨‹åºï¼ˆSignal Handlerï¼‰æ¥å¿½ç•¥ã€ç»ˆæ­¢æˆ–æ•è·ä¿¡å·ã€‚</li>
</ol>
<p><img alt="alt text" src="../image/image-104.png" />
å·²å‘é€ä½†è¿˜æœªæ¥æ”¶çš„ä¿¡å·è¢«ç§°ä¸ºå¾…å¤„ç†ä¿¡å·ï¼ˆPending Signalï¼‰ã€‚åœ¨ä»»æ„æ—¶é—´ç‚¹ï¼Œç›¸åŒç±»å‹çš„å¾…å¤„ç†ä¿¡å·æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªã€‚è¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªè¿›ç¨‹å·²ç»æœ‰ä¸€ä¸ªç±»å‹ä¸º k çš„å¾…å¤„ç†ä¿¡å·ï¼Œé‚£ä¹ˆåç»­æ‰€æœ‰å‘é€ç»™è¯¥è¿›ç¨‹çš„ k ç±»å‹ä¿¡å·éƒ½å°†è¢«ä¸¢å¼ƒã€‚è¿›ç¨‹è¿˜å¯ä»¥é€‰æ‹©æ€§åœ°é˜»å¡ï¼ˆBlockï¼‰æŸäº›ä¿¡å·çš„æ¥æ”¶ã€‚</p>
<h3 id="å‘é€ä¿¡å·">å‘é€ä¿¡å·<a class="headerlink" href="#å‘é€ä¿¡å·" title="Permanent link">&para;</a></h3>
<h4 id="è¿›ç¨‹ç»„">è¿›ç¨‹ç»„<a class="headerlink" href="#è¿›ç¨‹ç»„" title="Permanent link">&para;</a></h4>
<p>æ¯ä¸ªè¿›ç¨‹éƒ½å±äºä¸€ä¸ªè¿›ç¨‹ç»„ï¼ˆProcess Groupï¼‰ï¼Œå®ƒç”±ä¸€ä¸ªæ­£æ•´æ•°çš„è¿›ç¨‹ç»„ ID æ‰€æ ‡è¯†ã€‚<code>getpgrp</code>å‡½æ•°è¿”å›å½“å‰è¿›ç¨‹çš„è¿›ç¨‹ç»„ IDï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="kt">pid_t</span><span class="w"> </span><span class="nf">getpgrp</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</code></pre></div>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå­è¿›ç¨‹ä¸å…¶çˆ¶è¿›ç¨‹å±äºåŒä¸€ä¸ªè¿›ç¨‹ç»„ã€‚è¿›ç¨‹å¯ä»¥é€šè¿‡<code>setpgid</code>å‡½æ•°æ”¹å˜è‡ªå·±æˆ–å¦ä¸€ä¸ªè¿›ç¨‹çš„è¿›ç¨‹ç»„ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">setpgid</span><span class="p">(</span><span class="kt">pid_t</span><span class="w"> </span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="kt">pid_t</span><span class="w"> </span><span class="n">pgid</span><span class="p">);</span>
</code></pre></div>
<p>è¯¥å‡½æ•°ä¼šæŠŠè¿›ç¨‹<code>pid</code>çš„è¿›ç¨‹ç»„æ›´æ”¹ä¸º<code>pgid</code>ã€‚è‹¥å°†å‚æ•°<code>pid</code>æˆ–<code>pgid</code>è®¾ä¸º 0ï¼Œåˆ™ç›¸å½“äºä½¿ç”¨è°ƒç”¨è¿›ç¨‹çš„ PID ä½œä¸ºå‚æ•°ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœè¿›ç¨‹ 15213 è°ƒç”¨å‡½æ•°<code>setpgid(0, 0)</code>ï¼Œé‚£ä¹ˆå°†ä¼šåˆ›å»ºä¸€ä¸ªè¿›ç¨‹ç»„ ID ä¸º 15213 çš„æ–°è¿›ç¨‹ç»„ï¼Œå¹¶ä½¿è¯¥è¿›ç¨‹åŠ å…¥æ­¤ç»„ã€‚</p>
<h4 id="ä»é”®ç›˜å‘é€ä¿¡å·">ä»é”®ç›˜å‘é€ä¿¡å·<a class="headerlink" href="#ä»é”®ç›˜å‘é€ä¿¡å·" title="Permanent link">&para;</a></h4>
<p>Unix Shell ä½¿ç”¨ä»»åŠ¡ï¼ˆJobï¼‰è¡¨ç¤ºå•ä¸ªå‘½ä»¤è¡Œï¼ˆå¦‚<code>ls | sort</code>ï¼‰åˆ›å»ºçš„è¿›ç¨‹ï¼ŒåŒä¸€æ—¶é—´å†…åªèƒ½æœ‰ä¸€ä¸ªå‰å°ä»»åŠ¡å’Œå¤šä¸ªåå°ä»»åŠ¡ã€‚</p>
<p><img alt="alt text" src="../image/image-105.png" />
åœ¨é”®ç›˜ä¸Šè¾“å…¥ Ctrl+C ä¼šä½¿å†…æ ¸å‘å‰å°è¿›ç¨‹ç»„ä¸­çš„æ‰€æœ‰è¿›ç¨‹å‘é€ SIGINT ä¿¡å·ï¼Œè¿™å°†ç»ˆæ­¢å‰å°ä»»åŠ¡ã€‚åŒæ ·ï¼Œè¾“å…¥ Ctrl+Z ä¼šä½¿å†…æ ¸å‘å‰å°è¿›ç¨‹ç»„ä¸­çš„æ‰€æœ‰è¿›ç¨‹å‘é€ SIGTSTP ä¿¡å·ï¼Œè¿™å°†åœæ­¢ï¼ˆæŒ‚èµ·ï¼‰å‰å°ä»»åŠ¡ã€‚</p>
<h4 id="ä½¿ç”¨-kill-å‡½æ•°å‘é€ä¿¡å·">ä½¿ç”¨ kill å‡½æ•°å‘é€ä¿¡å·<a class="headerlink" href="#ä½¿ç”¨-kill-å‡½æ•°å‘é€ä¿¡å·" title="Permanent link">&para;</a></h4>
<p>è¿›ç¨‹å¯ä»¥è°ƒç”¨<code>kill</code>å‡½æ•°å‘å…¶ä»–è¿›ç¨‹ï¼ˆåŒ…æ‹¬å…¶è‡ªèº«ï¼‰å‘é€ä¿¡å·ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/types.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;signal.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">kill</span><span class="p">(</span><span class="kt">pid_t</span><span class="w"> </span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sig</span><span class="p">);</span>
<span class="c1">// Returns: 0 if OK, âˆ’1 on error</span>
</code></pre></div>
<p>è‹¥å‚æ•°<code>pid</code>å¤§äº 0ï¼Œåˆ™è¯¥å‡½æ•°å°†ç¼–å·ä¸º<code>sig</code>çš„ä¿¡å·å‘é€ç»™è¿›ç¨‹<code>pid</code>ï¼›è‹¥å‚æ•°<code>pid</code>ç­‰äº 0ï¼Œåˆ™è¯¥å‡½æ•°å°†ä¿¡å·å‘é€ç»™è°ƒç”¨è¿›ç¨‹æ‰€åœ¨è¿›ç¨‹ç»„ä¸­çš„æ‰€æœ‰è¿›ç¨‹ï¼›å¦‚æœå‚æ•°<code>pid</code>å°äº 0ï¼Œåˆ™è¯¥å‡½æ•°å°†ä¿¡å·å‘é€ç»™è¿›ç¨‹ç»„ ID ä¸º<code>|pid|</code>çš„è¿›ç¨‹ç»„ä¸­çš„æ‰€æœ‰è¿›ç¨‹ã€‚</p>
<h4 id="ä½¿ç”¨-alarm-å‡½æ•°å‘é€ä¿¡å·">ä½¿ç”¨ alarm å‡½æ•°å‘é€ä¿¡å·<a class="headerlink" href="#ä½¿ç”¨-alarm-å‡½æ•°å‘é€ä¿¡å·" title="Permanent link">&para;</a></h4>
<p>è¿›ç¨‹å¯ä»¥è°ƒç”¨<code>alarm</code>å‡½æ•°å‘è‡ªå·±å‘é€ SIGALRM ä¿¡å·ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">alarm</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">secs</span><span class="p">);</span>
<span class="c1">// Returns: remaining seconds of previous alarm, or 0 if no previous alarm</span>
</code></pre></div>
<p>å†…æ ¸å°†åœ¨<code>secs</code>ç§’åå‘è°ƒç”¨è¿›ç¨‹å‘é€ SIGALRM ä¿¡å·ï¼Œå–æ¶ˆæ‰€æœ‰ä¹‹å‰è®¾ç½®çš„<code>alarm</code>ï¼Œå¹¶è¿”å›å…¶å‰©ä½™çš„ç§’æ•°ã€‚</p>
<h3 id="æ¥æ”¶ä¿¡å·">æ¥æ”¶ä¿¡å·<a class="headerlink" href="#æ¥æ”¶ä¿¡å·" title="Permanent link">&para;</a></h3>
<p>å½“å†…æ ¸å°†è¿›ç¨‹ p ä»å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥ p æœªé˜»å¡ä¸”æœªå¤„ç†ï¼ˆPending &amp; ~Blockedï¼‰çš„ä¿¡å·é›†ã€‚é€šå¸¸è¯¥é›†åˆä¸ºç©ºï¼Œå†…æ ¸å°†æ§åˆ¶æƒè½¬ç§»ç»™ p çš„é€»è¾‘æ§åˆ¶æµä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚ä½†å¦‚æœè¯¥é›†åˆéç©ºï¼Œå†…æ ¸å°±ä¼šé€‰æ‹©ä¿¡å·é›†ä¸­çš„æŸä¸ªä¿¡å· k å¹¶å¼ºåˆ¶ p æ¥æ”¶å®ƒã€‚ä¿¡å·å°†è§¦å‘è¿›ç¨‹å®Œæˆä¸€äº›åŠ¨ä½œï¼ˆActionï¼‰ï¼Œé¢„å®šä¹‰çš„é»˜è®¤åŠ¨ä½œæœ‰ï¼š</p>
<ul>
<li>è¿›ç¨‹ç»ˆæ­¢ï¼›</li>
<li>è¿›ç¨‹ç»ˆæ­¢å¹¶è½¬å‚¨æ ¸å¿ƒï¼ˆDump Coreï¼Œå³å°†ä»£ç å’Œæ•°æ®å†…å­˜æ®µçš„é•œåƒå†™å…¥ç£ç›˜ï¼‰ï¼›</li>
<li>è¿›ç¨‹åœæ­¢ï¼ˆæš‚åœï¼‰ï¼Œç›´åˆ°æ¥æ”¶ SIGCONT ä¿¡å·é‡æ–°å¯åŠ¨ï¼›</li>
<li>è¿›ç¨‹å¿½ç•¥è¯¥ä¿¡å·ã€‚</li>
</ul>
<p>æ¯ç§ä¿¡å·çš„é»˜è®¤åŠ¨ä½œè§ï¼ˆä¸Šå›¾ 8.26ï¼‰ã€‚é™¤ SIGSTOP å’Œ SIGKILL ä¿¡å·å¤–ï¼Œè¿›ç¨‹è¿˜å¯ä»¥é€šè¿‡å‡½æ•°<code>signal</code>ä¿®æ”¹ä¿¡å·çš„é»˜è®¤åŠ¨ä½œï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;signal.h&gt;</span>
<span class="k">typedef</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="kt">sighandler_t</span><span class="p">)(</span><span class="kt">int</span><span class="p">);</span>
<span class="kt">sighandler_t</span><span class="w"> </span><span class="nf">signal</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">signum</span><span class="p">,</span><span class="w"> </span><span class="kt">sighandler_t</span><span class="w"> </span><span class="n">handler</span><span class="p">);</span>
<span class="c1">// Returns: pointer to previous handler if OK, SIG_ERR on error (does not set errno)</span>
</code></pre></div>
<p>è‹¥å‚æ•°<code>handler</code>ä¸º<code>SIG_IGN</code>ï¼Œåˆ™<code>signum</code>ç±»å‹çš„ä¿¡å·å°†ä¼šè¢«å¿½ç•¥ï¼›è‹¥å‚æ•°<code>handler</code>ä¸º<code>SIG_DFL</code>ï¼Œåˆ™<code>signum</code>ç±»å‹çš„ä¿¡å·çš„åŠ¨ä½œå°†æ¢å¤ä¸ºé»˜è®¤ï¼›è‹¥å‚æ•°<code>handler</code>ä¸ºç”¨æˆ·å®šä¹‰çš„ä¿¡å·å¤„ç†ç¨‹åºåœ°å€ï¼Œåˆ™è¿›ç¨‹æ¥æ”¶åˆ°<code>signum</code>ç±»å‹çš„ä¿¡å·åä¼šè°ƒç”¨è¯¥ç¨‹åºï¼Œè¿™ç§æ–¹æ³•è¢«ç§°ä¸ºå®‰è£…å¤„ç†ç¨‹åºï¼ˆInstalling Handlerï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè°ƒç”¨å¤„ç†ç¨‹åºè¢«ç§°ä¸ºæ•è·ä¿¡å·ï¼ˆCatching Signalï¼‰ï¼Œæ‰§è¡Œå¤„ç†ç¨‹åºè¢«ç§°ä¸ºå¤„ç†ä¿¡å·ï¼ˆHandling Signalï¼‰ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬åœ¨ç¤ºä¾‹ç¨‹åºè¿è¡Œæ—¶æŒ‰ä¸‹ Ctrl+Cï¼Œè¯¥è¿›ç¨‹å°±ä¸ä¼šç›´æ¥ç»ˆæ­¢è€Œæ˜¯è¾“å‡ºä¸€æ®µä¿¡æ¯åæ‰ç»ˆæ­¢ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;csapp.h&quot;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">handler</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">sig</span><span class="p">)</span><span class="w"> </span><span class="cm">/* SIGINT handler */</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Caught SIGINT</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="cm">/* Install the SIGINT handler */</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">signal</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span><span class="w"> </span><span class="n">handler</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SIG_ERR</span><span class="p">)</span>
<span class="w">        </span><span class="n">unix_error</span><span class="p">(</span><span class="s">&quot;signal error&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">Pause</span><span class="p">();</span><span class="w"> </span><span class="cm">/* Wait for the receipt of a signal */</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>ä¿¡å·å¤„ç†ç¨‹åºè¿˜å¯ä»¥è¢«å…¶ä»–å¤„ç†ç¨‹åºä¸­æ–­ï¼ˆä¿¡å· <span class="arithmatex">\(s \ne t\)</span>ï¼‰ï¼š</p>
<p><img alt="alt text" src="../image/image-106.png" /></p>
<h3 id="é˜»å¡ä¿¡å·">é˜»å¡ä¿¡å·<a class="headerlink" href="#é˜»å¡ä¿¡å·" title="Permanent link">&para;</a></h3>
<p>Linux ä¸ºé˜»å¡ä¿¡å·æä¾›äº†æ˜¾å¼å’Œéšå¼çš„å®ç°æœºåˆ¶ï¼š</p>
<ul>
<li>éšå¼ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå†…æ ¸ä¼šé˜»å¡ä»»ä½•ä¸å¤„ç†ç¨‹åºå½“å‰æ­£åœ¨å¤„ç†çš„ä¿¡å·ç±»å‹ç›¸åŒçš„æœªå¤„ç†ä¿¡å·ã€‚æ¯”å¦‚ä¸Šå›¾ 8.31 ä¸­ï¼Œè‹¥ä¿¡å· <span class="arithmatex">\(t\)</span> çš„ç±»å‹ä¸ <span class="arithmatex">\(s\)</span> ç›¸åŒï¼Œåˆ™ <span class="arithmatex">\(t\)</span> å°†åœ¨å¤„ç†ç¨‹åº <span class="arithmatex">\(S\)</span> è¿”å›å‰æŒç»­æŒ‚èµ·ï¼›</li>
<li>æ˜¾å¼ï¼šåº”ç”¨ç¨‹åºå¯ä»¥è°ƒç”¨<code>sigprocmask</code>ç­‰å‡½æ•°é˜»å¡ä¿¡å·æˆ–è§£é™¤ä¿¡å·çš„é˜»å¡ã€‚</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;signal.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">sigprocmask</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">how</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">sigset_t</span><span class="w"> </span><span class="o">*</span><span class="n">set</span><span class="p">,</span><span class="w"> </span><span class="kt">sigset_t</span><span class="w"> </span><span class="o">*</span><span class="n">oldset</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">sigemptyset</span><span class="p">(</span><span class="kt">sigset_t</span><span class="w"> </span><span class="o">*</span><span class="n">set</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">sigfillset</span><span class="p">(</span><span class="kt">sigset_t</span><span class="w"> </span><span class="o">*</span><span class="n">set</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">sigaddset</span><span class="p">(</span><span class="kt">sigset_t</span><span class="w"> </span><span class="o">*</span><span class="n">set</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">signum</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">sigdelset</span><span class="p">(</span><span class="kt">sigset_t</span><span class="w"> </span><span class="o">*</span><span class="n">set</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">signum</span><span class="p">);</span>
<span class="c1">// Returns: 0 if OK, âˆ’1 on error</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">sigismember</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">sigset_t</span><span class="w"> </span><span class="o">*</span><span class="n">set</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">signum</span><span class="p">);</span>
<span class="c1">// Returns: 1 if member, 0 if not, âˆ’1 on error</span>
</code></pre></div>
<p><code>sigprocmask</code>å‡½æ•°å¯ä»¥æ”¹å˜å½“å‰é˜»å¡ä¿¡å·çš„é›†åˆï¼ˆè®¾ä¸º<code>blocked</code>ï¼‰ï¼Œå…·ä½“è¡Œä¸ºå–å†³äºå‚æ•°<code>how</code>çš„å€¼ï¼š</p>
<ul>
<li><code>SIG_BLOCK</code>ï¼šå°†å‚æ•°<code>set</code>ä¸­çš„ä¿¡å·é˜»å¡ï¼ˆ<code>blocked = blocked | set</code>ï¼‰ï¼›</li>
<li><code>SIG_UNBLOCK</code>ï¼šä¸º<code>set</code>ä¸­çš„ä¿¡å·è§£é™¤é˜»å¡ï¼ˆ<code>blocked = blocked &amp; ~set</code>ï¼‰ï¼›</li>
<li><code>SIG_SETMASK</code>ï¼šå°†é˜»å¡ä¿¡å·é›†åˆè®¾ä¸º<code>set</code>ï¼ˆ<code>blocked = set</code>ï¼‰ã€‚</li>
</ul>
<p>å¦‚æœå‚æ•°<code>oldset</code>éç©ºï¼Œåˆ™å…ˆå‰<code>blocked</code>çš„å€¼ä¼šå­˜å‚¨åœ¨<code>oldset</code>ä¸­ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œå‡½æ•°<code>sigemptyset</code>å°†<code>set</code>åˆå§‹åŒ–ä¸ºç©ºé›†ï¼›<code>sigfillset</code>å°†æ‰€æœ‰ä¿¡å·åŠ å…¥åˆ°<code>set</code>ä¸­ï¼›<code>sigaddset</code>å°†ç¼–å·ä¸º<code>signum</code>çš„ä¿¡å·åŠ å…¥åˆ°<code>set</code>ä¸­ï¼›<code>sigdelset</code>å°†ç¼–å·ä¸º<code>signum</code>çš„ä¿¡å·ä»<code>set</code>ä¸­åˆ é™¤ï¼›å¦‚æœ<code>signum</code>ä¿¡å·åœ¨<code>set</code>ä¸­ï¼Œåˆ™å‡½æ•°<code>sigismember</code>è¿”å› 1ï¼Œå¦åˆ™è¿”å› 0ã€‚</p>
<p>ç¤ºä¾‹ç¨‹åºæš‚æ—¶é˜»å¡äº† SIGINT ä¿¡å·çš„æ¥æ”¶ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">sigset_t</span><span class="w"> </span><span class="n">mask</span><span class="p">,</span><span class="w"> </span><span class="n">prev_mask</span><span class="p">;</span>
<span class="n">sigemptyset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mask</span><span class="p">);</span>
<span class="n">sigaddset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mask</span><span class="p">,</span><span class="w"> </span><span class="n">SIGINT</span><span class="p">);</span>
<span class="cm">/* Block SIGINT and save previous blocked set */</span>
<span class="n">sigprocmask</span><span class="p">(</span><span class="n">SIG_BLOCK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mask</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">prev_mask</span><span class="p">);</span>

<span class="c1">// Code region that will not be interrupted by SIGINT</span>

<span class="cm">/* Restore previous blocked set, unblocking SIGINT */</span>
<span class="n">sigprocmask</span><span class="p">(</span><span class="n">SIG_SETMASK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">prev_mask</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
</code></pre></div>
<h3 id="ç¼–å†™ä¿¡å·å¤„ç†ç¨‹åº">ç¼–å†™ä¿¡å·å¤„ç†ç¨‹åº<a class="headerlink" href="#ç¼–å†™ä¿¡å·å¤„ç†ç¨‹åº" title="Permanent link">&para;</a></h3>
<h4 id="å®‰å…¨çš„ä¿¡å·å¤„ç†">å®‰å…¨çš„ä¿¡å·å¤„ç†<a class="headerlink" href="#å®‰å…¨çš„ä¿¡å·å¤„ç†" title="Permanent link">&para;</a></h4>
<p>å¦‚æœå¤„ç†ç¨‹åºå’Œä¸»ç¨‹åºå¹¶å‘åœ°è®¿é—®åŒä¸€ä¸ªå…¨å±€æ•°æ®ç»“æ„ï¼Œå°±ä¼šå‘ç”Ÿä¸å¯é¢„çŸ¥çš„ä¸¥é‡é—®é¢˜ã€‚å› æ­¤æˆ‘ä»¬åœ¨ç¼–å†™ä¿¡å·å¤„ç†ç¨‹åºæ—¶åº”å½“éµå¾ªä»¥ä¸‹å®ˆåˆ™ï¼š</p>
<ul>
<li>ä½¿ä¿¡å·å¤„ç†ç¨‹åºå°½å¯èƒ½çš„ç®€å•ï¼›</li>
<li>ä»…è°ƒç”¨å¼‚æ­¥ä¿¡å·å®‰å…¨ï¼ˆAsync-Signal-Safeï¼‰çš„å‡½æ•°ã€‚è¿™ç§å‡½æ•°ä¸€èˆ¬åªè®¿é—®å±€éƒ¨å˜é‡ï¼Œæˆ–è€…ä¸ä¼šè¢«å…¶ä»–ä¿¡å·å¤„ç†ç¨‹åºä¸­æ–­ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè®¸å¤šå¸¸ç”¨çš„å‡½æ•°ï¼Œå¦‚<code>printf</code>ã€<code>sprintf</code>ã€<code>malloc</code>å’Œ<code>exit</code>ç­‰å¹¶éå¼‚æ­¥ä¿¡å·å®‰å…¨ã€‚è°ƒç”¨<code>write</code>å‡½æ•°æ˜¯ä¿¡å·å¤„ç†ç¨‹åºç”Ÿæˆè¾“å‡ºçš„å”¯ä¸€å®‰å…¨æ–¹æ³•ï¼›</li>
<li>ä¿å­˜å¹¶æ¢å¤å˜é‡<code>errno</code>ï¼šè®¸å¤š Linux å¼‚æ­¥ä¿¡å·å®‰å…¨å‡½æ•°è¿”å›é”™è¯¯æ—¶ä¼šè®¾ç½®å˜é‡<code>errno</code>çš„å€¼ï¼Œå› æ­¤å¯èƒ½ä¼šå¹²æ‰°ç¨‹åºä¸­å…¶ä»–ä¾èµ–<code>errno</code>çš„éƒ¨åˆ†ã€‚å½“å¤„ç†ç¨‹åºæœ‰è¿”å›æ—¶ï¼Œæˆ‘ä»¬åº”å½“åœ¨è°ƒç”¨å‰å°†<code>errno</code>ä¿å­˜åˆ°å±€éƒ¨å˜é‡ä¸­ï¼Œå¹¶åœ¨è¿”å›å‰æ¢å¤å…¶å€¼ï¼›</li>
<li>è®¿é—®å…¨å±€æ•°æ®ç»“æ„æ—¶é˜»å¡æ‰€æœ‰ä¿¡å·ï¼›</li>
<li>å‡è®¾ä¸»ç¨‹åºå’Œä¿¡å·å¤„ç†ç¨‹åºå…±äº«å…¨å±€å˜é‡<code>g</code>ï¼Œå¤„ç†ç¨‹åºæ›´æ–°<code>g</code>çš„å€¼ï¼Œä¸»ç¨‹åºå®šæœŸè¯»å–<code>g</code>çš„å€¼ã€‚ä¼˜åŒ–çš„ç¼–è¯‘å™¨ä¼šä»å¯„å­˜å™¨ä¸­è¯»å–å·²ç¼“å­˜çš„<code>g</code>ï¼Œå› æ­¤ä¸»å‡½æ•°ä¸­çš„<code>g</code>å¯èƒ½æ°¸è¿œä¸å˜ï¼Œå¹¶ä¸”æ¯æ¬¡å¯¹<code>g</code>çš„å¼•ç”¨ä¹Ÿéƒ½æ˜¯å®‰å…¨çš„ã€‚è‹¥ä½¿ç”¨<code>volatile</code>å£°æ˜å…¨å±€å˜é‡ï¼Œå¦‚<code>volatile int g;</code>ï¼Œé‚£ä¹ˆå½“ä»£ç å¼•ç”¨<code>g</code>æ—¶ï¼Œç¼–è¯‘å™¨å°±ä¼šä»å†…å­˜ä¸­è¯»å–å…¶å€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”å½“ä¸´æ—¶é˜»å¡ä¿¡å·ä»¥ä¿æŠ¤å¯¹<code>g</code>çš„è®¿é—®ï¼›</li>
<li>åœ¨å¸¸è§çš„è®¾è®¡ä¸­ï¼Œå¤„ç†ç¨‹åºé€šè¿‡å†™å…¥å…¨å±€æ ‡è¯†ï¼ˆFlagï¼‰æ¥è®°å½•ä¿¡å·çš„æ¥æ”¶ã€‚è‹¥ä½¿ç”¨<code>sig_atomic_t</code>ç±»å‹å£°æ˜æ ‡è¯†ï¼Œå¦‚<code>volatile sig_atomic_t flag;</code>ï¼Œé‚£ä¹ˆä¾¿å¯ä»¥ä¿è¯<code>flag</code>å†™å…¥çš„åŸå­æ€§ï¼ˆAtomic/Uninterruptibleï¼‰ã€‚</li>
</ul>
<h4 id="æ­£ç¡®çš„ä¿¡å·å¤„ç†">æ­£ç¡®çš„ä¿¡å·å¤„ç†<a class="headerlink" href="#æ­£ç¡®çš„ä¿¡å·å¤„ç†" title="Permanent link">&para;</a></h4>
<p>ä¸Šæ–‡æåˆ°ï¼Œçˆ¶è¿›ç¨‹å¿…é¡»å›æ”¶å­è¿›ç¨‹ä»¥é¿å…åœ¨ç³»ç»Ÿä¸­ç•™ä¸‹åƒµå°¸è¿›ç¨‹ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¸Œæœ›çˆ¶è¿›ç¨‹å¯ä»¥åœ¨å­è¿›ç¨‹è¿è¡Œæ—¶è‡ªç”±åœ°æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚å› æ­¤æˆ‘ä»¬ä½¿ç”¨ SIGCHILD å¤„ç†ç¨‹åºæ¥å›æ”¶å­è¿›ç¨‹ï¼Œè€Œä¸æ˜¯æ˜¾å¼åœ°è°ƒç”¨<code>waitpid</code>ç­‰å¾…å­è¿›ç¨‹ç»ˆæ­¢ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;csapp.h&quot;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">handler1</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">sig</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">pid_t</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">waitpid</span><span class="p">(</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="n">unix_error</span><span class="p">(</span><span class="s">&quot;waitpid error&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Handler reaped child %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">pid</span><span class="p">);</span>
<span class="w">    </span><span class="n">Sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="n">MAXBUF</span><span class="p">];</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">signal</span><span class="p">(</span><span class="n">SIGCHLD</span><span class="p">,</span><span class="w"> </span><span class="n">handler1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SIG_ERR</span><span class="p">)</span>
<span class="w">        </span><span class="n">unix_error</span><span class="p">(</span><span class="s">&quot;signal error&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="cm">/* Parent creates children */</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Fork</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">fprintf</span><span class="p">(</span><span class="s">&quot;Hello from child %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">getpid</span><span class="p">());</span>
<span class="w">            </span><span class="n">Sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">            </span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/* Parent waits for terminal input and then processes it */</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read</span><span class="p">(</span><span class="n">STDIN_FILENO</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="n">unix_error</span><span class="p">(</span><span class="s">&quot;read&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Parent processing input</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">        </span><span class="p">;</span>

<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>ç¤ºä¾‹ç¨‹åºä¸­ï¼Œçˆ¶è¿›ç¨‹å®‰è£…äº†å¤„ç†ç¨‹åº<code>handler1</code>å¹¶åˆ›å»ºä¸‰ä¸ªå­è¿›ç¨‹ã€‚å®ƒç­‰å¾…æ¥è‡ªç»ˆç«¯çš„è¾“å…¥ï¼Œç„¶åè¿›å…¥ While å¾ªç¯ã€‚æ¯å½“ä¸€ä¸ªå­è¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œå†…æ ¸å°†å‘é€ä¸€ä¸ª SIGCHLD ä¿¡å·é€šçŸ¥çˆ¶è¿›ç¨‹ã€‚çˆ¶è¿›ç¨‹æ•è·ä¿¡å·åå›æ”¶å­è¿›ç¨‹ï¼Œè¾“å‡ºä¸€æ®µä¿¡æ¯ç„¶åè¿”å›ã€‚</p>
<p>åœ¨ Linux ä¸Šè¿è¡Œè¯¥ç¨‹åºå¾—åˆ°çš„è¾“å‡ºç»“æœä¸ºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="n">linux</span><span class="o">&gt;</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">signal1</span>
<span class="n">Hello</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="mi">14073</span><span class="w"> </span>
<span class="n">Hello</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="mi">14074</span><span class="w"> </span>
<span class="n">Hello</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="mi">14075</span><span class="w"> </span>
<span class="n">Handler</span><span class="w"> </span><span class="n">reaped</span><span class="w"> </span><span class="n">child</span><span class="w"> </span>
<span class="n">Handler</span><span class="w"> </span><span class="n">reaped</span><span class="w"> </span><span class="n">child</span>
<span class="n">CR</span>
<span class="n">Parent</span><span class="w"> </span><span class="n">processing</span><span class="w"> </span><span class="n">input</span>
</code></pre></div>
<p>çˆ¶è¿›ç¨‹åˆ›å»ºäº†ä¸‰ä¸ªå­è¿›ç¨‹ï¼Œç„¶è€Œå´åªå›æ”¶äº†ä¸¤ä¸ªï¼Œè¿™æ˜¯å› ä¸ºåŒä¸€æ—¶é—´å†…ç›¸åŒç±»å‹çš„æœªå¤„ç†ä¿¡å·æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªã€‚ä¿¡å·å¤„ç†ç¨‹åºåœ¨å¤„ç†ç¬¬ä¸€ä¸ªä¿¡å·æ—¶ï¼Œç¬¬äºŒä¸ªä¿¡å·åˆ°è¾¾å¹¶è¢«æ·»åŠ åˆ°æœªå¤„ç†ä¿¡å·é›†ä¸­ã€‚ç”±äºå·²æœ‰ä¸€ä¸ªæœªå¤„ç†çš„ SIGCHLD ä¿¡å·ï¼Œæ­¤æ—¶è‹¥ç¬¬ä¸‰ä¸ªä¿¡å·åˆ°è¾¾ä¾¿ä¼šè¢«ç›´æ¥ä¸¢å¼ƒã€‚å½“å¤„ç†ç¨‹åºè¿”å›åï¼Œå†…æ ¸å‘ç°ç¬¬äºŒä¸ªä¿¡å·è¿˜æœªå¤„ç†ï¼Œäºæ˜¯å¼ºåˆ¶çˆ¶è¿›ç¨‹æ¥æ”¶è¯¥ä¿¡å·å¹¶é‡æ–°æ‰§è¡Œå¤„ç†ç¨‹åºã€‚ç­‰åˆ°å¤„ç†ç¨‹åºå†æ¬¡è¿”å›ï¼Œçˆ¶è¿›ç¨‹å°±ä¸å†æœ‰ä»»ä½•æœªå¤„ç†çš„ SIGCHLD ä¿¡å·äº†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥è®©å¤„ç†ç¨‹åºåœ¨è¢«è°ƒç”¨æ—¶å°½å¯èƒ½å¤šåœ°å›æ”¶å­è¿›ç¨‹ä»¥è§£å†³è¿™ä¸€é—®é¢˜ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">handler2</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">sig</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">pid_t</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">waitpid</span><span class="p">(</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">WNOHANG</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Handler reaped child %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">pid</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">errno</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ECHILD</span><span class="p">)</span>
<span class="w">        </span><span class="n">unix_error</span><span class="p">(</span><span class="s">&quot;waitpid error&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">Sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="å¯ç§»æ¤çš„ä¿¡å·å¤„ç†">å¯ç§»æ¤çš„ä¿¡å·å¤„ç†<a class="headerlink" href="#å¯ç§»æ¤çš„ä¿¡å·å¤„ç†" title="Permanent link">&para;</a></h4>
<p>ä¸åŒçš„ç³»ç»Ÿæœ‰ç€ä¸åŒçš„ä¿¡å·å¤„ç†è¯­ä¹‰ï¼Œå› æ­¤ Posix æ ‡å‡†å®šä¹‰äº†<code>sigaction</code>å‡½æ•°ï¼Œå®ƒå…è®¸ç”¨æˆ·åœ¨å®‰è£…ä¿¡å·å¤„ç†ç¨‹åºæ—¶æ˜ç¡®åœ°æŒ‡å®šä»–ä»¬æƒ³è¦çš„è¯­ä¹‰ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;signal.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">sigaction</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">signum</span><span class="p">,</span><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">sigaction</span><span class="w"> </span><span class="o">*</span><span class="n">act</span><span class="p">,</span>
<span class="w">              </span><span class="k">struct</span><span class="w"> </span><span class="nc">sigaction</span><span class="w"> </span><span class="o">*</span><span class="n">oldact</span><span class="p">);</span>
<span class="c1">// Returns: 0 if OK, âˆ’1 on error</span>
</code></pre></div>
<p>ç„¶è€Œ<code>sigaction</code>å‡½æ•°ååˆ†ç¬¨é‡ï¼Œå› æ­¤æˆ‘ä»¬å¸¸ä½¿ç”¨å®ƒçš„åŒ…è£…å‡½æ•°<code>Signal</code>ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="n">handler_t</span><span class="w"> </span><span class="o">*</span><span class="nf">Signal</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">signum</span><span class="p">,</span><span class="w"> </span><span class="n">handler_t</span><span class="w"> </span><span class="o">*</span><span class="n">handler</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">sigaction</span><span class="w"> </span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">old_action</span><span class="p">;</span>
<span class="w">    </span><span class="n">action</span><span class="p">.</span><span class="n">sa_handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handler</span><span class="p">;</span>
<span class="w">    </span><span class="n">sigemptyset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">action</span><span class="p">.</span><span class="n">sa_mask</span><span class="p">);</span><span class="w"> </span><span class="cm">/* Block sigs of type being handled */</span>
<span class="w">    </span><span class="n">action</span><span class="p">.</span><span class="n">sa_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SA_RESTART</span><span class="p">;</span><span class="w"> </span><span class="cm">/* Restart syscalls if possible */</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sigaction</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">old_action</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="n">unix_error</span><span class="p">(</span><span class="s">&quot;Signal error&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">old_action</span><span class="p">.</span><span class="n">sa_handler</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="é¿å…å¹¶å‘é”™è¯¯">é¿å…å¹¶å‘é”™è¯¯<a class="headerlink" href="#é¿å…å¹¶å‘é”™è¯¯" title="Permanent link">&para;</a></h3>
<p>ä¸Šæ–‡æåˆ°ï¼Œæˆ‘ä»¬æ°¸è¿œæ— æ³•é¢„æµ‹ä¸¤ä¸ªåŒæ­¥ï¼ˆå¹¶å‘ï¼‰è¿è¡Œçš„å‡½æ•°çš„è°ƒç”¨é¡ºåºã€‚å¦‚æœè°ƒç”¨é¡ºåºä¼šå½±å“ç»“æœçš„æ­£ç¡®æ€§ï¼Œé‚£ä¹ˆè¿™ç§é”™è¯¯å°±è¢«ç§°ä¸ºç«äº‰ï¼ˆRaceï¼‰ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é˜»å¡ç›¸å…³ä¿¡å·æ¥é¿å…è¿™ä¸€é—®é¢˜ã€‚</p>
<h3 id="æ˜¾å¼ç­‰å¾…ä¿¡å·">æ˜¾å¼ç­‰å¾…ä¿¡å·<a class="headerlink" href="#æ˜¾å¼ç­‰å¾…ä¿¡å·" title="Permanent link">&para;</a></h3>
<p>æœ‰æ—¶å€™ä¸»ç¨‹åºéœ€è¦æ˜¾å¼ç­‰å¾…æŸä¸ªä¿¡å·å¤„ç†ç¨‹åºè¿è¡Œå®Œæ¯•ã€‚ä¾‹å¦‚ Linux Shell åˆ›å»ºå‰å°ä»»åŠ¡åï¼Œå¿…é¡»ç­‰å¾…ä»»åŠ¡ç»ˆæ­¢å¹¶è¢« SIGCHLD å¤„ç†ç¨‹åºå›æ”¶ï¼Œç„¶åæ‰èƒ½æ¥æ”¶ä¸‹ä¸€æ¡ç”¨æˆ·å‘½ä»¤ã€‚ç¤ºä¾‹ç¨‹åºå±•ç¤ºäº†å…¶åŸºæœ¬æ€æƒ³ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;csapp.h&quot;</span>

<span class="k">volatile</span><span class="w"> </span><span class="kt">sig_atomic_t</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">sigchld_handler</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">olderrno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">errno</span><span class="p">;</span>
<span class="w">    </span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">waitpid</span><span class="p">(</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">errno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">olderrno</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">sigint_handler</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">sigset_t</span><span class="w"> </span><span class="n">mask</span><span class="p">,</span><span class="w"> </span><span class="n">prev</span><span class="p">;</span>
<span class="w">    </span><span class="n">Signal</span><span class="p">(</span><span class="n">SIGCHLD</span><span class="p">,</span><span class="w"> </span><span class="n">sigchld_handler</span><span class="p">);</span>
<span class="w">    </span><span class="n">Signal</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span><span class="w"> </span><span class="n">sigint_handler</span><span class="p">);</span>
<span class="w">    </span><span class="n">Sigemptyset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mask</span><span class="p">);</span>
<span class="w">    </span><span class="n">Sigaddset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mask</span><span class="p">,</span><span class="w"> </span><span class="n">SIGCHLD</span><span class="p">);</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Sigprocmask</span><span class="p">(</span><span class="n">SIG_BLOCK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mask</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">prev</span><span class="p">);</span><span class="w"> </span><span class="cm">/* Block SIGCHLD */</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Fork</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">                      </span><span class="cm">/* Child */</span>
<span class="w">            </span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="cm">/* Parent */</span>
<span class="w">        </span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="n">Sigprocmask</span><span class="p">(</span><span class="n">SIG_SETMASK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">prev</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"> </span><span class="cm">/* Unblock SIGCHLD */</span>
<span class="w">        </span><span class="cm">/* Wait for SIGCHLD to be received (wasteful) */</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">pid</span><span class="p">)</span>
<span class="w">            </span><span class="p">;</span>
<span class="w">        </span><span class="cm">/* Do some work after receiving SIGCHLD */</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>çˆ¶è¿›ç¨‹å…ˆä¸ºä¿¡å· SIGCHLD å’Œ SIGINT å®‰è£…å¤„ç†ç¨‹åºï¼Œç„¶ååˆ›å»ºå­è¿›ç¨‹å¹¶å°†å…¨å±€å˜é‡<code>pid</code>è®¾ä¸º 0ï¼Œæœ€åè¿›å…¥è‡ªæ—‹å¾ªç¯ï¼ˆ<code>while (!pid)</code>ï¼‰ã€‚å­è¿›ç¨‹ç»ˆæ­¢åï¼Œ<code>pid</code>å˜ä¸ºé 0ï¼Œäºæ˜¯çˆ¶è¿›ç¨‹é€€å‡ºè‡ªæ—‹å¾ªç¯ã€‚ä¸ºäº†é˜²æ­¢çˆ¶è¿›ç¨‹è¿›å…¥è‡ªæ—‹å¾ªç¯å‰æ¥æ”¶åˆ° SIGCHLD ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åˆ›å»ºå­è¿›ç¨‹ä¹‹å‰é˜»å¡è¯¥ä¿¡å·ã€‚</p>
<p>è¿™æ®µä»£ç æ˜¯æ­£ç¡®çš„ï¼Œä½†è‡ªæ—‹å¾ªç¯ä¼šæµªè´¹å¤„ç†å™¨èµ„æºã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶æ”¹ä¸ºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">pid</span><span class="p">)</span><span class="w"> </span><span class="cm">/* Race! */</span>
<span class="w">    </span><span class="n">pause</span><span class="p">();</span>
</code></pre></div>
<p>é—®é¢˜åœ¨äºï¼šå¦‚æœçˆ¶è¿›ç¨‹åœ¨ While çš„æ¡ä»¶æµ‹è¯•ä¹‹åè€Œ<code>pause</code>çš„æ‰§è¡Œä¹‹å‰æ¥æ”¶åˆ° SIGCHLDï¼Œé‚£ä¹ˆç¨‹åºå°±ä¼šæ°¸è¿œä¼‘çœ ã€‚æˆ‘ä»¬è¿˜å¯ä»¥å°†<code>pause</code>æ”¹ä¸º<code>sleep</code>ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">pid</span><span class="p">)</span><span class="w"> </span><span class="cm">/* Too slow! */</span>
<span class="w">    </span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div>
<p>è¿™æ ·è™½ç„¶é¿å…äº†ç«äº‰é—®é¢˜ï¼Œä½†ä¼šå¢åŠ ç¨‹åºçš„è¿è¡Œæ—¶é—´ã€‚æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆæ˜¯è°ƒç”¨å‡½æ•°<code>sigsuspend</code>ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;signal.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">sigsuspend</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">sigset_t</span><span class="w"> </span><span class="o">*</span><span class="n">mask</span><span class="p">);</span>
<span class="c1">// Returns: -1</span>
</code></pre></div>
<p>è¯¥å‡½æ•°ä½¿ç”¨å‚æ•°<code>mask</code>æ›¿æ¢å½“å‰çš„é˜»å¡ä¿¡å·é›†åˆï¼Œç„¶åæš‚åœè¿›ç¨‹ç›´è‡³å…¶æ¥æ”¶ä¿¡å·ã€‚å¦‚æœè¯¥ä¿¡å·çš„åŠ¨ä½œæ˜¯ç»ˆæ­¢è¿›ç¨‹ï¼Œåˆ™è¿›ç¨‹ç»ˆæ­¢ä¸”ä¸ä»<code>sigsuspend</code>è¿”å›ï¼›å¦‚æœè¯¥ä¿¡å·çš„åŠ¨ä½œæ˜¯è¿è¡Œä¸€ä¸ªå¤„ç†ç¨‹åºï¼Œåˆ™<code>sigsuspend</code>åœ¨å¤„ç†ç¨‹åºè¿”å›åè¿”å›ï¼Œå¹¶å°†é˜»å¡ä¿¡å·é›†åˆçš„çŠ¶æ€æ¢å¤ã€‚</p>
<p>å®é™…ä¸Šå®ƒç­‰æ•ˆäºä¸‹åˆ—å‡½æ•°ç»„åˆçš„åŸå­æ€§ï¼ˆAtomicï¼Œå³ä¸å¯ä¸­æ–­ï¼‰ç‰ˆæœ¬ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="n">sigprocmask</span><span class="p">(</span><span class="n">SIG_SETMASK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mask</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">prev</span><span class="p">);</span>
<span class="n">pause</span><span class="p">();</span>
<span class="n">sigprocmask</span><span class="p">(</span><span class="n">SIG_SETMASK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">prev</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
</code></pre></div>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥å°†ç¤ºä¾‹å‡½æ•°ä¿®æ”¹ä¸ºï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Sigprocmask</span><span class="p">(</span><span class="n">SIG_BLOCK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mask</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">prev</span><span class="p">);</span><span class="w"> </span><span class="cm">/* Block SIGCHLD */</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Fork</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w">                      </span><span class="cm">/* Child */</span>
<span class="w">        </span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/* Wait for SIGCHLD to be received */</span>
<span class="w">    </span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">pid</span><span class="p">)</span>
<span class="w">        </span><span class="n">sigsuspend</span><span class="p">(</span><span class="o">&amp;</span><span class="n">prev</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/* Optionally unblock SIGCHLD */</span>
<span class="w">    </span><span class="n">Sigprocmask</span><span class="p">(</span><span class="n">SIG_SETMASK</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">prev</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/* Do some work after receiving SIGCHLD */</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="éæœ¬åœ°è·³è½¬">éæœ¬åœ°è·³è½¬<a class="headerlink" href="#éæœ¬åœ°è·³è½¬" title="Permanent link">&para;</a></h2>
<p>C æä¾›äº†ä¸€ç§ç”¨æˆ·çº§åˆ«çš„å¼‚å¸¸æ§åˆ¶æµï¼Œå³éæœ¬åœ°è·³è½¬ï¼ˆNonlocal Jumpï¼‰ã€‚å®ƒæ— éœ€å®Œæˆæ­£å¸¸çš„è°ƒç”¨/è¿”å›åºåˆ—ï¼Œå°±å¯ä»¥å°†æ§åˆ¶æƒä»ä¸€ä¸ªå‡½æ•°ç›´æ¥è½¬ç§»åˆ°å¦ä¸€ä¸ªå½“å‰æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°ã€‚éæœ¬åœ°è·³è½¬æ˜¯é€šè¿‡<code>setjmp</code>å’Œ<code>longjmp</code>å‡½æ•°å®ç°çš„ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;setjmp.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">setjmp</span><span class="p">(</span><span class="kt">jmp_buf</span><span class="w"> </span><span class="n">env</span><span class="p">);</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">sigsetjmp</span><span class="p">(</span><span class="n">sigjmp_buf</span><span class="w"> </span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">savesigs</span><span class="p">);</span>
<span class="c1">// Returns: 0 from setjmp, nonzero from longjmps</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">longjmp</span><span class="p">(</span><span class="kt">jmp_buf</span><span class="w"> </span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">siglongjmp</span><span class="p">(</span><span class="n">sigjmp_buf</span><span class="w"> </span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">retval</span><span class="p">);</span>
<span class="c1">// Never returns</span>
</code></pre></div>
<p><code>setjmp</code>å‡½æ•°å°†å½“å‰è°ƒç”¨ç¯å¢ƒï¼ˆCalling Environmentï¼ŒåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ã€æ ˆæŒ‡é’ˆå’Œé€šç”¨å¯„å­˜å™¨ç­‰ï¼‰ï¼Œä¿å­˜åœ¨å‚æ•°<code>env</code>æŒ‡å®šçš„ç¼“å†²åŒºä¸­å¹¶è¿”å› 0ã€‚<code>longjmp</code>å‡½æ•°ä¼šä»<code>env</code>ç¼“å†²åŒºæ¢å¤è°ƒç”¨ç¯å¢ƒï¼Œç„¶åè§¦å‘æœ€è¿‘è°ƒç”¨çš„<code>setjmp</code>å‡½æ•°çš„è¿”å›ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>setjmp</code>ä¼šè¿”å›ä¸€ä¸ªéé›¶å€¼<code>retval</code>ã€‚åœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>sigsetjmp</code>å’Œ<code>siglongjmp</code>ä»£æ›¿å®ƒä»¬ã€‚</p>
<p>éå±€éƒ¨è·³è½¬çš„ä¸€ä¸ªé‡è¦åº”ç”¨æ˜¯å¯ä»¥åœ¨æ£€æµ‹åˆ°æŸäº›é”™è¯¯æ¡ä»¶æ—¶ï¼Œä»æ·±åº¦åµŒå¥—çš„å‡½æ•°è°ƒç”¨ä¸­ç«‹å³è¿”å›ã€‚æˆ‘ä»¬ä½¿ç”¨éæœ¬åœ°è·³è½¬ç›´æ¥è¿”å›åˆ°å¸¸è§çš„é”™è¯¯å¤„ç†ç¨‹åºï¼Œæ— éœ€è´¹åŠ›åœ°å±•å¼€æ ˆï¼ˆUnwind Stackï¼‰ã€‚</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;csapp.h&quot;</span>

<span class="kt">jmp_buf</span><span class="w"> </span><span class="n">buf</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="n">error1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span><span class="w"> </span><span class="n">error2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">void</span><span class="p">),</span><span class="w"> </span><span class="n">bar</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">setjmp</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>
<span class="w">        </span><span class="n">foo</span><span class="p">();</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Detected an error1 condition in foo</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Detected an error2 condition in foo</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">default</span><span class="o">:</span>
<span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Unknown error condition in foo</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Deeply nested function foo */</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">error1</span><span class="p">)</span>
<span class="w">        </span><span class="n">longjmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="n">bar</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">bar</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">error2</span><span class="p">)</span>
<span class="w">        </span><span class="n">longjmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>ç¤ºä¾‹ç¨‹åºä¸­ä¸»å‡½æ•°é¦–å…ˆè°ƒç”¨<code>setjmp</code>ä¿å­˜å½“å‰è°ƒç”¨ç¯å¢ƒï¼Œç„¶åä¾æ¬¡è°ƒç”¨å‡½æ•°<code>foo</code>å’Œ<code>bar</code>ã€‚ ä¸€æ—¦å‡½æ•°æ‰§è¡Œå‘ç”Ÿé”™è¯¯ï¼Œå®ƒä»¬ä¼šç«‹å³é€šè¿‡<code>longjmp</code>ä»<code>setjmp</code>è¿”å›ã€‚<code>setjmp</code>çš„éé›¶è¿”å›å€¼è¡¨ç¤ºé”™è¯¯çš„ç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨ä»£ç ä¸­çš„æŸå¤„å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚</p>
<p>éå±€éƒ¨è·³è½¬çš„å¦ä¸€ä¸ªé‡è¦åº”ç”¨æ˜¯ä»ä¿¡å·å¤„ç†ç¨‹åºè·³è½¬åˆ°ç‰¹å®šä»£ç ä½ç½®ï¼Œè€Œä¸æ˜¯åƒå¾€å¸¸é‚£æ ·è¿”å›åˆ°å› ä¿¡å·ä¸­æ–­çš„æŒ‡ä»¤ã€‚</p>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="æœ€åæ›´æ–°">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-08-09T13:17:58+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-08-09</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="åˆ›å»ºæ—¥æœŸ">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-08-09T13:17:58+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-08-09</span>
  </span>

    
    
    
  </aside>


  



<div id="__comments">

<h3>é¢œè‰²ä¸»é¢˜è°ƒæ•´</h3>

<!-- <div class="tx-switch">
<button data-md-color-scheme="default"><code>default</code></button>
<button data-md-color-scheme="slate"><code>slate</code></button>
</div>

<script>
var buttons = document.querySelectorAll("button[data-md-color-scheme]")
buttons.forEach(function(button) {
        button.addEventListener("click", function() {
        var attr = this.getAttribute("data-md-color-scheme")
        document.body.setAttribute("data-md-color-scheme", attr)
        localStorage.setItem("data-md-color-scheme",attr);
        updateScheme();
        })
})
</script> -->

<div class="tx-switch">
<button class="button1" data-md-color-primary="red" style="background-color:red">red</button>
<button class="button1" data-md-color-primary="pink" style="background-color:pink;color:black">pink</button>
<button class="button1" data-md-color-primary="purple" style="background-color:purple">purple</button>
<button class="button1" data-md-color-primary="indigo" style="background-color:indigo">indigo</button>
<button class="button1" data-md-color-primary="blue" style="background-color:blue">blue</button>
<button class="button1" data-md-color-primary="cyan" style="background-color:cyan;color:black">cyan</button>
<button class="button1" data-md-color-primary="teal" style="background-color:teal">teal</button>
<button class="button1" data-md-color-primary="green" style="background-color:green">green</button>
<button class="button1" data-md-color-primary="lime" style="background-color:lime;color:black">lime</button>
<button class="button1" data-md-color-primary="orange" style="background-color:orange;color:black">orange</button>
<button class="button1" data-md-color-primary="brown" style="background-color:brown;border-radius=3px">brown</button>
<button class="button1" data-md-color-primary="grey" style="background-color:grey">grey</button>
<button class="button1" data-md-color-primary="black" style="background-color:black">black</button>
<button class="button1" data-md-color-primary="white" style="background-color:white;color:black">white</button>
</div>

<script>
var buttons = document.querySelectorAll("button[data-md-color-primary]")
buttons.forEach(function(button) {
        button.addEventListener("click", function() {
        var attr = this.getAttribute("data-md-color-primary")
        document.body.setAttribute("data-md-color-primary", attr)
        localStorage.setItem("data-md-color-primary",attr);
        })
})
</script>

<h2 ><!-- è¯„è®º -->è¯„è®ºåŒº~</h2>

æœ‰ç”¨çš„è¯è¯·ç»™æˆ‘ä¸ªèµå’Œ star => <a href="https://github.com/Tangjp-wraith/Tangjp-wraith.github.io"><img alt="GitHub stars" src="https://img.shields.io/github/stars/Tangjp-wraith/Tangjp-wraith.github.io.svg?style=plastic&amp;label=Stars"></a>

</br>

å¿«æ¥è·Ÿæˆ‘èŠå¤©~

</div>

<script src="https://giscus.app/client.js" data-repo="Tangjp-wraith/discussion" data-repo-id="R_kgDOLRJCPw"
    data-category="General" data-category-id="DIC_kwDOLRJCP84CdJdO" data-mapping="pathname" data-strict="0"
    data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="dark" data-lang="zh-CN"
    crossorigin="anonymous" async>
    </script>

<!-- Synchronize Giscus theme with palette -->
<script>
var giscus = document.querySelector("script[src*=giscus]")

/* Set palette on initial load */
var palette = __md_get("__palette")
if (palette && typeof palette.color === "object") {
    var theme = palette.color.scheme === "slate" ? "dark" : "light"
    giscus.setAttribute("data-theme", theme) 
}

/* Register event handlers after documented loaded */
document.addEventListener("DOMContentLoaded", function() {
    var ref = document.querySelector("[data-md-component=palette]")
    ref.addEventListener("change", function() {
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate" ? "dark" : "light"
        localStorage.setItem("data-md-color-scheme", palette.color.scheme === "slate" ? "slate" : "default");
        /* Instruct Giscus to change theme */
        var frame = document.querySelector(".giscus-frame")
        frame.contentWindow.postMessage(
        { giscus: { setConfig: { theme } } },
        "https://giscus.app"
        )
    }
    })
})
</script>
                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  å›åˆ°é¡µé¢é¡¶éƒ¨
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      æœ¬é¡µé¢çš„å…¨éƒ¨å†…å®¹åœ¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh">CC BY-SA 4.0</a> å’Œ <a href="https://github.com/zTrix/sata-license">SATA</a> åè®®ä¹‹æ¡æ¬¾ä¸‹æä¾›ï¼Œé™„åŠ æ¡æ¬¾äº¦å¯èƒ½åº”ç”¨
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "content.code.annotate", "navigation.indexes", "navigation.top", "toc.follow"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="../../../js/timeago.min.js"></script>
      
        <script src="../../../js/timeago_mkdocs_material.js"></script>
      
        <script src="../../../from_oi_wiki/js/extra.js"></script>
      
        <script src="../../../js/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../../js/tablesort.js"></script>
      
        <script src="../../../termynal.js"></script>
      
    
  </body>
</html>