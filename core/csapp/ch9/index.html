
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://tang-jiapeng.github.io/core/csapp/ch9/">
      
      
        <link rel="prev" href="../ch8/">
      
      
        <link rel="next" href="../ch10/">
      
      
      <link rel="icon" href="../../../logo.ico">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>Chapter9ï¼šè™šæ‹Ÿå†…å­˜ - 0X10CC's notes</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Serif SC";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/timeago.css">
    
      <link rel="stylesheet" href="../../../from_oi_wiki/css/extra.css?v=13">
    
      <link rel="stylesheet" href="../../../css/status.css">
    
      <link rel="stylesheet" href="../../../css/neoteroi-mkdocs.css">
    
      <link rel="stylesheet" href="../../../termynal.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-JT9BRCXKJJ"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-JT9BRCXKJJ",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-JT9BRCXKJJ",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#è™šæ‹Ÿå†…å­˜" class="md-skip">
          è·³è½¬è‡³
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="é¡µçœ‰">
    <a href="../../.." title="0X10CC&#39;s notes" class="md-header__button md-logo" aria-label="0X10CC's notes" data-md-component="logo">
      
  <img src="../../../logo.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            0X10CC's notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter9ï¼šè™šæ‹Ÿå†…å­˜
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="æœç´¢" placeholder="æœç´¢" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="æŸ¥æ‰¾">
        
        <button type="reset" class="md-search__icon md-icon" title="æ¸…ç©ºå½“å‰å†…å®¹" aria-label="æ¸…ç©ºå½“å‰å†…å®¹" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            æ­£åœ¨åˆå§‹åŒ–æœç´¢å¼•æ“
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/tang-jiapeng/tang-jiapeng.github.io" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    tang-jiapeng.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="æ ‡ç­¾" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
    
  
  ğŸ¡ Home

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../langs/" class="md-tabs__link">
          
  
    
  
  Langs

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
    
  
  Core

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../tools/" class="md-tabs__link">
          
  
    
  
  Tools

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../life/" class="md-tabs__link">
          
  
    
  
  Life

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="å¯¼èˆªæ " data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="0X10CC&#39;s notes" class="md-nav__button md-logo" aria-label="0X10CC's notes" data-md-component="logo">
      
  <img src="../../../logo.ico" alt="logo">

    </a>
    0X10CC's notes
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/tang-jiapeng/tang-jiapeng.github.io" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    tang-jiapeng.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../.." class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    ğŸ¡ Home
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            ğŸ¡ Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../langs/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Langs
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Langs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    C++é›¶ç¢æ‚è®°
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            C++é›¶ç¢æ‚è®°
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/%E9%A1%B6%E5%B1%82const%E4%B8%8E%E5%BA%95%E5%B1%82const/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    é¡¶å±‚constä¸åº•å±‚const
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/%E5%80%BC%E7%B1%BB%E5%9E%8B%E4%B8%8E%E5%8F%B3%E5%80%BC%E5%BC%95%E7%94%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    å€¼ç±»å‹ä¸å³å€¼å¼•ç”¨
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/%E6%95%B0%E7%BB%84%E6%8C%87%E9%92%88%E4%B8%8E%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    æ•°ç»„æŒ‡é’ˆä¸å‡½æ•°æŒ‡é’ˆ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/C%2B%2B%E7%B1%BB%E5%AF%B9%E8%B1%A1%E5%B8%83%E5%B1%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++ç±»å¯¹è±¡å¸ƒå±€
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/%E9%9B%B6%E7%A2%8E%E6%9D%82%E8%AE%B0/C%2B%2B%E4%B8%AD%E7%9A%84%E5%A4%9A%E6%80%81%E4%B8%8ERTTI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++ä¸­çš„å¤šæ€ä¸RTTI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Effective Modern C++
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Effective Modern C++
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item1ï¼šç†è§£æ¨¡æ¿ç±»å‹æ¨å¯¼
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item2ï¼šç†è§£autoç±»å‹æ¨å¯¼
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item3ï¼šç†è§£decltype
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item7ï¼šåŒºåˆ«ä½¿ç”¨()å’Œ{}åˆ›å»ºå¯¹è±¡
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item9/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item9ï¼šä¼˜å…ˆè€ƒè™‘åˆ«åå£°æ˜è€Œétypedef
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../langs/cpp/effective/item23/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    item23ï¼šç†è§£std::moveå’Œstd::forward
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Core
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CMU15-213ï¼šCSAPP
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            CMU15-213ï¼šCSAPP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter1ï¼šè®¡ç®—æœºç³»ç»Ÿæ¼«æ¸¸
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter2ï¼šä¿¡æ¯çš„è¡¨ç¤ºå’Œå¤„ç†
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter3ï¼šç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter4ï¼šå¤„ç†å™¨ä½“ç³»ç»“æ„
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter5ï¼šä¼˜åŒ–ç¨‹åºæ€§èƒ½
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter6ï¼šå­˜å‚¨å™¨å±‚æ¬¡ç»“æ„
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter7ï¼šé“¾æ¥
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter8ï¼šå¼‚å¸¸æ§åˆ¶æµ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Chapter9ï¼šè™šæ‹Ÿå†…å­˜
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Chapter9ï¼šè™šæ‹Ÿå†…å­˜
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="ç›®å½•">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ç‰©ç†å¯»å€ä¸è™šæ‹Ÿå¯»å€" class="md-nav__link">
    <span class="md-ellipsis">
      ç‰©ç†å¯»å€ä¸è™šæ‹Ÿå¯»å€
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#åœ°å€ç©ºé—´" class="md-nav__link">
    <span class="md-ellipsis">
      åœ°å€ç©ºé—´
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#è™šæ‹Ÿå†…å­˜ä½œä¸ºç¼“å­˜çš„å·¥å…·" class="md-nav__link">
    <span class="md-ellipsis">
      è™šæ‹Ÿå†…å­˜ä½œä¸ºç¼“å­˜çš„å·¥å…·
    </span>
  </a>
  
    <nav class="md-nav" aria-label="è™šæ‹Ÿå†…å­˜ä½œä¸ºç¼“å­˜çš„å·¥å…·">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dram-ç¼“å­˜" class="md-nav__link">
    <span class="md-ellipsis">
      DRAM ç¼“å­˜
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#é¡µè¡¨" class="md-nav__link">
    <span class="md-ellipsis">
      é¡µè¡¨
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ç¼ºé¡µæ•…éšœ" class="md-nav__link">
    <span class="md-ellipsis">
      ç¼ºé¡µæ•…éšœ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#åˆ†é…é¡µé¢" class="md-nav__link">
    <span class="md-ellipsis">
      åˆ†é…é¡µé¢
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#è™šæ‹Ÿå†…å­˜ä½œä¸ºå†…å­˜ç®¡ç†çš„å·¥å…·" class="md-nav__link">
    <span class="md-ellipsis">
      è™šæ‹Ÿå†…å­˜ä½œä¸ºå†…å­˜ç®¡ç†çš„å·¥å…·
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#è™šæ‹Ÿå†…å­˜ä½œä¸ºå†…å­˜ä¿æŠ¤çš„å·¥å…·" class="md-nav__link">
    <span class="md-ellipsis">
      è™šæ‹Ÿå†…å­˜ä½œä¸ºå†…å­˜ä¿æŠ¤çš„å·¥å…·
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#åœ°å€è½¬æ¢" class="md-nav__link">
    <span class="md-ellipsis">
      åœ°å€è½¬æ¢
    </span>
  </a>
  
    <nav class="md-nav" aria-label="åœ°å€è½¬æ¢">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#é«˜é€Ÿç¼“å­˜ä¸è™šæ‹Ÿå†…å­˜" class="md-nav__link">
    <span class="md-ellipsis">
      é«˜é€Ÿç¼“å­˜ä¸è™šæ‹Ÿå†…å­˜
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä½¿ç”¨-tlb-åŠ é€Ÿåœ°å€è½¬æ¢" class="md-nav__link">
    <span class="md-ellipsis">
      ä½¿ç”¨ TLB åŠ é€Ÿåœ°å€è½¬æ¢
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¤šçº§é¡µè¡¨" class="md-nav__link">
    <span class="md-ellipsis">
      å¤šçº§é¡µè¡¨
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intel-core-i7linux-å†…å­˜ç³»ç»Ÿ" class="md-nav__link">
    <span class="md-ellipsis">
      Intel Core i7/Linux å†…å­˜ç³»ç»Ÿ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Intel Core i7/Linux å†…å­˜ç³»ç»Ÿ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-i7-åœ°å€è½¬æ¢" class="md-nav__link">
    <span class="md-ellipsis">
      Core i7 åœ°å€è½¬æ¢
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-è™šæ‹Ÿå†…å­˜ç³»ç»Ÿ" class="md-nav__link">
    <span class="md-ellipsis">
      Linux è™šæ‹Ÿå†…å­˜ç³»ç»Ÿ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#å†…å­˜æ˜ å°„" class="md-nav__link">
    <span class="md-ellipsis">
      å†…å­˜æ˜ å°„
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å†…å­˜æ˜ å°„">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#å›çœ‹å…±äº«ç›®æ ‡æ–‡ä»¶" class="md-nav__link">
    <span class="md-ellipsis">
      å›çœ‹å…±äº«ç›®æ ‡æ–‡ä»¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å›çœ‹-fork-å‡½æ•°" class="md-nav__link">
    <span class="md-ellipsis">
      å›çœ‹ fork å‡½æ•°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å›çœ‹-execve-å‡½æ•°" class="md-nav__link">
    <span class="md-ellipsis">
      å›çœ‹ execve å‡½æ•°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mmap-å‡½æ•°" class="md-nav__link">
    <span class="md-ellipsis">
      mmap å‡½æ•°
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#åŠ¨æ€å†…å­˜åˆ†é…" class="md-nav__link">
    <span class="md-ellipsis">
      åŠ¨æ€å†…å­˜åˆ†é…
    </span>
  </a>
  
    <nav class="md-nav" aria-label="åŠ¨æ€å†…å­˜åˆ†é…">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#malloc-å’Œ-free-å‡½æ•°" class="md-nav__link">
    <span class="md-ellipsis">
      malloc å’Œ free å‡½æ•°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#åŠ¨æ€å†…å­˜åˆ†é…çš„åŸå› " class="md-nav__link">
    <span class="md-ellipsis">
      åŠ¨æ€å†…å­˜åˆ†é…çš„åŸå› 
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¯¹åˆ†é…å™¨çš„è¦æ±‚å’Œç›®æ ‡" class="md-nav__link">
    <span class="md-ellipsis">
      å¯¹åˆ†é…å™¨çš„è¦æ±‚å’Œç›®æ ‡
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ç¢ç‰‡" class="md-nav__link">
    <span class="md-ellipsis">
      ç¢ç‰‡
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#åˆ†é…å™¨çš„å®ç°éš¾ç‚¹" class="md-nav__link">
    <span class="md-ellipsis">
      åˆ†é…å™¨çš„å®ç°éš¾ç‚¹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#éšå¼ç©ºé—²é“¾è¡¨" class="md-nav__link">
    <span class="md-ellipsis">
      éšå¼ç©ºé—²é“¾è¡¨
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ”¾ç½®æ–°åˆ†é…çš„-block" class="md-nav__link">
    <span class="md-ellipsis">
      æ”¾ç½®æ–°åˆ†é…çš„ Block
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#åˆ†å‰²ç©ºé—²çš„-block" class="md-nav__link">
    <span class="md-ellipsis">
      åˆ†å‰²ç©ºé—²çš„ Block
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#è·å–é¢å¤–çš„å †å†…å­˜" class="md-nav__link">
    <span class="md-ellipsis">
      è·å–é¢å¤–çš„å †å†…å­˜
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#åˆå¹¶ç©ºé—²çš„-block" class="md-nav__link">
    <span class="md-ellipsis">
      åˆå¹¶ç©ºé—²çš„ Block
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä½¿ç”¨è¾¹ç•Œæ ‡è®°åˆå¹¶-block" class="md-nav__link">
    <span class="md-ellipsis">
      ä½¿ç”¨è¾¹ç•Œæ ‡è®°åˆå¹¶ Block
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ˜¾å¼ç©ºé—²é“¾è¡¨" class="md-nav__link">
    <span class="md-ellipsis">
      æ˜¾å¼ç©ºé—²é“¾è¡¨
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#åˆ†ç¦»å¼ç©ºé—²é“¾è¡¨" class="md-nav__link">
    <span class="md-ellipsis">
      åˆ†ç¦»å¼ç©ºé—²é“¾è¡¨
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#åƒåœ¾å›æ”¶" class="md-nav__link">
    <span class="md-ellipsis">
      åƒåœ¾å›æ”¶
    </span>
  </a>
  
    <nav class="md-nav" aria-label="åƒåœ¾å›æ”¶">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#åŸºæœ¬æ€æƒ³" class="md-nav__link">
    <span class="md-ellipsis">
      åŸºæœ¬æ€æƒ³
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marksweep-ç®—æ³•" class="md-nav__link">
    <span class="md-ellipsis">
      Mark&amp;Sweep ç®—æ³•
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch10/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter10ï¼šç³»ç»Ÿçº§I/O
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter11ï¼šç½‘ç»œç¼–ç¨‹
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ch12/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter12ï¼šå¹¶å‘ç¼–ç¨‹
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CMU10-714ï¼šDeep Learning Systems
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            CMU10-714ï¼šDeep Learning Systems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture2ï¼šML Refresher / Softmax Regression
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture3ï¼šManual Neural Networks / Backprop
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture4ï¼šAutomatic Differentiation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture5ï¼šAutomatic Differentiation Implementation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cmu10-714/lecture6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lecture6ï¼šOptimization
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../tools/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Tools
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../life/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Life
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Life
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="ç›®å½•">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ç‰©ç†å¯»å€ä¸è™šæ‹Ÿå¯»å€" class="md-nav__link">
    <span class="md-ellipsis">
      ç‰©ç†å¯»å€ä¸è™šæ‹Ÿå¯»å€
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#åœ°å€ç©ºé—´" class="md-nav__link">
    <span class="md-ellipsis">
      åœ°å€ç©ºé—´
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#è™šæ‹Ÿå†…å­˜ä½œä¸ºç¼“å­˜çš„å·¥å…·" class="md-nav__link">
    <span class="md-ellipsis">
      è™šæ‹Ÿå†…å­˜ä½œä¸ºç¼“å­˜çš„å·¥å…·
    </span>
  </a>
  
    <nav class="md-nav" aria-label="è™šæ‹Ÿå†…å­˜ä½œä¸ºç¼“å­˜çš„å·¥å…·">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dram-ç¼“å­˜" class="md-nav__link">
    <span class="md-ellipsis">
      DRAM ç¼“å­˜
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#é¡µè¡¨" class="md-nav__link">
    <span class="md-ellipsis">
      é¡µè¡¨
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ç¼ºé¡µæ•…éšœ" class="md-nav__link">
    <span class="md-ellipsis">
      ç¼ºé¡µæ•…éšœ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#åˆ†é…é¡µé¢" class="md-nav__link">
    <span class="md-ellipsis">
      åˆ†é…é¡µé¢
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#è™šæ‹Ÿå†…å­˜ä½œä¸ºå†…å­˜ç®¡ç†çš„å·¥å…·" class="md-nav__link">
    <span class="md-ellipsis">
      è™šæ‹Ÿå†…å­˜ä½œä¸ºå†…å­˜ç®¡ç†çš„å·¥å…·
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#è™šæ‹Ÿå†…å­˜ä½œä¸ºå†…å­˜ä¿æŠ¤çš„å·¥å…·" class="md-nav__link">
    <span class="md-ellipsis">
      è™šæ‹Ÿå†…å­˜ä½œä¸ºå†…å­˜ä¿æŠ¤çš„å·¥å…·
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#åœ°å€è½¬æ¢" class="md-nav__link">
    <span class="md-ellipsis">
      åœ°å€è½¬æ¢
    </span>
  </a>
  
    <nav class="md-nav" aria-label="åœ°å€è½¬æ¢">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#é«˜é€Ÿç¼“å­˜ä¸è™šæ‹Ÿå†…å­˜" class="md-nav__link">
    <span class="md-ellipsis">
      é«˜é€Ÿç¼“å­˜ä¸è™šæ‹Ÿå†…å­˜
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä½¿ç”¨-tlb-åŠ é€Ÿåœ°å€è½¬æ¢" class="md-nav__link">
    <span class="md-ellipsis">
      ä½¿ç”¨ TLB åŠ é€Ÿåœ°å€è½¬æ¢
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¤šçº§é¡µè¡¨" class="md-nav__link">
    <span class="md-ellipsis">
      å¤šçº§é¡µè¡¨
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intel-core-i7linux-å†…å­˜ç³»ç»Ÿ" class="md-nav__link">
    <span class="md-ellipsis">
      Intel Core i7/Linux å†…å­˜ç³»ç»Ÿ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Intel Core i7/Linux å†…å­˜ç³»ç»Ÿ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-i7-åœ°å€è½¬æ¢" class="md-nav__link">
    <span class="md-ellipsis">
      Core i7 åœ°å€è½¬æ¢
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-è™šæ‹Ÿå†…å­˜ç³»ç»Ÿ" class="md-nav__link">
    <span class="md-ellipsis">
      Linux è™šæ‹Ÿå†…å­˜ç³»ç»Ÿ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#å†…å­˜æ˜ å°„" class="md-nav__link">
    <span class="md-ellipsis">
      å†…å­˜æ˜ å°„
    </span>
  </a>
  
    <nav class="md-nav" aria-label="å†…å­˜æ˜ å°„">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#å›çœ‹å…±äº«ç›®æ ‡æ–‡ä»¶" class="md-nav__link">
    <span class="md-ellipsis">
      å›çœ‹å…±äº«ç›®æ ‡æ–‡ä»¶
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å›çœ‹-fork-å‡½æ•°" class="md-nav__link">
    <span class="md-ellipsis">
      å›çœ‹ fork å‡½æ•°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å›çœ‹-execve-å‡½æ•°" class="md-nav__link">
    <span class="md-ellipsis">
      å›çœ‹ execve å‡½æ•°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mmap-å‡½æ•°" class="md-nav__link">
    <span class="md-ellipsis">
      mmap å‡½æ•°
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#åŠ¨æ€å†…å­˜åˆ†é…" class="md-nav__link">
    <span class="md-ellipsis">
      åŠ¨æ€å†…å­˜åˆ†é…
    </span>
  </a>
  
    <nav class="md-nav" aria-label="åŠ¨æ€å†…å­˜åˆ†é…">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#malloc-å’Œ-free-å‡½æ•°" class="md-nav__link">
    <span class="md-ellipsis">
      malloc å’Œ free å‡½æ•°
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#åŠ¨æ€å†…å­˜åˆ†é…çš„åŸå› " class="md-nav__link">
    <span class="md-ellipsis">
      åŠ¨æ€å†…å­˜åˆ†é…çš„åŸå› 
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#å¯¹åˆ†é…å™¨çš„è¦æ±‚å’Œç›®æ ‡" class="md-nav__link">
    <span class="md-ellipsis">
      å¯¹åˆ†é…å™¨çš„è¦æ±‚å’Œç›®æ ‡
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ç¢ç‰‡" class="md-nav__link">
    <span class="md-ellipsis">
      ç¢ç‰‡
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#åˆ†é…å™¨çš„å®ç°éš¾ç‚¹" class="md-nav__link">
    <span class="md-ellipsis">
      åˆ†é…å™¨çš„å®ç°éš¾ç‚¹
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#éšå¼ç©ºé—²é“¾è¡¨" class="md-nav__link">
    <span class="md-ellipsis">
      éšå¼ç©ºé—²é“¾è¡¨
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ”¾ç½®æ–°åˆ†é…çš„-block" class="md-nav__link">
    <span class="md-ellipsis">
      æ”¾ç½®æ–°åˆ†é…çš„ Block
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#åˆ†å‰²ç©ºé—²çš„-block" class="md-nav__link">
    <span class="md-ellipsis">
      åˆ†å‰²ç©ºé—²çš„ Block
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#è·å–é¢å¤–çš„å †å†…å­˜" class="md-nav__link">
    <span class="md-ellipsis">
      è·å–é¢å¤–çš„å †å†…å­˜
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#åˆå¹¶ç©ºé—²çš„-block" class="md-nav__link">
    <span class="md-ellipsis">
      åˆå¹¶ç©ºé—²çš„ Block
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ä½¿ç”¨è¾¹ç•Œæ ‡è®°åˆå¹¶-block" class="md-nav__link">
    <span class="md-ellipsis">
      ä½¿ç”¨è¾¹ç•Œæ ‡è®°åˆå¹¶ Block
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#æ˜¾å¼ç©ºé—²é“¾è¡¨" class="md-nav__link">
    <span class="md-ellipsis">
      æ˜¾å¼ç©ºé—²é“¾è¡¨
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#åˆ†ç¦»å¼ç©ºé—²é“¾è¡¨" class="md-nav__link">
    <span class="md-ellipsis">
      åˆ†ç¦»å¼ç©ºé—²é“¾è¡¨
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#åƒåœ¾å›æ”¶" class="md-nav__link">
    <span class="md-ellipsis">
      åƒåœ¾å›æ”¶
    </span>
  </a>
  
    <nav class="md-nav" aria-label="åƒåœ¾å›æ”¶">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#åŸºæœ¬æ€æƒ³" class="md-nav__link">
    <span class="md-ellipsis">
      åŸºæœ¬æ€æƒ³
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#marksweep-ç®—æ³•" class="md-nav__link">
    <span class="md-ellipsis">
      Mark&amp;Sweep ç®—æ³•
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="è™šæ‹Ÿå†…å­˜">è™šæ‹Ÿå†…å­˜<a class="headerlink" href="#è™šæ‹Ÿå†…å­˜" title="Permanent link">&para;</a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8V2m6.78 1a.69.69 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38-2.5-2.5Z"/></svg></span> çº¦ 10792 ä¸ªå­— <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6zm80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3z"/></svg></span> 45 è¡Œä»£ç  <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3L12.5 13Z"/></svg></span> é¢„è®¡é˜…è¯»æ—¶é—´ 37 åˆ†é’Ÿ</p>
</div>
<p>ä¸ºäº†æ›´åŠ æœ‰æ•ˆåœ°ç®¡ç†å†…å­˜å¹¶å‡å°‘é”™è¯¯çš„å‘ç”Ÿï¼Œç°ä»£ç³»ç»Ÿæä¾›äº†ä¸€ç§å¯¹ä¸»å­˜å‚¨å™¨çš„æŠ½è±¡ï¼Œå³è™šæ‹Ÿå†…å­˜ï¼ˆVirtual Memoryï¼ŒVMï¼‰ã€‚è™šæ‹Ÿå†…å­˜æ˜¯ç¡¬ä»¶å¼‚å¸¸ã€ç¡¬ä»¶åœ°å€è½¬æ¢ã€ä¸»å­˜å‚¨å™¨ã€ç£ç›˜æ–‡ä»¶å’Œå†…æ ¸è½¯ä»¶ä¹‹é—´çš„ä¼˜é›…äº¤äº’ï¼Œå®ƒä¸ºæ¯ä¸ªè¿›ç¨‹æä¾›äº†ä¸€ä¸ªå¤§çš„ã€ç»Ÿä¸€çš„å’Œç§æœ‰çš„åœ°å€ç©ºé—´ã€‚</p>
<p>è™šæ‹Ÿå†…å­˜æœ‰ä»¥ä¸‹ä¸‰ä¸ªé‡è¦åŠŸèƒ½ï¼š</p>
<ul>
<li>å°†ä¸»å­˜å‚¨å™¨ä½œä¸ºç£ç›˜çš„ç¼“å­˜ï¼Œåªä¿ç•™ä¸»å­˜ä¸­çš„æ´»è·ƒåŒºåŸŸå¹¶æ ¹æ®éœ€è¦ä¸æ–­åœ°åœ¨ä¸¤è€…ä¹‹é—´ä¼ è¾“æ•°æ®ï¼›</li>
<li>ä¸ºæ¯ä¸ªè¿›ç¨‹æä¾›ç»Ÿä¸€çš„åœ°å€ç©ºé—´ï¼Œä»è€Œç®€åŒ–å†…å­˜ç®¡ç†ï¼›</li>
<li>ä¿æŠ¤æ¯ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸è¢«å…¶ä»–è¿›ç¨‹æ‰€ç ´åã€‚</li>
</ul>
<h2 id="ç‰©ç†å¯»å€ä¸è™šæ‹Ÿå¯»å€">ç‰©ç†å¯»å€ä¸è™šæ‹Ÿå¯»å€<a class="headerlink" href="#ç‰©ç†å¯»å€ä¸è™šæ‹Ÿå¯»å€" title="Permanent link">&para;</a></h2>
<p>ä¸»å­˜ä¸­çš„æ¯ä¸ªå­—èŠ‚éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç‰©ç†åœ°å€ï¼ˆPhysical Addressï¼ŒPAï¼‰ï¼ŒCPU ä½¿ç”¨ç‰©ç†åœ°å€è®¿é—®å†…å­˜çš„æ–¹å¼è¢«ç§°ä¸ºç‰©ç†å¯»å€ï¼ˆPhysical Addressingï¼‰ï¼š</p>
<p><img alt="alt text" src="../image/image-107.png" /></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒCPU ç”Ÿæˆäº†ä¸€ä¸ªæœ‰æ•ˆçš„ç‰©ç†åœ°å€å¹¶é€šè¿‡å­˜å‚¨å™¨æ€»çº¿ä¼ é€’ç»™ä¸»å­˜å‚¨å™¨ï¼Œè¯¦è§ <strong>è®¿é—®ä¸»å­˜å‚¨å™¨</strong>ã€‚</p>
<p>CPU ä¹Ÿå¯ä»¥é€šè¿‡è™šæ‹Ÿåœ°å€ï¼ˆVirtual Addressï¼ŒVAï¼‰è®¿é—®ä¸»å­˜ï¼Œåªä¸è¿‡è¯¥åœ°å€åœ¨å‘é€åˆ°ä¸»å­˜ä¹‹å‰éœ€è¦è¢«è½¬æ¢ä¸ºé€‚å½“çš„ç‰©ç†åœ°å€ã€‚è¿™ç§å¯»å€æ–¹å¼è¢«ç§°ä¸ºè™šæ‹Ÿå¯»å€ï¼ˆVirtual Addressingï¼‰ï¼š</p>
<p><img alt="alt text" src="../image/image-108.png" /></p>
<p>åœ°å€è½¬æ¢ï¼ˆAddress Translation ï¼‰éœ€è¦ CPU ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿä¹‹é—´å¯†åˆ‡åˆä½œï¼Œä½äº CPU èŠ¯ç‰‡ä¸Šçš„å†…å­˜ç®¡ç†å•å…ƒï¼ˆMemory Management Unitï¼ŒMMUï¼‰æ ¹æ® <strong>é¡µè¡¨</strong>ï¼ˆPage Tableï¼‰åŠ¨æ€åœ°å°†è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ã€‚é¡µè¡¨å­˜å‚¨åœ¨ä¸»å­˜ä¸­ï¼Œå…¶å†…å®¹ç”±æ“ä½œç³»ç»Ÿç»´æŠ¤ã€‚</p>
<h2 id="åœ°å€ç©ºé—´">åœ°å€ç©ºé—´<a class="headerlink" href="#åœ°å€ç©ºé—´" title="Permanent link">&para;</a></h2>
<p>åœ°å€ç©ºé—´ï¼ˆAddress Spaceï¼‰æ˜¯ä¸€ç»„æœ‰åºçš„éè´Ÿæ•´æ•°åœ°å€ï¼š</p>
<div class="arithmatex">\[\lbrace0, 1, 2, . . .\rbrace\]</div>
<p>å¦‚æœè¿™äº›æ•´æ•°æ˜¯è¿ç»­çš„ï¼Œæˆ‘ä»¬å°±ç§°å…¶ä¸ºçº¿æ€§åœ°å€ç©ºé—´ï¼ˆLinear Address Spaceï¼‰ã€‚åœ¨æ‹¥æœ‰è™šæ‹Ÿå†…å­˜çš„ç³»ç»Ÿä¸­ï¼ŒCPU ä» n ä½çº¿æ€§åœ°å€ç©ºé—´ä¸­ç”Ÿæˆè™šæ‹Ÿåœ°å€ï¼Œè¯¥è™šæ‹Ÿåœ°å€ç©ºé—´å…±æœ‰ N = <span class="arithmatex">\(2^n\)</span> ä¸ªåœ°å€ï¼š</p>
<div class="arithmatex">\[\lbrace0,1,2,...,N -1\rbrace\]</div>
<p>ç°ä»£ç³»ç»Ÿé€šå¸¸æ”¯æŒ 32 ä½æˆ– 64 ä½è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚åŒæ ·åœ°ï¼Œç³»ç»Ÿä¹Ÿæœ‰ä¸€ä¸ªç‰©ç†åœ°å€ç©ºé—´ï¼š</p>
<div class="arithmatex">\[\lbrace0,1,2,...,M -1\rbrace\]</div>
<p>ä¸è™šæ‹Ÿåœ°å€ç©ºé—´ä¸åŒï¼ŒM ä¸ä¸€å®šä¸º 2 çš„å¹‚ã€‚ä½†ä¸ºäº†ç®€åŒ–è®¨è®ºï¼Œæˆ‘ä»¬å‡è®¾ M = <span class="arithmatex">\(2^m\)</span>ã€‚</p>
<p>åœ°å€ç©ºé—´æ˜ç¡®åœ°å°†æ•°æ®å¯¹è±¡ï¼ˆå­—èŠ‚ï¼‰å’Œå…¶å±æ€§ï¼ˆåœ°å€ï¼‰åŒºåˆ†å¼€æ¥ï¼Œå› æ­¤æ¯ä¸ªæ•°æ®å¯¹è±¡éƒ½å¯ä»¥æœ‰å¤šä¸ªç‹¬ç«‹çš„åœ°å€ï¼Œè¿™ä¾¿æ˜¯è™šæ‹Ÿå†…å­˜çš„åŸºæœ¬æ€æƒ³ã€‚ä¸»å­˜ä¸­çš„æ¯ä¸ªå­—èŠ‚éƒ½æœ‰ä¸€ä¸ªä»ç‰©ç†åœ°å€ç©ºé—´ä¸­é€‰æ‹©çš„ç‰©ç†åœ°å€ï¼Œä»¥åŠä¸€ä¸ªä»è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­é€‰æ‹©çš„è™šæ‹Ÿåœ°å€ã€‚</p>
<h2 id="è™šæ‹Ÿå†…å­˜ä½œä¸ºç¼“å­˜çš„å·¥å…·">è™šæ‹Ÿå†…å­˜ä½œä¸ºç¼“å­˜çš„å·¥å…·<a class="headerlink" href="#è™šæ‹Ÿå†…å­˜ä½œä¸ºç¼“å­˜çš„å·¥å…·" title="Permanent link">&para;</a></h2>
<p>ä¸å­˜å‚¨å±‚çº§ç»“æ„ä¸­çš„å…¶ä»–ç¼“å­˜ä¸€æ ·ï¼Œç£ç›˜ä¸ä¸»å­˜ä¹‹é—´ä»¥ <strong>Block</strong> ä¸ºå•ä½ä¼ è¾“æ•°æ®ã€‚è€Œåœ¨è™šæ‹Ÿå†…å­˜ç³»ç»Ÿä¸­ï¼ŒBlock è¢«ç§°ä¸ºè™šæ‹Ÿé¡µé¢ï¼ˆVirtual Pageï¼ŒVPï¼‰ï¼Œå…¶å¤§å°ä¸º P = <span class="arithmatex">\(2^p\)</span>ã€‚ç±»ä¼¼åœ°ï¼Œç‰©ç†å†…å­˜ä¹Ÿå¯ä»¥è¢«åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ä¸º P çš„ç‰©ç†é¡µé¢ï¼ˆPhysical Pageï¼ŒPPï¼‰ã€‚</p>
<p>è™šæ‹Ÿé¡µé¢æœ‰ä»¥ä¸‹ä¸‰ç§çŠ¶æ€ï¼š</p>
<ul>
<li>æœªåˆ†é…ï¼ˆUnallocatedï¼‰ï¼šæ²¡æœ‰è¢«è¿›ç¨‹ç”³è¯·ä½¿ç”¨çš„é¡µé¢ï¼Œä¸å ç”¨ä»»ä½•ç£ç›˜ç©ºé—´ï¼›</li>
<li>æœªç¼“å­˜ï¼ˆUncachedï¼‰ï¼šä»…åŠ è½½åˆ°ç£ç›˜è€Œæœªç¼“å­˜åˆ°ä¸»å­˜ä¸­çš„é¡µé¢ï¼›</li>
<li>å·²ç¼“å­˜ï¼ˆCachedï¼‰ï¼šå·²ç¼“å­˜åœ¨ä¸»å­˜ä¸­çš„é¡µé¢ã€‚</li>
</ul>
<h3 id="dram-ç¼“å­˜">DRAM ç¼“å­˜<a class="headerlink" href="#dram-ç¼“å­˜" title="Permanent link">&para;</a></h3>
<p>æˆ‘ä»¬å°† CPU å’Œä¸»å­˜ä¹‹é—´çš„ L1ã€L2 å’Œ L3 çº§ç¼“å­˜ç§°ä¸º SRAM ç¼“å­˜ï¼Œè€Œå°†ä¸»å­˜ä¸­ç”¨æ¥ç¼“å­˜è™šæ‹Ÿé¡µé¢çš„ç¼“å­˜ç§°ä¸º DRAM ç¼“å­˜ã€‚</p>
<p>ä¸ SRAM ç¼“å­˜ç›¸æ¯”ï¼ŒDRAM ç¼“å­˜å‘ç”Ÿç¼“å­˜ç¼ºå¤±çš„æˆæœ¬å¾ˆé«˜ï¼ˆéœ€è¦ä»ç£ç›˜ä¸­åŠ è½½æ•°æ®ï¼‰ï¼Œå› æ­¤è™šæ‹Ÿé¡µé¢å¾€å¾€æ¯”è¾ƒå¤§â€”â€”é€šå¸¸ä¸º 4 KB åˆ° 2 MBã€‚DRAM ç¼“å­˜æ˜¯ <strong>å…¨å…³è”å‹</strong> çš„ï¼Œè¿™æ ·ä»»ä½•ä¸€ä¸ªè™šæ‹Ÿé¡µé¢éƒ½å¯ä»¥æ”¾åœ¨ä»»ä½•ä¸€ä¸ªç‰©ç†é¡µé¢ä¸­ã€‚</p>
<blockquote>
<p>Due to the large miss penalty, DRAM caches are fully associative; that is, any virtual page can be placed in any physical page.</p>
</blockquote>
<h3 id="é¡µè¡¨">é¡µè¡¨<a class="headerlink" href="#é¡µè¡¨" title="Permanent link">&para;</a></h3>
<p>é¡µè¡¨æ˜¯ç”±é¡µè¡¨æ¡ç›®ï¼ˆPage Table Entriesï¼ŒPTEsï¼‰ç»„æˆçš„æ•°ç»„ã€‚æ¯ä¸ªè™šæ‹Ÿé¡µé¢åœ¨é¡µè¡¨éƒ½æœ‰ä¸€æ¡ PTEï¼Œå®ƒåœ¨é¡µè¡¨ä¸­çš„åç§»é‡æ˜¯å›ºå®šçš„ã€‚æ¯æ¡ PTE ä¸­éƒ½åŒ…å«äº†ä¸€ä¸ªè¡¨ç¤ºè¯¥è™šæ‹Ÿé¡µé¢æ˜¯å¦å·²ç¼“å­˜çš„æœ‰æ•ˆä½ï¼Œä»¥åŠä¸€ä¸ª n ä½çš„åœ°å€å­—æ®µã€‚è‹¥æœ‰æ•ˆä½ä¸º 1ï¼Œåˆ™åœ°å€å­—æ®µæ˜¯ç¼“å­˜è¯¥é¡µé¢çš„ç‰©ç†é¡µé¢çš„èµ·å§‹åœ°å€ï¼›è‹¥æœ‰æ•ˆä½ä¸º 0 ä¸”åœ°å€å­—æ®µä¸ºç©ºï¼Œåˆ™ä»£è¡¨è¯¥è™šæ‹Ÿé¡µé¢æœªåˆ†é…ï¼›è‹¥æœ‰æ•ˆä½ä¸º 0 ä¸”åœ°å€å­—æ®µéç©ºï¼Œåˆ™åœ°å€å­—æ®µæ˜¯è¯¥é¡µé¢åœ¨ç£ç›˜ä¸Šçš„èµ·å§‹åœ°å€ã€‚</p>
<p><img alt="alt text" src="../image/image-109.png" /></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç³»ç»Ÿä¸­å­˜åœ¨ 8 ä¸ªè™šæ‹Ÿé¡µé¢å’Œ 4 ä¸ªç‰©ç†é¡µé¢ï¼šé¡µé¢ 1ï¼Œ2ï¼Œ4 å’Œ 7 ç¼“å­˜åœ¨ DRAM ä¸­ï¼›é¡µé¢ 3 å’Œ 6 å·²åˆ†é…ä½†æœªç¼“å­˜ï¼›é¡µé¢ 0 å’Œ 5 æœªåˆ†é…ã€‚</p>
<h3 id="ç¼ºé¡µæ•…éšœ">ç¼ºé¡µæ•…éšœ<a class="headerlink" href="#ç¼ºé¡µæ•…éšœ" title="Permanent link">&para;</a></h3>
<p>æˆ‘ä»¬å°†è®¿é—® DRAM ç¼“å­˜æ—¶å‘ç”Ÿçš„ç¼“å­˜ç¼ºå¤±ç§°ä¸ºç¼ºé¡µæ•…éšœï¼ˆPage Faultï¼‰ã€‚è‹¥ CPU å¼•ç”¨ä¸Šå›¾é¡µé¢ 3 ä¸­çš„æŸä¸ªå­—ï¼Œåœ°å€è½¬æ¢ç¡¬ä»¶ä¼šä»ä¸»å­˜ä¸­è¯»å– PTE 3 ï¼Œç„¶åæ ¹æ®å…¶æœ‰æ•ˆä½åˆ¤æ–­å‡ºè¯¥é¡µé¢æœªç¼“å­˜ã€‚ç¼ºé¡µæ•…éšœå¼‚å¸¸å°†è°ƒç”¨å†…æ ¸ä¸­çš„å¼‚å¸¸å¤„ç†ç¨‹åºï¼Œé€‰æ‹©å—å®³è€…é¡µé¢ï¼ˆVictim Pageï¼‰é€å‡ºä¸»å­˜ã€‚</p>
<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œå—å®³è€…é¡µé¢ä¸º VP 4ï¼Œå› æ­¤å†…æ ¸ä¼šå…ˆå°† PTE 4 ä¸­çš„æœ‰æ•ˆä½é‡ç½®ä¸º 0ã€‚å¦‚æœè¯¥é¡µé¢å·²å‘ç”Ÿæ›´æ”¹ï¼Œå†…æ ¸è¿˜éœ€è¦å°†å…¶å¤åˆ¶å›ç£ç›˜ã€‚æ¥ä¸‹æ¥ï¼Œå†…æ ¸æŠŠ VP 3 ä»ç£ç›˜å¤åˆ¶åˆ°ä¸»å­˜ä¸­çš„ PP 3ï¼Œå¹¶æ›´æ–° PTE 3 ä¸­çš„æœ‰æ•ˆä½ã€‚ä¸‹å›¾å±•ç¤ºäº†å¼‚å¸¸å¤„ç†ç¨‹åºè¿”å›åç¤ºä¾‹é¡µè¡¨çš„çŠ¶æ€ï¼š</p>
<p><img alt="alt text" src="../image/image-110.png" />
ä¸Šè¿°åœ¨ç£ç›˜å’Œä¸»å­˜ä¹‹é—´ä¼ è¾“é¡µé¢çš„æ´»åŠ¨è¢«ç§°ä¸ºäº¤æ¢ï¼ˆSwappingï¼‰æˆ–è€…åˆ†é¡µï¼ˆPagingï¼‰ã€‚é¡µé¢ä»ç£ç›˜ä¼ è¾“åˆ°ä¸»å­˜è¢«ç§°ä¸ºæ¢å…¥ï¼ˆSwapping In æˆ– Paging Inï¼‰ï¼Œåä¹‹åˆ™ä¸ºæ¢å‡ºï¼ˆSwapping Out æˆ– Paging Outï¼‰ã€‚å°½ç®¡æˆ‘ä»¬å¯ä»¥è¯•å›¾é¢„æµ‹ç¼ºé¡µæ•…éšœå¹¶åœ¨å¼•ç”¨æœªç¼“å­˜çš„é¡µé¢å‰åˆ†é¡µï¼Œä½†ç°ä»£ç³»ç»Ÿå‡åœ¨å¼‚å¸¸å‘ç”Ÿååˆ†é¡µï¼Œå³æŒ‰éœ€åˆ†é¡µï¼ˆDemand Pagingï¼‰ã€‚</p>
<h3 id="åˆ†é…é¡µé¢">åˆ†é…é¡µé¢<a class="headerlink" href="#åˆ†é…é¡µé¢" title="Permanent link">&para;</a></h3>
<p><img alt="alt text" src="../image/image-111.png" />
ä¸Šå›¾å±•ç¤ºäº†åˆ†é…ä¸€ä¸ªæ–°çš„è™šæ‹Ÿé¡µé¢ï¼ˆå¦‚è¿›ç¨‹è°ƒç”¨<code>malloc</code>ï¼‰åé¡µè¡¨çš„å˜åŒ–ã€‚æ“ä½œç³»ç»Ÿå…ˆåœ¨ç£ç›˜ä¸Šå¼€è¾Ÿç©ºé—´ï¼Œç„¶åæ›´æ–° PTE 5 ä½¿ VP 5 æŒ‡å‘ç£ç›˜ä¸Šæ–°åˆ›å»ºçš„é¡µé¢ã€‚</p>
<h2 id="è™šæ‹Ÿå†…å­˜ä½œä¸ºå†…å­˜ç®¡ç†çš„å·¥å…·">è™šæ‹Ÿå†…å­˜ä½œä¸ºå†…å­˜ç®¡ç†çš„å·¥å…·<a class="headerlink" href="#è™šæ‹Ÿå†…å­˜ä½œä¸ºå†…å­˜ç®¡ç†çš„å·¥å…·" title="Permanent link">&para;</a></h2>
<p>æ“ä½œç³»ç»Ÿä¸ºæ¯ä¸ªè¿›ç¨‹éƒ½ç»´æŠ¤äº†ä¸€ä¸ªå•ç‹¬çš„é¡µè¡¨ï¼Œå› æ­¤æ‰€æœ‰è¿›ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼š</p>
<p><img alt="alt text" src="../image/image-112.png" />
å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¿›ç¨‹ i çš„é¡µè¡¨å°† VP 1 æ˜ å°„åˆ° PP 2ï¼Œå°† VP 2 æ˜ å°„åˆ° PP 7ï¼›è¿›ç¨‹ j çš„é¡µè¡¨å°† VP 1 æ˜ å°„åˆ° PP 7ï¼Œå°† VP 2 æ˜ å°„åˆ° PP 10ã€‚å¤šä¸ªè™šæ‹Ÿé¡µé¢å¯ä»¥æ˜ å°„åˆ°åŒä¸€ä¸ªå…±äº«ç‰©ç†é¡µé¢ã€‚è™šæ‹Ÿå†…å­˜ç³»ç»Ÿç®€åŒ–äº†é“¾æ¥ã€åŠ è½½ã€ä»£ç å’Œæ•°æ®çš„å…±äº«ä»¥åŠåº”ç”¨ç¨‹åºçš„å†…å­˜åˆ†é…ï¼š</p>
<ul>
<li>ç®€åŒ–é“¾æ¥ï¼šç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´å…è®¸æ¯ä¸ªè¿›ç¨‹ä½¿ç”¨ç›¸åŒçš„ <strong>å†…å­˜ç»“æ„</strong>ï¼Œå› æ­¤é“¾æ¥å™¨æ— éœ€è€ƒè™‘å¯æ‰§è¡Œæ–‡ä»¶çš„ä»£ç å’Œæ•°æ®åœ¨ç‰©ç†å†…å­˜ä¸­çš„å®é™…ä½ç½®ã€‚è¿™ç§ç»Ÿä¸€æ€§æå¤§åœ°ç®€åŒ–äº†é“¾æ¥å™¨çš„è®¾è®¡å’Œå®ç°ï¼›</li>
<li>ç®€åŒ–åŠ è½½ï¼šè‹¥è¦å°†ç›®æ ‡æ–‡ä»¶çš„ .text å’Œ .data æ®µåŠ è½½åˆ°ä¸€ä¸ªæ–°è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­ï¼ŒåŠ è½½å™¨åªéœ€ä¸ºå®ƒä»¬åˆ†é…è™šæ‹Ÿé¡µé¢ï¼Œç„¶åå°†å…¶æ ‡è®°ä¸ºæœªç¼“å­˜ï¼Œæœ€åå†å°†é¡µè¡¨æ¡ç›®æŒ‡å‘ç›®æ ‡æ–‡ä»¶ä¸­å¯¹åº”çš„ä½ç½®ã€‚å®é™…ä¸ŠåŠ è½½å™¨ä»æœªå°†ä»»ä½•æ•°æ®ä»ç£ç›˜å¤åˆ¶åˆ°ä¸»å­˜ä¸­ï¼Œä»£ç å’Œæ•°æ®åªæœ‰åœ¨è¢«ç¬¬ä¸€æ¬¡å¼•ç”¨æ—¶æ‰ä¼šæŒ‰éœ€åˆ†é¡µï¼›</li>
<li>ç®€åŒ–å…±äº«ï¼šæ“ä½œç³»ç»Ÿå¯ä»¥å°†ä¸åŒè¿›ç¨‹ä¸­çš„ä¸åŒè™šæ‹Ÿé¡µé¢æ˜ å°„åˆ°ç›¸åŒçš„ç‰©ç†é¡µé¢ï¼Œä»è€Œå®ç°è¿›ç¨‹ä¹‹é—´ä»£ç å’Œæ•°æ®çš„å…±äº«ï¼›</li>
<li>ç®€åŒ–å†…å­˜åˆ†é…ï¼šå½“åº”ç”¨ç¨‹åºç”³è¯·é¢å¤–çš„å†…å­˜æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸ºå…¶åˆ†é…ä¸€å®šæ•°é‡çš„è¿ç»­è™šæ‹Ÿé¡µé¢ï¼Œç„¶åå°†å®ƒä»¬æ˜ å°„åˆ°ä»»æ„ä½ç½®çš„ç‰©ç†é¡µé¢ã€‚è¿™äº›ç‰©ç†é¡µé¢æ— éœ€è¿ç»­ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç‰©ç†å†…å­˜ä¸­éšæœºåˆ†å¸ƒã€‚</li>
</ul>
<h2 id="è™šæ‹Ÿå†…å­˜ä½œä¸ºå†…å­˜ä¿æŠ¤çš„å·¥å…·">è™šæ‹Ÿå†…å­˜ä½œä¸ºå†…å­˜ä¿æŠ¤çš„å·¥å…·<a class="headerlink" href="#è™šæ‹Ÿå†…å­˜ä½œä¸ºå†…å­˜ä¿æŠ¤çš„å·¥å…·" title="Permanent link">&para;</a></h2>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ PTE ä¸­æ·»åŠ ä¸€äº›æƒé™ä½æ¥ç®¡ç†è¿›ç¨‹å¯¹é¡µé¢çš„è®¿é—®ï¼š</p>
<p><img alt="alt text" src="../image/image-113.png" />
å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒSUP è¡¨ç¤ºæ˜¯å¦åªæœ‰åœ¨å†…æ ¸æ€è¿è¡Œçš„è¿›ç¨‹æ‰èƒ½è®¿é—®è¯¥é¡µé¢ï¼ŒREAD å’Œ WRITE åˆ™åˆ†åˆ«è¡¨ç¤ºé¡µé¢æ˜¯å¦å¯è¯»å†™ã€‚ä¾‹å¦‚ï¼Œè¿›ç¨‹ i åœ¨ç”¨æˆ·æ€ä¸­è¿è¡Œï¼Œé‚£ä¹ˆå®ƒå¯ä»¥è¯»å– VP 0ï¼Œè¯»å–å’Œå†™å…¥ VP 1ï¼Œä½†æ— æ³•è®¿é—® VP 2ã€‚</p>
<p>å¦‚æœæŸæ¡æŒ‡ä»¤è¿åäº†ä¸Šè¿°æƒé™ï¼ŒCPU å°±ä¼šè§¦å‘é€šç”¨ä¿æŠ¤æ•…éšœï¼Œå¹¶å°†æ§åˆ¶æƒè½¬ç§»åˆ°å†…æ ¸ä¸­çš„å¼‚å¸¸å¤„ç†ç¨‹åºã€‚è¯¥å¤„ç†ç¨‹åºä¼šå‘é—®é¢˜è¿›ç¨‹å‘é€ä¸€ä¸ª SIGSEGV ä¿¡å·ï¼ŒLinux Shell é€šå¸¸å°†æ­¤å¼‚å¸¸æŠ¥å‘Šä¸ºåˆ†æ®µæ•…éšœï¼ˆSegmentation Faultï¼‰ã€‚</p>
<h2 id="åœ°å€è½¬æ¢">åœ°å€è½¬æ¢<a class="headerlink" href="#åœ°å€è½¬æ¢" title="Permanent link">&para;</a></h2>
<p><img alt="alt text" src="../image/image-114.png" />
CPU ä¸­çš„é¡µè¡¨åŸºå€å¯„å­˜å™¨ï¼ˆPage Table Base Register ï¼ŒPTBRï¼‰æŒ‡å‘å½“å‰é¡µè¡¨ï¼Œn ä½çš„è™šæ‹Ÿåœ°å€ç”± p ä½çš„è™šæ‹Ÿé¡µé¢åç§»é‡ï¼ˆVirtual Page Offsetï¼ŒVPOï¼‰å’Œ n-p ä½çš„è™šæ‹Ÿé¡µé¢ç¼–å·ï¼ˆVirtual Page Numberï¼ŒVPNï¼‰ç»„æˆã€‚MMU æ ¹æ® VPN çš„å€¼é€‰æ‹©å¯¹åº”çš„ PTEï¼Œå¦‚ VPN 0 é€‰æ‹© PTE 0ï¼ŒVPN 1 é€‰æ‹© PTE 1ã€‚ç”±äºç‰©ç†é¡µé¢å’Œè™šæ‹Ÿé¡µé¢çš„å¤§å°ç›¸åŒï¼ŒVPO ä¸ç‰©ç†é¡µé¢åç§»é‡ï¼ˆPhysical Page Offsetï¼ŒPPOï¼‰ä¹Ÿå°±ç›¸åŒï¼Œå› æ­¤é¡µè¡¨æ¡ç›®ä¸­çš„ç‰©ç†é¡µé¢ç¼–å·ï¼ˆPhysical Page Numberï¼ŒPPNï¼‰ä¸ VPO å…±åŒç»„æˆäº†è½¬æ¢åçš„ç‰©ç†åœ°å€ã€‚</p>
<p><img alt="alt text" src="../image/image-115.png" />
ä¸Šå›¾å±•ç¤ºäº†é¡µé¢å‘½ä¸­æ—¶çš„ CPU ç¡¬ä»¶æ“ä½œæ­¥éª¤ï¼š</p>
<ol>
<li>å¤„ç†å™¨ç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿåœ°å€ VA å¹¶å‘é€åˆ° MMUï¼›</li>
<li>MMU ç”Ÿæˆ PTE åœ°å€ PTEA å¹¶å‘é«˜é€Ÿç¼“å­˜æˆ–ä¸»å­˜å‘èµ·è¯·æ±‚ï¼›</li>
<li>é«˜é€Ÿç¼“å­˜æˆ–ä¸»å­˜å°† PTE è¿”å›ç»™ MMUï¼›</li>
<li>MMU æ„é€ ç‰©ç†åœ°å€ PA å¹¶å°†å…¶å‘é€åˆ°é«˜é€Ÿç¼“å­˜æˆ–ä¸»å­˜ï¼›</li>
<li>é«˜é€Ÿç¼“å­˜æˆ–ä¸»å­˜å°†è¯·æ±‚çš„æ•°æ®è¿”å›ç»™å¤„ç†å™¨ã€‚</li>
</ol>
<p><img alt="alt text" src="../image/image-116.png" />
ä¸Šå›¾å±•ç¤ºäº†ç¼ºé¡µæ•…éšœæ—¶çš„ CPU ç¡¬ä»¶æ“ä½œæ­¥éª¤ï¼š</p>
<ol>
<li>å¤„ç†å™¨ç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿåœ°å€ VA å¹¶å‘é€åˆ° MMUï¼›</li>
<li>MMU ç”Ÿæˆ PTE åœ°å€ PTEA å¹¶å‘é«˜é€Ÿç¼“å­˜æˆ–ä¸»å­˜å‘èµ·è¯·æ±‚ï¼›</li>
<li>é«˜é€Ÿç¼“å­˜æˆ–ä¸»å­˜å°† PTE è¿”å›ç»™ MMUï¼›</li>
<li>PTE ä¸­çš„æœ‰æ•ˆä½ä¸º 0ï¼Œå› æ­¤ MMU è§¦å‘å¼‚å¸¸å¹¶å°†æ§åˆ¶æƒè½¬ç§»ç»™å†…æ ¸ä¸­çš„å¼‚å¸¸å¤„ç†ç¨‹åºï¼›</li>
<li>å¤„ç†ç¨‹åºä»ç‰©ç†å†…å­˜ä¸­é€‰å–å—å®³è€…é¡µé¢æ¢å‡ºã€‚è‹¥è¯¥é¡µé¢å·²è¢«ä¿®æ”¹ï¼Œåˆ™è¿˜è¦å°†å…¶å¤åˆ¶åˆ°ç£ç›˜ä¸­ï¼›</li>
<li>å¤„ç†ç¨‹åºå°†æ–°é¡µé¢æ¢å…¥å¹¶æ›´æ–° PTEï¼›</li>
<li>å¤„ç†ç¨‹åºè¿”å›åˆ°åŸæ¥çš„è¿›ç¨‹ï¼Œä¹‹å‰å¼•å‘ç¼ºé¡µæ•…éšœçš„æŒ‡ä»¤é‡æ–°æ‰§è¡Œã€‚æ­¤æ—¶è¿›ç¨‹è¯·æ±‚çš„é¡µé¢å·²ç¼“å­˜ï¼Œå› æ­¤ CPU éšåçš„æ“ä½œä¸é¡µé¢å‘½ä¸­æ—¶ç›¸åŒã€‚</li>
</ol>
<h3 id="é«˜é€Ÿç¼“å­˜ä¸è™šæ‹Ÿå†…å­˜">é«˜é€Ÿç¼“å­˜ä¸è™šæ‹Ÿå†…å­˜<a class="headerlink" href="#é«˜é€Ÿç¼“å­˜ä¸è™šæ‹Ÿå†…å­˜" title="Permanent link">&para;</a></h3>
<p>å¤§éƒ¨åˆ†åŒæ—¶ä½¿ç”¨è™šæ‹Ÿå†…å­˜å’Œé«˜é€Ÿç¼“å­˜ï¼ˆSRAM ç¼“å­˜ï¼‰çš„ç³»ç»Ÿå‡é‡‡ç”¨ç‰©ç†å¯»å€çš„æ–¹å¼è®¿é—®é«˜é€Ÿç¼“å­˜ã€‚ä¸‹å›¾å±•ç¤ºäº†ä¸¤è€…çš„é›†æˆæ–¹å¼ï¼š</p>
<p><img alt="alt text" src="../image/image-117.png" /></p>
<h3 id="ä½¿ç”¨-tlb-åŠ é€Ÿåœ°å€è½¬æ¢">ä½¿ç”¨ TLB åŠ é€Ÿåœ°å€è½¬æ¢<a class="headerlink" href="#ä½¿ç”¨-tlb-åŠ é€Ÿåœ°å€è½¬æ¢" title="Permanent link">&para;</a></h3>
<p>CPU æ¯æ¬¡ç”Ÿæˆè™šæ‹Ÿåœ°å€æ—¶ï¼ŒMMU éƒ½å¿…é¡»å¼•ç”¨ PTE æ‰èƒ½å®Œæˆåœ°å€è½¬æ¢ã€‚å¦‚æœ PTE ä½äºä¸»å­˜è€Œéé«˜é€Ÿç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆåœ°å€è½¬æ¢çš„é€Ÿåº¦å°†å¤§å¤§ä¸‹é™ã€‚å¤§å¤šæ•°ç³»ç»Ÿçš„ MMU ä¸­åŒ…å«äº†ä¸€ä¸ªè¢«ç§°ä¸ºè½¬æ¢åå¤‡ç¼“å†²åŒºï¼ˆTranslation Lookaside Bufferï¼ŒTLBï¼‰çš„å°å‹ PTE ç¼“å­˜ï¼Œå…¶æ¯ä¸ªç¼“å­˜è¡Œä¸­éƒ½æœ‰ä¸€ä¸ªç”±å•æ¡ PTE ç»„æˆçš„ Blockã€‚ç”¨äº <strong>é›†åˆé€‰æ‹©å’Œè¡ŒåŒ¹é…</strong> çš„ Set Index å’Œ Tag æ˜¯ä»è™šæ‹Ÿåœ°å€çš„ VPN ä¸­æå–çš„ï¼š</p>
<p><img alt="alt text" src="../image/image-118.png" />
å¦‚æœ TLB æœ‰ T = <span class="arithmatex">\(2^t\)</span> ä¸ªé›†åˆï¼Œåˆ™ Set Indexï¼ˆTLBIï¼‰ç”± VPN ä¸­ t ä¸ªæœ€ä½ä½ç»„æˆï¼ŒTagï¼ˆTLBTï¼‰ç”± VPN ä¸­çš„å‰©ä½™é«˜ä½ç»„æˆã€‚</p>
<p><img alt="alt text" src="../image/image-119.png" />
ä¸Šå›¾å±•ç¤ºäº† TLB å‘½ä¸­æ—¶çš„ CPU ç¡¬ä»¶æ“ä½œæ­¥éª¤ã€‚ç”±äºåœ°å€è½¬æ¢å‡åœ¨ CPU èŠ¯ç‰‡ä¸Šçš„ MMU ä¸­æ‰§è¡Œï¼Œå› æ­¤é€Ÿåº¦å¾ˆå¿«ï¼š</p>
<ol>
<li>CPU ç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿåœ°å€ VAï¼›</li>
<li>MMU å‘ TLB å‘é€ VPN ä»¥è¯·æ±‚ PTEï¼›</li>
<li>TLB å°† PTE è¿”å›ç»™ MMUï¼›</li>
<li>MMU å°†è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ PA å¹¶å‘é€åˆ°é«˜é€Ÿç¼“å­˜æˆ–ä¸»å­˜ï¼›</li>
<li>é«˜é€Ÿç¼“å­˜æˆ–ä¸»å­˜å°†è¯·æ±‚çš„æ•°æ®è¿”å›ç»™å¤„ç†å™¨ã€‚</li>
</ol>
<p><img alt="alt text" src="../image/image-120.png" />
ä¸Šå›¾å±•ç¤ºäº† TLB æœªå‘½ä¸­æ—¶çš„ CPU ç¡¬ä»¶æ“ä½œæ­¥éª¤ã€‚MMU å¿…é¡»ä»é«˜é€Ÿç¼“å­˜æˆ–ä¸»å­˜ä¸­è·å– PTE å¹¶å°†å…¶å­˜å‚¨åœ¨ TLB ä¸­ï¼Œè¿™å¯èƒ½ä¼šè¦†ç›–ç°æœ‰æ¡ç›®ã€‚</p>
<h3 id="å¤šçº§é¡µè¡¨">å¤šçº§é¡µè¡¨<a class="headerlink" href="#å¤šçº§é¡µè¡¨" title="Permanent link">&para;</a></h3>
<p>åœ¨ä¹‹å‰çš„è®¨è®ºä¸­ï¼Œæˆ‘ä»¬å‡è®¾ç³»ç»Ÿåªä½¿ç”¨å•çº§é¡µè¡¨è¿›è¡Œåœ°å€è½¬æ¢ã€‚ä½†å¦‚æœåœ°å€ç©ºé—´æœ‰ 32 ä½ï¼Œä¸€ä¸ªé¡µé¢ 4 KB å¹¶ä¸”ä¸€æ¡ PTE 4 å­—èŠ‚ã€‚é‚£ä¹ˆå³ä½¿åº”ç”¨ç¨‹åºåªå¼•ç”¨ä¸€å°éƒ¨åˆ†è™šæ‹Ÿå†…å­˜ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€ä¸ª 4 MB çš„é¡µè¡¨å¸¸é©»åœ¨å†…å­˜ä¸­ï¼š</p>
<div class="arithmatex">\[n=32, P=4K=2^{12}, n(PTE)=2^{n-p}=2^{20}=1M\]</div>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹é¡µè¡¨åˆ†çº§æ¥å‹ç¼©é¡µè¡¨çš„å¤§å°ï¼š</p>
<p><img alt="alt text" src="../image/image-121.png" />
å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸€çº§é¡µè¡¨ä¸­æœ‰ 1024 æ¡ PTEï¼Œæ¯æ¡ PTE éƒ½æ˜ å°„åˆ°ä¸€ä¸ªåŒ…å« 1024 ä¸ªè¿ç»­è™šæ‹Ÿé¡µé¢çš„åœ°å€ç©ºé—´å—ã€‚æ¯ä¸ªåœ°å€ç©ºé—´å—çš„å¤§å°ä¸º 1024 * 4 KB = 4 MBï¼Œå› æ­¤ 1024 æ¡ PTE å°±å¯ä»¥è¦†ç›– 32 ä½ï¼ˆ4 MB * 1024 = 4 GB = <span class="arithmatex">\(2^{32}\)</span> Bï¼‰åœ°å€ç©ºé—´ã€‚</p>
<p>å¦‚æœåœ°å€ç©ºé—´å—ä¸­çš„æ‰€æœ‰é¡µé¢å‡æœªåˆ†é…ï¼Œåˆ™ä¸€çº§é¡µè¡¨ä¸­å¯¹åº”çš„ PTE ä¸ºç©ºï¼ˆå¦‚ä¸Šå›¾ä¸­çš„ PTE 2ï½7ï¼‰ï¼›å¦‚æœåœ°å€ç©ºé—´å—ä¸­è‡³å°‘æœ‰ä¸€ä¸ªé¡µé¢å·²åˆ†é…ï¼Œé‚£ä¹ˆä¸€çº§é¡µè¡¨ä¸­å¯¹åº”çš„ PTE å°±æŒ‡å‘äºŒçº§é¡µè¡¨ä¸­è¯¥å—çš„èµ·å§‹ä½ç½®ï¼ˆå¦‚ä¸Šå›¾ä¸­çš„ PTE 0ï½1ï¼‰ã€‚äºŒçº§é¡µè¡¨ä¸­çš„æ¯æ¡ PTE éƒ½æ˜ å°„åˆ°ä¸€ä¸ª 4 KB çš„ç‰©ç†å†…å­˜é¡µï¼Œè¿™ä¸æˆ‘ä»¬ä¹‹å‰æŸ¥çœ‹çš„å•çº§é¡µè¡¨ç›¸åŒã€‚</p>
<p>è‹¥ä¸€çº§é¡µè¡¨ä¸­çš„ PTE ä¸ºç©ºï¼Œé‚£ä¹ˆäºŒçº§é¡µè¡¨å†…å¯¹åº”çš„æ¡ç›®å°±æ— éœ€å­˜åœ¨ã€‚å¤šæ•°åº”ç”¨ç¨‹åºçš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­å¤§éƒ¨åˆ†é¡µé¢æ˜¯æœªåˆ†é…çš„ï¼Œå› æ­¤è¿™å°†æ˜¾è‘—åœ°é™ä½é¡µè¡¨çš„å†…å­˜å ç”¨ã€‚å¦å¤–ï¼Œæˆ‘ä»¬åªéœ€åœ¨ä¸»å­˜ä¸­ç»´æŠ¤ä¸€çº§é¡µè¡¨å’Œè¢«è°ƒç”¨æœ€ä¸ºé¢‘ç¹çš„äºŒçº§é¡µè¡¨ï¼Œå…¶å®ƒçš„äºŒçº§é¡µè¡¨å¯ä»¥ç”±æ“ä½œç³»ç»ŸæŒ‰éœ€åˆ›å»ºå’Œåˆ†é¡µã€‚</p>
<p><img alt="alt text" src="../image/image-122.png" />
åœ¨ k çº§é¡µè¡¨ä¸­ï¼Œè™šæ‹Ÿåœ°å€è¢«åˆ’åˆ†ä¸º k ä¸ª VPN å’Œä¸€ä¸ª VPOï¼ŒVPN iï¼ˆ1 â‰¤ i â‰¤ kï¼‰æ˜¯ç¬¬ i çº§é¡µè¡¨çš„ç´¢å¼•ã€‚é™¤ç¬¬ k çº§é¡µè¡¨å¤–ï¼Œæ¯ä¸ªé¡µè¡¨ä¸­çš„ PTE å‡æŒ‡å‘ä¸‹ä¸€çº§é¡µè¡¨çš„èµ·å§‹ä½ç½®ï¼Œè€Œç¬¬ k çº§è¡¨å†…çš„æ¯æ¡ PTE åˆ™ä¿å­˜äº†å¯¹åº”ç‰©ç†é¡µé¢çš„ PPNã€‚ä¸å•çº§é¡µè¡¨ä¸€æ ·ï¼ŒPPO ä¸ VPO ç›¸åŒã€‚MMU å¿…é¡»å…ˆè¯·æ±‚ k ä¸ª PTEï¼Œç„¶åæ‰èƒ½ç¡®å®š PPN ä»¥ç”Ÿæˆå®Œæ•´çš„ç‰©ç†åœ°å€ã€‚TLB å¯ä»¥ç¼“å­˜å¤šçº§é¡µè¡¨ä¸­çš„ PTEï¼Œè¿™ä½¿å¾—å¤šçº§é¡µè¡¨çš„åœ°å€è½¬æ¢é€Ÿåº¦å¹¶ä¸æ¯”å•çº§é¡µè¡¨æ…¢å¾ˆå¤šã€‚</p>
<h2 id="intel-core-i7linux-å†…å­˜ç³»ç»Ÿ">Intel Core i7/Linux å†…å­˜ç³»ç»Ÿ<a class="headerlink" href="#intel-core-i7linux-å†…å­˜ç³»ç»Ÿ" title="Permanent link">&para;</a></h2>
<p>å°½ç®¡åº•å±‚çš„ Haswell å¾®æ¶æ„èƒ½å¤Ÿæ”¯æŒå®Œæ•´çš„ 64 ä½è™šæ‹Ÿå’Œç‰©ç†åœ°å€ç©ºé—´ï¼Œä½†ç›®å‰ Core i7 ä»…æä¾›äº† 48 ä½ (256 TB) çš„è™šæ‹Ÿåœ°å€ç©ºé—´å’Œ 52 ä½ (4 PB ) çš„ç‰©ç†åœ°å€ç©ºé—´ï¼Œä»¥åŠä¸€ä¸ªæ”¯æŒ 32 ä½ (4 GB) è™šæ‹Ÿå’Œç‰©ç†åœ°å€ç©ºé—´çš„å…¼å®¹æ¨¡å¼ã€‚</p>
<h3 id="core-i7-åœ°å€è½¬æ¢">Core i7 åœ°å€è½¬æ¢<a class="headerlink" href="#core-i7-åœ°å€è½¬æ¢" title="Permanent link">&para;</a></h3>
<p><img alt="alt text" src="../image/image-123.png" />
å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒCore i7 ä½¿ç”¨å››çº§é¡µè¡¨ç»“æ„ã€‚CR 3 æ§åˆ¶å¯„å­˜å™¨ä¸­ä¿å­˜äº†ä¸€çº§ (L1) é¡µè¡¨çš„èµ·å§‹ç‰©ç†åœ°å€ï¼Œå…¶å€¼æ˜¯æ¯ä¸ªè¿›ç¨‹ä¸Šä¸‹æ–‡çš„ä¸€éƒ¨åˆ†å¹¶åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶æ¢å¤ã€‚48 ä½çš„è™šæ‹Ÿåœ°å€åŒ…å«äº† 36 ä½çš„ VPN å’Œ 12 ä½ï¼ˆ4 K = <span class="arithmatex">\(2^{12}\)</span>ï¼‰çš„ VPOï¼Œå…¶ä¸­ VPN åˆè¢«åˆ’åˆ†ä¸ºå››ä¸ª 9 ä½çš„åœ°å€ç©ºé—´å—ã€‚</p>
<h3 id="linux-è™šæ‹Ÿå†…å­˜ç³»ç»Ÿ">Linux è™šæ‹Ÿå†…å­˜ç³»ç»Ÿ<a class="headerlink" href="#linux-è™šæ‹Ÿå†…å­˜ç³»ç»Ÿ" title="Permanent link">&para;</a></h3>
<p><img alt="alt text" src="../image/image-124.png" /></p>
<blockquote>
<p>æ³¨ï¼šæ¯ä¸ªè¿›ç¨‹åœ°å€ç©ºé—´é‡Œçš„å†…æ ¸éƒ¨åˆ†éƒ½æ˜¯ç›¸åŒçš„ï¼Œå› æ­¤ä¸Šå›¾ä¸­çš„"Different for each process"æœ‰è¯¯ã€‚</p>
</blockquote>
<p>Linux å°†è™šæ‹Ÿå†…å­˜åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸæˆ–æ®µï¼ˆArea æˆ– Segmentï¼‰ï¼Œæ¯ä¸ªåŒºåŸŸéƒ½æ˜¯ä¸€äº›å·²åˆ†é…ä¸”åœ¨æŸäº›æ–¹é¢ç›¸å…³çš„è¿ç»­é¡µé¢ã€‚ä¾‹å¦‚ï¼Œä»£ç æ®µã€æ•°æ®æ®µã€å †ã€å…±äº«åº“æ®µå’Œç”¨æˆ·æ ˆåˆ†åˆ«æ˜¯ä¸åŒçš„åŒºåŸŸã€‚æ¯ä¸ªå·²åˆ†é…çš„é¡µé¢éƒ½å±äºæŸä¸ªåŒºåŸŸï¼Œå› æ­¤ä¸å±äºä»»ä½•åŒºåŸŸçš„é¡µé¢ä¸å­˜åœ¨ä¹Ÿæ— æ³•è¢«è¿›ç¨‹å¼•ç”¨ã€‚åŒºåŸŸæ¦‚å¿µçš„å¼•å…¥ä½¿å¾— Linux å…è®¸è™šæ‹Ÿåœ°å€ç©ºé—´å­˜åœ¨é—´éš™ã€‚</p>
<p><img alt="alt text" src="../image/image-125.png" />
å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒLinux å†…æ ¸ä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤äº†ä¸€ä¸ªç‹¬ç‰¹çš„æ•°æ®ç»“æ„<code>task_struct</code>ï¼Œå…¶å­—æ®µåŒ…å«æˆ–æŒ‡å‘å†…æ ¸è¿è¡Œè¯¥è¿›ç¨‹æ‰€éœ€çš„å…¨éƒ¨ä¿¡æ¯ï¼ˆå¦‚ PIDã€ç”¨æˆ·æ ˆæŒ‡é’ˆã€å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶åç§°å’Œç¨‹åºå¯„å­˜å™¨ç­‰ï¼‰ã€‚å…¶ä¸­ï¼Œå­—æ®µ<code>mm</code>æŒ‡å‘<code>mm_struct</code>ï¼Œè¯¥ç»“æ„ä½“æè¿°äº†è™šæ‹Ÿå†…å­˜çš„å½“å‰çŠ¶æ€ã€‚<code>mm_struct</code>ä¸­çš„<code>pgd</code>å­—æ®µæŒ‡å‘ä¸€çº§é¡µè¡¨çš„èµ·å§‹ä½ç½®ï¼Œå®ƒåœ¨è¿›ç¨‹è¿è¡Œæ—¶è¢«å†…æ ¸å­˜å‚¨åœ¨ CR 3 æ§åˆ¶å¯„å­˜å™¨ä¸­ã€‚è€Œ<code>mmap</code>å­—æ®µåˆ™æŒ‡å‘ä¸€ä¸ªç”±<code>vm_area_structs</code>ç»„æˆçš„é“¾è¡¨ã€‚æè¿°åŒºåŸŸä¿¡æ¯çš„ç»“æ„ä½“<code>vm_area_structs</code>åŒ…å«ä»¥ä¸‹å­—æ®µï¼š</p>
<ul>
<li><code>vm_start</code>ï¼šæŒ‡å‘åŒºåŸŸçš„èµ·ç‚¹ï¼›</li>
<li><code>vm_end</code>ï¼šæŒ‡å‘åŒºåŸŸçš„æœ«ç«¯ï¼›</li>
<li><code>vm_prot</code>ï¼šæè¿°è¯¥åŒºåŸŸä¸­æ‰€æœ‰é¡µé¢çš„è¯»/å†™æƒé™ï¼›</li>
<li><code>vm_flags</code>ï¼šæè¿°è¯¥åŒºåŸŸä¸­çš„é¡µé¢æ˜¯å¦ä¸å…¶ä»–è¿›ç¨‹å…±äº«ï¼›</li>
<li><code>vm_next</code>ï¼šæŒ‡å‘é“¾è¡¨ä¸­ä¸‹ä¸€ä¸ª<code>vm_area_structs</code>ã€‚</li>
</ul>
<p><img alt="alt text" src="../image/image-126.png" />
å¼‚å¸¸å¤„ç†ç¨‹åºå¯ä»¥å°†è™šæ‹Ÿåœ°å€ä¸<code>vm_start</code>å’Œ<code>vm_end</code>å­—æ®µæ¯”è¾ƒï¼Œä»è€Œåˆ¤æ–­å®ƒæ˜¯å¦å±äºæŸä¸ªåŒºåŸŸï¼Œå¦‚ä¸Šå›¾ â‘ ã€‚è¿˜å¯ä»¥æ ¹æ®<code>vm_prot</code>å­—æ®µåˆ¤æ–­è¿›ç¨‹æ˜¯å¦æœ‰æƒé™è®¿é—®ç›®æ ‡åŒºåŸŸä¸­çš„é¡µé¢ï¼Œå¦‚ä¸Šå›¾ â‘¡ã€‚</p>
<h2 id="å†…å­˜æ˜ å°„">å†…å­˜æ˜ å°„<a class="headerlink" href="#å†…å­˜æ˜ å°„" title="Permanent link">&para;</a></h2>
<p>Linux ä½¿ç”¨å†…å­˜æ˜ å°„ï¼ˆMemory Mappingï¼‰æŠ€æœ¯åˆå§‹åŒ–è™šæ‹Ÿå†…å­˜åŒºåŸŸå¹¶å°†å…¶ä¸ç£ç›˜ä¸Šçš„â€œå¯¹è±¡â€ç›¸å…³è”ã€‚è¯¥â€œå¯¹è±¡â€æœ‰ä¸¤ç§ç±»å‹ï¼š</p>
<ul>
<li>æ–‡ä»¶ç³»ç»Ÿä¸­çš„å¸¸è§„æ–‡ä»¶ï¼ˆRegular Fileï¼‰ï¼šæ–‡ä»¶è¢«åˆ†æˆå¤šä¸ªä¸é¡µé¢å¤§å°ç›¸åŒçš„ç‰‡æ®µï¼Œè€Œæ¯ä¸ªç‰‡æ®µéƒ½åŒ…å«äº†ä¸€ä¸ªè™šæ‹Ÿé¡µé¢çš„åˆå§‹å†…å®¹ã€‚ç”±äºæ“ä½œç³»ç»Ÿé‡‡ç”¨æŒ‰éœ€åˆ†é¡µçš„ç­–ç•¥ï¼Œå› æ­¤é¡µé¢åœ¨ç¬¬ä¸€æ¬¡è¢« CPU å¼•ç”¨å‰ä¸ä¼šè¢«æ¢å…¥åˆ°ç‰©ç†å†…å­˜ä¸­ã€‚å¦‚æœè™šæ‹Ÿå†…å­˜åŒºåŸŸæ¯”æ–‡ä»¶å¤§ï¼Œåˆ™å¤šä½™éƒ¨åˆ†ç”¨é›¶å¡«å……ï¼›</li>
<li>åŒ¿åæ–‡ä»¶ï¼ˆAnonymous Fileï¼‰ï¼šç”±å†…æ ¸åˆ›å»ºï¼Œå…¶å†…å®¹å…¨éƒ¨ä¸ºäºŒè¿›åˆ¶é›¶ã€‚å½“ CPU ç¬¬ä¸€æ¬¡å¼•ç”¨è¯¥åŒºåŸŸå†…çš„è™šæ‹Ÿé¡µé¢æ—¶ï¼Œå†…æ ¸ä¼šå…ˆåœ¨ç‰©ç†å†…å­˜ä¸­é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„å—å®³è€…é¡µé¢ï¼ˆè‹¥è¯¥é¡µé¢å·²è¢«ä¿®æ”¹åˆ™éœ€è¦å°†å…¶æ¢å‡ºï¼‰å¹¶ç”¨äºŒè¿›åˆ¶é›¶å°†å…¶è¦†ç›–ï¼Œç„¶åæ›´æ–°é¡µè¡¨ä½¿è™šæ‹Ÿé¡µé¢æŒ‡å‘è¢«è¦†ç›–åçš„ç‰©ç†é¡µé¢ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­æ²¡æœ‰æ•°æ®è¢«æ¢å…¥åˆ°ç‰©ç†å†…å­˜ï¼Œå› æ­¤è¯¥åŒºåŸŸå†…çš„é¡µé¢åˆè¢«ç§°ä¸ºé›¶éœ€æ±‚é¡µé¢ï¼ˆDemand-zero Pageï¼‰ã€‚</li>
</ul>
<p>ä¸€æ—¦æˆ‘ä»¬ä½¿ç”¨å†…å­˜æ˜ å°„åˆå§‹åŒ–ä¸€ä¸ªè™šæ‹Ÿé¡µé¢ï¼Œå®ƒå°±ä¼šåœ¨ç”±å†…æ ¸ç»´æŠ¤çš„äº¤æ¢æ–‡ä»¶ï¼ˆSwap Fileï¼‰ä¸ç‰©ç†å†…å­˜ä¹‹é—´æ¥å›äº¤æ¢ã€‚äº¤æ¢æ–‡ä»¶åˆç§°äº¤æ¢åŒºï¼ˆSwap Areaï¼‰æˆ–äº¤æ¢ç©ºé—´ï¼ˆSwap Spaceï¼‰ï¼Œå®ƒçš„å¤§å°é™åˆ¶äº†å½“å‰è¿è¡Œè¿›ç¨‹æ‰€èƒ½ç”³è¯·çš„è™šæ‹Ÿé¡µé¢æ€»é‡ã€‚</p>
<h3 id="å›çœ‹å…±äº«ç›®æ ‡æ–‡ä»¶">å›çœ‹å…±äº«ç›®æ ‡æ–‡ä»¶<a class="headerlink" href="#å›çœ‹å…±äº«ç›®æ ‡æ–‡ä»¶" title="Permanent link">&para;</a></h3>
<p><img alt="alt text" src="../image/image-127.png" />
å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸¤è¿›ç¨‹å°†ç›¸åŒçš„ <strong>å…±äº«ç›®æ ‡æ–‡ä»¶</strong> æ˜ å°„åˆ°å„è‡ªè™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„ä¸åŒåŒºåŸŸï¼Œè€Œç‰©ç†å†…å­˜ä¸­åªéœ€å­˜åœ¨å•ä¸ªæ–‡ä»¶å‰¯æœ¬ã€‚è¿›ç¨‹ 1 å¯¹è¯¥å…±äº«åŒºåŸŸçš„ä»»ä½•å†™å…¥æ“ä½œéƒ½å¯¹è¿›ç¨‹ 2 å¯è§ï¼Œå¹¶ä¸”è¿™äº›æ›´æ”¹è¿˜ä¼šåŒæ­¥åˆ°ç£ç›˜ä¸Šçš„åŸå§‹æ–‡ä»¶ã€‚</p>
<p><img alt="alt text" src="../image/image-128.png" /></p>
<p>å¦‚ä¸Šå›¾ (a) æ‰€ç¤ºï¼Œä¸¤è¿›ç¨‹å°†ç§æœ‰ç›®æ ‡æ–‡ä»¶æ˜ å°„åˆ°å„è‡ªè™šæ‹Ÿåœ°å€ç©ºé—´çš„ä¸åŒåŒºåŸŸã€‚è¿›ç¨‹ 1 å¯¹è¯¥ç§æœ‰åŒºåŸŸçš„ä»»ä½•å†™å…¥æ“ä½œéƒ½å¯¹è¿›ç¨‹ 2 ä¸å¯è§ï¼Œå¹¶ä¸”è¿™äº›æ›´æ”¹ä¹Ÿä¸ä¼šåŒæ­¥åˆ°ç£ç›˜ä¸Šçš„åŸå§‹æ–‡ä»¶ã€‚å¦‚ä¸Šå›¾ (b) æ‰€ç¤ºï¼Œå½“è¿›ç¨‹ 2 è¯•å›¾ä¿®æ”¹è¯¥åŒºåŸŸä¸­çš„å†…å®¹æ—¶ï¼Œå†…æ ¸ä¼šåœ¨ç‰©ç†å†…å­˜ä¸­ä¸ºé¡µé¢åˆ›å»ºä¸€ä¸ªæ–°å‰¯æœ¬å¹¶æ›´æ–°é¡µè¡¨æ¡ç›®ä½¿å…¶æŒ‡å‘å®ƒã€‚ç”±äºé¡µé¢å¤åˆ¶å‘ç”Ÿåœ¨å†™å…¥æ“ä½œå‰ï¼Œè¿™ç§æŠ€æœ¯è¢«ç§°ä¸ºå†™æ—¶å¤åˆ¶ï¼ˆCopy-on-Writeï¼‰ï¼Œè¿™äº›åŒºåŸŸåˆ™æ˜¯ç§æœ‰å†™æ—¶å¤åˆ¶çš„ï¼ˆPrivate Copy-on-Writeï¼‰ã€‚</p>
<h3 id="å›çœ‹-fork-å‡½æ•°">å›çœ‹ fork å‡½æ•°<a class="headerlink" href="#å›çœ‹-fork-å‡½æ•°" title="Permanent link">&para;</a></h3>
<p>è¿›ç¨‹è°ƒç”¨ <code>fork</code> å‡½æ•°åï¼Œå†…æ ¸ä¼šä¸ºå­è¿›ç¨‹åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ PID å¹¶ä¸ºå…¶åˆ›å»ºä¸çˆ¶è¿›ç¨‹ç›¸åŒçš„<code>mm_struct</code>ã€<code>vm_area_structs</code>ä»¥åŠé¡µè¡¨ã€‚å½“ä»»æ„è¿›ç¨‹åç»­æ‰§è¡Œå†™å…¥æ“ä½œæ—¶ï¼Œå†…æ ¸å°†ä½¿ç”¨å†™æ—¶å¤åˆ¶æŠ€æœ¯åˆ›å»ºæ–°é¡µé¢ï¼Œè¿™ä¾¿ä¿è¯äº†è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´çš„ç§æœ‰æ€§ã€‚</p>
<h3 id="å›çœ‹-execve-å‡½æ•°">å›çœ‹ execve å‡½æ•°<a class="headerlink" href="#å›çœ‹-execve-å‡½æ•°" title="Permanent link">&para;</a></h3>
<p>å¦‚æœè¿›ç¨‹è°ƒç”¨ <code>execve</code> å‡½æ•°ï¼Œå¦‚<code>execve("a.out", NULL, NULL)</code>ï¼Œåˆ™åŠ è½½å¹¶è¿è¡Œ<code>a.out</code>çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ é™¤å½“å‰è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ç”¨æˆ·åŒºåŸŸçš„<code>vm_area_structs</code>ï¼›</li>
<li>ä¸ºæ–°ç¨‹åºçš„ä»£ç ã€æ•°æ®ã€bss å’Œå †æ ˆåŒºåŸŸåˆ›å»º<code>vm_area_structs</code>ã€‚è¿™äº›åŒºåŸŸéƒ½æ˜¯ç§æœ‰å†™æ—¶å¤åˆ¶çš„ï¼Œä»£ç å’Œæ•°æ®åŒºåŸŸè¢«æ˜ å°„åˆ°<code>a.out</code>æ–‡ä»¶ä¸­çš„ .text å’Œ .dataï¼Œbss åŒºåŸŸåˆ™è¢«æ˜ å°„åˆ°å¤§å°åŒ…å«åœ¨<code>a.out</code>å†…çš„åŒ¿åæ–‡ä»¶ã€‚å †æ ˆçš„åˆå§‹é•¿åº¦å‡ä¸º 0ï¼Œå…¶é¡µé¢æ˜¯é›¶éœ€æ±‚çš„ï¼›</li>
<li>å¦‚æœ<code>a.out</code>æ–‡ä»¶é“¾æ¥äº†å…±äº«åº“ï¼Œå¦‚ C æ ‡å‡†åº“<code>libc.so</code>ï¼Œé‚£ä¹ˆè¿˜éœ€è¦æŠŠè¿™äº›å¯¹è±¡åŠ¨æ€é“¾æ¥åˆ°ç¨‹åºä¸­ï¼Œå¹¶å°†å…¶æ˜ å°„åˆ°è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„å…±äº«åŒºåŸŸå†…ï¼›</li>
<li>ä½¿å½“å‰è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­çš„ç¨‹åºè®¡æ•°å™¨æŒ‡å‘æ–°ç¨‹åºä»£ç åŒºåŸŸçš„å…¥å£ç‚¹ã€‚</li>
</ol>
<p><img alt="alt text" src="../image/image-129.png" /></p>
<h3 id="mmap-å‡½æ•°">mmap å‡½æ•°<a class="headerlink" href="#mmap-å‡½æ•°" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/mman.h&gt;</span>
<span class="kt">void</span><span class="w">  </span><span class="o">*</span><span class="nf">mmap</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">prot</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">,</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">off_t</span><span class="w"> </span><span class="n">offset</span><span class="p">);</span>
<span class="c1">// Returns: pointer to mapped area if OK, MAP_FAILED (âˆ’1) on error</span>
</code></pre></div>
<p><code>mmap</code>å‡½æ•°è¯·æ±‚å†…æ ¸åˆ›å»ºä¸€ä¸ªèµ·å§‹åœ°å€ä¸ºå‚æ•°<code>start</code>çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸï¼Œè¯¥åŒºåŸŸæ˜ å°„åˆ°æ–‡ä»¶æè¿°ç¬¦<code>fd</code>æ‰€æŒ‡å®šçš„å¯¹è±¡ã€‚è¿ç»­å¯¹è±¡çš„é•¿åº¦ä¸ºå‚æ•°<code>length</code>ï¼Œå…¶é¦–éƒ¨åœ¨æ–‡ä»¶ä¸­çš„åç§»é‡ä¸ºå‚æ•°<code>offset</code>ï¼š</p>
<p><img alt="alt text" src="../image/image-130.png" /></p>
<p>å‚æ•°<code>prot</code>ä¸­åŒ…å«äº†æè¿°è™šæ‹Ÿå†…å­˜åŒºåŸŸè®¿é—®æƒé™çš„ä½ï¼Œå³<code>vm_area_structs</code>ä¸­çš„<code>vm_prot</code>ï¼š</p>
<ul>
<li><code>PROT_EXEC</code>ï¼šè¯¥åŒºåŸŸä¸­çš„é¡µé¢åŒ…å«å¯æ‰§è¡ŒæŒ‡ä»¤ï¼›</li>
<li><code>PROT_READ</code>ï¼šå¯ä»¥é˜…è¯»è¯¥åŒºåŸŸä¸­çš„é¡µé¢ï¼›</li>
<li><code>PROT_WRITE</code>ï¼šå¯ä»¥å†™å…¥è¯¥åŒºåŸŸä¸­çš„é¡µé¢ï¼›</li>
<li><code>PROT_NONE</code>ï¼šæ— æ³•è®¿é—®è¯¥åŒºåŸŸä¸­çš„é¡µé¢ã€‚</li>
</ul>
<p>å‚æ•°<code>flag</code>ä¸­åŒ…å«äº†æè¿°äº†æ˜ å°„å¯¹è±¡ç±»å‹çš„ä½ï¼š</p>
<ul>
<li><code>MAP_SHARED</code>ï¼šå…±äº«å¯¹è±¡ï¼›</li>
<li><code>MAP_PRIVATE</code>ï¼šç§æœ‰å†™æ—¶å¤åˆ¶å¯¹è±¡ï¼›</li>
<li><code>MAP_ANON</code>ï¼šåŒ¿åå¯¹è±¡ï¼Œå¯¹åº”çš„è™šæ‹Ÿé¡µé¢æ˜¯é›¶éœ€æ±‚é¡µé¢ã€‚</li>
</ul>
<p><code>munmap</code>å‡½æ•°åˆ é™¤èµ·å§‹äºè™šæ‹Ÿåœ°å€<code>start</code>ã€é•¿åº¦ä¸º<code>length</code>çš„åŒºåŸŸï¼Œåç»­å¯¹å·²åˆ é™¤åŒºåŸŸçš„å¼•ç”¨ä¼šå¼•å‘åˆ†æ®µæ•…éšœã€‚</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/mman.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">munmap</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">length</span><span class="p">);</span>
<span class="c1">// Returns: 0 if OK, âˆ’1 on error</span>
</code></pre></div>
<h2 id="åŠ¨æ€å†…å­˜åˆ†é…">åŠ¨æ€å†…å­˜åˆ†é…<a class="headerlink" href="#åŠ¨æ€å†…å­˜åˆ†é…" title="Permanent link">&para;</a></h2>
<p>ç›¸æ¯”äºä½çº§åˆ«çš„<code>mmap</code>å‡½æ•°ï¼ŒC ç¨‹åºå‘˜æ›´å€¾å‘äºåœ¨è¿è¡Œæ—¶è°ƒç”¨åŠ¨æ€å†…å­˜åˆ†é…å™¨ï¼ˆDynamic Memory Allocatorï¼‰æ¥åˆ›å»ºè™šæ‹Ÿå†…å­˜åŒºåŸŸã€‚åŠ¨æ€å†…å­˜åˆ†é…å™¨ä¸ºè¿›ç¨‹ç»´æŠ¤çš„è™šæ‹Ÿå†…å­˜åŒºåŸŸè¢«ç§°ä¸ºå †ï¼ˆHeapï¼‰ï¼Œå…¶ä¸€èˆ¬ç»“æ„ä¸ºï¼š</p>
<p><img alt="alt text" src="../image/image-131.png" /></p>
<p>å †å‘ä¸Šå¢é•¿ï¼Œå†…æ ¸ä¸ºæ¯ä¸ªè¿›ç¨‹éƒ½ç»´æŠ¤äº†ä¸€ä¸ªæŒ‡å‘å †é¡¶çš„å˜é‡<code>brk</code>ã€‚åˆ†é…å™¨å°†å †çœ‹ä½œä¸€ä¸ªåŒ…å«ä¸åŒå°ºå¯¸ Block çš„é›†åˆï¼Œæ¯ä¸ª Block éƒ½æ˜¯ä¸€ä¸ªè¿ç»­çš„è™šæ‹Ÿå†…å­˜å—ã€‚Block æœ‰ä¸¤ç§çŠ¶æ€ï¼Œå·²åˆ†é…ï¼ˆAllocatedï¼‰å’Œç©ºé—²ï¼ˆFreeï¼‰ã€‚æ‰€æœ‰åˆ†é…å™¨å‡æ˜¾å¼åœ°ä¸ºåº”ç”¨ç¨‹åºåˆ†é… Blockï¼Œä½†è´Ÿè´£é‡Šæ”¾å·²åˆ†é… Block çš„å®ä½“å¯èƒ½æœ‰æ‰€ä¸åŒï¼š</p>
<ul>
<li>æ˜¾å¼åˆ†é…å™¨ï¼šåº”ç”¨ç¨‹åºæ˜¾å¼åœ°é‡Šæ”¾å·²åˆ†é…çš„ Blockã€‚C å’Œ C++ ç¨‹åºåˆ†åˆ«è°ƒç”¨<code>malloc</code>å’Œ<code>new</code>å‡½æ•°è¯·æ±‚ Blockï¼Œè°ƒç”¨<code>free</code>å’Œ<code>delete</code>å‡½æ•°é‡Šæ”¾ Blockï¼›</li>
<li>éšå¼åˆ†é…å™¨ï¼šåˆ†é…å™¨è‡ªè¡Œé‡Šæ”¾ç¨‹åºä¸å†ä½¿ç”¨çš„å·²åˆ†é… Blockï¼Œè¯¥è¿‡ç¨‹è¢«ç§°ä¸ºåƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ã€‚Lispã€ML å’Œ Java ç­‰é«˜çº§è¯­è¨€å‡é‡‡ç”¨è¿™ç§æ–¹æ³•ã€‚</li>
</ul>
<h3 id="malloc-å’Œ-free-å‡½æ•°">malloc å’Œ free å‡½æ•°<a class="headerlink" href="#malloc-å’Œ-free-å‡½æ•°" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">malloc</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
<span class="c1">// Returns: pointer to allocated block if OK, NULL on error</span>
</code></pre></div>
<p><code>malloc</code>å‡½æ•°è¯·æ±‚å †ä¸­çš„ä¸€å— Block å¹¶è¿”å›æŒ‡å‘è¯¥ Block çš„æŒ‡é’ˆã€‚Block çš„å¤§å°è‡³å°‘ä¸ºå‚æ•°<code>size</code>ï¼Œå¹¶å¯èƒ½æ ¹æ®å…¶ä¿å­˜çš„æ•°æ®å¯¹è±¡ç±»å‹è¿›è¡Œé€‚å½“å¯¹é½ã€‚åœ¨ 32 ä½ç¼–è¯‘æ¨¡å¼ä¸‹ï¼ŒBlock çš„åœ°å€å§‹ç»ˆä¸º 8 çš„å€æ•°ï¼Œè€Œåœ¨ 64 ä½ä¸­åˆ™ä¸º 16 çš„å€æ•°ã€‚å¦‚æœæ‰§è¡Œ<code>malloc</code>é‡åˆ°é—®é¢˜ï¼Œå¦‚ç¨‹åºè¯·æ±‚çš„ Block å¤§å°è¶…è¿‡äº†å¯ç”¨çš„è™šæ‹Ÿå†…å­˜ï¼Œåˆ™å‡½æ•°è¿”å›<code>NULL</code>å¹¶è®¾ç½® <a href="https://man7.org/linux/man-pages/man3/errno.3.html"><code>errno</code></a>ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨<code>malloc</code>çš„åŒ…è£…å‡½æ•°<code>calloc</code>ï¼Œå®ƒä¼šå°†åˆ†é…çš„å†…å­˜åˆå§‹åŒ–ä¸ºé›¶ã€‚ç±»ä¼¼åœ°ï¼Œ<code>realloc</code>å‡½æ•°å¯ä»¥æ›´æ”¹å·²åˆ†é… Block çš„å¤§å°ã€‚</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="nf">sbrk</span><span class="p">(</span><span class="kt">intptr_t</span><span class="w"> </span><span class="n">incr</span><span class="p">);</span>
<span class="c1">// Returns: old brk pointer on success, âˆ’1 on error</span>
</code></pre></div>
<p><code>sbrk</code>å‡½æ•°å°†å‚æ•°<code>incr</code>ä¸å†…æ ¸ä¸­çš„<code>brk</code>æŒ‡é’ˆç›¸åŠ ä»¥å¢å¤§æˆ–ç¼©å°å †ã€‚è‹¥æ‰§è¡ŒæˆåŠŸï¼Œåˆ™è¿”å›<code>brk</code>çš„æ—§å€¼ï¼Œå¦åˆ™å°†è¿”å› -1 å¹¶å°†<code>errno</code>è®¾ç½®ä¸º<code>ENOMEM</code>ã€‚</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">free</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span><span class="p">);</span>
<span class="c1">// Returns: nothing</span>
</code></pre></div>
<p><code>free</code>å‡½æ•°å°†å‚æ•°<code>ptr</code>æŒ‡å‘çš„ Block é‡Šæ”¾ï¼Œè€Œè¿™äº› Block å¿…é¡»æ˜¯ç”±<code>malloc</code>ã€<code>calloc</code>æˆ–<code>realloc</code>åˆ†é…çš„ã€‚è¯¥å‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œå› æ­¤å¾ˆå®¹æ˜“äº§ç”Ÿä¸€äº›ä»¤äººè´¹è§£çš„è¿è¡Œæ—¶é”™è¯¯ã€‚</p>
<p><img alt="alt text" src="../image/image-132.png" />
ä¸Šå›¾å±•ç¤ºäº† C ç¨‹åºå¦‚ä½•ä½¿ç”¨<code>malloc</code>å’Œ<code>free</code>ç®¡ç†ä¸€ä¸ªå¤§å°ä¸º 16 å­—ï¼ˆå­—é•¿ä¸º 4 å­—èŠ‚ï¼‰çš„å †ã€‚å›¾ä¸­çš„æ¯ä¸ªæ–¹æ¡†ä»£è¡¨ä¸€ä¸ªå­—ï¼Œæ¯ä¸ªè¢«ç²—çº¿åˆ†éš”çš„çŸ©å½¢ä»£è¡¨ä¸€ä¸ª Blockã€‚æœ‰é˜´å½±çš„ Block ä»£è¡¨å·²åˆ†é…ï¼Œæ— é˜´å½±çš„ Block åˆ™ä»£è¡¨ç©ºé—²ã€‚</p>
<p>å¦‚ä¸Šå›¾ (a) æ‰€ç¤ºï¼Œç¨‹åºè¯·æ±‚ä¸€ä¸ª 4 å­—çš„ Blockï¼Œ<code>malloc</code>ä»ç©ºé—²å—ä¸­åˆ‡å‡ºä¸€ä¸ª 4 å­—çš„ Block å¹¶è¿”å›æŒ‡å‘è¯¥ Block ä¸­ç¬¬ä¸€ä¸ªå­—çš„æŒ‡é’ˆ<code>p1</code>ï¼›å¦‚ä¸Šå›¾ (b) æ‰€ç¤ºï¼Œç¨‹åºè¯·æ±‚ä¸€ä¸ª 5 å­—çš„ Blockï¼Œ<code>malloc</code>ä»ç©ºé—²å—ä¸­åˆ‡å‡ºä¸€ä¸ª 6 å­—çš„ Block ä»¥å®ç°åŒå­—å¯¹é½ï¼›å¦‚ä¸Šå›¾ &copy; æ‰€ç¤ºï¼Œç¨‹åºè¯·æ±‚ä¸€ä¸ª 6 å­—çš„ Blockï¼Œ<code>malloc</code>ä»ç©ºé—²å—ä¸­åˆ‡å‡ºä¸€ä¸ª 6 å­—çš„ Blockï¼›å¦‚ä¸Šå›¾ (d) æ‰€ç¤ºï¼Œç¨‹åºé‡Šæ”¾å›¾ (b) ä¸­åˆ†é…çš„ Blockã€‚<code>free</code>è¿”å›åï¼ŒæŒ‡é’ˆ<code>p2</code>ä¾ç„¶æŒ‡å‘å·²é‡Šæ”¾çš„ Blockï¼Œå› æ­¤ç¨‹åºä¸åº”åœ¨é‡æ–°åˆå§‹åŒ–<code>p2</code>å‰ç»§ç»­ä½¿ç”¨å®ƒï¼›å¦‚ä¸Šå›¾ (e) æ‰€ç¤ºï¼Œç¨‹åºè¯·æ±‚ä¸€ä¸ª 2 å­—çš„ Blockã€‚<code>malloc</code>ä»ä¸Šä¸€æ­¥é‡Šæ”¾çš„ Block ä¸­åˆ‡å‡ºä¸€éƒ¨åˆ†å¹¶è¿”å›æŒ‡å‘æ–° Block çš„æŒ‡é’ˆ<code>p4</code>ã€‚</p>
<h3 id="åŠ¨æ€å†…å­˜åˆ†é…çš„åŸå› ">åŠ¨æ€å†…å­˜åˆ†é…çš„åŸå› <a class="headerlink" href="#åŠ¨æ€å†…å­˜åˆ†é…çš„åŸå› " title="Permanent link">&para;</a></h3>
<p>åœ¨ç¨‹åºå®é™…è¿è¡Œä¹‹å‰ï¼Œæˆ‘ä»¬å¯èƒ½å¹¶ä¸çŸ¥é“æŸäº›æ•°æ®ç»“æ„çš„å¤§å°ã€‚ç¤ºä¾‹ C ç¨‹åºå°†<code>n</code>ä¸ª ASCII æ•´å‹ä»æ ‡å‡†è¾“å…¥è¯»å–åˆ°æ•°ç»„<code>array[MAXN]</code>ä¸­ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;csapp.h&quot;</span>
<span class="cp">#define MAXN 15213</span>

<span class="kt">int</span><span class="w"> </span><span class="n">array</span><span class="p">[</span><span class="n">MAXN</span><span class="p">];</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">MAXN</span><span class="p">)</span>
<span class="w">        </span><span class="n">app_error</span><span class="p">(</span><span class="s">&quot;Input file too big&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>ç”±äºæˆ‘ä»¬æ— æ³•é¢„æµ‹<code>n</code>çš„å€¼ï¼Œå› æ­¤åªèƒ½å°†æ•°ç»„å¤§å°å†™æ­»ä¸º<code>MAXN</code>ã€‚<code>MAXN</code>çš„å€¼æ˜¯ä»»æ„çš„ï¼Œå¯èƒ½è¶…å‡ºç³»ç»Ÿå¯ç”¨çš„è™šæ‹Ÿå†…å­˜é‡ã€‚å¦å¤–ï¼Œä¸€æ—¦ç¨‹åºæƒ³è¦è¯»å–ä¸€ä¸ªæ¯”<code>MAXN</code>è¿˜å¤§çš„æ–‡ä»¶ï¼Œå”¯ä¸€çš„åŠæ³•å°±æ˜¯å¢å¤§<code>MAXN</code>çš„å€¼å¹¶é‡æ–°ç¼–è¯‘ç¨‹åºã€‚å¦‚æœæˆ‘ä»¬åœ¨è¿è¡Œæ—¶æ ¹æ®<code>n</code>çš„å¤§å°åŠ¨æ€åˆ†é…å†…å­˜ï¼Œä»¥ä¸Šé—®é¢˜ä¾¿è¿åˆƒè€Œè§£ï¼š</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;csapp.h&quot;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<span class="w">    </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
<span class="w">    </span><span class="n">array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">Malloc</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">array</span><span class="p">);</span>
<span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="å¯¹åˆ†é…å™¨çš„è¦æ±‚å’Œç›®æ ‡">å¯¹åˆ†é…å™¨çš„è¦æ±‚å’Œç›®æ ‡<a class="headerlink" href="#å¯¹åˆ†é…å™¨çš„è¦æ±‚å’Œç›®æ ‡" title="Permanent link">&para;</a></h3>
<p>æ˜¾å¼åˆ†é…å™¨å¿…é¡»åœ¨è‹¥å¹²é™åˆ¶æ¡ä»¶ä¸‹è¿è¡Œï¼š</p>
<ul>
<li>å¤„ç†ä»»æ„é¡ºåºçš„è¯·æ±‚ï¼šåˆ†é…å™¨ä¸èƒ½å¯¹<code>malloc</code>å’Œ<code>free</code>çš„è¯·æ±‚é¡ºåºä½œå‡ºå‡è®¾ã€‚ä¾‹å¦‚ï¼Œåˆ†é…å™¨ä¸èƒ½å‡è®¾æ‰€æœ‰çš„<code>malloc</code>éƒ½ç´§è·Ÿä¸€ä¸ªä¸ä¹‹åŒ¹é…çš„<code>free</code>ï¼›</li>
<li>ç«‹å³å“åº”è¯·æ±‚ï¼šåˆ†é…å™¨ä¸å¯ä»¥å¯¹è¯·æ±‚é‡æ–°æ’åºæˆ–ç¼“å†²ï¼ˆBufferï¼‰ä»¥æé«˜æ€§èƒ½ï¼›</li>
<li>ä»…ä½¿ç”¨å †ï¼šåˆ†é…å™¨ä½¿ç”¨çš„æ•°æ®ç»“æ„å¿…é¡»å­˜å‚¨åœ¨å †ä¸­ï¼›</li>
<li>å¯¹é½ Blockï¼šåˆ†é…å™¨å¿…é¡»å¯¹é½ Block ä»¥ä½¿å…¶èƒ½å¤Ÿå®¹çº³ä»»ä½•ç±»å‹çš„æ•°æ®å¯¹è±¡ï¼›</li>
<li>ä¸ä¿®æ”¹å·²åˆ†é…çš„ Blockï¼šåˆ†é…å™¨æ— æ³•ä¿®æ”¹ã€ç§»åŠ¨æˆ–å‹ç¼©å·²åˆ†é…çš„ Blockã€‚</li>
</ul>
<p>è¡¡é‡åˆ†é…å™¨æ€§èƒ½çš„æŒ‡æ ‡æœ‰ï¼š</p>
<ul>
<li>ååé‡ï¼ˆThroughputï¼‰ï¼šå•ä½æ—¶é—´å†…å®Œæˆçš„è¯·æ±‚æ•°ï¼›</li>
<li>å†…å­˜åˆ©ç”¨ç‡ï¼ˆMemory Utilizationï¼‰ï¼šå³å †å†…å­˜çš„ä½¿ç”¨ç‡ã€‚</li>
</ul>
<p>æœ€å¤§åŒ–ååé‡å’Œæœ€å¤§åŒ–å†…å­˜åˆ©ç”¨ç‡ä¹‹é—´å­˜åœ¨çŸ›ç›¾ï¼Œå› æ­¤æˆ‘ä»¬åœ¨è®¾è®¡åˆ†é…å™¨æ—¶éœ€è¦æ‰¾åˆ°äºŒè€…çš„å¹³è¡¡ã€‚</p>
<h3 id="ç¢ç‰‡">ç¢ç‰‡<a class="headerlink" href="#ç¢ç‰‡" title="Permanent link">&para;</a></h3>
<p>æˆ‘ä»¬å°†ç©ºé—²å †å†…å­˜æ— æ³•æ»¡è¶³åˆ†é…è¯·æ±‚çš„ç°è±¡ç§°ä¸ºç¢ç‰‡ï¼ˆFragmentationï¼‰ï¼Œå®ƒæ˜¯å†…å­˜åˆ©ç”¨ç‡ä½çš„ä¸»è¦åŸå› ã€‚ç¢ç‰‡æœ‰ä¸¤ç§å½¢å¼ï¼š</p>
<ul>
<li>å†…éƒ¨ç¢ç‰‡ï¼ˆInternal Fragmentationï¼‰ï¼šå·²åˆ†é…çš„ Block æ¯”è¿›ç¨‹è¯·æ±‚çš„ Blockï¼ˆå³ Payloadï¼‰å¤§ï¼Œé€šå¸¸å› åˆ†é…å™¨ä¸ºæ»¡è¶³å¯¹é½è¦æ±‚è€Œäº§ç”Ÿï¼›</li>
<li>å¤–éƒ¨ç¢ç‰‡ï¼ˆExternal Fragmentationï¼‰ï¼šç©ºé—²å†…å­˜å……è¶³ä½†å´æ²¡æœ‰ç©ºé—²çš„ Block èƒ½å¤Ÿæ»¡è¶³åˆ†é…è¯·æ±‚ã€‚ä¾‹å¦‚å †ä¸­æœ‰ 4 ä¸ªç©ºé—²çš„å­—ä¸”åˆ†å¸ƒåœ¨ä¸¤ä¸ªä¸ç›¸é‚»çš„ Block ä¸Šï¼Œæ­¤æ—¶è‹¥è¿›ç¨‹ç”³è¯·ä¸€ä¸ª 4 å­—çš„ Block å°±ä¼šå‡ºç°å¤–éƒ¨ç¢ç‰‡ã€‚</li>
</ul>
<p>å†…éƒ¨ç¢ç‰‡å¾ˆå®¹æ˜“é‡åŒ–ï¼Œå› ä¸ºå®ƒåªæ˜¯å·²åˆ†é… Block ä¸ Payload ä¹‹é—´å¤§å°å·®å¼‚çš„æ€»å’Œï¼Œå…¶æ•°é‡ä»…å–å†³äºå…ˆå‰çš„è¯·æ±‚æ¨¡å¼å’Œåˆ†é…å™¨çš„å®ç°æ–¹å¼ï¼›å¤–éƒ¨ç¢ç‰‡åˆ™éš¾ä»¥é‡åŒ–ï¼Œå› ä¸ºå®ƒè¿˜è¦å—åˆ°æœªæ¥è¯·æ±‚æ¨¡å¼çš„å½±å“ã€‚ä¸ºäº†å‡å°‘å¤–éƒ¨ç¢ç‰‡çš„äº§ç”Ÿï¼Œåˆ†é…å™¨åŠ›æ±‚ç»´æŠ¤å°‘é‡è¾ƒå¤§çš„ç©ºé—² Block è€Œéå¤§é‡è¾ƒå°çš„ç©ºé—² Blockã€‚</p>
<h3 id="åˆ†é…å™¨çš„å®ç°éš¾ç‚¹">åˆ†é…å™¨çš„å®ç°éš¾ç‚¹<a class="headerlink" href="#åˆ†é…å™¨çš„å®ç°éš¾ç‚¹" title="Permanent link">&para;</a></h3>
<p>æˆ‘ä»¬å¯ä»¥æƒ³è±¡ä¸€ä¸ªç®€å•çš„åˆ†é…å™¨ï¼Œå®ƒå°†å †çœ‹ä½œä¸€ä¸ªå¤§å‹çš„å­—èŠ‚æ•°ç»„ï¼ŒæŒ‡é’ˆ<code>p</code>æŒ‡å‘è¯¥æ•°ç»„çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ã€‚å½“è¿›ç¨‹è¯·æ±‚<code>size</code>å¤§å°çš„ Block æ—¶ï¼Œ<code>malloc</code>å…ˆæŠŠ<code>p</code>çš„å½“å‰å€¼ä¿å­˜åœ¨æ ˆä¸­ï¼Œç„¶åå°†å…¶åŠ ä¸Š<code>size</code>ï¼Œæœ€åè¿”å›<code>p</code>çš„æ—§å€¼ã€‚å½“è¿›ç¨‹æƒ³è¦é‡Šæ”¾ Block æ—¶ï¼Œ<code>free</code>åˆ™åªæ˜¯ç®€å•åœ°è¿”å›ç»™è°ƒç”¨è€…è€Œä¸åšä»»ä½•äº‹æƒ…ã€‚</p>
<p>ç”±äº<code>malloc</code>å’Œ<code>free</code>ä»…ç”±å°‘é‡æŒ‡ä»¤ç»„æˆï¼Œè¿™ç§åˆ†é…å™¨çš„ååé‡å¾ˆå¤§ã€‚ç„¶è€Œ<code>malloc</code>ä¸ä¼šé‡ç”¨ä»»ä½• Blockï¼Œå› æ­¤å †å†…å­˜çš„åˆ©ç”¨ç‡éå¸¸ä½ã€‚èƒ½å¤Ÿåœ¨ååé‡å’Œå†…å­˜åˆ©ç”¨ç‡ä¹‹é—´å–å¾—è‰¯å¥½å¹³è¡¡çš„åˆ†é…å™¨å¿…é¡»è€ƒè™‘ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>ç»„ç»‡ï¼ˆOrganizationï¼‰ï¼šå¦‚ä½•è·Ÿè¸ªç©ºé—²çš„ Blockï¼Ÿ</li>
<li>æ”¾ç½®ï¼ˆPlacementï¼‰ï¼šå¦‚ä½•ä»ç©ºé—²çš„ Block ä¸­é€‰æ‹©åˆé€‚çš„æ¥æ”¾ç½®æ–°åˆ†é…çš„ Blockï¼Ÿ</li>
<li>åˆ†å‰²ï¼ˆSplittingï¼‰ï¼šå®Œæˆæ”¾ç½®åï¼Œå¦‚ä½•å¤„ç†å‰©ä½™çš„ç©ºé—² Blockï¼Ÿ</li>
<li>åˆå¹¶ï¼ˆCoalescingï¼‰ï¼šå¦‚ä½•å¤„ç†åˆšåˆšè¢«é‡Šæ”¾çš„ Blockï¼Ÿ</li>
</ul>
<h3 id="éšå¼ç©ºé—²é“¾è¡¨">éšå¼ç©ºé—²é“¾è¡¨<a class="headerlink" href="#éšå¼ç©ºé—²é“¾è¡¨" title="Permanent link">&para;</a></h3>
<p>å¤§å¤šæ•°åˆ†é…å™¨é€šè¿‡å°†ä¸€äº›æ•°æ®ç»“æ„åµŒå…¥åˆ° Block ä¸­ä»¥åˆ†è¾¨å…¶è¾¹ç•Œå’ŒçŠ¶æ€ï¼Œä¾‹å¦‚ï¼š</p>
<p><img alt="alt text" src="../image/image-133.png" /></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒBlock ç”±ä¸€ä¸ªå•å­—ï¼ˆå››å­—èŠ‚ï¼‰çš„å¤´éƒ¨ï¼ˆHeaderï¼‰ã€æœ‰æ•ˆè´Ÿè½½ï¼ˆPayloadï¼‰å’Œä¸€äº›é¢å¤–å¡«å……ï¼ˆPaddingï¼‰ç»„æˆï¼Œå¤´éƒ¨ä¸­åŒ…å«äº† Block çš„å¤§å°ï¼ˆBlock Sizeï¼‰å’ŒçŠ¶æ€ä¿¡æ¯ï¼ˆAllocated or Freeï¼‰ã€‚å¦‚æœç³»ç»Ÿé‡‡ç”¨åŒå­—å¯¹é½ç­–ç•¥ï¼Œé‚£ä¹ˆæ¯ä¸ª Block çš„å¤§å°å§‹ç»ˆä¸º 8 çš„å€æ•°ï¼Œå…¶äºŒè¿›åˆ¶è¡¨è¾¾çš„å 3 ä½å§‹ç»ˆä¸º 0ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ä»…åœ¨å¤´éƒ¨ä¸­å­˜å‚¨è¯¥å­—æ®µçš„å‰ 29 ä½ï¼Œå‰©ä½™ 3 ä½ç”¨æ¥å­˜å‚¨å…¶ä»–ä¿¡æ¯ã€‚ä¸Šå›¾ä¸­çš„ä½â€œaâ€ä¾¿æŒ‡ç¤ºäº†æ­¤ Block æ˜¯å·²åˆ†é…çš„è¿˜æ˜¯ç©ºé—²çš„ã€‚å¡«å……çš„å¤§å°æ˜¯ä»»æ„çš„ï¼Œå®ƒå¯èƒ½æ˜¯åˆ†é…å™¨ä¸ºäº†é¿å…å¤–éƒ¨ç¢ç‰‡äº§ç”Ÿè€Œè®¾ç½®çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸ºäº†æ»¡è¶³å¯¹é½è¦æ±‚è€Œå­˜åœ¨çš„ã€‚</p>
<p>åŸºäºè¿™ç§ Block æ ¼å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†å †ç»„ç»‡æˆä¸€ç³»åˆ—è¿ç»­çš„å·²åˆ†é… Block å’Œç©ºé—² Blockï¼š</p>
<p><img alt="alt text" src="../image/image-134.png" />
Block é€šè¿‡å…¶å¤´éƒ¨ä¸­çš„å¤§å°å­—æ®µéšå¼åœ°é“¾æ¥èµ·æ¥ï¼ˆaddr(next_block) = addr(current_block) + block_sizeï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å°†è¿™ç§å †ç»„ç»‡æ–¹å¼ç§°ä¸ºéšå¼ç©ºé—²é“¾è¡¨ï¼ˆImplicit Free Listï¼‰ï¼Œåˆ†é…å™¨å¿…é¡»éå†å †ä¸­æ‰€æœ‰çš„ Block æ‰èƒ½å¾—åˆ°å…¨éƒ¨ç©ºé—²çš„ Blockã€‚æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„ Block ä»¥æ ‡è®°å †çš„ç»“å°¾ï¼Œå¦‚ä¸Šå›¾ä¸­çš„ â€œ0/1â€ã€‚éšå¼ç©ºé—²é“¾è¡¨çš„ä¼˜ç‚¹æ˜¯ç®€å•ï¼Œä½†ä»»ä½•æœç´¢ç©ºé—² Block çš„æ“ä½œï¼ˆå¦‚æ”¾ç½®æ–°åˆ†é…çš„ Blockï¼‰çš„æˆæœ¬éƒ½ä¸å †ä¸­ Block çš„æ€»æ•°æˆæ­£æ¯”ã€‚</p>
<h3 id="æ”¾ç½®æ–°åˆ†é…çš„-block">æ”¾ç½®æ–°åˆ†é…çš„ Block<a class="headerlink" href="#æ”¾ç½®æ–°åˆ†é…çš„-block" title="Permanent link">&para;</a></h3>
<p>å½“åº”ç”¨ç¨‹åºè¯·æ±‚ä¸€ä¸ª Block æ—¶ï¼Œåˆ†é…å™¨éœ€è¦åœ¨ç©ºé—²é“¾è¡¨ä¸­é€‰å–ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ Block ä»¥å“åº”ã€‚åˆ†é…å™¨æœç´¢ç©ºé—² Block çš„æ–¹å¼ç”±æ”¾ç½®ç­–ç•¥ï¼ˆPlacement Policyï¼‰æ‰€å†³å®šï¼š</p>
<ul>
<li>ç¬¬ä¸€æ¬¡æ‹Ÿåˆï¼ˆFirst Fitï¼‰ï¼šä»å¤´å¼€å§‹éå†ç©ºé—²é“¾è¡¨å¹¶é€‰æ‹©ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„ Blockï¼›</li>
<li>ä¸‹ä¸€æ¬¡æ‹Ÿåˆï¼ˆNext Fitï¼‰ï¼šä»ä¸Šä¸€æ¬¡æœç´¢åœæ­¢çš„åœ°æ–¹å¼€å§‹éå†ç©ºé—²é“¾è¡¨å¹¶é€‰æ‹©ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„ Blockï¼›</li>
<li>æœ€ä½³æ‹Ÿåˆï¼ˆBest Fitï¼‰ï¼šéå†æ‰€æœ‰ Block å¹¶é€‰æ‹©æ»¡è¶³æ¡ä»¶ä¸”æœ€å°çš„ Blockã€‚</li>
</ul>
<p>ç¬¬ä¸€æ¬¡æ‹Ÿåˆçš„ä¼˜ç‚¹æ˜¯è¾ƒå¤§çš„ Block é€šå¸¸å­˜ç•™åœ¨é“¾è¡¨æœ«å°¾ï¼Œä½†ä¸€äº›è¾ƒå°çš„ Block ä¹Ÿä¼šæ•£è½åœ¨é“¾è¡¨å¼€å¤´ï¼Œè¿™å°†å¢åŠ æœç´¢è¾ƒå¤§ Block çš„æ—¶é—´ã€‚å¦‚æœé“¾è¡¨å¼€å¤´å­˜åœ¨å¤§é‡è¾ƒå°çš„ Blockï¼Œä¸‹ä¸€æ¬¡æ‹Ÿåˆå°±æ¯”ç¬¬ä¸€æ¬¡æ‹Ÿåˆå¿«å¾ˆå¤šã€‚ç„¶è€Œç ”ç©¶è¡¨æ˜ï¼Œä¸‹ä¸€æ¬¡æ‹Ÿåˆçš„å†…å­˜åˆ©ç”¨ç‡æ¯”ç¬¬ä¸€æ¬¡æ‹Ÿåˆä½ã€‚æœ€ä½³æ‹Ÿåˆçš„å†…å­˜åˆ©ç”¨ç‡é€šå¸¸æ¯”å…¶ä»–ä¸¤ç§ç­–ç•¥é«˜ï¼Œä½†å¯¹éšå¼ç©ºé—²é“¾è¡¨æ¥è¯´ï¼Œå…¶æœç´¢æ—¶é—´æ˜¾ç„¶è¦æ¯”å®ƒä»¬æ…¢å¾ˆå¤šã€‚</p>
<h3 id="åˆ†å‰²ç©ºé—²çš„-block">åˆ†å‰²ç©ºé—²çš„ Block<a class="headerlink" href="#åˆ†å‰²ç©ºé—²çš„-block" title="Permanent link">&para;</a></h3>
<p>å¦‚æœåˆ†é…å™¨æ‰¾åˆ°äº†åˆé€‚çš„ Block å¹¶å°†æ•´ä¸ª Block åˆ†é…ç»™ç¨‹åºï¼Œå°±æœ‰å¯èƒ½äº§ç”Ÿå†…éƒ¨ç¢ç‰‡ã€‚ä¸ºäº†é¿å…è¿™ä¸€é—®é¢˜ï¼Œåˆ†é…å™¨å¯ä»¥å°†é€‰å–çš„ Block åˆ†æˆä¸€ä¸ªå·²åˆ†é…çš„ Block å’Œä¸€ä¸ªæ–°çš„ç©ºé—² Blockï¼š</p>
<p><img alt="alt text" src="../image/image-135.png" />
å¦‚å›¾ 9.37 æ‰€ç¤ºï¼Œç¨‹åºè¯·æ±‚ä¸€ä¸ª 3 å­—çš„ Blockï¼Œäºæ˜¯åˆ†é…å™¨å°†å›¾ 9.36 ä¸­ 8 å­—çš„ç©ºé—² Block æ‹†åˆ†ä¸ºä¸¤ä¸ª 4 å­—çš„ Block å¹¶å°†å…¶ä¸­ä¹‹ä¸€åˆ†é…ç»™å®ƒã€‚</p>
<h3 id="è·å–é¢å¤–çš„å †å†…å­˜">è·å–é¢å¤–çš„å †å†…å­˜<a class="headerlink" href="#è·å–é¢å¤–çš„å †å†…å­˜" title="Permanent link">&para;</a></h3>
<p>å¦‚æœåˆ†é…å™¨æ— æ³•æ‰¾åˆ°åˆé€‚çš„ Blockï¼Œå®ƒå¯ä»¥å°è¯•å°†ç›¸é‚»çš„ç©ºé—² Block åˆå¹¶ä»¥è·å–æ›´å¤§çš„ Blockã€‚ä½†å¦‚æœä»ç„¶æ— æ³•æ»¡è¶³è¯·æ±‚ï¼Œåˆ†é…å™¨ä¾¿ä¼šè°ƒç”¨<code>sbrk</code>å‡½æ•°å‘å†…æ ¸è¯·æ±‚é¢å¤–çš„å †å†…å­˜å¹¶å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªæ–°çš„ç©ºé—² Blockã€‚</p>
<h3 id="åˆå¹¶ç©ºé—²çš„-block">åˆå¹¶ç©ºé—²çš„ Block<a class="headerlink" href="#åˆå¹¶ç©ºé—²çš„-block" title="Permanent link">&para;</a></h3>
<p>åˆ†é…å™¨é‡Šæ”¾ Block åï¼Œå¯èƒ½ä¼šæœ‰å…¶ä»–ç©ºé—²çš„ Block ä¸ä¹‹ç›¸é‚»ã€‚æ­¤æ—¶å†…å­˜ä¸­å°†äº§ç”Ÿä¸€ç§ç‰¹æ®Šçš„å¤–éƒ¨ç¢ç‰‡ç°è±¡ï¼Œæˆ‘ä»¬ç§°å…¶ä¸ºè™šå‡ç¢ç‰‡ï¼ˆFalse Fagmentationï¼‰ã€‚</p>
<p><img alt="alt text" src="../image/image-136.png" />
å¦‚å›¾ 9.38 æ‰€ç¤ºï¼Œåˆ†é…å™¨å°†å›¾ 9.37 ä¸­ç¬¬äºŒä¸ª 4 å­— Block é‡Šæ”¾ã€‚å°½ç®¡ä¸¤ä¸ªè¿ç»­ç©ºé—² Block ä¸­å‡æœ‰ 3 å­—çš„æœ‰æ•ˆè´Ÿè½½ï¼Œå®ƒä»¬ä¹Ÿæ— æ³•æ»¡è¶³ä¸€ä¸ª 4 å­—çš„åˆ†é…è¯·æ±‚ã€‚å› æ­¤ï¼Œåˆ†é…å™¨å¿…é¡»å°†ç›¸é‚»ç©ºé—²çš„ Block åˆå¹¶ã€‚</p>
<p>åˆ†é…å™¨å¯ä»¥åœ¨æ¯æ¬¡é‡Šæ”¾ Block åç«‹å³åˆå¹¶ Blockï¼Œä¹Ÿå¯ä»¥ç­‰åˆ°æŸä¸ªæ—¶åˆ»ï¼Œæ¯”å¦‚åˆ†é…è¯·æ±‚å¤±è´¥æ—¶æ‰åˆå¹¶å †ä¸­æ‰€æœ‰ç©ºé—²çš„ Blockã€‚ç«‹å³åˆå¹¶å¾ˆç®€å•ï¼Œä½†å®ƒä¹Ÿæœ‰å¯èƒ½é€ æˆâ€œé¢ ç°¸â€ï¼Œå³æŸä¸ª Block åœ¨çŸ­æ—¶é—´å†…è¢«å¤šæ¬¡åˆå¹¶å’Œåˆ†å‰²ã€‚</p>
<h3 id="ä½¿ç”¨è¾¹ç•Œæ ‡è®°åˆå¹¶-block">ä½¿ç”¨è¾¹ç•Œæ ‡è®°åˆå¹¶ Block<a class="headerlink" href="#ä½¿ç”¨è¾¹ç•Œæ ‡è®°åˆå¹¶-block" title="Permanent link">&para;</a></h3>
<p>æˆ‘ä»¬æŠŠå³å°†é‡Šæ”¾çš„ Block ç§°ä¸ºå½“å‰ï¼ˆCurrentï¼‰Blockï¼Œå…¶å¤´éƒ¨æŒ‡å‘ä¸‹ä¸€ä¸ª Block çš„å¤´éƒ¨ï¼ˆaddr(next_block) = addr(current_block) + block_sizeï¼‰ã€‚å› æ­¤æˆ‘ä»¬å¾ˆå®¹æ˜“åˆ¤æ–­ä¸‹ä¸€ä¸ª Block æ˜¯å¦ç©ºé—²ï¼Œå¹¶ä¸”åªéœ€å°†å½“å‰ Block å¤´éƒ¨ä¸­çš„å¤§å°å­—æ®µä¸ä¹‹ç›¸åŠ å³å¯å®Œæˆåˆå¹¶ã€‚</p>
<p>ä½†è‹¥è¦åˆå¹¶ä¸Šä¸€ä¸ª Blockï¼Œæˆ‘ä»¬åªèƒ½éå†æ•´ä¸ªé“¾è¡¨ï¼Œå¹¶åœ¨åˆ°è¾¾å½“å‰ Block å‰ä¸æ–­è®°ä¸‹ä¸Šä¸€ä¸ª Block çš„ä½ç½®ã€‚å› æ­¤å¯¹äºéšå¼ç©ºé—²é“¾è¡¨ï¼Œåˆå¹¶ä¸Šä¸€ä¸ª Block çš„æ—¶é—´ä¸å †å†…å­˜çš„å¤§å°æˆæ­£æ¯”ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ª Block æœ«å°¾éƒ½æ·»åŠ ä¸€ä¸ªå¤´éƒ¨çš„å‰¯æœ¬ä»¥ä½¿åˆå¹¶ Block çš„æ—¶é—´å˜ä¸ºå¸¸æ•°ï¼Œè¿™ç§æŠ€æœ¯è¢«ç§°ä¸ºè¾¹ç•Œæ ‡è®°ï¼ˆBoundary Tagsï¼‰ï¼š</p>
<p><img alt="alt text" src="../image/image-137.png" />
ä¸Šä¸€ä¸ª Block çš„å°¾éƒ¨å§‹ç»ˆä¸å½“å‰ Block çš„å¤´éƒ¨ç›¸è·ä¸€ä¸ªå­—é•¿ï¼Œå› æ­¤åˆ†é…å™¨å¯ä»¥é€šè¿‡æ£€æŸ¥ä¸Šä¸€ä¸ª Block çš„å°¾éƒ¨æ¥ç¡®å®šå…¶ä½ç½®å’ŒçŠ¶æ€ã€‚ä¸‹å›¾å±•ç¤ºäº†åˆ†é…å™¨æ˜¯å¦‚ä½•ä½¿ç”¨è¾¹ç•Œæ ‡è®°åˆå¹¶ Block çš„ï¼š</p>
<p><img alt="alt text" src="../image/image-138.png" />
ç”±äºæ¯ä¸ª Block éƒ½åŒ…å«å¤´éƒ¨å’Œå°¾éƒ¨ï¼Œå½“ Block æ•°é‡è¾ƒå¤šæ—¶ï¼Œè¾¹ç•Œæ ‡è®°æ˜¾è‘—åœ°å¢åŠ äº†å†…å­˜çš„å¼€é”€ã€‚è€ƒè™‘åˆ°åˆ†é…å™¨åªæœ‰åœ¨ä¸Šä¸€ä¸ª Block ç©ºé—²æ—¶æ‰éœ€è¦è·å–å…¶å°¾éƒ¨å†…çš„ Block å¤§å°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†ä¸Šä¸€ä¸ª Block çš„çŠ¶æ€å­˜å‚¨åœ¨å½“å‰ Block å¤´éƒ¨çš„å¤šä½™ä½ä½ä¸­ï¼Œè¿™æ ·å·²åˆ†é…çš„ Block ä¾¿ä¸éœ€è¦å°¾éƒ¨äº†ã€‚</p>
<h3 id="æ˜¾å¼ç©ºé—²é“¾è¡¨">æ˜¾å¼ç©ºé—²é“¾è¡¨<a class="headerlink" href="#æ˜¾å¼ç©ºé—²é“¾è¡¨" title="Permanent link">&para;</a></h3>
<p>ç”±äºåˆ†é… Block çš„æ—¶é—´ä¸ Block çš„æ€»æ•°æˆæ­£æ¯”ï¼Œéšå¼ç©ºé—²é“¾è¡¨ä¸é€‚ç”¨äºé€šç”¨åˆ†é…å™¨ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªç©ºé—² Block ä¸­åŠ å…¥ä¸€ä¸ªæŒ‡å‘ä¸Šä¸€ä¸ªç©ºé—² Block çš„å‰é©±ï¼ˆPredecessorï¼‰æŒ‡é’ˆå’Œä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªç©ºé—² Block çš„åç»§ï¼ˆSuccessorï¼‰æŒ‡é’ˆï¼Œè¿™æ ·å †çš„ç»„ç»‡ç»“æ„å°±å˜æˆäº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œæˆ‘ä»¬ç§°å…¶ä¸ºæ˜¾å¼ç©ºé—²é“¾è¡¨ï¼ˆExplicit Free Listï¼‰ã€‚
<img alt="alt text" src="../image/image-139.png" />
å¦‚æœé‡‡ç”¨ç¬¬ä¸€æ¬¡æ‹Ÿåˆç­–ç•¥ï¼Œæ˜¾å¼ç©ºé—²é“¾è¡¨åˆ†é… Block çš„æ—¶é—´ä¸ç©ºé—² Block çš„æ•°é‡æˆæ­£æ¯”ï¼Œè€Œé‡Šæ”¾ Block çš„æ—¶é—´åˆ™å–å†³äºç©ºé—² Block çš„æ’åºæ–¹å¼ï¼š</p>
<ul>
<li>åè¿›å…ˆå‡ºï¼ˆLast-in First-outï¼ŒLIFOï¼‰ï¼šå°†åˆšè¢«é‡Šæ”¾çš„ Block æ’å…¥åˆ°é“¾è¡¨å¼€å¤´ï¼Œå› æ­¤é‡Šæ”¾ Block çš„æ—¶é—´ä¸ºå¸¸æ•°ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è¾¹ç•Œæ ‡è®°ä½¿åˆå¹¶ Block çš„æ—¶é—´ä¹Ÿä¸ºå¸¸æ•°ï¼›</li>
<li>æŒ‰åœ°å€é¡ºåºï¼ˆAddress Orderï¼‰ï¼šä½¿é“¾è¡¨ä¸­æ¯ä¸ª Block çš„åœ°å€å‡å°äºå…¶åç»§ Block çš„åœ°å€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé‡Šæ”¾ Block éœ€è¦ä¸€å®šçš„æ—¶é—´æ¥å¯»æ‰¾åˆé€‚çš„ä½ç½®ï¼Œä½†å †å†…å­˜çš„åˆ©ç”¨ç‡æ¯”åè¿›å…ˆå‡ºé«˜ã€‚</li>
</ul>
<p>æ˜¾å¼ç©ºé—²é“¾è¡¨çš„ç¼ºç‚¹åœ¨äºæŒ‡é’ˆçš„å¼•å…¥å¢åŠ äº†ç©ºé—² Block çš„å¤§å°ï¼Œè¿™å°†å¢å¤§å†…éƒ¨ç¢ç‰‡å‘ç”Ÿçš„å¯èƒ½æ€§ã€‚</p>
<h3 id="åˆ†ç¦»å¼ç©ºé—²é“¾è¡¨">åˆ†ç¦»å¼ç©ºé—²é“¾è¡¨<a class="headerlink" href="#åˆ†ç¦»å¼ç©ºé—²é“¾è¡¨" title="Permanent link">&para;</a></h3>
<p>æˆ‘ä»¬å¯ä»¥å°†å †ç»„ç»‡æˆå¤šä¸ªç©ºé—²é“¾è¡¨ï¼Œæ¯ä¸ªé“¾è¡¨ä¸­ Block çš„å¤§å°éƒ½å¤§è‡´ç›¸åŒï¼Œè¿™ç§ç»“æ„è¢«ç§°ä¸ºåˆ†ç¦»å¼ç©ºé—²é“¾è¡¨ï¼ˆSegregated Free Listï¼‰ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç»“æ„ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ Block çš„å¤§å°åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç±»ï¼ˆSize Classï¼‰ï¼Œå¦‚ï¼š</p>
<div class="arithmatex">\[\lbrace1\rbrace, \lbrace2\rbrace, \lbrace3, 4\rbrace, \lbrace5â€“8\rbrace,..., \lbrace1025â€“2048\rbrace, \lbrace2049â€“4096\rbrace, \lbrace4097â€“âˆ\rbrace\]</div>
<p>ä¹Ÿå¯ä»¥è®©æ¯ä¸ªè¾ƒå°çš„ Block ç‹¬è‡ªæˆä¸ºä¸€ä¸ªå¤§å°ç±»ï¼Œè¾ƒå¤§çš„ Block ä¾ç„¶æŒ‰ 2 çš„å¹‚åˆ’åˆ†ï¼š</p>
<div class="arithmatex">\[\lbrace1\rbrace, \lbrace2\rbrace, \lbrace3\rbrace,..., \lbrace1024\rbrace, \lbrace1025â€“2048\rbrace, \lbrace2049â€“4096\rbrace, \lbrace4097â€“âˆ\rbrace\]</div>
<p>æ¯ä¸ªç©ºé—²é“¾è¡¨éƒ½å±äºæŸä¸ªå¤§å°ç±»ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†å †çœ‹æˆä¸€ä¸ªæŒ‰å¤§å°ç±»é€’å¢çš„ç©ºé—²é“¾è¡¨æ•°ç»„ã€‚å½“è¿›ç¨‹è¯·æ±‚ä¸€ä¸ª Block æ—¶ï¼Œåˆ†é…å™¨ä¼šæ ¹æ®å…¶å¤§å°åœ¨é€‚å½“çš„ç©ºé—²é“¾è¡¨ä¸­æœç´¢ã€‚å¦‚æœæ‰¾ä¸åˆ°æ»¡è¶³è¦æ±‚çš„ Blockï¼Œå®ƒä¾¿ä¼šç»§ç»­æœç´¢ä¸‹ä¸€ä¸ªé“¾è¡¨ã€‚</p>
<p>ä¸åŒçš„åˆ†ç¦»å¼ç©ºé—²é“¾è¡¨åœ¨å®šä¹‰å¤§å°ç±»çš„æ–¹å¼ã€åˆå¹¶ Block çš„æ—¶æœºä»¥åŠæ˜¯å¦å…è®¸åˆ†å‰² Block ç­‰æ–¹é¢æœ‰æ‰€ä¸åŒï¼Œå…¶ä¸­æœ€åŸºæœ¬çš„ä¸¤ç§ç±»å‹ä¸ºç®€å•åˆ†ç¦»å­˜å‚¨ï¼ˆSimple Segregated Storageï¼‰å’Œåˆ†ç¦»æ‹Ÿåˆï¼ˆSegregated Fitsï¼‰ã€‚</p>
<p>åœ¨ç®€å•åˆ†ç¦»å­˜å‚¨ä¸­ï¼Œç©ºé—²é“¾è¡¨å†…æ¯ä¸ª Block çš„å¤§å°å‡ç­‰äºå…¶æ‰€å±å¤§å°ç±»ä¸­æœ€å¤§çš„å…ƒç´ ã€‚å¦‚æŸä¸ªå¤§å°ç±»ä¸º {17-32}ï¼Œåˆ™å…¶å¯¹åº”çš„ç©ºé—²é“¾è¡¨ä¸­ Block çš„å¤§å°éƒ½æ˜¯ 32ã€‚</p>
<p>å½“è¿›ç¨‹è¯·æ±‚ä¸€ä¸ª Block æ—¶ï¼Œåˆ†é…å™¨é€‰å–æ»¡è¶³è¯·æ±‚çš„ç©ºé—²é“¾è¡¨å¹¶åˆ†é…å…¶ä¸­ç¬¬ä¸€ä¸ª Blockï¼›å½“æŸä¸ª Block è¢«é‡Šæ”¾åï¼Œåˆ†é…å™¨å°†å…¶æ’å…¥åˆ°åˆé€‚çš„ç©ºé—²é“¾è¡¨å‰é¢ã€‚å› æ­¤ï¼Œç®€å•åˆ†ç¦»å­˜å‚¨åˆ†é…å’Œé‡Šæ”¾ Block çš„æ—¶é—´å‡ä¸ºå¸¸é‡ã€‚</p>
<p>ä½¿ç”¨åˆ†ç¦»å¼ç©ºé—²é“¾è¡¨çš„åˆ†é…å™¨åªä¼šåœ¨å †ä¸­æŸä¸ªç‰¹å®šéƒ¨åˆ†æœç´¢ç©ºé—² Blockï¼Œå› æ­¤å…¶ååé‡è¾ƒå¤§ï¼›å¯¹åˆ†ç¦»å¼ç©ºé—²é“¾è¡¨ä½¿ç”¨ç¬¬ä¸€æ¬¡æ‹Ÿåˆçš„å†…å­˜åˆ©ç”¨ç‡ä¸å¯¹æ•´ä¸ªå †ä½¿ç”¨æœ€ä½³æ‹Ÿåˆçš„å†…å­˜åˆ©ç”¨ç‡è¿‘ä¼¼ï¼Œå› æ­¤å…¶å†…å­˜åˆ©ç”¨ç‡è¾ƒé«˜ã€‚å¤§å¤šæ•°é«˜æ€§èƒ½çš„åˆ†é…å™¨å‡é‡‡ç”¨åˆ†ç¦»å¼ç©ºé—²é“¾è¡¨ï¼Œå¦‚ C æ ‡å‡†åº“æä¾›çš„ GNU <code>malloc</code>ã€‚</p>
<h2 id="åƒåœ¾å›æ”¶">åƒåœ¾å›æ”¶<a class="headerlink" href="#åƒåœ¾å›æ”¶" title="Permanent link">&para;</a></h2>
<p>åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰æ˜¯ä¸€ç§åŠ¨æ€å­˜å‚¨åˆ†é…å™¨ï¼Œå®ƒä¼šè‡ªåŠ¨é‡Šæ”¾ç¨‹åºä¸å†éœ€è¦çš„ Blockï¼ˆåƒåœ¾ï¼‰ã€‚</p>
<h3 id="åŸºæœ¬æ€æƒ³">åŸºæœ¬æ€æƒ³<a class="headerlink" href="#åŸºæœ¬æ€æƒ³" title="Permanent link">&para;</a></h3>
<p>åƒåœ¾å›æ”¶å™¨å°†å†…å­˜çœ‹ä½œä¸€ä¸ªæœ‰å‘å¯è¾¾æ€§å›¾ï¼š</p>
<p><img alt="alt text" src="../image/image-140.png" />
å›¾ä¸­çš„èŠ‚ç‚¹è¢«åˆ†ä¸ºä¸€ç»„æ ¹èŠ‚ç‚¹ï¼ˆRoot Nodesï¼‰å’Œä¸€ç»„å †èŠ‚ç‚¹ï¼ˆHeap Nodesï¼‰ï¼Œæ¯ä¸ªå †èŠ‚ç‚¹éƒ½å¯¹åº”äºä¸€ä¸ªå †ä¸­å·²åˆ†é…çš„ Blockã€‚æœ‰å‘è¾¹ <span class="arithmatex">\(p \to q\)</span> è¡¨ç¤º Block <span class="arithmatex">\(p\)</span> ä¸­çš„æŸä¸ªä½ç½®æŒ‡å‘ Block <span class="arithmatex">\(q\)</span> ä¸­çš„æŸä¸ªä½ç½®ã€‚æ ¹èŠ‚ç‚¹å¯¹åº”äºä¸åœ¨å †ä¸­å´åŒ…å«äº†æŒ‡å‘å †çš„æŒ‡é’ˆçš„ä½ç½®ï¼Œè¿™äº›ä½ç½®å¯ä»¥æ˜¯å¯„å­˜å™¨ã€æ ˆä¸­çš„å˜é‡æˆ–å¯è¯»å†™æ•°æ®åŒºåŸŸä¸­çš„å…¨å±€å˜é‡ã€‚</p>
<p>å¦‚æœæ ¹èŠ‚ç‚¹ä¸å †èŠ‚ç‚¹ä¹‹é—´å­˜åœ¨ä¸€æ¡æœ‰å‘è·¯å¾„ï¼Œæˆ‘ä»¬å°±ç§°è¯¥å †èŠ‚ç‚¹æ˜¯å¯è¾¾çš„ï¼ˆReachableï¼‰ã€‚åœ¨ä»»ä½•æ—¶åˆ»ï¼Œä¸å¯è¾¾çš„èŠ‚ç‚¹éƒ½ä¸ç¨‹åºä¸å†ä½¿ç”¨çš„ Block å¯¹åº”ã€‚åƒåœ¾å›æ”¶å™¨å®šæœŸé‡Šæ”¾ä¸å¯è¾¾èŠ‚ç‚¹å¹¶å°†å…¶è¿”å›åˆ°ç©ºé—²é“¾è¡¨ã€‚</p>
<p>ML å’Œ Java ç­‰è¯­è¨€çš„åƒåœ¾å›æ”¶å™¨å¯¹åº”ç”¨ç¨‹åºä½¿ç”¨æŒ‡é’ˆçš„æ–¹å¼è¿›è¡Œäº†ä¸¥æ ¼çš„é™åˆ¶ï¼Œå› æ­¤å®ƒå¯ä»¥ç»´æŠ¤ä¸€ä¸ªç²¾ç¡®çš„å¯è¾¾æ€§å›¾ï¼Œä»è€Œå›æ”¶æ‰€æœ‰çš„åƒåœ¾ã€‚è€Œ C å’Œ C++ ç­‰è¯­è¨€çš„åƒåœ¾å›æ”¶å™¨åˆ™æ— æ³•ä¿è¯å¯è¾¾æ€§å›¾çš„ç²¾ç¡®æ€§ï¼Œä¸€äº›ä¸å¯è¾¾çš„èŠ‚ç‚¹å¯èƒ½è¢«é”™è¯¯åœ°è¯†åˆ«ä¸ºå¯è¾¾çš„ï¼Œæˆ‘ä»¬ç§°å…¶ä¸ºä¿å®ˆåƒåœ¾å›æ”¶å™¨ï¼ˆConservative Garbage Collectorï¼‰ã€‚</p>
<p>åƒåœ¾å›æ”¶å™¨å¯ä»¥æŒ‰éœ€æä¾›æœåŠ¡ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå•ç‹¬çš„è¿›ç¨‹ä¸åº”ç”¨ç¨‹åºå¹¶è¡Œè¿è¡Œï¼Œä¸æ–­æ›´æ–°å¯è¾¾æ€§å›¾å¹¶å›æ”¶åƒåœ¾ï¼š</p>
<p><img alt="alt text" src="../image/image-141.png" /></p>
<h3 id="marksweep-ç®—æ³•">Mark&amp;Sweep ç®—æ³•<a class="headerlink" href="#marksweep-ç®—æ³•" title="Permanent link">&para;</a></h3>
<p>Mark&amp;Sweep æ˜¯å¸¸ç”¨çš„åƒåœ¾å›æ”¶ç®—æ³•ä¹‹ä¸€ï¼Œå®ƒåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>æ ‡è®°ï¼ˆMarkï¼‰é˜¶æ®µï¼šæ ‡è®°æ‰€æœ‰å¯è¾¾çš„æ ¹èŠ‚ç‚¹åä»£ã€‚é€šå¸¸æˆ‘ä»¬å°† Block å¤´éƒ¨çš„å¤šä½™ä½ä½ä¹‹ä¸€ç”¨äºæŒ‡ç¤ºè¯¥ Block æ˜¯å¦è¢«æ ‡è®°ï¼›</li>
<li>æ¸…é™¤ï¼ˆSweepï¼‰é˜¶æ®µï¼šé‡Šæ”¾æ‰€æœ‰æœªæ ‡è®°ä¸”å·²åˆ†é…çš„ Blockã€‚</li>
</ul>
<p>ä¸ºäº†æ›´å¥½åœ°ç†è§£ Mark&amp;Sweep ç®—æ³•ï¼Œæˆ‘ä»¬ä½œå‡ºä»¥ä¸‹å‡è®¾ï¼š</p>
<ul>
<li><code>ptr</code>ï¼šç”±<code>typedef void *ptr</code>å®šä¹‰çš„ç±»å‹ï¼›</li>
<li><code>ptr isPtr(ptr p)</code>ï¼šè‹¥<code>p</code>æŒ‡å‘å·²åˆ†é… Block ä¸­çš„æŸä¸ªå­—ï¼Œåˆ™è¿”å›æŒ‡å‘è¯¥ Block èµ·å§‹ä½ç½®çš„æŒ‡é’ˆ<code>b</code>ï¼Œå¦åˆ™è¿”å›<code>NULL</code>ï¼›</li>
<li><code>int blockMarked(ptr b)</code>ï¼šå¦‚æœè¯¥ Block å·²è¢«æ ‡è®°åˆ™è¿”å›<code>true</code>ï¼›</li>
<li><code>int blockAllocated(ptr b)</code>ï¼šå¦‚æœè¯¥ Block å·²åˆ†é…åˆ™è¿”å›<code>true</code>ï¼›</li>
<li><code>void markBlock(ptr b)</code>ï¼šæ ‡è®° Blockï¼›</li>
<li><code>int length(ptr b)</code>ï¼šè¿”å› Block é™¤å¤´éƒ¨å¤–çš„å­—é•¿ï¼›</li>
<li><code>void unmarkBlock(ptr b)</code>ï¼šå°† Block çš„çŠ¶æ€ä»å·²æ ‡è®°è½¬æ¢ä¸ºæœªæ ‡è®°ï¼›</li>
<li><code>ptr nextBlock(ptr b)</code>ï¼šè¿”å›æŒ‡å‘ä¸‹ä¸€ä¸ª Block çš„æŒ‡é’ˆã€‚</li>
</ul>
<p>é‚£ä¹ˆæ­¤ç®—æ³•å°±å¯ä»¥ç”¨ä¸‹å›¾ä¸­çš„ä¼ªç è¡¨ç¤ºï¼š</p>
<p><img alt="alt text" src="../image/image-142.png" />
åœ¨æ ‡è®°é˜¶æ®µï¼Œåƒåœ¾å›æ”¶å™¨ä¸ºæ¯ä¸ªæ ¹èŠ‚ç‚¹è°ƒç”¨ä¸€æ¬¡<code>mark</code>å‡½æ•°ã€‚è‹¥<code>p</code>æœªæŒ‡å‘å·²åˆ†é…ä¸”æœªæ ‡è®°çš„ Blockï¼Œåˆ™è¯¥å‡½æ•°ç›´æ¥è¿”å›ã€‚å¦åˆ™ï¼Œå®ƒæ ‡è®°è¯¥ Block å¹¶å°†å…¶ä¸­çš„æ¯ä¸ªå­—ä½œä¸ºå‚æ•°é€’å½’åœ°è°ƒç”¨è‡ªèº«ï¼ˆ<code>mark(b[i])</code>ï¼‰ã€‚æ­¤é˜¶æ®µç»“æŸæ—¶ï¼Œä»»ä½•æœªæ ‡è®°ä¸”å·²åˆ†é…çš„ Block éƒ½æ˜¯ä¸å¯è¾¾çš„ï¼›åœ¨æ‰«æé˜¶æ®µï¼Œåƒåœ¾å›æ”¶å™¨åªè°ƒç”¨ä¸€æ¬¡<code>sweep</code>å‡½æ•°ã€‚è¯¥å‡½æ•°éå†å †ä¸­çš„æ¯ä¸€ä¸ª Blockï¼Œé‡Šæ”¾æ‰€æœ‰å·²åˆ†é…ä¸”æœªæ ‡è®°çš„ Blockã€‚</p>
<p><img alt="alt text" src="../image/image-143.png" />
ä¸Šå›¾ä¸­çš„æ¯ä¸ªæ–¹æ¡†ä»£è¡¨ä¸€ä¸ªå­—ï¼Œæ¯ä¸ªè¢«ç²—çº¿åˆ†éš”çš„çŸ©å½¢ä»£è¡¨ä¸€ä¸ª Blockï¼Œè€Œæ¯ä¸ª Block éƒ½æœ‰ä¸€ä¸ªå•å­—çš„å¤´éƒ¨ã€‚æœ€åˆï¼Œå †ä¸­æœ‰ 6 ä¸ªå·²åˆ†é…ä¸”æœªæ ‡è®°çš„ Blockã€‚Block 3 ä¸­åŒ…å«æŒ‡å‘ Block 1 çš„æŒ‡é’ˆï¼ŒBlock 4 ä¸­åŒ…å«æŒ‡å‘ Block 3 å’Œ 6 çš„æŒ‡é’ˆã€‚æ ¹èŠ‚ç‚¹æŒ‡å‘ Block 4ï¼Œå› æ­¤ Block 1ã€3ã€4 å’Œ 6 ä»æ ¹èŠ‚ç‚¹å¯è¾¾ï¼Œå®ƒä»¬ä¼šè¢«åƒåœ¾å›æ”¶å™¨æ ‡è®°ã€‚åœ¨æ‰«æé˜¶æ®µå®Œæˆåï¼Œå‰©ä½™ä¸å¯è¾¾çš„ Block 2 å’Œ 5 å°†è¢«é‡Šæ”¾ã€‚</p>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="æœ€åæ›´æ–°">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-08-09T13:17:58+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-08-09</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="åˆ›å»ºæ—¥æœŸ">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-08-09T13:17:58+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-08-09</span>
  </span>

    
    
    
  </aside>


  



<div id="__comments">

<h3>é¢œè‰²ä¸»é¢˜è°ƒæ•´</h3>

<!-- <div class="tx-switch">
<button data-md-color-scheme="default"><code>default</code></button>
<button data-md-color-scheme="slate"><code>slate</code></button>
</div>

<script>
var buttons = document.querySelectorAll("button[data-md-color-scheme]")
buttons.forEach(function(button) {
        button.addEventListener("click", function() {
        var attr = this.getAttribute("data-md-color-scheme")
        document.body.setAttribute("data-md-color-scheme", attr)
        localStorage.setItem("data-md-color-scheme",attr);
        updateScheme();
        })
})
</script> -->

<div class="tx-switch">
<button class="button1" data-md-color-primary="red" style="background-color:red">red</button>
<button class="button1" data-md-color-primary="pink" style="background-color:pink;color:black">pink</button>
<button class="button1" data-md-color-primary="purple" style="background-color:purple">purple</button>
<button class="button1" data-md-color-primary="indigo" style="background-color:indigo">indigo</button>
<button class="button1" data-md-color-primary="blue" style="background-color:blue">blue</button>
<button class="button1" data-md-color-primary="cyan" style="background-color:cyan;color:black">cyan</button>
<button class="button1" data-md-color-primary="teal" style="background-color:teal">teal</button>
<button class="button1" data-md-color-primary="green" style="background-color:green">green</button>
<button class="button1" data-md-color-primary="lime" style="background-color:lime;color:black">lime</button>
<button class="button1" data-md-color-primary="orange" style="background-color:orange;color:black">orange</button>
<button class="button1" data-md-color-primary="brown" style="background-color:brown;border-radius=3px">brown</button>
<button class="button1" data-md-color-primary="grey" style="background-color:grey">grey</button>
<button class="button1" data-md-color-primary="black" style="background-color:black">black</button>
<button class="button1" data-md-color-primary="white" style="background-color:white;color:black">white</button>
</div>

<script>
var buttons = document.querySelectorAll("button[data-md-color-primary]")
buttons.forEach(function(button) {
        button.addEventListener("click", function() {
        var attr = this.getAttribute("data-md-color-primary")
        document.body.setAttribute("data-md-color-primary", attr)
        localStorage.setItem("data-md-color-primary",attr);
        })
})
</script>

<h2 ><!-- è¯„è®º -->è¯„è®ºåŒº~</h2>

æœ‰ç”¨çš„è¯è¯·ç»™æˆ‘ä¸ªèµå’Œ star => <a href="https://github.com/Tangjp-wraith/Tangjp-wraith.github.io"><img alt="GitHub stars" src="https://img.shields.io/github/stars/Tangjp-wraith/Tangjp-wraith.github.io.svg?style=plastic&amp;label=Stars"></a>

</br>

å¿«æ¥è·Ÿæˆ‘èŠå¤©~

</div>

<script src="https://giscus.app/client.js" data-repo="Tangjp-wraith/discussion" data-repo-id="R_kgDOLRJCPw"
    data-category="General" data-category-id="DIC_kwDOLRJCP84CdJdO" data-mapping="pathname" data-strict="0"
    data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="dark" data-lang="zh-CN"
    crossorigin="anonymous" async>
    </script>

<!-- Synchronize Giscus theme with palette -->
<script>
var giscus = document.querySelector("script[src*=giscus]")

/* Set palette on initial load */
var palette = __md_get("__palette")
if (palette && typeof palette.color === "object") {
    var theme = palette.color.scheme === "slate" ? "dark" : "light"
    giscus.setAttribute("data-theme", theme) 
}

/* Register event handlers after documented loaded */
document.addEventListener("DOMContentLoaded", function() {
    var ref = document.querySelector("[data-md-component=palette]")
    ref.addEventListener("change", function() {
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
        var theme = palette.color.scheme === "slate" ? "dark" : "light"
        localStorage.setItem("data-md-color-scheme", palette.color.scheme === "slate" ? "slate" : "default");
        /* Instruct Giscus to change theme */
        var frame = document.querySelector(".giscus-frame")
        frame.contentWindow.postMessage(
        { giscus: { setConfig: { theme } } },
        "https://giscus.app"
        )
    }
    })
})
</script>
                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  å›åˆ°é¡µé¢é¡¶éƒ¨
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      æœ¬é¡µé¢çš„å…¨éƒ¨å†…å®¹åœ¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh">CC BY-SA 4.0</a> å’Œ <a href="https://github.com/zTrix/sata-license">SATA</a> åè®®ä¹‹æ¡æ¬¾ä¸‹æä¾›ï¼Œé™„åŠ æ¡æ¬¾äº¦å¯èƒ½åº”ç”¨
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "content.code.annotate", "navigation.indexes", "navigation.top", "toc.follow"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="../../../js/timeago.min.js"></script>
      
        <script src="../../../js/timeago_mkdocs_material.js"></script>
      
        <script src="../../../from_oi_wiki/js/extra.js"></script>
      
        <script src="../../../js/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../../js/tablesort.js"></script>
      
        <script src="../../../termynal.js"></script>
      
    
  </body>
</html>